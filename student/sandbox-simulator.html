<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta viewport="width=device-width, initial-scale=1.0">
    <title>Sandbox Virtual Simulator - DisasterSafe</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #0d47a1;
            --secondary: #34a853;
            --accent: #f25c54;
            --warning: #f9a825;
            --card-bg: #ffffff;
            --text-dark: #202124;
            --light-bg: #f5f7fb;

            /* user palette to use across cards/overlays */
            --p1: #309ad4;
            --p2: #e69c42;
            --p3: #ea8d99;
            --p4: #faafa4;
            --p5: #e2afd3;
            --p6: #c8e5f3;
            --p7: #fae8c7;

            --shadow: 0 8px 20px rgba(18, 38, 63, 0.08);
            --transition: all 0.25s ease;
            --glass: rgba(255, 255, 255, 0.72);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Prevent horizontal scrolling */
        html {
            overflow-x: hidden;
        }

        /* Ensure all containers respect max width */
        .container, .main-content, .dashboard-container {
            max-width: 100%;
            box-sizing: border-box;
        }
        
        /* Prevent horizontal overflow for all elements */
        * {
            max-width: 100%;
            box-sizing: border-box;
        }

        /* Text wrapping for long content */
        h1, h2, h3, h4, h5, h6, p {
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        /* Responsive images and media */
        img, video, canvas {
            max-width: 100%;
            height: auto;
        }

        body {
            background: var(--light-bg);
            color: var(--text-dark);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-family: "Ubuntu", sans-serif;
            font-weight: 400;
            font-style: normal;
            overflow-x: hidden;
        }

        /* Layout */
        .dashboard-container {
            display: grid;
            grid-template-columns: 240px 1fr;
            min-height: 100vh;
            max-width: 100vw;
            width: 100%;
        }

        .sidebar {
            background: linear-gradient(180deg, var(--primary), var(--primary-dark));
            color: #fff;
            padding: 22px;
            position: fixed;
            width: 240px;
            height: 100%;
            overflow-y: auto;
            box-shadow: var(--shadow);
            z-index: 200;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06)
        }

        .logo i {
            font-size: 22px;
            color: var(--p6)
        }

        .logo h1 {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 0.2px
        }

        .menu-items {
            margin-top: 18px;
            display: flex;
            flex-direction: column;
            gap: 8px
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            color: rgba(255, 255, 255, 0.95)
        }

        .menu-item i {
            width: 20px;
            text-align: center
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.06)
        }

        .menu-item.active {
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.14), rgba(255, 255, 255, 0.06));
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08)
        }

        /* Sidebar User Profile */
        .sidebar-user-profile {
            margin-top: auto;
            padding: 12px;
            margin: 0 -12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: var(--transition);
            cursor: pointer;
        }

        .sidebar-user-profile:hover {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--p6), var(--p1));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 700;
            color: var(--primary-dark);
            text-transform: uppercase;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .user-info {
            flex: 1;
            min-width: 0;
        }

        .user-info h4 {
            font-size: 14px;
            font-weight: 600;
            color: white;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-info p {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            margin: 0;
        }

        /* Main content */
        .main-content {
            grid-column: 2;
            padding: 20px;
            min-height: 100vh;
            max-width: calc(100vw - 240px);
            overflow-x: hidden;
            width: 100%;
            box-sizing: border-box;
        }

        .header-section {
            text-align: center;
            margin-bottom: 50px;
            color: var(--text-dark);
        }

        .header-section h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            font-weight: 700;
            color: var(--primary);
        }

        .header-section p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: #666;
        }

        .purpose-statement {
            margin-top: 40px;
        }

        .purpose-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 30px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .purpose-item {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px 20px;
            text-align: center;
            transition: var(--transition);
            border: 1px solid rgba(16, 24, 32, 0.03);
            box-shadow: var(--shadow);
        }

        .purpose-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
        }

        .purpose-item i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--p1);
        }

        .purpose-item h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .purpose-item p {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }

        .simulators-library {
            margin-bottom: 50px;
            max-width: 100%;
            overflow-x: hidden;
        }

        .library-header {
            text-align: center;
            margin-bottom: 40px;
            color: var(--text-dark);
        }

        .library-header h2 {
            font-size: 2.2rem;
            margin-bottom: 15px;
            font-weight: 600;
            color: var(--primary);
        }

        .library-header p {
            font-size: 1.1rem;
            color: #666;
        }

        .simulators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
            max-width: 100%;
        }

        .simulator-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 18px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(16, 24, 32, 0.03);
            position: relative;
            overflow: hidden;
            max-width: 100%;
            width: 100%;
            box-sizing: border-box;
        }

        .simulator-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: var(--transition);
        }

        .simulator-card:hover::before {
            opacity: 1;
        }

        .simulator-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .simulator-card.featured {
            border-color: rgba(26, 115, 232, 0.3);
        }

        .simulator-card.featured::before {
            opacity: 1;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
        }

        .card-icon.ar {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .card-icon.vr {
            background: linear-gradient(135deg, #f093fb, #f5576c);
        }

        .card-icon.strategy {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
        }

        .card-icon.community {
            background: linear-gradient(135deg, #43e97b, #38f9d7);
        }

        .card-badge {
            background: var(--primary);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .card-content h3 {
            font-size: 1.3rem;
            margin-bottom: 12px;
            color: var(--text-dark);
            font-weight: 600;
        }

        .card-content p {
            color: #666;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .card-features {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .card-features span {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            color: #555;
        }

        .card-features i {
            margin-right: 8px;
            color: var(--primary);
            width: 16px;
        }

        .card-footer {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid #e0e0e0;
            padding-top: 15px;
        }

        .difficulty-indicator {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            color: #666;
        }

        .difficulty-indicator span {
            margin-right: 8px;
        }

        .difficulty-dots {
            display: flex;
            gap: 4px;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ddd;
            transition: var(--transition);
        }

        .dot.active {
            background: var(--warning);
        }

        .launch-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .launch-btn:hover {
            background: var(--p1);
            transform: translateY(-2px);
        }

        .quick-start-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid rgba(16, 24, 32, 0.03);
        }

        .quick-start-section h3 {
            margin-bottom: 25px;
            color: var(--primary);
            font-size: 1.4rem;
        }

        .quick-start-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .quick-btn {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 15px 25px;
            border-radius: 15px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            min-width: 120px;
        }

        .quick-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
        }

        .quick-btn i {
            font-size: 1.5rem;
        }

        .quick-btn span {
            font-weight: 500;
            font-size: 0.9rem;
        }

        /* Progress & Feedback System Styles */
        .progress-feedback-section {
            margin-bottom: 50px;
            max-width: 100%;
            overflow-x: hidden;
        }

        .section-header {
            text-align: center;
            margin-bottom: 40px;
            color: var(--text-dark);
        }

        .section-header h2 {
            font-size: 2.2rem;
            margin-bottom: 15px;
            font-weight: 600;
            color: var(--primary);
        }

        .section-header p {
            font-size: 1.1rem;
            color: #666;
        }

        .progress-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
            max-width: 100%;
        }

        .performance-summary,
        .skill-badges {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(16, 24, 32, 0.03);
        }

        .performance-summary h3,
        .skill-badges h3 {
            margin-bottom: 25px;
            color: var(--primary);
            font-size: 1.4rem;
            border-bottom: 2px solid rgba(26, 115, 232, 0.2);
            padding-bottom: 10px;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .stat-card {
            display: flex;
            align-items: center;
            padding: 20px;
            border-radius: 15px;
            background: linear-gradient(135deg, rgba(26, 115, 232, 0.1), rgba(26, 115, 232, 0.05));
            border: 1px solid rgba(26, 115, 232, 0.2);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.2rem;
        }

        .stat-info {
            display: flex;
            flex-direction: column;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            line-height: 1;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .badges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .badge-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 15px;
            border-radius: 15px;
            text-align: center;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .badge-item.earned {
            background: linear-gradient(135deg, rgba(52, 168, 83, 0.1), rgba(52, 168, 83, 0.05));
            border-color: rgba(52, 168, 83, 0.3);
        }

        .badge-item.locked {
            background: rgba(224, 224, 224, 0.1);
            border-color: rgba(224, 224, 224, 0.3);
            opacity: 0.7;
        }

        .badge-item:hover {
            transform: translateY(-3px);
        }

        .badge-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            color: white;
            font-size: 1.3rem;
        }

        .badge-icon.triage {
            background: linear-gradient(135deg, #e91e63, #ad1457);
        }

        .badge-icon.evacuation {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .badge-icon.communication {
            background: linear-gradient(135deg, #2196f3, #1565c0);
        }

        .badge-icon.rescue {
            background: linear-gradient(135deg, #4caf50, #2e7d32);
        }

        .badge-icon.leadership {
            background: linear-gradient(135deg, #ffc107, #f57f17);
        }

        .badge-icon.planning {
            background: linear-gradient(135deg, #9c27b0, #6a1b9a);
        }

        .badge-name {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .badge-date {
            font-size: 0.8rem;
            color: var(--secondary);
        }

        .badge-requirement {
            font-size: 0.8rem;
            color: #666;
            text-align: center;
            line-height: 1.3;
        }

        .improvement-feedback {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 40px;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }

        .improvement-feedback h3 {
            margin-bottom: 25px;
            color: var(--primary);
            font-size: 1.4rem;
            border-bottom: 2px solid rgba(26, 115, 232, 0.2);
            padding-bottom: 10px;
        }

        .feedback-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .feedback-card {
            display: flex;
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid;
        }

        .feedback-card.warning {
            background: rgba(249, 168, 37, 0.1);
            border-color: var(--warning);
        }

        .feedback-card.success {
            background: rgba(52, 168, 83, 0.1);
            border-color: var(--secondary);
        }

        .feedback-card.info {
            background: rgba(26, 115, 232, 0.1);
            border-color: var(--primary);
        }

        .feedback-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .feedback-card.warning .feedback-icon {
            background: var(--warning);
            color: white;
        }

        .feedback-card.success .feedback-icon {
            background: var(--secondary);
            color: white;
        }

        .feedback-card.info .feedback-icon {
            background: var(--primary);
            color: white;
        }

        .feedback-content h4 {
            margin-bottom: 10px;
            color: var(--dark);
            font-size: 1.1rem;
        }

        .feedback-content p {
            color: #666;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .feedback-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .action-btn:hover {
            background: var(--primary);
            color: white;
        }

        .recent-sessions {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(16, 24, 32, 0.03);
        }

        .recent-sessions h3 {
            margin-bottom: 25px;
            color: var(--primary);
            font-size: 1.4rem;
            border-bottom: 2px solid rgba(26, 115, 232, 0.2);
            padding-bottom: 10px;
        }

        .sessions-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .session-item {
            display: flex;
            align-items: center;
            padding: 20px;
            border-radius: 15px;
            background: rgba(26, 115, 232, 0.05);
            border: 1px solid rgba(26, 115, 232, 0.1);
            transition: var(--transition);
        }

        .session-item:hover {
            background: rgba(26, 115, 232, 0.1);
            transform: translateY(-2px);
        }

        .session-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            color: white;
            font-size: 1.3rem;
        }

        .session-icon.flood {
            background: linear-gradient(135deg, #2196f3, #1976d2);
        }

        .session-icon.fire {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        .session-icon.earthquake {
            background: linear-gradient(135deg, #795548, #5d4037);
        }

        .session-info {
            flex: 1;
        }

        .session-info h4 {
            margin-bottom: 5px;
            color: var(--dark);
            font-size: 1.1rem;
        }

        .session-info p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .session-metrics {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .metric {
            display: flex;
            align-items: center;
            font-size: 0.8rem;
            color: #555;
        }

        .metric i {
            margin-right: 5px;
            color: var(--primary);
        }

        .session-actions {
            display: flex;
            gap: 10px;
        }

        .review-btn,
        .replay-btn {
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .review-btn {
            background: var(--primary);
            color: white;
            border: none;
        }

        .replay-btn {
            background: transparent;
            color: var(--secondary);
            border: 2px solid var(--secondary);
        }

        .review-btn:hover {
            background: var(--primary-dark);
        }

        .replay-btn:hover {
            background: var(--secondary);
            color: white;
        }

        /* Navigation Actions Styles */
        .navigation-actions {
            margin-bottom: 50px;
            max-width: 100%;
            overflow-x: hidden;
        }

        .nav-actions-header {
            text-align: center;
            margin-bottom: 40px;
            color: var(--text-dark);
        }

        .nav-actions-header h3 {
            font-size: 2rem;
            margin-bottom: 15px;
            font-weight: 600;
            color: var(--primary);
        }

        .nav-actions-header p {
            font-size: 1.1rem;
            color: #666;
        }

        .action-recommendations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .recommendation-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: flex-start;
            gap: 20px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }

        .recommendation-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            opacity: 0.8;
        }

        .recommendation-card.needs-review::before {
            background: linear-gradient(90deg, var(--warning), #ffa726);
        }

        .recommendation-card.celebration::before {
            background: linear-gradient(90deg, var(--secondary), #66bb6a);
        }

        .recommendation-card.practice::before {
            background: linear-gradient(90deg, var(--primary), var(--p1));
        }

        .recommendation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .rec-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .needs-review .rec-icon {
            background: linear-gradient(135deg, var(--warning), #ffa726);
        }

        .celebration .rec-icon {
            background: linear-gradient(135deg, var(--secondary), #66bb6a);
        }

        .practice .rec-icon {
            background: linear-gradient(135deg, var(--primary), var(--p1));
        }

        .rec-content {
            flex: 1;
        }

        .rec-content h4 {
            margin-bottom: 10px;
            color: var(--text-dark);
            font-size: 1.2rem;
            font-weight: 600;
        }

        .rec-content p {
            color: #666;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .rec-tags,
        .rec-rewards,
        .rec-suggestions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .tag,
        .reward,
        .suggestion {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .tag {
            background: rgba(249, 168, 37, 0.2);
            color: var(--warning);
        }

        .reward {
            background: rgba(52, 168, 83, 0.2);
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .suggestion {
            background: rgba(26, 115, 232, 0.2);
            color: var(--primary);
        }

        .rec-action {
            align-self: flex-end;
        }

        .cta-btn {
            padding: 12px 20px;
            border-radius: 25px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .cta-btn.review {
            background: var(--warning);
            color: white;
        }

        .cta-btn.rewards {
            background: var(--secondary);
            color: white;
        }

        .cta-btn.practice {
            background: var(--primary);
            color: white;
        }

        .cta-btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.1);
        }

        /* Responsive Design Updates */
        @media (max-width: 1400px) {
            .simulator-main {
                grid-template-columns: 250px 1fr 250px;
            }
        }

        @media (max-width: 1200px) {
            .simulator-main {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .simulator-sidebar {
                order: -1;
                min-width: unset;
                width: 100%;
                max-width: 100%;
            }
            
            .main-content {
                max-width: 100%;
                padding: 15px;
            }
        }

        @media (max-width: 992px) {
            .dashboard-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
            }

            .main-content {
                padding: 15px;
                grid-column: 1;
                max-width: 100%;
                width: 100%;
            }

            .simulators-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 20px;
            }

            .progress-grid {
                grid-template-columns: 1fr;
            }
            
            .action-recommendations {
                grid-template-columns: 1fr;
            }
            
            .feedback-cards {
                grid-template-columns: 1fr;
            }
            
            .controls-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                gap: 15px;
            }
            
            .prompt-options {
                flex-direction: column;
                gap: 10px;
            }
            
            .option-btn {
                min-width: 100%;
                max-width: 100%;
            }
        }

        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }

            .header-section h1 {
                font-size: 2rem;
            }

            .controls-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .simulators-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .quick-start-buttons {
                flex-direction: column;
                align-items: center;
            }

            .quick-btn {
                width: 100%;
                max-width: 200px;
            }

            .main-content {
                padding: 10px;
                max-width: 100%;
                width: 100%;
            }

            .simulator-card {
                padding: 15px;
                width: 100%;
                max-width: 100%;
                box-sizing: border-box;
            }

            .card-features {
                flex-wrap: wrap;
            }

            .card-footer {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .recommendation-card {
                flex-direction: column;
                text-align: center;
            }

            .rec-action {
                align-self: center;
            }

            .purpose-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .summary-stats {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .badges-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 10px;
            }
        }

        @media (max-width: 480px) {
            .header-section h1 {
                font-size: 1.8rem;
            }

            .header-section p {
                font-size: 1rem;
            }

            .library-header h2 {
                font-size: 1.8rem;
            }

            .simulator-card {
                padding: 12px;
            }

            .card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .launch-btn {
                width: 100%;
                justify-content: center;
            }

            .session-item {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .session-actions {
                width: 100%;
                justify-content: center;
            }

            .main-viewer {
                border-radius: 15px;
            }

            .viewer-header {
                padding: 15px;
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .viewer-controls {
                justify-content: center;
            }

            .simulation-area {
                height: 400px;
            }
        }

        .simulator-controls {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(16, 24, 32, 0.03);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }
        
        .simulator-controls.active {
            opacity: 1;
            transform: translateY(0);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            max-width: 100%;
            width: 100%;
            box-sizing: border-box;
        }

        .control-group {
            text-align: center;
        }

        .control-group h3 {
            margin-bottom: 15px;
            color: var(--primary);
        }

        .control-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .control-btn {
            padding: 10px 20px;
            border: 2px solid var(--primary);
            background: transparent;
            color: var(--primary);
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .control-btn:hover,
        .control-btn.active {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .simulator-main {
            display: grid;
            grid-template-columns: 280px 1fr 280px;
            gap: 20px;
            margin-bottom: 40px;
            max-width: 100%;
            overflow-x: auto;
            width: 100%;
            box-sizing: border-box;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }
        
        .simulator-main.active {
            opacity: 1;
            transform: translateY(0);
        }

        .simulator-sidebar {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow);
            height: fit-content;
            max-width: 100%;
            min-width: 250px;
            width: 100%;
            box-sizing: border-box;
        }

        .simulator-sidebar h3 {
            margin-bottom: 20px;
            color: var(--primary);
            border-bottom: 2px solid rgba(26, 115, 232, 0.2);
            padding-bottom: 10px;
        }

        .scenario-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid #e0e0e0;
        }

        .scenario-item:hover {
            background: rgba(26, 115, 232, 0.05);
            border-color: var(--primary);
        }

        .scenario-item.active {
            background: rgba(26, 115, 232, 0.1);
            border-color: var(--primary);
        }

        .scenario-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            color: white;
        }

        .scenario-icon.flood {
            background: linear-gradient(135deg, #2196f3, #1976d2);
        }

        .scenario-icon.earthquake {
            background: linear-gradient(135deg, #795548, #5d4037);
        }

        .scenario-icon.fire {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        .scenario-icon.tornado {
            background: linear-gradient(135deg, #9e9e9e, #616161);
        }

        .scenario-icon.tsunami {
            background: linear-gradient(135deg, #00bcd4, #0097a7);
        }

        .scenario-info h4 {
            font-size: 14px;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .scenario-info p {
            font-size: 12px;
            color: #666;
        }

        .main-viewer {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow);
            position: relative;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }

        .viewer-header {
            background: linear-gradient(to right, var(--primary), var(--p1));
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .viewer-controls {
            display: flex;
            gap: 10px;
        }

        .viewer-btn {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
        }

        .viewer-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .simulation-area {
            height: 600px;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            position: relative;
            overflow: hidden;
        }

        .simulation-canvas {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .simulation-placeholder {
            text-align: center;
            color: #666;
        }

        .simulation-placeholder i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .simulation-placeholder h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.5rem;
        }

        .simulation-placeholder p {
            color: #666;
            margin-bottom: 25px;
        }

        .placeholder-features {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .feature-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: #555;
        }

        .feature-item i {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .feature-item span {
            font-size: 0.9rem;
            text-align: center;
        }

        .simulation-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 10;
            backdrop-filter: blur(5px);
        }

        .overlay-content {
            text-align: center;
            max-width: 400px;
        }

        .overlay-content i {
            font-size: 3rem;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .overlay-content h3 {
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .overlay-content p {
            margin-bottom: 25px;
            opacity: 0.9;
        }

        .loading-progress {
            width: 100%;
        }

        .loading-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .loading-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            animation: loading 3s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 70%; }
            100% { width: 100%; }
        }

        .loading-text {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .simulation-hud {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 5;
        }

        .hud-top {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 20px;
            color: white;
        }

        .hud-item {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .hud-label {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .hud-value {
            font-size: 1rem;
            font-weight: 600;
        }

        .hud-timer,
        .hud-score {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .hud-timer {
            color: var(--warning);
        }

        .hud-score {
            color: var(--secondary);
        }

        .hud-bottom {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
        }

        .decision-prompt {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            color: white;
            pointer-events: auto;
        }

        .prompt-content h4 {
            margin-bottom: 10px;
            color: var(--accent);
            font-size: 1.2rem;
        }

        .prompt-content p {
            margin-bottom: 20px;
            opacity: 0.9;
            line-height: 1.5;
        }

        .prompt-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .option-btn {
            flex: 1;
            min-width: 180px;
            max-width: 250px;
            padding: 12px 20px;
            background: rgba(26, 115, 232, 0.2);
            border: 2px solid var(--primary);
            color: white;
            border-radius: 15px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            word-wrap: break-word;
            text-align: center;
            box-sizing: border-box;
        }

        .option-btn:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--secondary), #4caf50);
            width: 0%;
            transition: width 0.3s ease;
        }

        .tools-panel {
            padding: 20px 0;
        }

        .tool-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .tool-item:hover {
            background: rgba(26, 115, 232, 0.05);
        }

        .tool-icon {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            color: white;
            font-size: 14px;
        }

        .tool-icon.emergency {
            background: var(--accent);
        }

        .tool-icon.evacuation {
            background: var(--warning);
        }

        .tool-icon.rescue {
            background: var(--secondary);
        }

        .tool-icon.communication {
            background: var(--primary);
        }

        .stats-panel {
            background: rgba(26, 115, 232, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .stat-value {
            font-weight: 600;
            color: var(--primary);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-primary {
            flex: 1;
            padding: 12px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        .simulation-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            z-index: 10;
        }

        .disaster-animations {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .water-wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%;
            background: linear-gradient(to top, #1976d2, #42a5f5);
            opacity: 0.7;
            animation: flood-rise 5s ease-in-out infinite alternate;
        }

        @keyframes flood-rise {
            0% { height: 0%; }
            100% { height: 60%; }
        }

        .earthquake-shake {
            animation: shake 0.5s infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .fire-effect {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40%;
            background: linear-gradient(to top, #d32f2f, #ff5722, #ff9800);
            opacity: 0.8;
            animation: fire-flicker 1s infinite alternate;
        }

        @keyframes fire-flicker {
            0% { opacity: 0.6; transform: scaleY(0.9); }
            100% { opacity: 0.9; transform: scaleY(1.1); }
        }

        .floating-objects {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #666;
            border-radius: 50%;
            animation: float 3s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        @media (max-width: 1200px) {
            .simulator-main {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .simulator-sidebar {
                order: -1;
            }
        }

        @media (max-width: 992px) {
            .dashboard-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
            }

            .main-content {
                padding-left: 20px;
            }
        }

        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }

            .header-section h1 {
                font-size: 2rem;
            }

            .controls-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
                <h1>ResQ</h1>
            </div>
            <div class="menu-items">
                <div class="menu-item"><i class="fas fa-home"></i><span>Dashboard</span></div>
                <div class="menu-item"><i class="fas fa-book"></i><span>Education Modules</span></div>
                <div class="menu-item active"><i class="fas fa-gamepad"></i><span>Sandbox Simulator</span></div>
                <div class="menu-item"><i class="fas fa-phone-alt"></i><span>Emergency Contacts</span></div>
                <div class="menu-item"><i class="fa-solid fa-book-open"></i><span>Do's & Dont's</span></div>
                <div class="menu-item"><i class="fa-solid fa-calendar-days"></i><span>Drill Schedule</span></div>
                <div class="menu-item"><i class="fas fa-map-marked-alt"></i><span>Disaster Map</span></div>
                <div class="menu-item"><i class="fas fa-robot"></i><span>AI Helper</span></div>
                <div class="menu-item"><i class="fas fa-graduation-cap"></i><span>Gamified Learning</span></div>
                <!-- <div class="menu-item"><i class="fas fa-user"></i><span>Profile & Badges</span></div> -->
                <div class="menu-item"><i class="fas fa-cog"></i><span>Settings</span></div>
            </div>

            <!-- User Profile at Bottom -->
            <div class="sidebar-user-profile">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-info">
                    <h4 id="sidebarUserName">User</h4>
                    <p>Student</p>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
        <div class="simulators-library">
            <div class="library-header">
                <h2>Choose Your Training Environment</h2>
                <p>Select from our comprehensive library of realistic simulations</p>
            </div>
            
            <div class="simulators-grid">
                <div class="simulator-card featured" data-type="ar-campus">
                    <div class="card-header">
                        <div class="card-icon ar">
                            <i class="fas fa-school"></i>
                        </div>
                        <div class="card-badge">AR</div>
                    </div>
                    <div class="card-content">
                        <h3>AR Campus Evacuation Simulator</h3>
                        <p>Practice evacuation procedures using augmented reality in your actual campus environment. Turn theoretical maps into real-world, guided drills.</p>
                        <div class="card-features">
                            <span><i class="fas fa-map-marked-alt"></i> Real location mapping</span>
                            <span><i class="fas fa-users"></i> Multi-user support</span>
                            <span><i class="fas fa-clock"></i> 15-30 min sessions</span>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="difficulty-indicator">
                            <span>Difficulty:</span>
                            <div class="difficulty-dots">
                                <span class="dot active"></span>
                                <span class="dot active"></span>
                                <span class="dot"></span>
                            </div>
                        </div>
                        <button class="launch-btn" onclick="launchSimulator('ar-campus')">
                            <i class="fas fa-play"></i> Launch AR Mode
                        </button>
                    </div>
                </div>

                <div class="simulator-card featured" data-type="vr-responder">
                    <div class="card-header">
                        <div class="card-icon vr">
                            <i class="fas fa-ambulance"></i>
                        </div>
                        <div class="card-badge">VR</div>
                    </div>
                    <div class="card-content">
                        <h3>VR First-Responder Simulator</h3>
                        <p>Immersive virtual reality training for critical skills like triage, first-aid, and rescue operations in high-pressure scenarios.</p>
                        <div class="card-features">
                            <span><i class="fas fa-heartbeat"></i> Medical procedures</span>
                            <span><i class="fas fa-exclamation-triangle"></i> High-pressure training</span>
                            <span><i class="fas fa-clock"></i> 20-45 min sessions</span>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="difficulty-indicator">
                            <span>Difficulty:</span>
                            <div class="difficulty-dots">
                                <span class="dot active"></span>
                                <span class="dot active"></span>
                                <span class="dot active"></span>
                            </div>
                        </div>
                        <button class="launch-btn" onclick="launchVRResponder()">
                            <i class="fas fa-vr-cardboard"></i> Enter VR
                        </button>
                    </div>
                </div>

                <div class="simulator-card" data-type="city-planner">
                    <div class="card-header">
                        <div class="card-icon strategy">
                            <i class="fas fa-city"></i>
                        </div>
                        <div class="card-badge">Strategy</div>
                    </div>
                    <div class="card-content">
                        <h3>"Disasteropolis" City Planner Game</h3>
                        <p>Strategic simulation teaching disaster mitigation and preparedness planning. Build resilient communities and test your designs against various disasters.</p>
                        <div class="card-features">
                            <span><i class="fas fa-hammer"></i> Infrastructure planning</span>
                            <span><i class="fas fa-shield-alt"></i> Mitigation strategies</span>
                            <span><i class="fas fa-clock"></i> 30-60 min sessions</span>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="difficulty-indicator">
                            <span>Difficulty:</span>
                            <div class="difficulty-dots">
                                <span class="dot active"></span>
                                <span class="dot active"></span>
                                <span class="dot"></span>
                            </div>
                        </div>
                        <button class="launch-btn" onclick="launchSimulator('city-planner')">
                            <i class="fas fa-play"></i> Start Planning
                        </button>
                    </div>
                </div>

                <div class="simulator-card" data-type="crowd-map">
                    <div class="card-header">
                        <div class="card-icon community">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="card-badge">Live</div>
                    </div>
                    <div class="card-content">
                        <h3>Crowd-Sourced Safe Zone Map</h3>
                        <p>Real-time community mapping simulation. Learn to identify and report safe zones while coordinating with other users during emergencies.</p>
                        <div class="card-features">
                            <span><i class="fas fa-users"></i> Community collaboration</span>
                            <span><i class="fas fa-satellite"></i> Real-time updates</span>
                            <span><i class="fas fa-clock"></i> 10-25 min sessions</span>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="difficulty-indicator">
                            <span>Difficulty:</span>
                            <div class="difficulty-dots">
                                <span class="dot active"></span>
                                <span class="dot"></span>
                                <span class="dot"></span>
                            </div>
                        </div>
                        <button class="launch-btn" onclick="launchSimulator('crowd-map')">
                            <i class="fas fa-globe"></i> Join Community
                        </button>
                    </div>
                </div>
            </div>

            <div class="quick-start-section">
                <h3>Quick Start Options</h3>
                <div class="quick-start-buttons">
                    <button class="quick-btn" onclick="startRandomSimulation()">
                        <i class="fas fa-random"></i>
                        <span>Random Challenge</span>
                    </button>
                    <button class="quick-btn" onclick="continueProgress()">
                        <i class="fas fa-play-circle"></i>
                        <span>Continue Training</span>
                    </button>
                    <button class="quick-btn" onclick="startRealScenario()">
                        <i class="fas fa-users"></i>
                        <span>Real Scenarios</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- User Progress & Feedback System -->
        <div class="progress-feedback-section">
            <div class="section-header">
                <h2>Your Training Progress</h2>
                <p>Track your performance and discover areas for improvement</p>
            </div>

            <div class="progress-grid">
                <div class="performance-summary">
                    <h3>Performance Overview</h3>
                    <div class="summary-stats">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-number">87</span>
                                <span class="stat-label">Average Score</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-number">4.2</span>
                                <span class="stat-label">Avg Response Time (min)</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-number">342</span>
                                <span class="stat-label">People Rescued</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-number">15</span>
                                <span class="stat-label">Simulations Completed</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="skill-badges">
                    <h3>Skill Badges Earned</h3>
                    <div class="badges-grid">
                        <div class="badge-item earned">
                            <div class="badge-icon triage">
                                <i class="fas fa-user-md"></i>
                            </div>
                            <span class="badge-name">Triage Master</span>
                            <span class="badge-date">Earned 3 days ago</span>
                        </div>
                        <div class="badge-item earned">
                            <div class="badge-icon evacuation">
                                <i class="fas fa-route"></i>
                            </div>
                            <span class="badge-name">Evacuation Expert</span>
                            <span class="badge-date">Earned 1 week ago</span>
                        </div>
                        <div class="badge-item earned">
                            <div class="badge-icon communication">
                                <i class="fas fa-broadcast-tower"></i>
                            </div>
                            <span class="badge-name">Crisis Communicator</span>
                            <span class="badge-date">Earned 2 weeks ago</span>
                        </div>
                        <div class="badge-item locked">
                            <div class="badge-icon rescue">
                                <i class="fas fa-hands-helping"></i>
                            </div>
                            <span class="badge-name">Rescue Specialist</span>
                            <span class="badge-requirement">Complete 5 VR rescue simulations</span>
                        </div>
                        <div class="badge-item locked">
                            <div class="badge-icon leadership">
                                <i class="fas fa-crown"></i>
                            </div>
                            <span class="badge-name">Emergency Leader</span>
                            <span class="badge-requirement">Score 95+ in team scenarios</span>
                        </div>
                        <div class="badge-item locked">
                            <div class="badge-icon planning">
                                <i class="fas fa-drafting-compass"></i>
                            </div>
                            <span class="badge-name">Strategic Planner</span>
                            <span class="badge-requirement">Complete Disasteropolis campaign</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="improvement-feedback">
                <h3>Areas for Improvement</h3>
                <div class="feedback-cards">
                    <div class="feedback-card warning">
                        <div class="feedback-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="feedback-content">
                            <h4>Response Time</h4>
                            <p>Your average response time is 30% slower than optimal. Focus on quick decision-making in high-pressure scenarios.</p>
                            <div class="feedback-actions">
                                <button class="action-btn" onclick="reviewSkills('response-time')">
                                    <i class="fas fa-book"></i> Review Time Management
                                </button>
                                <button class="action-btn" onclick="practiceScenario('speed-training')">
                                    <i class="fas fa-stopwatch"></i> Practice Speed Training
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="feedback-card success">
                        <div class="feedback-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="feedback-content">
                            <h4>Triage Accuracy</h4>
                            <p>Excellent work! Your injury assessment accuracy is 94%. You correctly prioritized critical patients in 9 out of 10 scenarios.</p>
                            <div class="feedback-actions">
                                <button class="action-btn" onclick="claimRewards('triage-master')">
                                    <i class="fas fa-trophy"></i> Claim Rewards
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="feedback-card info">
                        <div class="feedback-icon">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <div class="feedback-content">
                            <h4>Communication Skills</h4>
                            <p>Good progress on emergency communications. Consider practicing multi-channel coordination to reach the next level.</p>
                            <div class="feedback-actions">
                                <button class="action-btn" onclick="reviewSkills('communication')">
                                    <i class="fas fa-book"></i> Review Protocols
                                </button>
                                <button class="action-btn" onclick="practiceScenario('team-coordination')">
                                    <i class="fas fa-users"></i> Practice Team Scenarios
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="recent-sessions">
                <h3>Recent Training Sessions</h3>
                <div class="sessions-list">
                    <div class="session-item">
                        <div class="session-icon flood">
                            <i class="fas fa-water"></i>
                        </div>
                        <div class="session-info">
                            <h4>Flash Flood Response</h4>
                            <p>Campus AR Simulation  Yesterday, 3:45 PM</p>
                            <div class="session-metrics">
                                <span class="metric"><i class="fas fa-star"></i> Score: 89/100</span>
                                <span class="metric"><i class="fas fa-clock"></i> Time: 4:32</span>
                                <span class="metric"><i class="fas fa-users"></i> Rescued: 47</span>
                            </div>
                        </div>
                        <div class="session-actions">
                            <button class="review-btn" onclick="reviewSession('flood-001')">
                                <i class="fas fa-chart-line"></i> Review
                            </button>
                            <button class="replay-btn" onclick="replaySession('flood-001')">
                                <i class="fas fa-redo"></i> Retry
                            </button>
                        </div>
                    </div>
                    <div class="session-item">
                        <div class="session-icon fire">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="session-info">
                            <h4>Wildfire Evacuation</h4>
                            <p>VR First-Responder  2 days ago, 7:20 PM</p>
                            <div class="session-metrics">
                                <span class="metric"><i class="fas fa-star"></i> Score: 76/100</span>
                                <span class="metric"><i class="fas fa-clock"></i> Time: 6:15</span>
                                <span class="metric"><i class="fas fa-users"></i> Rescued: 23</span>
                            </div>
                        </div>
                        <div class="session-actions">
                            <button class="review-btn" onclick="reviewSession('fire-003')">
                                <i class="fas fa-chart-line"></i> Review
                            </button>
                            <button class="replay-btn" onclick="replaySession('fire-003')">
                                <i class="fas fa-redo"></i> Retry
                            </button>
                        </div>
                    </div>
                    <div class="session-item">
                        <div class="session-icon earthquake">
                            <i class="fas fa-mountain"></i>
                        </div>
                        <div class="session-info">
                            <h4>Earthquake Response</h4>
                            <p>Disasteropolis City Planner  1 week ago, 2:10 PM</p>
                            <div class="session-metrics">
                                <span class="metric"><i class="fas fa-star"></i> Score: 95/100</span>
                                <span class="metric"><i class="fas fa-clock"></i> Time: 12:45</span>
                                <span class="metric"><i class="fas fa-building"></i> Buildings Saved: 78</span>
                            </div>
                        </div>
                        <div class="session-actions">
                            <button class="review-btn" onclick="reviewSession('earthquake-002')">
                                <i class="fas fa-chart-line"></i> Review
                            </button>
                            <button class="replay-btn" onclick="replaySession('earthquake-002')">
                                <i class="fas fa-redo"></i> Retry
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Call-to-Action Navigation -->
        <div class="navigation-actions">
            <div class="nav-actions-header">
                <h3>What's Next?</h3>
                <p>Based on your performance, here are personalized recommendations</p>
            </div>
            
            <div class="action-recommendations">
                <div class="recommendation-card needs-review">
                    <div class="rec-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <div class="rec-content">
                        <h4>Review Your Skills</h4>
                        <p>Your response time could use improvement. Review time management techniques in our education modules.</p>
                        <div class="rec-tags">
                            <span class="tag">Emergency Response</span>
                            <span class="tag">Time Management</span>
                        </div>
                    </div>
                    <div class="rec-action">
                        <button class="cta-btn review" onclick="navigateToEducation('time-management')">
                            <i class="fas fa-arrow-right"></i>
                            Go to Education
                        </button>
                    </div>
                </div>

                <div class="recommendation-card celebration">
                    <div class="rec-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="rec-content">
                        <h4>Claim Your Rewards</h4>
                        <p>Excellent triage performance! You've earned 250 points and unlocked new achievements.</p>
                        <div class="rec-rewards">
                            <span class="reward"><i class="fas fa-coins"></i> +250 Points</span>
                            <span class="reward"><i class="fas fa-medal"></i> Triage Master Badge</span>
                        </div>
                    </div>
                    <div class="rec-action">
                        <button class="cta-btn rewards" onclick="navigateToGamification()">
                            <i class="fas fa-gift"></i>
                            Claim Rewards
                        </button>
                    </div>
                </div>

                <div class="recommendation-card practice">
                    <div class="rec-icon">
                        <i class="fas fa-gamepad"></i>
                    </div>
                    <div class="rec-content">
                        <h4>More Practice</h4>
                        <p>Ready for the next challenge? Try our gamified scenarios to test your skills in fun ways.</p>
                        <div class="rec-suggestions">
                            <span class="suggestion">Disaster Response Game</span>
                            <span class="suggestion">Emergency Quiz Challenge</span>
                        </div>
                    </div>
                    <div class="rec-action">
                        <button class="cta-btn practice" onclick="navigateToGames()">
                            <i class="fas fa-play"></i>
                            Play Games
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Simulator Interface (Initially Hidden) -->
        <div class="simulator-controls" id="simulatorControls" style="display: none;">
            <div class="controls-grid">
                <div class="control-group">
                    <h3>Simulation Mode</h3>
                    <div class="control-buttons">
                        <button class="control-btn active" data-mode="training">Training</button>
                        <button class="control-btn" data-mode="assessment">Assessment</button>
                        <button class="control-btn" data-mode="multiplayer">Multiplayer</button>
                    </div>
                </div>
                <div class="control-group">
                    <h3>Difficulty Level</h3>
                    <div class="control-buttons">
                        <button class="control-btn active" data-difficulty="beginner">Beginner</button>
                        <button class="control-btn" data-difficulty="intermediate">Intermediate</button>
                        <button class="control-btn" data-difficulty="expert">Expert</button>
                    </div>
                </div>
                <div class="control-group">
                    <h3>Environment</h3>
                    <div class="control-buttons">
                        <button class="control-btn active" data-environment="urban">Urban</button>
                        <button class="control-btn" data-environment="rural">Rural</button>
                        <button class="control-btn" data-environment="coastal">Coastal</button>
                    </div>
                </div>
            </div>
            <div class="action-buttons">
                <button class="btn-primary" onclick="startSimulation()">Start New Simulation</button>
                <button class="btn-secondary" onclick="loadScenario()">Load Saved Scenario</button>
            </div>
        </div>

        <div class="simulator-main" id="simulatorMain" style="display: none;">
            <!-- Content will be dynamically created when simulator is launched -->
        </div>
    </div>

    <script>
        let currentSimulation = null;
        let simulationTimer = null;
        let startTime = null;
        let currentScore = 0;
        let peopleSaved = 0;

        // Control button functionality
        document.querySelectorAll('.control-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const type = this.dataset.mode || this.dataset.difficulty || this.dataset.environment;
                const group = this.parentElement;
                
                group.querySelectorAll('.control-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Scenario selection
        document.querySelectorAll('.scenario-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.scenario-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                
                const scenario = this.dataset.scenario;
                updateScenarioDisplay(scenario);
            });
        });

        function updateScenarioDisplay(scenario) {
            const scenarios = {
                flood: 'Flash Flood Simulation',
                earthquake: 'Earthquake Simulation',
                fire: 'Wildfire Simulation',
                tornado: 'Tornado Simulation',
                tsunami: 'Tsunami Simulation'
            };
            
            document.getElementById('currentScenario').textContent = scenarios[scenario];
        }

        function startSimulation() {
            const overlay = document.getElementById('simulationOverlay');
            const canvas = document.getElementById('simulationCanvas');
            const animations = document.getElementById('disasterAnimations');
            
            // Show loading overlay
            overlay.style.display = 'flex';
            
            setTimeout(() => {
                overlay.style.display = 'none';
                canvas.innerHTML = '';
                
                // Get active scenario
                const activeScenario = document.querySelector('.scenario-item.active').dataset.scenario;
                
                // Start simulation based on scenario
                switch(activeScenario) {
                    case 'flood':
                        startFloodSimulation(animations);
                        break;
                    case 'earthquake':
                        startEarthquakeSimulation(animations);
                        break;
                    case 'fire':
                        startFireSimulation(animations);
                        break;
                    case 'tornado':
                        startTornadoSimulation(animations);
                        break;
                    case 'tsunami':
                        startTsunamiSimulation(animations);
                        break;
                }
                
                // Start timer and progress
                startTimer();
                updateProgress();
            }, 2000);
        }

        function startFloodSimulation(container) {
            container.innerHTML = '<div class="water-wave"></div>';
            
            // Add floating debris
            for(let i = 0; i < 5; i++) {
                const debris = document.createElement('div');
                debris.className = 'floating-objects';
                debris.style.left = Math.random() * 80 + '%';
                debris.style.top = Math.random() * 60 + '%';
                debris.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(debris);
            }
            
            simulateRescueOperations();
        }

        function startEarthquakeSimulation(container) {
            container.innerHTML = '';
            document.getElementById('simulationCanvas').classList.add('earthquake-shake');
            
            // Add falling objects
            for(let i = 0; i < 8; i++) {
                const debris = document.createElement('div');
                debris.className = 'floating-objects';
                debris.style.left = Math.random() * 90 + '%';
                debris.style.top = '0%';
                debris.style.animation = 'fall 2s linear infinite';
                debris.style.animationDelay = Math.random() * 3 + 's';
                container.appendChild(debris);
            }
            
            simulateRescueOperations();
        }

        function startFireSimulation(container) {
            container.innerHTML = '<div class="fire-effect"></div>';
            simulateRescueOperations();
        }

        function startTornadoSimulation(container) {
            container.innerHTML = '';
            // Add spinning debris
            for(let i = 0; i < 10; i++) {
                const debris = document.createElement('div');
                debris.className = 'floating-objects';
                debris.style.left = Math.random() * 80 + '%';
                debris.style.top = Math.random() * 80 + '%';
                debris.style.animation = 'spin 1s linear infinite';
                debris.style.animationDelay = Math.random() * 1 + 's';
                container.appendChild(debris);
            }
            simulateRescueOperations();
        }

        function startTsunamiSimulation(container) {
            container.innerHTML = '<div class="water-wave" style="animation: tsunami-wave 8s ease-in-out infinite;"></div>';
            simulateRescueOperations();
        }

        function simulateRescueOperations() {
            currentSimulation = setInterval(() => {
                // Randomly update rescue statistics
                if (Math.random() > 0.7) {
                    peopleSaved += Math.floor(Math.random() * 5) + 1;
                    currentScore += Math.floor(Math.random() * 100) + 50;
                    updateStats();
                }
            }, 2000);
        }

        function startTimer() {
            startTime = Date.now();
            simulationTimer = setInterval(() => {
                const elapsed = Date.now() - startTime;
                const minutes = Math.floor(elapsed / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                document.getElementById('timeElapsed').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function updateProgress() {
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 2;
                document.getElementById('progressFill').style.width = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    completeSimulation();
                }
            }, 1000);
        }

        function updateStats() {
            document.getElementById('peopleSaved').textContent = peopleSaved;
            document.getElementById('currentScore').textContent = currentScore;
            
            const efficiency = Math.min(100, Math.floor((peopleSaved / 100) * 100));
            document.getElementById('efficiency').textContent = efficiency + '%';
        }

        function useTool(tool) {
            const tools = {
                emergency: 'Emergency services contacted! Response time: 5 minutes',
                evacuation: 'Evacuation route established! Guiding people to safety',
                rescue: 'Rescue team deployed! Searching for survivors',
                communication: 'Public alert sent! Warning broadcasted to all devices'
            };
            
            alert(tools[tool]);
            
            // Update score based on tool used
            currentScore += 150;
            updateStats();
        }

        function pauseSimulation() {
            if (currentSimulation) {
                clearInterval(currentSimulation);
                clearInterval(simulationTimer);
                alert('Simulation paused');
            }
        }

        function resetSimulation() {
            if (currentSimulation) clearInterval(currentSimulation);
            if (simulationTimer) clearInterval(simulationTimer);
            
            document.getElementById('disasterAnimations').innerHTML = '';
            document.getElementById('simulationCanvas').className = 'simulation-canvas';
            document.getElementById('simulationCanvas').innerHTML = `
                <div class="simulation-placeholder">
                    <i class="fas fa-play-circle"></i>
                    <h3>Click "Start Simulation" to begin</h3>
                    <p>Choose a disaster scenario and simulation settings</p>
                </div>
            `;
            document.getElementById('progressFill').style.width = '0%';
            
            // Reset stats
            peopleSaved = 0;
            currentScore = 0;
            document.getElementById('timeElapsed').textContent = '00:00';
            updateStats();
        }

        function toggleFullscreen() {
            const viewer = document.querySelector('.main-viewer');
            if (!document.fullscreenElement) {
                viewer.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        function loadScenario() {
            alert('Load saved scenario functionality would connect to user progress database');
        }

        function completeSimulation() {
            if (currentSimulation) clearInterval(currentSimulation);
            if (simulationTimer) clearInterval(simulationTimer);
            
            const finalScore = currentScore + (peopleSaved * 100);
            alert(`Simulation Complete!\n\nFinal Score: ${finalScore}\nPeople Saved: ${peopleSaved}\n\nGreat job! Check your profile for badges and achievements.`);
        }

        // Add CSS for additional animations
        const additionalCSS = `
            @keyframes fall {
                0% { transform: translateY(-50px); }
                100% { transform: translateY(600px); }
            }
            
            @keyframes spin {
                0% { transform: rotate(0deg) translateX(50px) rotate(0deg); }
                100% { transform: rotate(360deg) translateX(50px) rotate(-360deg); }
            }
            
            @keyframes tsunami-wave {
                0% { height: 0%; }
                50% { height: 80%; }
                100% { height: 20%; }
            }
            
            /* AR Mode Styles */
            .ar-simulation-area {
                position: relative;
                width: 100%;
                height: 100%;
                background: linear-gradient(45deg, #0f4c75, #3282b8, #bbe1fa);
                overflow: hidden;
            }

            .ar-campus-environment {
                position: relative;
                width: 100%;
                height: 100%;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 15px;
                backdrop-filter: blur(10px);
                overflow: hidden;
            }

            .ar-campus-map {
                position: relative;
                width: 100%;
                height: 100%;
                background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9IiNmNWY1ZjUiIG9wYWNpdHk9IjAuMiIvPgo8cmVjdCB4PSIxMCIgeT0iMjAiIHdpZHRoPSIyMCIgaGVpZ2h0PSIzMCIgZmlsbD0iIzNmNTFiNSIgb3BhY2l0eT0iMC42Ii8+CjxyZWN0IHg9IjQwIiB5PSIxMCIgd2lkdGg9IjMwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjM2Y1MWI1IiBvcGFjaXR5PSIwLjYiLz4KPHJlY3QgeD0iNzAiIHk9IjQwIiB3aWR0aD0iMjUiIGhlaWdodD0iMzUiIGZpbGw9IiMzZjUxYjUiIG9wYWNpdHk9IjAuNiIvPgo8cmVjdCB4PSIxNSIgeT0iNzAiIHdpZHRoPSI0MCIgaGVpZ2h0PSIyMCIgZmlsbD0iIzNmNTFiNSIgb3BhY2l0eT0iMC42Ii8+CjxwYXRoIGQ9Ik01IDU1IEw5NSA1NSIgc3Ryb2tlPSIjNjA2NDc4IiBzdHJva2Utd2lkdGg9IjIiIG9wYWNpdHk9IjAuNCIvPgo8cGF0aCBkPSJNNTUgNSBMNTUgOTUiIHN0cm9rZT0iIzYwNjQ3OCIgc3Ryb2tlLXdpZHRoPSIyIiBvcGFjaXR5PSIwLjQiLz4KPC9zdmc+') center/cover;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .ar-interface {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
            }

            .evacuation-route {
                position: absolute;
                height: 4px;
                background: linear-gradient(90deg, #4caf50, #8bc34a);
                box-shadow: 0 0 10px rgba(76, 175, 80, 0.6);
                animation: pulse-route 2s infinite;
                border-radius: 2px;
            }

            .route-1 {
                top: 30%;
                left: 15%;
                width: 70%;
                transform: rotate(-5deg);
            }

            .route-2 {
                top: 60%;
                left: 10%;
                width: 60%;
                transform: rotate(3deg);
            }

            @keyframes pulse-route {
                0%, 100% { opacity: 0.7; transform: scaleY(1); }
                50% { opacity: 1; transform: scaleY(1.5); }
            }

            .ar-safe-zone {
                position: absolute;
                width: 50px;
                height: 50px;
                background: radial-gradient(circle, rgba(76, 175, 80, 0.3), rgba(76, 175, 80, 0.1));
                border: 3px solid #4caf50;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: pulse-safe 3s infinite;
                pointer-events: auto;
                cursor: pointer;
                color: #4caf50;
                font-size: 1.2rem;
            }

            @keyframes pulse-safe {
                0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.4); }
                50% { transform: scale(1.1); box-shadow: 0 0 0 20px rgba(76, 175, 80, 0); }
            }

            .ar-zone-1 { top: 15%; right: 20%; }
            .ar-zone-2 { bottom: 20%; left: 25%; }
            .ar-zone-3 { top: 45%; right: 30%; }

            .ar-marker {
                position: absolute;
                width: 35px;
                height: 35px;
                background: rgba(26, 115, 232, 0.9);
                border: 2px solid white;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 1rem;
                animation: float 2s ease-in-out infinite;
                pointer-events: auto;
                cursor: pointer;
                box-shadow: 0 4px 15px rgba(26, 115, 232, 0.4);
            }

            @keyframes float {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-8px); }
            }

            .ar-marker-1 { top: 25%; left: 25%; }
            .ar-marker-2 { top: 50%; left: 60%; }
            .ar-marker-3 { bottom: 30%; right: 30%; }

            .ar-person-icon {
                position: absolute;
                width: 28px;
                height: 28px;
                background: #f9a825;
                border: 2px solid white;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 0.8rem;
                animation: blink 1.5s infinite;
                pointer-events: auto;
                cursor: pointer;
            }

            @keyframes blink {
                0%, 50% { opacity: 1; }
                51%, 100% { opacity: 0.6; }
            }

            .ar-person-1 { top: 35%; left: 30%; }
            .ar-person-2 { top: 45%; left: 70%; }
            .ar-person-3 { bottom: 40%; left: 40%; }
            .ar-person-4 { top: 55%; right: 40%; }

            .ar-distance-indicator {
                position: absolute;
                background: rgba(26, 115, 232, 0.9);
                color: white;
                padding: 2px 6px;
                border-radius: 10px;
                font-size: 0.7rem;
                font-weight: 600;
                top: -25px;
                left: 50%;
                transform: translateX(-50%);
                white-space: nowrap;
            }

            .ar-scenario-alert {
                position: absolute;
                top: 20%;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(244, 67, 54, 0.95);
                color: white;
                padding: 15px 25px;
                border-radius: 12px;
                text-align: center;
                font-size: 1rem;
                font-weight: 600;
                animation: alertPulse 2s infinite;
                z-index: 100;
                border: 2px solid white;
                box-shadow: 0 8px 32px rgba(244, 67, 54, 0.6);
            }

            @keyframes alertPulse {
                0%, 100% { transform: translateX(-50%) scale(1); }
                50% { transform: translateX(-50%) scale(1.05); }
            }

            .ar-success-animation {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(76, 175, 80, 0.95);
                color: white;
                padding: 20px 30px;
                border-radius: 15px;
                text-align: center;
                font-size: 1.1rem;
                font-weight: 600;
                animation: successBounce 1s ease-out;
                z-index: 100;
                border: 3px solid white;
                box-shadow: 0 8px 32px rgba(76, 175, 80, 0.6);
                display: none;
            }

            @keyframes successBounce {
                0% { transform: translate(-50%, -50%) scale(0); }
                60% { transform: translate(-50%, -50%) scale(1.2); }
                100% { transform: translate(-50%, -50%) scale(1); }
            }

            .ar-interaction-ripple {
                position: absolute;
                width: 80px;
                height: 80px;
                border: 2px solid rgba(255, 255, 255, 0.5);
                border-radius: 50%;
                transform: scale(0);
                animation: ripple 1s ease-out;
                pointer-events: none;
            }

            @keyframes ripple {
                to {
                    transform: scale(3);
                    opacity: 0;
                }
            }

            .ar-instructions {
                position: absolute;
                top: 10px;
                left: 10px;
                background: rgba(0, 0, 0, 0.8);
                backdrop-filter: blur(10px);
                color: white;
                padding: 12px 15px;
                border-radius: 10px;
                max-width: 280px;
                font-size: 0.8rem;
                border: 1px solid rgba(255, 255, 255, 0.2);
                z-index: 50;
            }

            .ar-instruction-title {
                font-weight: 600;
                margin-bottom: 8px;
                color: #64b5f6;
                font-size: 0.9rem;
            }

            .ar-instruction-text {
                line-height: 1.3;
                opacity: 0.9;
            }

            .ar-hud-overlay {
                position: absolute;
                bottom: 10px;
                left: 10px;
                right: 10px;
                background: rgba(0, 0, 0, 0.8);
                backdrop-filter: blur(10px);
                border-radius: 12px;
                padding: 12px;
                color: white;
                display: flex;
                justify-content: space-around;
                align-items: center;
                border: 1px solid rgba(255, 255, 255, 0.2);
                z-index: 50;
            }

            .ar-hud-section {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 3px;
            }

            .ar-hud-value {
                font-size: 1.1rem;
                font-weight: 700;
                color: #34a853;
            }

            .ar-hud-label {
                font-size: 0.7rem;
                opacity: 0.8;
            }

            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        
        const style = document.createElement('style');
        style.textContent = additionalCSS;
        document.head.appendChild(style);

        // Load User Information from MongoDB database
        async function loadUserInfo() {
            try {
                // First try to get user data from session/localStorage
                let userData = null;

                // Check localStorage for stored user data
                const localData = localStorage.getItem('resq_user') || localStorage.getItem('currentUser') || localStorage.getItem('user');
                if (localData) {
                    userData = JSON.parse(localData);
                }

                // If no local data or token exists, try to fetch from backend
                const token = localStorage.getItem('token') || localStorage.getItem('authToken') || localStorage.getItem('jwt');
                if (!userData && token) {
                    try {
                        const response = await fetch('http://localhost:5000/api/auth/current', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (response.ok) {
                            userData = await response.json();
                            // Save to localStorage for future use
                            localStorage.setItem('resq_user', JSON.stringify(userData));
                        } else {
                            console.log('Failed to fetch user from backend:', response.status);
                        }
                    } catch (fetchError) {
                        console.log('Could not fetch user from backend:', fetchError.message);
                    }
                }

                if (userData) {
                    const firstName = userData.firstName || userData.name || userData.username || userData.email?.split('@')[0] || 'User';
                    const lastName = userData.lastName || '';
                    const fullName = lastName ? `${firstName} ${lastName}` : firstName;

                    // Update sidebar user profile
                    const userNameElement = document.getElementById('sidebarUserName');
                    const userAvatarElement = document.getElementById('userAvatar');

                    if (userNameElement) userNameElement.textContent = fullName;
                    if (userAvatarElement) userAvatarElement.textContent = firstName.charAt(0).toUpperCase();

                    console.log('User loaded:', fullName);
                } else {
                    // Fallback to default values
                    console.log('No user data found');
                    setDefaultUser();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                setDefaultUser();
            }
        }

        function setDefaultUser() {
            const userNameElement = document.getElementById('sidebarUserName');
            const userAvatarElement = document.getElementById('userAvatar');

            if (userNameElement) userNameElement.textContent = 'Guest User';
            if (userAvatarElement) userAvatarElement.textContent = 'G';
        }

        // Initialize menu navigation
        function initializeMenuNavigation() {
            const menuItems = document.querySelectorAll('.menu-item');

            // Define page mappings for each menu item
            const pageMapping = {
                'Dashboard': 'dashboard-student.html',
                'Education Modules': 'education-modules.html',
                'Sandbox Simulator': 'sandbox-simulator.html',
                'Emergency Contacts': '../emergency_contacts.html',
                "Do's & Dont's": '../dos&donts.html',
                'Drill Schedule': '../drill_schedule.html',
                'Disaster Map': '../advanced-map.html',
                'AI Helper': 'chatbot.html',
                'Gamified Learning': 'gamified-learning.html',
                'Settings': 'settings.html'
            };

            menuItems.forEach(item => {
                item.addEventListener('click', function () {
                    // Update active state
                    menuItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');

                    // Get the menu item text
                    const menuText = this.querySelector('span').textContent.trim();
                    const targetPage = pageMapping[menuText];

                    if (targetPage && menuText !== 'Sandbox Simulator') {
                        // Navigate to page (don't navigate if current page)
                        navigateToPage(targetPage, menuText);
                    }
                });

                // Add hover effect
                item.addEventListener('mouseenter', function () {
                    if (!this.classList.contains('active')) {
                        this.style.backgroundColor = 'rgba(255, 255, 255, 0.15)';
                    }
                });

                item.addEventListener('mouseleave', function () {
                    if (!this.classList.contains('active')) {
                        this.style.backgroundColor = '';
                    }
                });
            });
        }

        function navigateToPage(targetPage, menuText) {
            // Show loading indicator
            showLoadingIndicator();

            // Add smooth transition
            document.body.style.opacity = '0.8';
            document.body.style.transition = 'opacity 0.3s ease';

            setTimeout(() => {
                try {
                    window.location.href = targetPage;
                } catch (error) {
                    console.error('Navigation error:', error);
                    hideLoadingIndicator();
                    showNavigationError(menuText);
                    document.body.style.opacity = '1';
                }
            }, 300);
        }

        function showLoadingIndicator() {
            // Create loading overlay if it doesn't exist
            if (!document.getElementById('loadingOverlay')) {
                const loadingHTML = `
                    <div id="loadingOverlay" style="
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(26, 115, 232, 0.9);
                        display: flex;
                        flex-direction: column;
                        justify-content: center;
                        align-items: center;
                        z-index: 9999;
                        color: white;
                    ">
                        <div style="
                            width: 50px;
                            height: 50px;
                            border: 3px solid rgba(255, 255, 255, 0.3);
                            border-top: 3px solid white;
                            border-radius: 50%;
                            animation: spin 1s linear infinite;
                            margin-bottom: 20px;
                        "></div>
                        <h3>Loading...</h3>
                        <p>Navigating to your selected page</p>
                    </div>
                    <style>
                        @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }
                    </style>
                `;
                document.body.insertAdjacentHTML('beforeend', loadingHTML);
            }
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoadingIndicator() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        }

        function showNavigationError(menuText) {
            alert(` Navigation Error\n\nSorry, the ${menuText} page is currently unavailable.\n\nThis might be because:\n The page is still being developed\n The file path has changed\n There's a temporary server issue\n\nPlease try again later or contact support.`);
        }

        // FETCHING POINTS AND USER DATA FROM DATABASE
        window.addEventListener('DOMContentLoaded', () => {
            loadUserInfo();
            initializeMenuNavigation();

            // Refresh user data every 5 minutes
            setInterval(loadUserInfo, 5 * 60 * 1000);
        });

        // Simulator Library Functions
        function launchSimulator(type) {
            // Show the simulator controls and main interface
            const simulatorControls = document.getElementById('simulatorControls');
            const simulatorMain = document.getElementById('simulatorMain');
            
            simulatorControls.style.display = 'block';
            simulatorMain.style.display = 'grid';
            
            // Create the simulator interface content
            createSimulatorInterface();
            
            // Add smooth fade-in animation
            setTimeout(() => {
                simulatorControls.classList.add('active');
                simulatorMain.classList.add('active');
            }, 100);
            
            // Show loading overlay first
            const overlay = document.getElementById('simulationOverlay');
            overlay.style.display = 'flex';
            
            // Scroll to the simulator section smoothly
            setTimeout(() => {
                simulatorControls.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 300);
            
            setTimeout(() => {
                overlay.style.display = 'none';
                
                switch(type) {
                    case 'ar-campus':
                        alert('Launching AR Campus Evacuation Simulator...\nPlease ensure your device has camera access for the AR experience.');
                        launchARMode();
                        break;
                    case 'vr-responder':
                        alert('Launching VR First-Responder Simulator...\nPut on your VR headset for an immersive training experience.');
                        launchSimulatorWithHUD(type);
                        break;
                    case 'city-planner':
                        alert('Launching Disasteropolis City Planner...\nTest your strategic planning skills in this comprehensive simulation.');
                        launchSimulatorWithHUD(type);
                        break;
                    case 'crowd-map':
                        alert('Joining Crowd-Sourced Safe Zone Map...\nConnecting to live community mapping session.');
                        launchSimulatorWithHUD(type);
                        break;
                }
            }, 2500);
        }

        function createSimulatorInterface() {
            const simulatorMain = document.getElementById('simulatorMain');
            
            simulatorMain.innerHTML = `
            <div class="simulator-sidebar">
                <h3>Disaster Scenarios</h3>
                <div class="scenario-item active" data-scenario="flood">
                    <div class="scenario-icon flood">
                        <i class="fas fa-water"></i>
                    </div>
                    <div class="scenario-info">
                        <h4>Flash Flood</h4>
                        <p>Rapid water rise simulation</p>
                    </div>
                </div>
                <div class="scenario-item" data-scenario="earthquake">
                    <div class="scenario-icon earthquake">
                        <i class="fas fa-mountain"></i>
                    </div>
                    <div class="scenario-info">
                        <h4>Earthquake</h4>
                        <p>Seismic activity and aftershocks</p>
                    </div>
                </div>
                <div class="scenario-item" data-scenario="fire">
                    <div class="scenario-icon fire">
                        <i class="fas fa-fire"></i>
                    </div>
                    <div class="scenario-info">
                        <h4>Wildfire</h4>
                        <p>Spreading fire simulation</p>
                    </div>
                </div>
                <div class="scenario-item" data-scenario="tornado">
                    <div class="scenario-icon tornado">
                        <i class="fas fa-wind"></i>
                    </div>
                    <div class="scenario-info">
                        <h4>Tornado</h4>
                        <p>Severe weather conditions</p>
                    </div>
                </div>
                <div class="scenario-item" data-scenario="tsunami">
                    <div class="scenario-icon tsunami">
                        <i class="fas fa-wave-square"></i>
                    </div>
                    <div class="scenario-info">
                        <h4>Tsunami</h4>
                        <p>Coastal wave simulation</p>
                    </div>
                </div>

                <div class="stats-panel">
                    <h4>Current Session</h4>
                    <div class="stat-row">
                        <span>People Saved:</span>
                        <span class="stat-value" id="peopleSaved">0</span>
                    </div>
                    <div class="stat-row">
                        <span>Time Elapsed:</span>
                        <span class="stat-value" id="timeElapsed">00:00</span>
                    </div>
                    <div class="stat-row">
                        <span>Score:</span>
                        <span class="stat-value" id="currentScore">0</span>
                    </div>
                    <div class="stat-row">
                        <span>Efficiency:</span>
                        <span class="stat-value" id="efficiency">0%</span>
                    </div>
                </div>
            </div>

            <div class="main-viewer">
                <div class="viewer-header">
                    <h3 id="currentScenario">Flash Flood Simulation</h3>
                    <div class="viewer-controls">
                        <button class="viewer-btn" onclick="pauseSimulation()">
                            <i class="fas fa-pause"></i>
                        </button>
                        <button class="viewer-btn" onclick="resetSimulation()">
                            <i class="fas fa-redo"></i>
                        </button>
                        <button class="viewer-btn" onclick="toggleFullscreen()">
                            <i class="fas fa-expand"></i>
                        </button>
                        <button class="viewer-btn" onclick="exitSimulator()" style="background: var(--accent);">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="simulation-area">
                    <div class="simulation-canvas" id="simulationCanvas">
                        <div class="simulation-placeholder">
                            <i class="fas fa-play-circle"></i>
                            <h3>Simulator Ready</h3>
                            <p>Click "Start New Simulation" above to begin your training</p>
                            <div class="placeholder-features">
                                <div class="feature-item">
                                    <i class="fas fa-brain"></i>
                                    <span>Real-time decision making</span>
                                </div>
                                <div class="feature-item">
                                    <i class="fas fa-users"></i>
                                    <span>Multi-user collaboration</span>
                                </div>
                                <div class="feature-item">
                                    <i class="fas fa-chart-line"></i>
                                    <span>Performance tracking</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="disaster-animations" id="disasterAnimations">
                        <!-- Disaster effects will be added here -->
                    </div>
                    <div class="simulation-overlay" id="simulationOverlay">
                        <div class="overlay-content">
                            <i class="fas fa-spinner fa-spin"></i>
                            <h3>Initializing Training Environment</h3>
                            <p>Preparing realistic scenario based on your skill level...</p>
                            <div class="loading-progress">
                                <div class="loading-bar">
                                    <div class="loading-fill"></div>
                                </div>
                                <span class="loading-text">Setting up simulation...</span>
                            </div>
                        </div>
                    </div>
                    <div class="simulation-hud" id="simulationHUD" style="display: none;">
                        <div class="hud-top">
                            <div class="hud-item">
                                <span class="hud-label">Objective:</span>
                                <span class="hud-value" id="currentObjective">Evacuate 50 people safely</span>
                            </div>
                            <div class="hud-timer">
                                <i class="fas fa-clock"></i>
                                <span id="scenarioTimer">05:00</span>
                            </div>
                            <div class="hud-score">
                                <i class="fas fa-star"></i>
                                <span id="liveScore">0</span>
                            </div>
                        </div>
                        <div class="hud-bottom">
                            <div class="decision-prompt" id="decisionPrompt" style="display: none;">
                                <div class="prompt-content">
                                    <h4>Critical Decision Required</h4>
                                    <p id="promptText">A injured person is trapped. What's your priority?</p>
                                    <div class="prompt-options">
                                        <button class="option-btn" onclick="makeDecision(1)">Assess injury severity first</button>
                                        <button class="option-btn" onclick="makeDecision(2)">Clear escape route immediately</button>
                                        <button class="option-btn" onclick="makeDecision(3)">Call for medical backup</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <div class="simulator-sidebar">
                <h3>Response Tools</h3>
                <div class="tools-panel">
                    <div class="tool-item" onclick="useTool('emergency')">
                        <div class="tool-icon emergency">
                            <i class="fas fa-phone"></i>
                        </div>
                        <div>
                            <h4>Emergency Call</h4>
                            <p>Contact emergency services</p>
                        </div>
                    </div>
                    <div class="tool-item" onclick="useTool('evacuation')">
                        <div class="tool-icon evacuation">
                            <i class="fas fa-route"></i>
                        </div>
                        <div>
                            <h4>Evacuation Route</h4>
                            <p>Plan escape routes</p>
                        </div>
                    </div>
                    <div class="tool-item" onclick="useTool('rescue')">
                        <div class="tool-icon rescue">
                            <i class="fas fa-hands-helping"></i>
                        </div>
                        <div>
                            <h4>Rescue Team</h4>
                            <p>Deploy rescue operations</p>
                        </div>
                    </div>
                    <div class="tool-item" onclick="useTool('communication')">
                        <div class="tool-icon communication">
                            <i class="fas fa-broadcast-tower"></i>
                        </div>
                        <div>
                            <h4>Public Alert</h4>
                            <p>Send emergency alerts</p>
                        </div>
                    </div>
                </div>

                <h3>Objectives</h3>
                <div class="objectives-list" id="objectivesList">
                    <div class="objective-item">
                        <i class="fas fa-check-circle" style="color: var(--secondary);"></i>
                        <span>Evacuate 50 people</span>
                    </div>
                    <div class="objective-item">
                        <i class="far fa-circle" style="color: #ccc;"></i>
                        <span>Establish safe zones</span>
                    </div>
                    <div class="objective-item">
                        <i class="far fa-circle" style="color: #ccc;"></i>
                        <span>Coordinate with authorities</span>
                    </div>
                </div>
            </div>
            `;
            
            // Re-attach event listeners for scenario selection
            const scenarioItems = simulatorMain.querySelectorAll('.scenario-item');
            scenarioItems.forEach(item => {
                item.addEventListener('click', function() {
                    scenarioItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    const scenario = this.dataset.scenario;
                    updateScenarioDisplay(scenario);
                });
            });
        }

        function exitSimulator() {
            const simulatorControls = document.getElementById('simulatorControls');
            const simulatorMain = document.getElementById('simulatorMain');
            
            // Remove active classes for smooth fade-out
            simulatorControls.classList.remove('active');
            simulatorMain.classList.remove('active');
            
            // Hide the simulator interface after animation
            setTimeout(() => {
                simulatorControls.style.display = 'none';
                simulatorMain.style.display = 'none';
            }, 500);
            
            // Stop any running simulation
            if (currentSimulation) clearInterval(currentSimulation);
            if (simulationTimer) clearInterval(simulationTimer);
            if (scenarioTimerInterval) clearInterval(scenarioTimerInterval);
            
            // Reset state
            simulationActive = false;
            currentSimulation = null;
            peopleSaved = 0;
            currentScore = 0;
            
            // Scroll back to the top
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            alert('Simulator closed. Your progress has been saved.');
        }

        function startRandomSimulation() {
            const simulators = ['ar-campus', 'vr-responder', 'city-planner', 'crowd-map'];
            const randomSim = simulators[Math.floor(Math.random() * simulators.length)];
            launchSimulator(randomSim);
        }

        function continueProgress() {
            alert('Loading your latest training session...\nResuming Flash Flood AR simulation from checkpoint.');
        }

        function startRealScenario() {
            alert('Launching Real Scenario Mode...\nChoose from actual emergency situations:\n 2023 Turkey-Syria Earthquake Response\n Hurricane Katrina Evacuation\n 2020 Australian Bushfire Crisis\n COVID-19 Hospital Triage');
            // This would open a modal or redirect to real scenario selection
        }

        function viewAchievements() {
            window.location.href = 'dashboard-student.html#achievements';
        }

        // Progress & Feedback Functions
        function reviewSkills(topic) {
            switch(topic) {
                case 'response-time':
                    alert('Redirecting to Education Module: Time Management in Emergency Response');
                    window.location.href = 'education-modules.html#time-management';
                    break;
                case 'communication':
                    alert('Redirecting to Education Module: Emergency Communication Protocols');
                    window.location.href = 'education-modules.html#communication';
                    break;
                default:
                    window.location.href = 'education-modules.html';
            }
        }

        function practiceScenario(scenario) {
            switch(scenario) {
                case 'speed-training':
                    alert('Starting Speed Training Module...\nFocus on quick decision-making under pressure.');
                    break;
                case 'team-coordination':
                    alert('Starting Team Coordination Practice...\nMultiplayer scenario with other trainees.');
                    break;
            }
        }

        function claimRewards(badge) {
            alert('Congratulations! Badge claimed successfully.\nRedirecting to your achievements page...');
            window.location.href = 'gamified-learning.html#badges';
        }

        function reviewSession(sessionId) {
            alert(`Loading detailed analysis for session ${sessionId}...\nShowing performance metrics, decision timeline, and improvement suggestions.`);
        }

        function replaySession(sessionId) {
            alert(`Restarting session ${sessionId}...\nYou can try different approaches to improve your score.`);
        }

        // Navigation Functions
        function navigateToEducation(module) {
            if (module) {
                window.location.href = `education-modules.html#${module}`;
            } else {
                window.location.href = 'education-modules.html';
            }
        }

        function navigateToGamification() {
            window.location.href = 'gamified-learning.html';
        }

        function navigateToGames() {
            window.location.href = 'gamified-learning.html#games';
        }

        // Enhanced Simulation Functions
        let decisionCount = 0;
        let correctDecisions = 0;
        let simulationActive = false;
        let scenarioTimerInterval;

        function makeDecision(option) {
            decisionCount++;
            
            // Simulate decision evaluation
            const isCorrect = Math.random() > 0.4; // 60% chance of being optimal
            if (isCorrect) {
                correctDecisions++;
                showFeedback('Excellent decision! +50 points', 'success');
                currentScore += 50;
            } else {
                showFeedback('Could be improved. +20 points', 'warning');
                currentScore += 20;
            }
            
            updateStats();
            hideDecisionPrompt();
            
            // Continue simulation with next scenario
            setTimeout(() => {
                if (simulationActive) {
                    triggerRandomEvent();
                }
            }, 3000);
        }

        function showFeedback(message, type) {
            const feedback = document.createElement('div');
            feedback.className = `feedback-toast ${type}`;
            feedback.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-triangle'}"></i>
                <span>${message}</span>
            `;
            
            feedback.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: ${type === 'success' ? 'var(--secondary)' : 'var(--warning)'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                display: flex;
                align-items: center;
                gap: 10px;
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                feedback.remove();
            }, 3000);
        }

        function triggerRandomEvent() {
            const events = [
                {
                    text: "Fire is spreading rapidly. Multiple people need evacuation.",
                    options: [
                        "Evacuate closest group first",
                        "Split team to cover more ground", 
                        "Focus on disabled individuals"
                    ]
                },
                {
                    text: "Communication system is down. How do you coordinate?",
                    options: [
                        "Use hand signals and runners",
                        "Try to restore communications",
                        "Proceed with pre-planned routes"
                    ]
                },
                {
                    text: "Injured person blocks the main exit route.",
                    options: [
                        "Treat injury on-site",
                        "Carefully move to safety",
                        "Find alternative route"
                    ]
                }
            ];
            
            const event = events[Math.floor(Math.random() * events.length)];
            showDecisionPrompt(event.text, event.options);
        }

        function showDecisionPrompt(text, options) {
            const prompt = document.getElementById('decisionPrompt');
            const promptText = document.getElementById('promptText');
            const optionsContainer = prompt.querySelector('.prompt-options');
            
            promptText.textContent = text;
            optionsContainer.innerHTML = '';
            
            options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.onclick = () => makeDecision(index + 1);
                optionsContainer.appendChild(btn);
            });
            
            prompt.style.display = 'block';
        }

        function hideDecisionPrompt() {
            document.getElementById('decisionPrompt').style.display = 'none';
        }

        function startScenarioTimer() {
            let timeLeft = 300; // 5 minutes
            const timerDisplay = document.getElementById('scenarioTimer');
            
            scenarioTimerInterval = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(scenarioTimerInterval);
                    endSimulation();
                }
                timeLeft--;
            }, 1000);
        }

        function endSimulation() {
            simulationActive = false;
            hideDecisionPrompt();
            
            const accuracy = decisionCount > 0 ? Math.round((correctDecisions / decisionCount) * 100) : 0;
            const finalMessage = `
                Simulation Complete!
                
                Final Score: ${currentScore}
                Decision Accuracy: ${accuracy}%
                Decisions Made: ${decisionCount}
                
                ${accuracy >= 80 ? 'Outstanding performance! ' : 
                  accuracy >= 60 ? 'Good work! Keep practicing. ' : 
                  'Review your training materials and try again. '}
            `;
            
            alert(finalMessage);
            
            // Reset for next simulation
            decisionCount = 0;
            correctDecisions = 0;
            document.getElementById('simulationHUD').style.display = 'none';
        }

        // Enhanced simulator launch with HUD
        function launchSimulatorWithHUD(type) {
            simulationActive = true;
            document.getElementById('simulationHUD').style.display = 'block';
            
            // Set scenario-specific objective
            const objectives = {
                'ar-campus': 'Navigate to 3 emergency exits using AR guidance',
                'vr-responder': 'Provide first aid to 5 critical patients',
                'city-planner': 'Design evacuation routes for 10,000 residents',
                'crowd-map': 'Identify and mark 15 safe zones in real-time'
            };
            
            document.getElementById('currentObjective').textContent = objectives[type] || 'Complete training scenario';
            document.getElementById('liveScore').textContent = currentScore;
            
            startScenarioTimer();
            
            // Start first event after 5 seconds
            setTimeout(() => {
                if (simulationActive) {
                    triggerRandomEvent();
                }
            }, 5000);
            
            // Track detailed analytics
            trackSimulationStart(type);
        }

        // Performance Analytics System
        let sessionStartTime;
        let decisionTimes = [];
        let simulationType;

        function trackSimulationStart(type) {
            sessionStartTime = Date.now();
            simulationType = type;
            decisionTimes = [];
            
            console.log(`Started ${type} simulation at ${new Date().toISOString()}`);
        }

        function trackDecisionTime(startTime) {
            const decisionTime = Date.now() - startTime;
            decisionTimes.push(decisionTime);
            
            // Provide real-time feedback on decision speed
            if (decisionTime < 10000) { // Less than 10 seconds
                showFeedback('Quick thinking! Excellent response time.', 'success');
            } else if (decisionTime > 30000) { // More than 30 seconds
                showFeedback('Consider faster decision-making in real emergencies.', 'warning');
            }
        }

        function calculatePerformanceMetrics() {
            const sessionDuration = Date.now() - sessionStartTime;
            const avgDecisionTime = decisionTimes.length > 0 ? 
                decisionTimes.reduce((a, b) => a + b, 0) / decisionTimes.length : 0;
            
            const metrics = {
                sessionDuration: Math.round(sessionDuration / 1000), // in seconds
                avgDecisionTime: Math.round(avgDecisionTime / 1000), // in seconds
                totalDecisions: decisionCount,
                correctDecisions: correctDecisions,
                accuracy: decisionCount > 0 ? Math.round((correctDecisions / decisionCount) * 100) : 0,
                finalScore: currentScore,
                simulationType: simulationType,
                timestamp: new Date().toISOString()
            };
            
            return metrics;
        }

        function generatePerformanceReport(metrics) {
            let report = `
 PERFORMANCE ANALYTICS REPORT
=================================

 Simulation: ${metrics.simulationType.toUpperCase()}
  Duration: ${Math.floor(metrics.sessionDuration / 60)}:${(metrics.sessionDuration % 60).toString().padStart(2, '0')}
 Final Score: ${metrics.finalScore} points

 DECISION METRICS:
    Total Decisions: ${metrics.totalDecisions}
    Accuracy: ${metrics.accuracy}%
    Avg Response Time: ${metrics.avgDecisionTime}s

 PERFORMANCE RATING:
`;

            // Performance rating based on multiple factors
            let rating = 'Needs Improvement';
            let recommendations = [];
            
            if (metrics.accuracy >= 85 && metrics.avgDecisionTime <= 15) {
                rating = 'Expert Level ';
                recommendations.push('Consider advanced training scenarios');
                recommendations.push('Share knowledge with other trainees');
            } else if (metrics.accuracy >= 70 && metrics.avgDecisionTime <= 25) {
                rating = 'Proficient ';
                recommendations.push('Focus on speed improvement');
                recommendations.push('Practice high-pressure scenarios');
            } else if (metrics.accuracy >= 50) {
                rating = 'Developing ';
                recommendations.push('Review emergency response protocols');
                recommendations.push('Practice decision-making exercises');
            } else {
                recommendations.push('Study basic emergency procedures');
                recommendations.push('Start with beginner-level simulations');
                recommendations.push('Consider one-on-one tutoring');
            }

            report += `   ${rating}\n\n`;
            report += ` PERSONALIZED RECOMMENDATIONS:\n`;
            recommendations.forEach(rec => {
                report += `    ${rec}\n`;
            });

            return report;
        }

        // Enhanced makeDecision function with analytics
        function makeDecision(option) {
            const decisionStartTime = Date.now() - 10000; // Simulate decision start time
            trackDecisionTime(decisionStartTime);
            
            decisionCount++;
            
            // Simulate decision evaluation with more sophisticated scoring
            const scenarios = {
                1: { points: 50, feedback: 'Excellent prioritization!', correct: true },
                2: { points: 30, feedback: 'Good approach, but consider assessment first.', correct: false },
                3: { points: 40, feedback: 'Solid choice, backup is important.', correct: true }
            };
            
            const result = scenarios[option] || scenarios[1];
            
            if (result.correct) {
                correctDecisions++;
                showFeedback(result.feedback + ` +${result.points} points`, 'success');
            } else {
                showFeedback(result.feedback + ` +${result.points} points`, 'warning');
            }
            
            currentScore += result.points;
            updateStats();
            hideDecisionPrompt();
            
            // Continue simulation with next scenario
            setTimeout(() => {
                if (simulationActive) {
                    triggerRandomEvent();
                }
            }, 3000);
        }

        // Enhanced endSimulation with detailed analytics
        function endSimulation() {
            simulationActive = false;
            hideDecisionPrompt();
            clearInterval(scenarioTimerInterval);
            
            const metrics = calculatePerformanceMetrics();
            const report = generatePerformanceReport(metrics);
            
            // Show detailed performance report
            alert(report);
            
            // Update user interface with new session data
            addSessionToHistory(metrics);
            updateProgressStats(metrics);
            
            // Reset for next simulation
            decisionCount = 0;
            correctDecisions = 0;
            document.getElementById('simulationHUD').style.display = 'none';
        }

        function addSessionToHistory(metrics) {
            // This would typically save to a database
            console.log('Session completed:', metrics);
            
            // For demo purposes, update the recent sessions display
            // In a real app, this would refresh from server data
        }

        function updateProgressStats(metrics) {
            // Update aggregate statistics
            // This would typically update user's overall progress metrics
            const currentAvg = parseInt(document.querySelector('.stat-number').textContent) || 0;
            const newAvg = Math.round((currentAvg + metrics.finalScore) / 2);
            
            // Update display (simplified for demo)
            if (document.querySelector('.stat-number')) {
                document.querySelector('.stat-number').textContent = newAvg;
            }
        }

        // AR Mode Variables
        let arSimulationActive = false;
        let arStartTime = null;
        let arTimer = null;
        let arPeopleEvacuated = 0;
        let arSafeZonesDiscovered = 0;
        let arTotalPeople = 4;
        let arEvacuatedPeople = new Set();
        let arDiscoveredZones = new Set();

        // Launch AR Mode
        function launchARMode() {
            // Navigate to the dedicated AR simulation page
            window.location.href = 'sandbox/ar-simulation.html';
        }

        // Start AR Simulation
        function arStartSimulation() {
            arSimulationActive = true;
            arStartTime = Date.now();
            
            // Start AR timer
            arTimer = setInterval(arUpdateTimer, 1000);
            
            // Hide scenario alert after 5 seconds
            setTimeout(() => {
                const alert = document.getElementById('arScenarioAlert');
                if (alert) {
                    alert.style.transition = 'opacity 0.5s ease';
                    alert.style.opacity = '0';
                    setTimeout(() => alert.style.display = 'none', 500);
                }
            }, 5000);
            
            // Hide instructions after 10 seconds
            setTimeout(() => {
                const instructions = document.getElementById('arInstructions');
                if (instructions) {
                    instructions.style.transition = 'opacity 0.5s ease';
                    instructions.style.opacity = '0';
                    setTimeout(() => instructions.style.display = 'none', 500);
                }
            }, 10000);
        }

        // Update AR Timer
        function arUpdateTimer() {
            if (!arSimulationActive || !arStartTime) return;
            
            const elapsed = Date.now() - arStartTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            
            const timeElement = document.getElementById('arTimeElapsed');
            if (timeElement) {
                timeElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            arUpdateEfficiency();
        }

        // Update AR Efficiency
        function arUpdateEfficiency() {
            const timeElapsed = (Date.now() - arStartTime) / 1000;
            const maxTime = 300; // 5 minutes
            const timeScore = Math.max(0, (maxTime - timeElapsed) / maxTime);
            const evacuationScore = arPeopleEvacuated / arTotalPeople;
            const zoneScore = arSafeZonesDiscovered / 3;
            
            const efficiency = Math.round((timeScore * 0.4 + evacuationScore * 0.4 + zoneScore * 0.2) * 100);
            const efficiencyElement = document.getElementById('arEfficiency');
            if (efficiencyElement) {
                efficiencyElement.textContent = `${Math.max(0, efficiency)}%`;
            }
        }

        // Interact with AR Safe Zone
        function arInteractWithSafeZone(zoneId) {
            if (!arSimulationActive) return;
            
            arCreateRippleEffect(event);
            
            if (!arDiscoveredZones.has(zoneId)) {
                arDiscoveredZones.add(zoneId);
                arSafeZonesDiscovered++;
                const safeZonesElement = document.getElementById('arSafeZonesFound');
                if (safeZonesElement) {
                    safeZonesElement.textContent = `${arSafeZonesDiscovered}/3`;
                }
                
                // Show feedback
                arShowFeedback(`Safe Zone ${zoneId} Discovered!`, 'success');
                
                // Check completion
                arCheckCompletion();
            } else {
                arShowFeedback(`Safe Zone ${zoneId} already discovered`, 'info');
            }
        }

        // Interact with AR Marker
        function arInteractWithMarker(markerId) {
            if (!arSimulationActive) return;
            
            arCreateRippleEffect(event);
            
            const markerInfo = {
                1: "Emergency Exit: 25m straight ahead. Capacity: 50 people",
                2: "Assembly Point: Turn right and proceed 100m to open courtyard",
                3: "Alternative Route: Stairs blocked, use elevator or west exit"
            };
            
            arShowFeedback(markerInfo[markerId], 'info');
        }

        // Evacuate Person in AR
        function arEvacuatePerson(personId) {
            if (!arSimulationActive) return;
            
            arCreateRippleEffect(event);
            
            if (!arEvacuatedPeople.has(personId)) {
                arEvacuatedPeople.add(personId);
                arPeopleEvacuated++;
                const peopleElement = document.getElementById('arPeopleEvacuated');
                if (peopleElement) {
                    peopleElement.textContent = arPeopleEvacuated;
                }
                
                // Hide the person
                const personElement = document.querySelector(`.ar-person-${personId}`);
                if (personElement) {
                    personElement.style.transition = 'all 0.5s ease';
                    personElement.style.transform = 'scale(0)';
                    personElement.style.opacity = '0';
                    
                    setTimeout(() => {
                        personElement.style.display = 'none';
                    }, 500);
                }
                
                arShowFeedback(`Person ${personId} evacuated safely!`, 'success');
                
                // Check completion
                arCheckCompletion();
            }
        }

        // Create AR Ripple Effect
        function arCreateRippleEffect(event) {
            const ripple = document.createElement('div');
            ripple.className = 'ar-interaction-ripple';
            
            const rect = event.target.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = (event.clientX - rect.left - size / 2) + 'px';
            ripple.style.top = (event.clientY - rect.top - size / 2) + 'px';
            
            event.target.appendChild(ripple);
            
            setTimeout(() => {
                ripple.remove();
            }, 1000);
        }

        // Show AR Feedback
        function arShowFeedback(message, type) {
            const feedback = document.createElement('div');
            feedback.style.cssText = `
                position: fixed;
                top: 120px;
                right: 20px;
                background: ${type === 'success' ? 'rgba(76, 175, 80, 0.9)' : 
                            type === 'warning' ? 'rgba(255, 152, 0, 0.9)' : 
                            'rgba(33, 150, 243, 0.9)'};
                color: white;
                padding: 12px 20px;
                border-radius: 25px;
                font-size: 0.9rem;
                font-weight: 600;
                z-index: 1000;
                animation: slideInRight 0.3s ease;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.3);
                max-width: 300px;
                text-align: center;
            `;
            
            feedback.textContent = message;
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                feedback.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => feedback.remove(), 300);
            }, 3000);
        }

        // Check AR Completion
        function arCheckCompletion() {
            if (arPeopleEvacuated === arTotalPeople && arSafeZonesDiscovered === 3) {
                arCompleteSimulation();
            }
        }

        // Complete AR Simulation
        function arCompleteSimulation() {
            arSimulationActive = false;
            clearInterval(arTimer);
            
            // Show success animation
            const successAnim = document.getElementById('arSuccessAnimation');
            if (successAnim) {
                successAnim.style.display = 'block';
            }
            
            // Calculate final score
            const timeElapsed = (Date.now() - arStartTime) / 1000;
            const finalEfficiency = document.getElementById('arEfficiency').textContent;
            
            setTimeout(() => {
                alert(` AR MISSION ACCOMPLISHED! 

 All ${arTotalPeople} people evacuated safely
 All 3 safe zones discovered
 Time: ${document.getElementById('arTimeElapsed').textContent}
 Efficiency: ${finalEfficiency}

Excellent work! You've successfully completed the AR Campus Evacuation Simulation.

Your performance will be saved to your profile.`);
                
                // Ask if user wants to try again or return
                if (confirm('Would you like to try again with a different scenario?')) {
                    arResetSimulation();
                } else {
                    // Return to normal simulation view
                    resetSimulation();
                }
            }, 2000);
        }

        // Reset AR Simulation
        function arResetSimulation() {
            arSimulationActive = false;
            if (arTimer) clearInterval(arTimer);
            
            // Reset counters
            arPeopleEvacuated = 0;
            arSafeZonesDiscovered = 0;
            arEvacuatedPeople.clear();
            arDiscoveredZones.clear();
            
            // Restart AR mode
            setTimeout(() => {
                launchARMode();
            }, 1000);
        }

        // VR First Responder Simulator Launch Function
        function launchVRResponder() {
            // Show loading indicator
            showLoadingIndicator();
            
            // Add transition effect
            document.body.style.transition = 'opacity 0.3s ease';
            document.body.style.opacity = '0.8';
            
            setTimeout(() => {
                try {
                    // Navigate to VR First Responder page
                    window.location.href = 'sandbox/vr-first-responder.html';
                } catch (error) {
                    console.error('Navigation error:', error);
                    hideLoadingIndicator();
                    document.body.style.opacity = '1';
                    alert(' Unable to load VR First Responder Simulator\n\nPlease ensure the VR simulator page is available.');
                }
            }, 500);
        }
    </script>
        </main>
    </div>
</body>
</html>