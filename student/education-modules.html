<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Disaster Education Modules - DisasterSafe</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #0d47a1;
            --secondary: #34a853;
            --accent: #f25c54;
            --warning: #f9a825;
            --card-bg: #ffffff;
            --text-dark: #202124;
            --light-bg: #f5f7fb;

            /* user palette to use across cards/overlays */
            --p1: #309ad4;
            --p2: #e69c42;
            --p3: #ea8d99;
            --p4: #faafa4;
            --p5: #e2afd3;
            --p6: #c8e5f3;
            --p7: #fae8c7;

            --shadow: 0 8px 20px rgba(18, 38, 63, 0.08);
            --transition: all 0.25s ease;
            --glass: rgba(255, 255, 255, 0.72);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--light-bg);
            color: var(--text-dark);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-family: "Ubuntu", sans-serif;
            font-weight: 400;
            font-style: normal;
        }

        /* Layout */
        .dashboard-container {
            display: grid;
            grid-template-columns: 240px 1fr;
            min-height: 100vh;
        }

        .sidebar {
            background: linear-gradient(180deg, var(--primary), var(--primary-dark));
            color: #fff;
            padding: 22px;
            position: fixed;
            width: 240px;
            height: 100%;
            overflow-y: auto;
            box-shadow: var(--shadow);
            z-index: 200;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }

        .logo i {
            font-size: 22px;
            color: var(--p6);
        }

        .logo h1 {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 0.2px;
        }

        .menu-items {
            margin-top: 18px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex: 1;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            color: rgba(255, 255, 255, 0.95);
        }

        .menu-item i {
            width: 20px;
            text-align: center;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .menu-item.active {
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.14), rgba(255, 255, 255, 0.06));
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
        }

        .new-badge {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: #fff;
            margin-left: auto;
        }

        /* Dropdown Menu Styles - VERTICAL LAYOUT */
        .dropdown-menu {
            position: relative;
            z-index: 10;
            width: 100%;
            display: flex;
            flex-direction: column;
            margin-bottom: 4px;
        }

        .menu-item-main {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            color: rgba(255, 255, 255, 0.95);
        }

        .menu-item-main i:first-child {
            width: 20px;
            text-align: center;
        }

        .dropdown-arrow {
            margin-left: auto;
            transition: transform 0.3s ease;
            font-size: 12px;
        }

        .dropdown-menu.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .menu-item-main:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .dropdown-menu.active .menu-item-main {
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.14), rgba(255, 255, 255, 0.06));
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
        }

        .dropdown-content {
            display: none;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            margin: 4px 0 8px 0;
            padding: 4px 0;
            width: 100%;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .dropdown-menu.active .dropdown-content {
            display: block !important;
            animation: slideDown 0.3s ease-out forwards;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                max-height: 200px;
                transform: translateY(0);
            }
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 16px;
            margin: 2px 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            color: rgba(255, 255, 255, 0.85);
            font-size: 14px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item i {
            width: 16px;
            text-align: center;
            font-size: 12px;
            color: #4ecdc4;
        }

        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.12);
            color: rgba(255, 255, 255, 1);
            transform: translateX(4px);
        }

        .dropdown-item.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
        }

        /* Menu items spacing to accommodate dropdown */
        .menu-items {
            margin-top: 18px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        /* Ensure dropdown pushes other menu items down */
        .dropdown-menu {
            flex-direction: column;
        }

        /* Always show education dropdown content since we're on the education page */
        #educationDropdown .dropdown-content {
            display: block !important;
            opacity: 1 !important;
            max-height: none !important;
            animation: none !important;
        }

        /* Sidebar User Profile */
        .sidebar-user-profile {
            margin-top: auto;
            padding: 12px;
            margin: 0 -12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: var(--transition);
            cursor: pointer;
        }

        .sidebar-user-profile:hover {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--p6), var(--p1));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 700;
            color: var(--primary-dark);
            text-transform: uppercase;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .user-info {
            flex: 1;
            min-width: 0;
        }

        .user-info h4 {
            font-size: 14px;
            font-weight: 600;
            color: white;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-info p {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            margin: 0;
        }

        /* Main content */
        .main-content {
            grid-column: 2;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px;
            border-radius: 12px;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: var(--shadow);
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-profile i {
            font-size: 40px;
            color: #fff;
        }

        .user-profile h4 {
            font-size: 16px;
            margin-bottom: 2px;
        }

        .user-profile p {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.85);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .page-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .page-header h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .page-header p {
            font-size: 1.1rem;
            color: #6c757d;
            margin-bottom: 0;
        }

        .filters-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(16, 24, 32, 0.03);
        }

        .filters-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--primary);
            text-align: center;
            font-weight: 600;
        }

        .filter-groups {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .filter-group {
            text-align: center;
        }

        .filter-group h3 {
            margin-bottom: 15px;
            color: var(--text-dark);
            font-weight: 600;
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid var(--primary);
            background: transparent;
            color: var(--primary);
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .module-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }

        .module-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(to right, var(--primary), var(--p1));
        }

        .module-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 20px 40px rgba(18, 38, 63, 0.15);
        }

        .module-icon {
            width: 70px;
            height: 70px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--p1), var(--primary));
            color: white;
        }

        .module-card h3 {
            font-size: 1.3rem;
            margin-bottom: 12px;
            color: var(--text-dark);
            font-weight: 600;
        }

        .module-card p {
            color: #6c757d;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .age-tag {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(26, 115, 232, 0.1);
            color: var(--primary);
            border-radius: 12px;
            font-size: 0.75rem;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .module-features {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .feature-tag {
            padding: 4px 8px;
            background: rgba(52, 168, 83, 0.1);
            color: var(--secondary);
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .module-actions {
            display: flex;
            gap: 8px;
        }

        .btn-primary {
            flex: 1;
            padding: 10px 16px;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(26, 115, 232, 0.3);
        }

        .btn-secondary {
            padding: 10px 12px;
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .ar-vr-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, var(--p3), var(--accent));
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.65rem;
            font-weight: 700;
        }

        .progress-section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(16, 24, 32, 0.03);
        }

        .progress-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--primary);
            text-align: center;
            font-weight: 600;
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: linear-gradient(180deg, #fff, #fbfdff);
            border-radius: 12px;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .floating-help {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 56px;
            height: 56px;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
            z-index: 1000;
        }

        .floating-help:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(26, 115, 232, 0.4);
        }

        @media (max-width: 992px) {
            .dashboard-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
            }

            .main-content {
                padding: 15px;
            }

            .page-header h1 {
                font-size: 2rem;
            }

            .modules-grid {
                grid-template-columns: 1fr;
            }

            .filter-groups {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                text-align: center;
            }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(6, 12, 30, 0.45);
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: linear-gradient(180deg, #fff, #fbfdff);
            margin: 5% auto;
            padding: 25px;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            position: relative;
            animation: modalSlideIn 0.3s ease;
            box-shadow: 0 18px 50px rgba(8, 12, 32, 0.25);
            border: 1px solid rgba(16, 24, 40, 0.04);
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .close {
            position: absolute;
            top: 12px;
            right: 18px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            color: #6c757d;
            transition: var(--transition);
        }

        .close:hover {
            color: var(--accent);
        }

        .ar-viewer {
            width: 100%;
            height: 350px;
            background: linear-gradient(135deg, var(--p1), var(--primary));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        /* Risk Assessment Styles */
        .risk-question {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            transition: var(--transition);
        }

        .risk-question:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .risk-question label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--text-dark);
        }

        .radio-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            transition: var(--transition);
        }

        .radio-option:hover {
            background: rgba(26, 115, 232, 0.1);
        }

        .radio-option input[type="radio"] {
            margin: 0;
            width: 16px;
            height: 16px;
        }

        .risk-gauge {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin: 0 auto;
        }

        .risk-gauge-inner {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .risk-percentage {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .risk-label {
            font-size: 0.9rem;
            color: #666;
        }

        .disaster-module-content {
            max-height: 70vh;
            overflow-y: auto;
        }

        .disaster-module-content::-webkit-scrollbar {
            width: 6px;
        }

        .disaster-module-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .disaster-module-content::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .action-item {
            margin-bottom: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: var(--transition);
        }

        .action-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .action-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        .recommendation-item {
            margin-bottom: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            line-height: 1.5;
        }

        .high-risk-area {
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            border: 1px solid rgba(244, 67, 54, 0.2);
            transition: var(--transition);
        }

        .high-risk-area:hover {
            border-color: rgba(244, 67, 54, 0.4);
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.1);
        }

        /* Assessment Dashboard Styles */
        .assessment-dashboard:not(:empty) {
            margin: 20px 0;
        }

        .assessment-notification {
            background: linear-gradient(135deg, var(--secondary), #2e7d32);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border-left: 4px solid #4caf50;
            animation: slideInDown 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .assessment-notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 40%, rgba(255, 255, 255, 0.1) 50%, transparent 60%);
            animation: shimmer 2s infinite;
        }

        .assessment-notification.improvement {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-left-color: var(--primary);
        }

        .assessment-notification.warning {
            background: linear-gradient(135deg, var(--warning), #f57c00);
            border-left-color: var(--warning);
        }

        .notification-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .notification-header i {
            font-size: 1.3rem;
        }

        .notification-content {
            font-size: 0.95rem;
            line-height: 1.5;
            opacity: 0.95;
        }

        /* Performance Summary Styles */
        .performance-summary {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .performance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .performance-header h2 {
            color: var(--text-dark);
            font-size: 1.8rem;
            font-weight: 700;
        }

        .overall-rating {
            text-align: center;
        }

        .rating-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            position: relative;
            box-shadow: 0 4px 20px rgba(26, 115, 232, 0.3);
        }

        .rating-score {
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
        }

        .rating-max {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .rating-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .performance-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .category-item {
            background: rgba(26, 115, 232, 0.05);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(26, 115, 232, 0.1);
            transition: var(--transition);
        }

        .category-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(26, 115, 232, 0.15);
        }

        .category-item i {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .category-name {
            display: block;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 15px;
        }

        .category-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 4px;
            transition: width 0.8s ease;
        }

        .progress-text {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-dark);
            min-width: 35px;
        }

        .performance-insights {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
        }

        .performance-insights h3 {
            color: var(--text-dark);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .insights-content {
            line-height: 1.6;
            color: #555;
        }

        .insights-list {
            list-style: none;
            padding: 0;
        }

        .insights-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .insights-list li:last-child {
            border-bottom: none;
        }

        .insights-list li i {
            color: var(--secondary);
            margin-top: 2px;
            flex-shrink: 0;
        }

        .insights-list li.warning i {
            color: var(--warning);
        }

        .insights-list li.improvement i {
            color: var(--primary);
        }

        .module-completed {
            position: relative;
        }

        .completion-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: var(--secondary);
            color: white;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 2;
            box-shadow: 0 2px 8px rgba(52, 168, 83, 0.3);
        }

        .module-progress-indicator {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #e0e0e0;
            border-radius: 0 0 12px 12px;
            overflow: hidden;
        }

        .module-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.8s ease;
            border-radius: 0 0 12px 12px;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 0.3;
            }
            50% {
                opacity: 0.7;
            }
        }

        /* Responsive adjustments for assessment features */
        @media (max-width: 768px) {
            .performance-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .performance-categories {
                grid-template-columns: 1fr;
            }

            .rating-circle {
                width: 70px;
                height: 70px;
            }

            .rating-score {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
                <h1>JeevanSetu</h1>
            </div>
            <div class="menu-items">
                <div class="menu-item" data-link="dashboard-student.html"><i
                        class="fas fa-home"></i><span>Dashboard</span></div>
                <div class="menu-item dropdown-menu active" id="educationDropdown">
                    <div class="menu-item-main">
                        <i class="fas fa-book"></i><span>Education Modules</span>
                        <i class="fas fa-chevron-down dropdown-arrow"></i>
                    </div>
                    <div class="dropdown-content">
                        <div class="dropdown-item active" data-link="education-modules.html"><i
                                class="fas fa-graduation-cap"></i><span>Learning Modules</span></div>
                        <div class="dropdown-item" data-link="dos&donts.html"><i
                                class="fas fa-exclamation-triangle"></i><span>Dos & Don'ts</span></div>
                    </div>
                </div>
                <div class="menu-item" data-link="sandbox-simulator.html"><i class="fas fa-gamepad"></i><span>Sandbox
                        Simulator</span></div>
                <div class="menu-item" data-link="emergency_contacts.html"><i
                        class="fas fa-phone-alt"></i><span>Emergency Contacts</span></div>
                <div class="menu-item" data-link="drill_schedule.html"><i
                        class="fa-solid fa-calendar-days"></i><span>Drill Schedule</span></div>
                <div class="menu-item" data-link="advanced-map.html"><i class="fas fa-map-marked-alt"></i><span>Disaster
                        Map</span></div>
                <div class="menu-item" data-link="chatbot.html"><i class="fas fa-robot"></i><span>AI Helper</span></div>
                <div class="menu-item" data-link="gamified-learning.html"><i
                        class="fas fa-graduation-cap"></i><span>Gamified Learning</span></div>
                <!-- <div class="menu-item"><i class="fas fa-user"></i><span>Profile & Badges</span></div> -->
                <div class="menu-item" data-link="settings.html"><i class="fas fa-cog"></i><span>Settings</span></div>
            </div>

            <!-- User Profile at Bottom -->
            <div class="sidebar-user-profile">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-info">
                    <h4 id="sidebarUserName">User</h4>
                    <p>Student</p>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <div class="page-header">
                    <h1 data-translate="title">Interactive Disaster Education</h1>
                    <p data-translate="subtitle">Learn disaster management through immersive AR/VR experiences and
                        interactive modules</p>
                </div>

                <!-- Learning Assessment Dashboard -->
                <div class="assessment-dashboard" id="assessmentDashboard">
                    <!-- Assessment notification will be added here dynamically -->
                </div>

                <!-- Learning Performance Summary -->
                <div class="performance-summary" id="performanceSummary">
                    <div class="performance-header">
                        <h2>Your Learning Progress Profile</h2>
                        <div class="overall-rating" id="overallRating">
                            <div class="rating-circle">
                                <span class="rating-score" id="ratingScore">0</span>
                                <span class="rating-max">%</span>
                            </div>
                            <div class="rating-label" id="ratingLabel">Getting Started</div>
                        </div>
                    </div>

                    <div class="performance-categories">
                        <div class="category-item">
                            <i class="fas fa-shield-alt"></i>
                            <span class="category-name">Mitigation</span>
                            <div class="category-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="mitigationProgress" style="width: 0%"></div>
                                </div>
                                <span class="progress-text" id="mitigationText">0%</span>
                            </div>
                        </div>

                        <div class="category-item">
                            <i class="fas fa-toolbox"></i>
                            <span class="category-name">Preparedness</span>
                            <div class="category-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="preparednessProgress" style="width: 0%"></div>
                                </div>
                                <span class="progress-text" id="preparednessText">0%</span>
                            </div>
                        </div>

                        <div class="category-item">
                            <i class="fas fa-heart"></i>
                            <span class="category-name">First Aid</span>
                            <div class="category-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="firstAidProgress" style="width: 0%"></div>
                                </div>
                                <span class="progress-text" id="firstAidText">0%</span>
                            </div>
                        </div>

                        <div class="category-item">
                            <i class="fas fa-users"></i>
                            <span class="category-name">Response</span>
                            <div class="category-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="responseProgress" style="width: 0%"></div>
                                </div>
                                <span class="progress-text" id="responseText">0%</span>
                            </div>
                        </div>
                    </div>

                    <div class="performance-insights" id="performanceInsights">
                        <h3>Your Learning Insights & Recommendations</h3>
                        <div class="insights-content" id="insightsContent">
                            <p>Complete learning modules to receive personalized insights about your disaster preparedness knowledge!</p>
                        </div>
                    </div>
                </div>

                <div class="filters-section">
                    <h2 class="filters-title" data-translate="filters">Choose Your Learning Path</h2>
                    <div class="filter-groups">
                        <div class="filter-group">
                            <h3 data-translate="ageGroup">Age Group</h3>
                            <div class="filter-buttons">
                                <button class="filter-btn active" data-filter="age" data-value="all">All Ages</button>
                                <button class="filter-btn" data-filter="age" data-value="1-5">1-5 Years</button>
                                <button class="filter-btn" data-filter="age" data-value="5-8">5-8 Years</button>
                                <button class="filter-btn" data-filter="age" data-value="8-12">8-12 Years</button>
                                <button class="filter-btn" data-filter="age" data-value="12+">12+ Years</button>
                            </div>
                        </div>
                        <div class="filter-group">
                            <h3 data-translate="topics">Topics</h3>
                            <div class="filter-buttons">
                                <button class="filter-btn active" data-filter="topic" data-value="all">All
                                    Topics</button>
                                <button class="filter-btn" data-filter="topic"
                                    data-value="mitigation">Mitigation</button>
                                <button class="filter-btn" data-filter="topic"
                                    data-value="preparedness">Preparedness</button>
                                <button class="filter-btn" data-filter="topic" data-value="first-aid">First Aid</button>
                                <button class="filter-btn" data-filter="topic" data-value="response">Response</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modules-grid" id="modulesGrid">

                    <!-- Preparedness Modules -->
                    <div class="module-card" id="emergency-kit" data-age="5-8,8-12" data-topic="preparedness">
                        <!-- <div class="ar-vr-indicator">AR Ready</div> -->
                        <div class="module-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="age-tag">Ages 5-12</div>
                        <h3>Emergency Kit Builder</h3>
                        <p>Create your family emergency kit using AR to visualize and organize essential supplies.</p>
                        <div class="module-features">
                            <span class="feature-tag">AR Experience</span>
                            <span class="feature-tag">Practical</span>
                            <span class="feature-tag">Family</span>
                        </div>
                        <div class="module-actions">
                            <button class="btn-primary" onclick="window.location.href='emergency-kit-builder.html'">Start
                                Learning</button>
                            <button class="btn-secondary" onclick="previewAR('kit-ar')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="module-card" id="evacuation-planning" data-age="8-12,12+" data-topic="preparedness">
                        <div class="module-icon">
                            <i class="fas fa-route"></i>
                        </div>
                        <div class="age-tag">Ages 8+</div>
                        <h3>Evacuation Planning</h3>
                        <p>Learn to create effective evacuation plans for different disaster scenarios using interactive
                            mapping.</p>
                        <div class="module-features">
                            <span class="feature-tag">Interactive Map</span>
                            <span class="feature-tag">Planning</span>
                            <span class="feature-tag">Strategy</span>
                        </div>
                        <div class="module-actions">
                            <button class="btn-primary" onclick="startModule('evacuation-planning', 'preparedness')">Start
                                Learning</button>
                            <button class="btn-secondary" onclick="previewAR('evacuation-ar')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <!-- First Aid Modules -->
                    <div class="module-card" id="basic-life-support" data-age="5-8,8-12,12+" data-topic="first-aid">
                        <!-- <div class="ar-vr-indicator">VR Ready</div> -->
                        <div class="module-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <div class="age-tag">Ages 5+</div>
                        <h3>Basic Life Support</h3>
                        <p>Master CPR and basic life support techniques through guided VR training with realistic
                            scenarios.</p>
                        <div class="module-features">
                            <span class="feature-tag">VR Training</span>
                            <span class="feature-tag">Life-saving</span>
                            <span class="feature-tag">Certified</span>
                        </div>
                        <div class="module-actions">
                            <button class="btn-primary" onclick="startModule('basic-life-support', 'firstAid')">Start
                                Learning</button>
                            <button class="btn-secondary" onclick="previewAR('cpr-vr')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="module-card" id="wound-care" data-age="8-12,12+" data-topic="first-aid">
                        <!-- <div class="ar-vr-indicator">AR Ready</div> -->
                        <div class="module-icon">
                            <i class="fas fa-band-aid"></i>
                        </div>
                        <div class="age-tag">Ages 8+</div>
                        <h3>Wound Care & Treatment</h3>
                        <p>Learn proper wound care and emergency treatment techniques using AR-guided tutorials.</p>
                        <div class="module-features">
                            <span class="feature-tag">AR Guidance</span>
                            <span class="feature-tag">Medical</span>
                            <span class="feature-tag">Hands-on</span>
                        </div>
                        <div class="module-actions">
                            <button class="btn-primary" onclick="startModule('wound-care', 'firstAid')">Start
                                Learning</button>
                            <button class="btn-secondary" onclick="previewAR('wound-ar')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Response Modules -->
                    <div class="module-card" id="disaster-response-children" data-age="1-5,5-8" data-topic="response">
                        <!-- <div class="ar-vr-indicator">AR Ready</div> -->
                        <div class="module-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="age-tag">Ages 1-8</div>
                        <h3>What to Do When Disaster Strikes</h3>
                        <p>Simple, age-appropriate steps for children during emergencies, taught through interactive AR
                            stories.</p>
                        <div class="module-features">
                            <span class="feature-tag">AR Stories</span>
                            <span class="feature-tag">Child-friendly</span>
                            <span class="feature-tag">Essential</span>
                        </div>
                        <div class="module-actions">
                            <button class="btn-primary" onclick="startModule('disaster-response-children', 'response')">Start
                                Learning</button>
                            <button class="btn-secondary" onclick="previewAR('response-ar')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="module-card" id="community-response" data-age="12+" data-topic="response">
                        <!-- <div class="ar-vr-indicator">VR Ready</div> -->
                        <div class="module-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="age-tag">Ages 12+</div>
                        <h3>Community Response Leadership</h3>
                        <p>Develop leadership skills for coordinating community disaster response through immersive VR
                            scenarios.</p>
                        <div class="module-features">
                            <span class="feature-tag">VR Simulation</span>
                            <span class="feature-tag">Leadership</span>
                            <span class="feature-tag">Advanced</span>
                        </div>
                        <div class="module-actions">
                            <button class="btn-primary" onclick="startModule('community-response', 'response')">Start
                                Learning</button>
                            <button class="btn-secondary" onclick="previewAR('leadership-vr')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Mitigation Modules -->
                    <div class="module-card" id="flood-prevention-card" data-age="1-5,5-8" data-topic="mitigation">
                        <div class="ar-vr-indicator">AR Ready</div>
                        <div class="module-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="age-tag">Ages 1-8</div>
                        <h3>Flood Prevention Basics</h3>
                        <p>Learn how to protect your home and family from floods through fun interactive activities and
                            AR visualization.</p>
                        <div class="module-features">
                            <span class="feature-tag">AR Experience</span>
                            <span class="feature-tag">Interactive</span>
                            <span class="feature-tag">Beginner</span>
                        </div>
                        <div class="module-actions">
                            <button class="btn-primary" onclick="startModule('flood-prevention', 'mitigation')">Start
                                Learning</button>
                            <button class="btn-secondary" onclick="previewAR('flood-ar')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <span id="flood-prevention-status"
                            style="position:absolute;top:15px;left:15px;display:none;background:#34a853;color:white;padding:5px 12px;border-radius:12px;font-size:0.9rem;z-index:2;">Completed</span>
                    </div>

                    <div class="module-card" id="earthquake-safety" data-age="8-12,12+" data-topic="mitigation">
                        <!-- <div class="ar-vr-indicator">VR Ready</div> -->
                        <div class="module-icon">
                            <i class="fas fa-mountain"></i>
                        </div>
                        <div class="age-tag">Ages 8+</div>
                        <h3>Earthquake Safety Engineering</h3>
                        <p>Understand building design and earthquake-resistant construction through immersive VR
                            simulations.</p>
                        <div class="module-features">
                            <span class="feature-tag">VR Experience</span>
                            <span class="feature-tag">Advanced</span>
                            <span class="feature-tag">Engineering</span>
                        </div>
                        <div class="module-actions">
                            <button class="btn-primary" onclick="startModule('earthquake-safety', 'mitigation')">Start
                                Learning</button>
                            <button class="btn-secondary" onclick="previewAR('earthquake-vr')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
    </div>
    </div>

    <div class="floating-help" onclick="openHelp()">>
        <i class="fas fa-question"></i>
    </div>

    <!-- AR/VR Preview Modal -->
    <div id="arModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>AR/VR Preview</h2>
            <div class="ar-viewer">
                <div style="text-align: center;">
                    <i class="fas fa-cube fa-3x" style="margin-bottom: 20px;"></i>
                    <p>AR/VR Experience Loading...</p>
                    <p style="font-size: 0.9rem; opacity: 0.8;">Use your device's camera for AR mode or VR headset for
                        full immersion</p>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn-primary" style="margin-right: 10px;">Launch Full Experience</button>
                <button class="btn-secondary">Download AR App</button>
            </div>
        </div>
    </div>

    <script>
        // Learning Progress Tracking System
        class EducationProgressTracker {
            constructor() {
                this.storageKey = 'education_progress_data';
                this.sessionKey = 'education_session_data';
                this.data = this.loadData();
                this.sessionData = this.loadSessionData();
            }

            loadData() {
                const saved = localStorage.getItem(this.storageKey);
                if (saved) {
                    return JSON.parse(saved);
                }
                return {
                    totalModulesCompleted: 0,
                    totalScore: 0,
                    totalTime: 0,
                    moduleResults: {},
                    categoryScores: {
                        mitigation: { score: 0, attempts: 0, maxScore: 0 },
                        preparedness: { score: 0, attempts: 0, maxScore: 0 },
                        firstAid: { score: 0, attempts: 0, maxScore: 0 },
                        response: { score: 0, attempts: 0, maxScore: 0 }
                    },
                    lastCompletedDate: null,
                    achievements: [],
                    overallRating: 0,
                    learningTraits: {
                        comprehension: 0,
                        retention: 0,
                        application: 0,
                        engagement: 0,
                        consistency: 0
                    }
                };
            }

            loadSessionData() {
                const saved = sessionStorage.getItem(this.sessionKey);
                if (saved) {
                    return JSON.parse(saved);
                }
                return {
                    modulesCompletedThisSession: [],
                    improvementsSeen: false,
                    lastNotificationShown: null
                };
            }

            saveData() {
                localStorage.setItem(this.storageKey, JSON.stringify(this.data));
                sessionStorage.setItem(this.sessionKey, JSON.stringify(this.sessionData));
            }

            recordModuleCompletion(moduleId, score, timeSpent, category, skillsLearned) {
                // Record module result
                if (!this.data.moduleResults[moduleId]) {
                    this.data.moduleResults[moduleId] = {
                        timesCompleted: 0,
                        bestScore: 0,
                        averageScore: 0,
                        totalScore: 0,
                        totalTime: 0,
                        lastCompleted: null,
                        improvement: 0,
                        category: category
                    };
                }

                const moduleResult = this.data.moduleResults[moduleId];
                const previousBest = moduleResult.bestScore;

                moduleResult.timesCompleted++;
                moduleResult.totalScore += score;
                moduleResult.totalTime += timeSpent;
                moduleResult.averageScore = moduleResult.totalScore / moduleResult.timesCompleted;
                moduleResult.lastCompleted = new Date().toISOString();

                if (score > moduleResult.bestScore) {
                    moduleResult.bestScore = score;
                    moduleResult.improvement = score - previousBest;
                }

                // Update category scores
                this.updateCategoryScores(category, score, skillsLearned);

                // Update overall statistics
                this.data.totalModulesCompleted++;
                this.data.totalScore += score;
                this.data.totalTime += timeSpent;
                this.data.lastCompletedDate = new Date().toISOString();

                // Update learning traits
                this.updateLearningTraits(moduleId, score, timeSpent, skillsLearned);

                // Record session data
                this.sessionData.modulesCompletedThisSession.push({
                    moduleId,
                    score,
                    timeSpent,
                    timestamp: new Date().toISOString(),
                    improved: moduleResult.improvement > 0
                });

                // Calculate new overall rating
                this.calculateOverallRating();

                this.saveData();
            }

            updateCategoryScores(category, score, skillsLearned) {
                if (this.data.categoryScores[category]) {
                    const categoryData = this.data.categoryScores[category];
                    categoryData.attempts++;
                    categoryData.score += score;
                    categoryData.maxScore = Math.max(categoryData.maxScore, score);
                }
            }

            updateLearningTraits(moduleId, score, timeSpent, skillsLearned) {
                const maxTime = 45; // minutes
                const timeRatio = Math.min(timeSpent / maxTime, 1);
                const scoreRatio = score / 100;

                // Comprehension (understanding concepts)
                if (score > 80) {
                    this.data.learningTraits.comprehension += 5;
                }

                // Retention (repeated good performance)
                const moduleResult = this.data.moduleResults[moduleId];
                if (moduleResult && moduleResult.timesCompleted > 1 && score > 75) {
                    this.data.learningTraits.retention += 3;
                }

                // Application (practical understanding)
                if (skillsLearned && skillsLearned.length > 2 && score > 70) {
                    this.data.learningTraits.application += 4;
                }

                // Engagement (completion rate and time spent)
                if (timeSpent > 15 && score > 65) {
                    this.data.learningTraits.engagement += 3;
                }

                // Consistency (regular learning)
                const recentModules = this.sessionData.modulesCompletedThisSession.slice(-3);
                if (recentModules.length >= 2) {
                    this.data.learningTraits.consistency += 2;
                }

                // Cap learning traits at 100
                Object.keys(this.data.learningTraits).forEach(trait => {
                    this.data.learningTraits[trait] = Math.min(this.data.learningTraits[trait], 100);
                });
            }

            calculateOverallRating() {
                let totalWeight = 0;
                let weightedScore = 0;

                // Category performance (50% weight)
                Object.values(this.data.categoryScores).forEach(category => {
                    if (category.attempts > 0) {
                        const categoryScore = (category.score / category.attempts); // Keep as percentage
                        weightedScore += categoryScore * 0.125; // Each category gets 12.5% (50% total)
                        totalWeight += 0.125;
                    }
                });

                // Module diversity (20% weight)
                const uniqueModulesCompleted = Object.keys(this.data.moduleResults).length;
                const totalModules = 8; // Total number of available modules
                const diversityScore = (uniqueModulesCompleted / totalModules) * 20; // Convert to percentage
                weightedScore += diversityScore;
                totalWeight += 0.2;

                // Consistency (15% weight)
                const modules = Object.values(this.data.moduleResults);
                if (modules.length > 1) {
                    const averageScore = modules.reduce((sum, module) => sum + module.averageScore, 0) / modules.length;
                    const consistencyScore = (averageScore / 100) * 15; // Convert to percentage
                    weightedScore += consistencyScore;
                    totalWeight += 0.15;
                }

                // Improvement trend (15% weight)
                const recentModules = this.sessionData.modulesCompletedThisSession.slice(-3);
                if (recentModules.length > 0) {
                    const improvementCount = recentModules.filter(module => module.improved).length;
                    const improvementScore = (improvementCount / recentModules.length) * 15; // Convert to percentage
                    weightedScore += improvementScore;
                    totalWeight += 0.15;
                }

                // Calculate final rating (0-100 percentage scale)
                this.data.overallRating = totalWeight > 0 ? Math.min(weightedScore, 100) : 0;
            }

            getOverallRating() {
                return {
                    score: Math.round(this.data.overallRating),
                    label: this.getRatingLabel(this.data.overallRating),
                    description: this.getRatingDescription(this.data.overallRating)
                };
            }

            getRatingLabel(score) {
                if (score >= 90) return "Disaster Education Expert";
                if (score >= 80) return "Highly Knowledgeable";
                if (score >= 70) return "Well Educated";
                if (score >= 60) return "Good Understanding";
                if (score >= 50) return "Moderate Knowledge";
                if (score >= 40) return "Basic Understanding";
                if (score >= 30) return "Learning Foundation";
                if (score >= 20) return "Building Knowledge";
                if (score >= 10) return "Getting Started";
                return "Just Beginning";
            }

            getRatingDescription(score) {
                if (score >= 90) return "You have mastered disaster education concepts and could effectively teach others about emergency preparedness.";
                if (score >= 80) return "You have strong knowledge of disaster management and safety protocols across multiple areas.";
                if (score >= 70) return "You demonstrate good understanding of disaster preparedness and emergency response principles.";
                if (score >= 60) return "You have solid foundation knowledge with some areas that could benefit from review.";
                if (score >= 50) return "You understand basic disaster concepts but should continue learning for better preparedness.";
                if (score >= 40) return "You're developing disaster knowledge but need more comprehensive learning across topics.";
                if (score >= 30) return "You're building fundamental understanding - continue with different module types to improve.";
                if (score >= 20) return "You're making progress in disaster education - focus on completing more diverse modules.";
                if (score >= 10) return "You're beginning your disaster education journey - explore different learning modules to build knowledge.";
                return "Start completing learning modules to develop your disaster preparedness knowledge and skills.";
            }

            getCategoryProgress() {
                const categories = {};
                Object.entries(this.data.categoryScores).forEach(([key, category]) => {
                    if (category.attempts > 0) {
                        const percentage = Math.min((category.score / category.attempts), 100);
                        categories[key] = {
                            percentage: Math.round(percentage),
                            score: category.score / category.attempts,
                            attempts: category.attempts
                        };
                    } else {
                        categories[key] = { percentage: 0, score: 0, attempts: 0 };
                    }
                });
                return categories;
            }

            getPersonalizedInsights() {
                const insights = [];
                const categoryProgress = this.getCategoryProgress();
                const traits = this.data.learningTraits;

                // Analyze strengths
                const strongCategories = Object.entries(categoryProgress)
                    .filter(([key, data]) => data.percentage >= 80)
                    .map(([key]) => key);

                const weakCategories = Object.entries(categoryProgress)
                    .filter(([key, data]) => data.percentage < 60 && data.attempts > 0)
                    .map(([key]) => key);

                if (strongCategories.length > 0) {
                    const categoryNames = {
                        mitigation: "disaster mitigation",
                        preparedness: "emergency preparedness",
                        firstAid: "first aid skills",
                        response: "emergency response"
                    };

                    insights.push({
                        type: 'strength',
                        icon: 'fas fa-check-circle',
                        text: `Excellent progress in ${strongCategories.map(c => categoryNames[c]).join(', ')}. You've mastered these areas!`
                    });
                }

                if (weakCategories.length > 0) {
                    const categoryNames = {
                        mitigation: "disaster mitigation",
                        preparedness: "emergency preparedness",
                        firstAid: "first aid skills",
                        response: "emergency response"
                    };

                    insights.push({
                        type: 'improvement',
                        icon: 'fas fa-lightbulb',
                        text: `Focus on ${weakCategories.map(c => categoryNames[c]).join(', ')} modules to improve your overall preparedness knowledge.`
                    });
                }

                // Learning trait insights
                const topTrait = Object.entries(traits).reduce((max, [key, value]) =>
                    value > max.value ? { key, value } : max, { key: '', value: 0 });

                if (topTrait.value >= 50) {
                    const traitNames = {
                        comprehension: "understanding complex concepts quickly",
                        retention: "remembering important safety information",
                        application: "applying knowledge to real situations",
                        engagement: "active participation in learning",
                        consistency: "regular and steady learning progress"
                    };

                    insights.push({
                        type: 'strength',
                        icon: 'fas fa-star',
                        text: `Your strongest learning trait is ${traitNames[topTrait.key]}. This will help you in emergency situations!`
                    });
                }

                // Module diversity insight
                const uniqueModules = Object.keys(this.data.moduleResults).length;
                const totalModules = 8; // Total number of available modules
                if (uniqueModules < totalModules) {
                    insights.push({
                        type: 'improvement',
                        icon: 'fas fa-graduation-cap',
                        text: `Complete more learning modules (${uniqueModules}/${totalModules} completed) to develop comprehensive disaster preparedness knowledge.`
                    });
                }

                // Recent improvement insight
                const recentImprovements = this.sessionData.modulesCompletedThisSession.filter(m => m.improved).length;
                if (recentImprovements > 0) {
                    insights.push({
                        type: 'improvement',
                        icon: 'fas fa-trending-up',
                        text: `Outstanding! You've improved your understanding in ${recentImprovements} module(s) this session. Keep learning!`
                    });
                }

                if (insights.length === 0) {
                    insights.push({
                        type: 'neutral',
                        icon: 'fas fa-book-open',
                        text: 'Complete learning modules to receive personalized insights about your disaster preparedness knowledge!'
                    });
                }

                return insights;
            }

            getReturnNotification() {
                const recentImprovements = this.sessionData.modulesCompletedThisSession.filter(m => m.improved);
                const overallRating = this.getOverallRating();

                if (recentImprovements.length > 0) {
                    return {
                        type: 'improvement',
                        title: 'Learning Progress!',
                        content: `Welcome back! You've improved your understanding in recent modules. Your learning completion is now ${overallRating.score}% (${overallRating.label}). ${overallRating.description}`
                    };
                }

                if (this.data.totalModulesCompleted > 0) {
                    return {
                        type: 'welcome',
                        title: 'Continue Learning!',
                        content: `Your current learning completion is ${overallRating.score}% (${overallRating.label}). Continue with modules to expand your disaster preparedness knowledge.`
                    };
                }

                return null;
            }

            // Mark module as completed
            completeModule(moduleId, category = 'general') {
                const score = Math.floor(Math.random() * 20) + 80; // Random score between 80-100
                const timeSpent = Math.floor(Math.random() * 20) + 15; // Random time between 15-35 minutes
                const skills = ['safety protocols', 'emergency procedures', 'risk assessment', 'prevention techniques'];
                const skillsLearned = skills.slice(0, Math.floor(Math.random() * 3) + 2);

                this.recordModuleCompletion(moduleId, score, timeSpent, category, skillsLearned);
                return { score, timeSpent, skillsLearned };
            }

            // Check if module is completed
            isModuleCompleted(moduleId) {
                return this.data.moduleResults[moduleId] && this.data.moduleResults[moduleId].timesCompleted > 0;
            }

            // Get module progress (for progress bars)
            getModuleProgress(moduleId) {
                const module = this.data.moduleResults[moduleId];
                if (!module) return 0;
                return Math.min((module.averageScore / 100) * 100, 100);
            }
        }

        // Initialize progress tracker
        const progressTracker = new EducationProgressTracker();

        // Load User Information from database/session
        async function loadUserInfo() {
            try {
                // First try to get user data from session/localStorage
                let userData = null;

                // Check localStorage for stored user data
                const localData = localStorage.getItem('resq_user') || localStorage.getItem('currentUser') || localStorage.getItem('user');
                if (localData) {
                    userData = JSON.parse(localData);
                }

                // If no local data or token exists, try to fetch from backend
                const token = localStorage.getItem('token') || localStorage.getItem('authToken') || localStorage.getItem('jwt');
                if (!userData && token) {
                    try {
                        const response = await fetch('http://localhost:5000/api/auth/current', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (response.ok) {
                            userData = await response.json();
                            // Save to localStorage for future use
                            localStorage.setItem('resq_user', JSON.stringify(userData));
                        } else {
                            console.log('Failed to fetch user from backend:', response.status);
                        }
                    } catch (fetchError) {
                        console.log('Could not fetch user from backend:', fetchError.message);
                    }
                }

                if (userData) {
                    const firstName = userData.firstName || userData.name || userData.username || userData.email?.split('@')[0] || 'User';
                    const lastName = userData.lastName || '';
                    const fullName = lastName ? `${firstName} ${lastName}` : firstName;

                    // Update sidebar user profile
                    const userNameElement = document.getElementById('sidebarUserName');
                    const userAvatarElement = document.getElementById('userAvatar');

                    if (userNameElement) userNameElement.textContent = fullName;
                    if (userAvatarElement) userAvatarElement.textContent = firstName.charAt(0).toUpperCase();

                    console.log('User loaded:', fullName);
                } else {
                    // Fallback to default values
                    console.log('No user data found');
                    setDefaultUser();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                setDefaultUser();
            }
        }

        function setDefaultUser() {
            const userNameElement = document.getElementById('sidebarUserName');
            const userAvatarElement = document.getElementById('userAvatar');

            if (userNameElement) userNameElement.textContent = 'Guest User';
            if (userAvatarElement) userAvatarElement.textContent = 'G';
        }

        // Initialize the assessment system
        function initializeAssessmentSystem() {
            updatePerformanceDashboard();
            showReturnNotification();
            updateModuleCompletionStatus();
        }

        // Update performance dashboard
        function updatePerformanceDashboard() {
            const overallRating = progressTracker.getOverallRating();
            const categoryProgress = progressTracker.getCategoryProgress();
            const insights = progressTracker.getPersonalizedInsights();

            // Update overall rating
            document.getElementById('ratingScore').textContent = overallRating.score;
            document.getElementById('ratingLabel').textContent = overallRating.label;

            // Update category progress
            Object.entries(categoryProgress).forEach(([category, data]) => {
                const progressElement = document.getElementById(`${category}Progress`);
                const textElement = document.getElementById(`${category}Text`);

                if (progressElement && textElement) {
                    progressElement.style.width = `${data.percentage}%`;
                    textElement.textContent = `${data.percentage}%`;
                }
            });

            // Update insights
            updateInsights(insights);

            // Update rating circle color based on score
            updateRatingCircleColor(overallRating.score);
        }

        // Update insights display
        function updateInsights(insights) {
            const insightsContent = document.getElementById('insightsContent');

            if (insights.length === 0) {
                insightsContent.innerHTML = '<p>Complete learning modules to receive personalized insights about your disaster preparedness knowledge!</p>';
                return;
            }

            const insightsList = document.createElement('ul');
            insightsList.className = 'insights-list';

            insights.forEach(insight => {
                const listItem = document.createElement('li');
                listItem.className = insight.type;
                listItem.innerHTML = `
                    <i class="${insight.icon}"></i>
                    <span>${insight.text}</span>
                `;
                insightsList.appendChild(listItem);
            });

            insightsContent.innerHTML = '';
            insightsContent.appendChild(insightsList);
        }

        // Update rating circle color
        function updateRatingCircleColor(score) {
            const ratingCircle = document.querySelector('.rating-circle');

            if (score >= 80) {
                ratingCircle.style.background = 'linear-gradient(135deg, var(--secondary), #2e7d32)';
            } else if (score >= 60) {
                ratingCircle.style.background = 'linear-gradient(135deg, var(--primary), var(--primary-dark))';
            } else if (score >= 40) {
                ratingCircle.style.background = 'linear-gradient(135deg, var(--warning), #f57c00)';
            } else {
                ratingCircle.style.background = 'linear-gradient(135deg, var(--accent), #d32f2f)';
            }
        }

        // Show return notification
        function showReturnNotification() {
            const notification = progressTracker.getReturnNotification();
            if (!notification) return;

            const dashboardElement = document.getElementById('assessmentDashboard');
            const notificationElement = document.createElement('div');
            notificationElement.className = `assessment-notification ${notification.type}`;

            notificationElement.innerHTML = `
                <div class="notification-header">
                    <i class="${getNotificationIcon(notification.type)}"></i>
                    <span>${notification.title}</span>
                </div>
                <div class="notification-content">
                    ${notification.content}
                </div>
            `;

            dashboardElement.appendChild(notificationElement);

            // Auto-hide after 10 seconds
            setTimeout(() => {
                notificationElement.style.opacity = '0';
                setTimeout(() => {
                    if (notificationElement.parentNode) {
                        notificationElement.parentNode.removeChild(notificationElement);
                    }
                }, 500);
            }, 10000);
        }

        // Get notification icon
        function getNotificationIcon(type) {
            switch (type) {
                case 'improvement': return 'fas fa-trophy';
                case 'welcome': return 'fas fa-hand-wave';
                case 'warning': return 'fas fa-exclamation-triangle';
                default: return 'fas fa-info-circle';
            }
        }

        // Update module completion status
        function updateModuleCompletionStatus() {
            const moduleCards = document.querySelectorAll('.module-card');
            
            moduleCards.forEach(card => {
                const cardId = card.id || card.querySelector('h3')?.textContent.toLowerCase().replace(/\s+/g, '-');
                if (cardId && progressTracker.isModuleCompleted(cardId)) {
                    // Add completion badge
                    if (!card.querySelector('.completion-badge')) {
                        const badge = document.createElement('div');
                        badge.className = 'completion-badge';
                        badge.innerHTML = '<i class="fas fa-check"></i> Completed';
                        card.appendChild(badge);
                        card.classList.add('module-completed');
                    }

                    // Add progress indicator
                    if (!card.querySelector('.module-progress-indicator')) {
                        const progressIndicator = document.createElement('div');
                        progressIndicator.className = 'module-progress-indicator';
                        progressIndicator.innerHTML = '<div class="module-progress-fill" style="width: 100%"></div>';
                        card.appendChild(progressIndicator);
                    }
                }
            });
        }

        // Enhanced module completion function
        function completeModule(moduleId, category) {
            const result = progressTracker.completeModule(moduleId, category);
            
            // Update the dashboard immediately
            updatePerformanceDashboard();
            updateModuleCompletionStatus();
            
            // Show completion notification
            showModuleCompletionNotification(moduleId, result);
            
            return result;
        }

        // Show module completion notification
        function showModuleCompletionNotification(moduleId, result) {
            // Show congratulations dialog box
            showCongratulationsDialog(moduleId, result);
            
            const dashboardElement = document.getElementById('assessmentDashboard');
            const notificationElement = document.createElement('div');
            notificationElement.className = 'assessment-notification improvement';

            const overallRating = progressTracker.getOverallRating();

            notificationElement.innerHTML = `
                <div class="notification-header">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Module Completed!</span>
                </div>
                <div class="notification-content">
                    Excellent work! Module understanding: ${result.score}/100. 
                    Your learning completion is now ${overallRating.score}% (${overallRating.label}). 
                    Continue learning to improve your disaster preparedness knowledge!
                </div>
            `;

            dashboardElement.appendChild(notificationElement);

            // Auto-hide after 8 seconds
            setTimeout(() => {
                notificationElement.style.opacity = '0';
                setTimeout(() => {
                    if (notificationElement.parentNode) {
                        notificationElement.parentNode.removeChild(notificationElement);
                    }
                }, 500);
            }, 8000);
        }

        // Show congratulations dialog box
        function showCongratulationsDialog(moduleId, result) {
            const moduleNames = {
                'emergency-kit': 'Emergency Kit Builder',
                'evacuation-planning': 'Evacuation Planning',
                'basic-life-support': 'Basic Life Support',
                'wound-care': 'Wound Care & Treatment',
                'disaster-response-children': 'Children Disaster Response',
                'community-response': 'Community Response Leadership',
                'flood-prevention': 'Flood Prevention Basics',
                'earthquake-safety': 'Earthquake Safety Engineering'
            };

            const moduleName = moduleNames[moduleId] || moduleId;
            const overallRating = progressTracker.getOverallRating();

            // Create dialog overlay
            const dialogOverlay = document.createElement('div');
            dialogOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(5px);
                z-index: 3000;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease;
            `;

            // Create dialog box
            const dialogBox = document.createElement('div');
            dialogBox.style.cssText = `
                background: linear-gradient(135deg, #ffffff, #f8f9fa);
                border-radius: 20px;
                padding: 40px;
                text-align: center;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                border: 2px solid #4caf50;
                max-width: 500px;
                width: 90%;
                animation: slideInUp 0.4s ease;
                position: relative;
                overflow: hidden;
            `;

            dialogBox.innerHTML = `
                <div style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(76, 175, 80, 0.1) 0%, transparent 70%); animation: pulse 2s infinite;"></div>
                
                <div style="position: relative; z-index: 1;">
                    <div style="margin-bottom: 20px;">
                        <div style="display: inline-block; background: linear-gradient(135deg, #4caf50, #66bb6a); color: white; border-radius: 50%; width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(76, 175, 80, 0.4);">
                            <i class="fas fa-trophy"></i>
                        </div>
                    </div>
                    
                    <h2 style="color: #2e7d32; margin-bottom: 15px; font-size: 2rem; font-weight: 700;">🎉 Congratulations! 🎉</h2>
                    
                    <h3 style="color: #1976d2; margin-bottom: 20px; font-size: 1.3rem;">Module Completed Successfully!</h3>
                    
                    <div style="background: rgba(76, 175, 80, 0.1); border-radius: 15px; padding: 20px; margin: 20px 0; border-left: 4px solid #4caf50;">
                        <p style="color: #333; font-size: 1.1rem; margin-bottom: 10px; font-weight: 600;">${moduleName}</p>
                        <p style="color: #666; margin-bottom: 15px;">You have successfully completed this learning module!</p>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; background: white; padding: 15px; border-radius: 10px; margin: 15px 0;">
                            <div>
                                <div style="font-size: 1.5rem; font-weight: bold; color: #4caf50;">${result.score}%</div>
                                <div style="font-size: 0.9rem; color: #666;">Module Score</div>
                            </div>
                            <div>
                                <div style="font-size: 1.5rem; font-weight: bold; color: #1976d2;">${overallRating.score}%</div>
                                <div style="font-size: 0.9rem; color: #666;">Overall Progress</div>
                            </div>
                        </div>
                        
                        <p style="color: #4caf50; font-weight: 600; margin-top: 15px;">
                            <i class="fas fa-star"></i> ${overallRating.label}
                        </p>
                    </div>
                    
                    <p style="color: #666; margin-bottom: 25px; line-height: 1.5;">
                        Great job! Your disaster preparedness knowledge has improved. Keep learning to become even more prepared for emergency situations.
                    </p>
                    
                    <button onclick="closeCongratulationsDialog()" style="
                        background: linear-gradient(135deg, #4caf50, #66bb6a);
                        color: white;
                        border: none;
                        padding: 15px 35px;
                        border-radius: 25px;
                        font-size: 1.1rem;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
                    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(76, 175, 80, 0.5)'" 
                       onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 15px rgba(76, 175, 80, 0.4)'">
                        <i class="fas fa-check"></i> Continue Learning
                    </button>
                </div>
            `;

            dialogOverlay.appendChild(dialogBox);
            document.body.appendChild(dialogOverlay);

            // Store reference for closing
            window.currentCongratulationsDialog = dialogOverlay;
        }

        // Close congratulations dialog
        function closeCongratulationsDialog() {
            if (window.currentCongratulationsDialog) {
                window.currentCongratulationsDialog.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    if (window.currentCongratulationsDialog && window.currentCongratulationsDialog.parentNode) {
                        window.currentCongratulationsDialog.parentNode.removeChild(window.currentCongratulationsDialog);
                    }
                    window.currentCongratulationsDialog = null;
                }, 300);
            }
        }

        // Modified module opening functions to track completion
        function openModule(moduleId) {
            if (moduleId === 'flood-prevention') {
                // Track that user started flood prevention module
                window.location.href = 'games/floodQuest.html';
                
                // Simulate completion after a delay (in real app, this would be triggered by actual module completion)
                setTimeout(() => {
                    completeModule('flood-prevention', 'mitigation');
                }, 2000);
            } else {
                alert(`Opening ${moduleId} module. This would launch the full interactive experience.`);
                // Simulate completion for demo
                completeModule(moduleId, 'general');
            }
        }

        // Add demo function to test the progress system
        function demoProgressSystem() {
            const modules = [
                { id: 'emergency-kit', category: 'preparedness' },
                { id: 'evacuation-planning', category: 'preparedness' },
                { id: 'basic-life-support', category: 'firstAid' },
                { id: 'wound-care', category: 'firstAid' },
                { id: 'disaster-response', category: 'response' }
            ];

            modules.forEach((module, index) => {
                setTimeout(() => {
                    completeModule(module.id, module.category);
                    
                    if (index === modules.length - 1) {
                        setTimeout(() => {
                            const notification = document.createElement('div');
                            notification.className = 'assessment-notification improvement';
                            notification.innerHTML = `
                                <div class="notification-header">
                                    <i class="fas fa-chart-line"></i>
                                    <span>Demo Complete!</span>
                                </div>
                                <div class="notification-content">
                                    Demo: Simulated completing 5 learning modules to show the progress tracking system. 
                                    Your learning rating has been updated!
                                </div>
                            `;

                            document.getElementById('assessmentDashboard').appendChild(notification);

                            setTimeout(() => {
                                notification.style.opacity = '0';
                                setTimeout(() => {
                                    if (notification.parentNode) {
                                        notification.parentNode.removeChild(notification);
                                    }
                                }, 500);
                            }, 5000);
                        }, 500);
                    }
                }, index * 800);
            });
        }

        // Add keyboard shortcut for demo (Ctrl+D)
        document.addEventListener('keydown', function (e) {
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                demoProgressSystem();
            }
        });

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function () {
            loadUserInfo();
            initializeAssessmentSystem();
        });

        // Menu Navigation
        async function loadUserInfo() {
            try {
                // First try to get user data from session/localStorage
                let userData = null;

                // Check localStorage for stored user data
                const localData = localStorage.getItem('resq_user') || localStorage.getItem('currentUser') || localStorage.getItem('user');
                if (localData) {
                    userData = JSON.parse(localData);
                }

                // If no local data or token exists, try to fetch from backend
                const token = localStorage.getItem('token') || localStorage.getItem('authToken') || localStorage.getItem('jwt');
                if (!userData && token) {
                    try {
                        const response = await fetch('http://localhost:5000/api/auth/current', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (response.ok) {
                            userData = await response.json();
                            // Save to localStorage for future use
                            localStorage.setItem('resq_user', JSON.stringify(userData));
                        } else {
                            console.log('Failed to fetch user from backend:', response.status);
                        }
                    } catch (fetchError) {
                        console.log('Could not fetch user from backend:', fetchError.message);
                    }
                }

                if (userData) {
                    const firstName = userData.firstName || userData.name || userData.username || userData.email?.split('@')[0] || 'User';
                    const lastName = userData.lastName || '';
                    const fullName = lastName ? `${firstName} ${lastName}` : firstName;

                    // Update sidebar user profile
                    const userNameElement = document.getElementById('sidebarUserName');
                    const userAvatarElement = document.getElementById('userAvatar');

                    if (userNameElement) userNameElement.textContent = fullName;
                    if (userAvatarElement) userAvatarElement.textContent = firstName.charAt(0).toUpperCase();

                    console.log('User loaded:', fullName);
                } else {
                    // Fallback to default values
                    console.log('No user data found');
                    setDefaultUser();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                setDefaultUser();
            }
        }

        function setDefaultUser() {
            const userNameElement = document.getElementById('sidebarUserName');
            const userAvatarElement = document.getElementById('userAvatar');

            if (userNameElement) userNameElement.textContent = 'Guest User';
            if (userAvatarElement) userAvatarElement.textContent = 'G';
        }

        // Function to save user data (call this when user logs in)
        function saveUserData(userData) {
            try {
                localStorage.setItem('resq_user', JSON.stringify(userData));
                loadUserInfo(); // Refresh the display
                console.log('User data saved:', userData);
            } catch (error) {
                console.error('Error saving user data:', error);
            }
        }

        // Add hover effects for user profile
        function initializeUserProfile() {
            const userProfile = document.querySelector('.sidebar-user-profile');
            if (userProfile) {
                // Add hover effect only (no click navigation)
                userProfile.addEventListener('mouseenter', function () {
                    this.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
                    this.style.borderRadius = '10px';
                    this.style.transition = 'all 0.2s ease';
                });

                userProfile.addEventListener('mouseleave', function () {
                    this.style.backgroundColor = 'transparent';
                });
            }
        }

        // Load user info when page loads
        document.addEventListener('DOMContentLoaded', function () {
            loadUserInfo();
            initializeUserProfile();
        });

        // Menu Navigation
        document.addEventListener('DOMContentLoaded', function () {
            // Sidebar navigation
            const menuItems = document.querySelectorAll('.menu-item');
            const educationDropdown = document.getElementById('educationDropdown');

            menuItems.forEach(item => {
                // Exclude dropdown main button from this generic navigation
                if (item.id !== 'educationDropdown' && !item.classList.contains('dropdown-item')) {
                    item.addEventListener('click', function (event) {
                        const link = this.getAttribute('data-link');
                        if (link) {
                            window.location.href = link;
                        }
                    });
                }
            });

            // Dropdown menu functionality
            if (educationDropdown) {
                console.log('Education dropdown found, setting up event listeners');
                const mainDropdownButton = educationDropdown.querySelector('.menu-item-main');
                const dropdownContent = educationDropdown.querySelector('.dropdown-content');

                // Force show dropdown content since this is the Education Modules page
                if (dropdownContent) {
                    dropdownContent.style.display = 'block';
                    dropdownContent.style.opacity = '1';
                    dropdownContent.style.maxHeight = 'none';
                    console.log('Forced dropdown content to show');
                }

                if (mainDropdownButton && dropdownContent) {
                    console.log('Dropdown button and content found');
                    mainDropdownButton.addEventListener('click', (event) => {
                        event.preventDefault();
                        event.stopPropagation();
                        console.log('Dropdown clicked, current active state:', educationDropdown.classList.contains('active'));

                        // Close any other open dropdowns first (if there are multiple)
                        document.querySelectorAll('.dropdown-menu').forEach(dropdown => {
                            if (dropdown !== educationDropdown) {
                                dropdown.classList.remove('active');
                            }
                        });

                        // Toggle this dropdown
                        educationDropdown.classList.toggle('active');
                        console.log('After toggle, active state:', educationDropdown.classList.contains('active'));

                        // Force display check
                        const isActive = educationDropdown.classList.contains('active');
                        console.log('Dropdown content display should be:', isActive ? 'block' : 'none');
                    });
                } else {
                    console.error('Dropdown button or content not found');
                }
            } else {
                console.error('Education dropdown not found');
            }

            // Handle navigation for dropdown items
            const dropdownItems = document.querySelectorAll('.dropdown-item');
            console.log('Found dropdown items:', dropdownItems.length);

            dropdownItems.forEach((item, index) => {
                const link = item.getAttribute('data-link');
                const text = item.querySelector('span')?.textContent.trim();
                console.log(`Dropdown item ${index}:`, text, 'Link:', link);

                item.addEventListener('click', (event) => {
                    event.preventDefault();
                    event.stopPropagation(); // Stop event from bubbling up to the parent

                    console.log('Dropdown item clicked:', text, 'Link:', link);

                    if (link) {
                        // Close the dropdown
                        if (educationDropdown) {
                            educationDropdown.classList.remove('active');
                        }

                        // Remove active class from all menu items and dropdown items
                        document.querySelectorAll('.menu-item, .dropdown-item').forEach(menuItem => {
                            menuItem.classList.remove('active');
                        });

                        // Add active class to clicked dropdown item
                        item.classList.add('active');

                        // Navigate to the page
                        console.log('Navigating to:', link);
                        window.location.href = link;
                    } else {
                        console.error('No link found for dropdown item:', text);
                    }
                });
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function (event) {
                if (educationDropdown && !educationDropdown.contains(event.target)) {
                    educationDropdown.classList.remove('active');
                }
            });
        });

        // Language translations
        const translations = {
            en: {
                title: "Interactive Disaster Education",
                subtitle: "Learn disaster management through immersive AR/VR experiences and interactive modules",
                filters: "Choose Your Learning Path",
                ageGroup: "Age Group",
                topics: "Topics",
                progress: "Your Learning Progress"
            },
            hi: {
                title: "इंटरैक्टिव आपदा शिक्षा",
                subtitle: "एआर/वीआर अनुभवों और इंटरैक्टिव मॉड्यूल के माध्यम से आपदा प्रबंधन सीखें",
                filters: "अपना सीखने का रास्ता चुनें",
                ageGroup: "आयु समूह",
                topics: "विषय",
                progress: "आपकी सीखने की प्रगति"
            }
        };

        // Filter functionality
        let currentFilters = { age: 'all', topic: 'all' };

        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                const filterType = this.dataset.filter;
                const value = this.dataset.value;

                // Update active state
                document.querySelectorAll(`[data-filter="${filterType}"]`).forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                // Update current filters
                currentFilters[filterType] = value;

                // Apply filters
                filterModules();
            });
        });

        function filterModules() {
            const modules = document.querySelectorAll('.module-card');

            modules.forEach(module => {
                const moduleAges = module.dataset.age.split(',');
                const moduleTopic = module.dataset.topic;

                let showModule = true;

                // Age filter
                if (currentFilters.age !== 'all') {
                    showModule = showModule && moduleAges.includes(currentFilters.age);
                }

                // Topic filter
                if (currentFilters.topic !== 'all') {
                    showModule = showModule && moduleTopic === currentFilters.topic;
                }

                module.style.display = showModule ? 'block' : 'none';
            });
        }

        // AR/VR Preview functionality
        function previewAR(type) {
            document.getElementById('arModal').style.display = 'block';
        }


        // Module opening functionality (other modules)
        function openModule(moduleId) {
            if (moduleId === 'flood-prevention') {
                window.location.href = 'educationmodule1.html';
            } else {
                alert(`Opening ${moduleId} module. This would launch the full interactive AR/VR experience.`);
            }
        }

        // Language change functionality
        document.getElementById('languageSelect').addEventListener('change', function () {
            const selectedLang = this.value;
            changeLanguage(selectedLang);
        });

        function changeLanguage(lang) {
            if (translations[lang]) {
                document.querySelectorAll('[data-translate]').forEach(element => {
                    const key = element.dataset.translate;
                    if (translations[lang][key]) {
                        element.textContent = translations[lang][key];
                    }
                });
            }
        }

        // Modal functionality
        document.querySelector('.close').addEventListener('click', function () {
            document.getElementById('arModal').style.display = 'none';
        });

        window.addEventListener('click', function (event) {
            const modal = document.getElementById('arModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });

        // Enhanced module start function with progress tracking
        function startModule(moduleId, category) {
            // Show learning notification
            showModuleStartNotification(moduleId);

            // Create module URL mapping for actual navigation
            const moduleUrls = {
                'emergency-kit': 'https://www.ready.gov/kit',
                'evacuation-planning': 'https://www.ready.gov/evacuation', 
                'basic-life-support': 'https://www.redcross.org/take-a-class/bls',
                'wound-care': 'https://www.redcross.org/take-a-class/first-aid',
                'disaster-response-children': 'https://www.ready.gov/kids',
                'community-response': 'https://training.fema.gov/is/courseoverview.aspx?code=IS-244.b',
                'flood-prevention': 'games/floodQuest.html',
                'earthquake-safety': 'games/disasterQuest.html'
            };

            // For demonstration, simulate module completion after a delay
            setTimeout(() => {
                completeModule(moduleId, category);
            }, 3000);

            // Navigate to actual module or show demo message
            if (moduleUrls[moduleId]) {
                if (moduleId === 'flood-prevention' || moduleId === 'earthquake-safety') {
                    // Local game modules
                    window.location.href = moduleUrls[moduleId];
                } else {
                    // External learning resources
                    window.open(moduleUrls[moduleId], '_blank');
                }
            } else {
                alert(`${moduleId} module will be available soon! This is a demo version showing progress tracking.`);
            }
        }

        // Show module start notification
        function showModuleStartNotification(moduleId) {
            const previousResult = progressTracker.data.moduleResults[moduleId];
            const dashboardElement = document.getElementById('assessmentDashboard');
            const notificationElement = document.createElement('div');
            notificationElement.className = 'assessment-notification improvement';

            const moduleNames = {
                'emergency-kit': 'Emergency Kit Builder',
                'evacuation-planning': 'Evacuation Planning',
                'basic-life-support': 'Basic Life Support',
                'wound-care': 'Wound Care & Treatment',
                'disaster-response-children': 'Children Disaster Response',
                'community-response': 'Community Response Leadership',
                'flood-prevention': 'Flood Prevention Basics',
                'earthquake-safety': 'Earthquake Safety Engineering'
            };

            const title = moduleNames[moduleId] || moduleId;

            if (previousResult && previousResult.timesCompleted > 0) {
                notificationElement.innerHTML = `
                    <div class="notification-header">
                        <i class="fas fa-book-open"></i>
                        <span>Learning Module Active</span>
                    </div>
                    <div class="notification-content">
                        Starting ${title}... Your previous best understanding was ${Math.round(previousResult.bestScore)}%. 
                        Try to improve and deepen your disaster preparedness knowledge!
                    </div>
                `;
            } else {
                notificationElement.innerHTML = `
                    <div class="notification-header">
                        <i class="fas fa-play-circle"></i>
                        <span>New Learning Module</span>
                    </div>
                    <div class="notification-content">
                        Starting ${title} for the first time. Take your time to understand all concepts thoroughly!
                    </div>
                `;
            }

            dashboardElement.appendChild(notificationElement);

            // Auto-hide after 5 seconds
            setTimeout(() => {
                notificationElement.style.opacity = '0';
                setTimeout(() => {
                    if (notificationElement.parentNode) {
                        notificationElement.parentNode.removeChild(notificationElement);
                    }
                }, 500);
            }, 5000);
        }

        // Help function
        function openHelp() {
            alert('Welcome to Disaster Education! Use the filters to find age-appropriate content. Click AR/VR preview buttons to see immersive experiences. Need help? Contact support@disastersafe.com');
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function () {
            filterModules();
            // Show completed badge for Flood Prevention Basics if done
            if (localStorage.getItem('flood-prevention-completed') === 'true') {
                const badge = document.getElementById('flood-prevention-status');
                if (badge) badge.style.display = 'inline-block';
            }
        });

        // Disaster-specific module functions
        function openEarthquakeModule() {
            showDisasterModule('earthquake', {
                title: '🏗️ Earthquake Response & Safety',
                whatToDo: [
                    'DROP to hands and knees immediately',
                    'Take COVER under a sturdy desk/table',
                    'HOLD ON to your shelter and protect your head/neck',
                    'Stay away from windows, mirrors, and heavy objects',
                    'If outdoors, move away from buildings and power lines',
                    'If in bed, stay there and cover your head with a pillow'
                ],
                institutionalRisks: [
                    'Old buildings with unreinforced masonry walls',
                    'Buildings with heavy fixtures (ceiling fans, lights)',
                    'Multi-story structures without earthquake retrofitting',
                    'Areas near heavy machinery or equipment',
                    'Buildings on soft soil or near fault lines',
                    'Structures with inadequate seismic bracing'
                ],
                highRiskAreas: [
                    'Chemistry/Physics laboratories with heavy equipment',
                    'Library areas with tall, unsecured bookcases',
                    'Older dormitories and academic buildings',
                    'Cafeterias with hanging lights and fixtures',
                    'Computer labs with unsecured monitors'
                ]
            });
        }

        function openFireModule() {
            showDisasterModule('fire', {
                title: '🔥 Fire Safety & Evacuation',
                whatToDo: [
                    'Activate fire alarm immediately',
                    'Evacuate using nearest safe exit route',
                    'Stay low under smoke (crawl if necessary)',
                    'Feel doors with back of hand before opening',
                    'Close doors behind you to slow fire spread',
                    'Meet at designated assembly point outside'
                ],
                institutionalRisks: [
                    'Buildings with old electrical wiring',
                    'Areas with flammable materials storage',
                    'Kitchens and food preparation areas',
                    'Chemistry labs with combustible chemicals',
                    'Workshops with heating equipment',
                    'Buildings with poor ventilation systems'
                ],
                highRiskAreas: [
                    'Chemistry and science laboratories',
                    'Cafeteria kitchens and food storage',
                    'Maintenance rooms with electrical panels',
                    'Dormitory rooms with heating appliances',
                    'Art studios with solvents and materials'
                ]
            });
        }

        function openFloodModule() {
            showDisasterModule('flood', {
                title: '🌊 Flood Response & Protection',
                whatToDo: [
                    'Move to higher ground immediately',
                    'Never drive through flooded roads',
                    'Avoid walking in moving water',
                    'Turn off electricity if water threatens electrical outlets',
                    'Stay away from storm drains and waterways',
                    'Listen to emergency broadcasts for updates'
                ],
                institutionalRisks: [
                    'Buildings in low-lying areas or flood plains',
                    'Basements and underground facilities',
                    'Areas near rivers, lakes, or storm drains',
                    'Buildings with poor drainage systems',
                    'Facilities near construction sites',
                    'Areas with inadequate flood barriers'
                ],
                highRiskAreas: [
                    'Basement computer centers and server rooms',
                    'Ground-floor electrical and mechanical rooms',
                    'Parking garages and underground areas',
                    'Buildings near campus water features',
                    'Low-lying dormitories and academic buildings'
                ]
            });
        }

        function openCycloneModule() {
            showDisasterModule('cyclone', {
                title: '🌪️ Cyclone & Storm Safety',
                whatToDo: [
                    'Move to interior rooms away from windows',
                    'Stay on lowest floor possible',
                    'Avoid using elevators during storms',
                    'Keep away from large roof areas',
                    'Have emergency supplies ready',
                    'Monitor weather updates continuously'
                ],
                institutionalRisks: [
                    'Buildings with large glass windows/facades',
                    'Temporary or prefabricated structures',
                    'Buildings with old or damaged roofing',
                    'Areas with many trees and power lines',
                    'High-rise buildings susceptible to wind',
                    'Coastal facilities prone to storm surge'
                ],
                highRiskAreas: [
                    'Buildings with extensive glass facades',
                    'Temporary classrooms and portable structures',
                    'Areas under large trees or power lines',
                    'Outdoor sports facilities and stadiums',
                    'High floors of tall buildings'
                ]
            });
        }

        function openChemicalModule() {
            showDisasterModule('chemical', {
                title: '⚗️ Chemical Emergency Response',
                whatToDo: [
                    'Evacuate the immediate area quickly',
                    'Move upwind and uphill from the source',
                    'Remove contaminated clothing if safe to do so',
                    'Flush exposed skin/eyes with clean water',
                    'Seek immediate medical attention',
                    'Report the incident to authorities'
                ],
                institutionalRisks: [
                    'Chemistry and biology laboratories',
                    'Maintenance areas with cleaning chemicals',
                    'Art studios with solvents and acids',
                    'Medical facilities with pharmaceuticals',
                    'Research facilities with experimental chemicals',
                    'Areas near chemical storage rooms'
                ],
                highRiskAreas: [
                    'Science laboratories and prep rooms',
                    'Maintenance and custodial storage areas',
                    'Art and photography darkrooms',
                    'Medical clinics and health centers',
                    'Research laboratories and chemical storage'
                ]
            });
        }

        function openSecurityModule() {
            showDisasterModule('security', {
                title: '🛡️ Security Threat Response',
                whatToDo: [
                    'Follow lockdown procedures immediately',
                    'Lock and barricade doors if possible',
                    'Turn off lights and silence phones',
                    'Hide away from windows and doors',
                    'Stay quiet and follow official instructions',
                    'Call emergency services when safe'
                ],
                institutionalRisks: [
                    'Buildings with multiple unsecured entry points',
                    'Areas with poor surveillance coverage',
                    'Isolated buildings or remote areas',
                    'Facilities near public access roads',
                    'Buildings with inadequate security systems',
                    'Areas with high-value targets or equipment'
                ],
                highRiskAreas: [
                    'Main entrances and lobby areas',
                    'Cafeterias and large gathering spaces',
                    'Isolated buildings and remote facilities',
                    'Parking areas and external walkways',
                    'Computer labs and valuable equipment areas'
                ]
            });
        }

        function openPandemicModule() {
            showDisasterModule('pandemic', {
                title: '🦠 Pandemic Preparedness',
                whatToDo: [
                    'Follow health authority guidelines',
                    'Maintain physical distancing protocols',
                    'Wear appropriate personal protective equipment',
                    'Practice good hygiene (handwashing, sanitizing)',
                    'Monitor your health symptoms daily',
                    'Follow quarantine procedures if exposed'
                ],
                institutionalRisks: [
                    'Crowded classrooms and lecture halls',
                    'Shared facilities (cafeterias, gyms, libraries)',
                    'Dormitories with shared living spaces',
                    'Buildings with poor ventilation systems',
                    'High-traffic areas and corridors',
                    'Facilities lacking proper sanitization'
                ],
                highRiskAreas: [
                    'Cafeterias and dining facilities',
                    'Dormitories and shared living spaces',
                    'Large lecture halls and auditoriums',
                    'Gymnasiums and recreational facilities',
                    'High-traffic corridors and common areas'
                ]
            });
        }

        function openElectricalModule() {
            showDisasterModule('electrical', {
                title: '⚡ Electrical Safety',
                whatToDo: [
                    'Never touch electrical equipment with wet hands',
                    'Unplug devices during storms',
                    'Stay away from downed power lines',
                    'Use surge protectors for valuable equipment',
                    'Report electrical hazards immediately',
                    'Know location of electrical shut-offs'
                ],
                institutionalRisks: [
                    'Buildings with old electrical wiring',
                    'Areas with overloaded electrical circuits',
                    'Facilities near high-voltage power lines',
                    'Buildings with inadequate grounding',
                    'Areas prone to water infiltration',
                    'Facilities with amateur electrical work'
                ],
                highRiskAreas: [
                    'Computer labs with high electrical loads',
                    'Maintenance rooms and electrical panels',
                    'Older buildings with outdated wiring',
                    'Wet areas near electrical equipment',
                    'Facilities with extension cord overuse'
                ]
            });
        }

        function openStructuralModule() {
            showDisasterModule('structural', {
                title: '🏢 Structural Safety Assessment',
                whatToDo: [
                    'Evacuate immediately if you hear cracking sounds',
                    'Look for cracks in walls, ceilings, or foundations',
                    'Report any structural changes or damage',
                    'Avoid areas with sagging ceilings or floors',
                    'Stay away from buildings showing signs of distress',
                    'Follow building safety protocols'
                ],
                institutionalRisks: [
                    'Old buildings without recent inspections',
                    'Structures with heavy loads on upper floors',
                    'Buildings with visible cracks or damage',
                    'Facilities built on unstable ground',
                    'Structures with poor maintenance history',
                    'Buildings exceeding designed capacity'
                ],
                highRiskAreas: [
                    'Older academic and administrative buildings',
                    'Libraries with heavy book collections',
                    'Buildings with known structural issues',
                    'Facilities with heavy equipment or machinery',
                    'Structures showing signs of wear or damage'
                ]
            });
        }

        function openMedicalModule() {
            showDisasterModule('medical', {
                title: '🏥 Medical Emergency Response',
                whatToDo: [
                    'Call emergency services immediately (911)',
                    'Provide basic first aid if trained',
                    'Keep the person calm and comfortable',
                    'Do not move someone with potential spinal injury',
                    'Apply pressure to bleeding wounds',
                    'Stay with the person until help arrives'
                ],
                institutionalRisks: [
                    'Facilities far from medical centers',
                    'Areas with limited first aid supplies',
                    'Buildings without trained first responders',
                    'Facilities with high-risk activities',
                    'Areas with poor emergency communication',
                    'Remote locations with delayed response times'
                ],
                highRiskAreas: [
                    'Science labs with hazardous materials',
                    'Sports and recreational facilities',
                    'Workshops and technical training areas',
                    'Remote buildings or isolated areas',
                    'Facilities with elderly or disabled occupants'
                ]
            });
        }

        function openTransportModule() {
            showDisasterModule('transport', {
                title: '🚗 Transportation Safety',
                whatToDo: [
                    'Always wear seatbelts or use safety equipment',
                    'Follow evacuation procedures for vehicles',
                    'Exit vehicles quickly in emergency situations',
                    'Move away from accident scenes safely',
                    'Call for help and provide first aid if trained',
                    'Follow traffic control and emergency personnel'
                ],
                institutionalRisks: [
                    'Campus roads with heavy traffic',
                    'Areas with poor visibility or lighting',
                    'Parking areas near busy roadways',
                    'Transportation routes through hazardous areas',
                    'Facilities with inadequate emergency vehicle access',
                    'Areas with mixing of pedestrian and vehicle traffic'
                ],
                highRiskAreas: [
                    'Campus main roads and intersections',
                    'Parking garages and surface lots',
                    'Bus stops and transportation hubs',
                    'Emergency vehicle access routes',
                    'Areas with mixed pedestrian-vehicle traffic'
                ]
            });
        }

        function openCyberModule() {
            showDisasterModule('cyber', {
                title: '🔒 Cyber Security & Data Protection',
                whatToDo: [
                    'Disconnect affected systems from network',
                    'Change all passwords immediately',
                    'Report security incidents to IT department',
                    'Back up important data regularly',
                    'Do not click suspicious links or attachments',
                    'Follow institutional cybersecurity protocols'
                ],
                institutionalRisks: [
                    'Systems with outdated security software',
                    'Networks with weak password policies',
                    'Facilities with unsecured Wi-Fi access',
                    'Areas with unmonitored computer access',
                    'Systems lacking regular security updates',
                    'Facilities with inadequate data backup'
                ],
                highRiskAreas: [
                    'Computer labs and IT facilities',
                    'Administrative offices with sensitive data',
                    'Research facilities with valuable information',
                    'Financial and student records departments',
                    'Systems with external network connections'
                ]
            });
        }

        // Show detailed disaster module
        function showDisasterModule(disasterType, moduleData) {
            const modal = document.getElementById('arModal');
            const modalContent = modal.querySelector('.modal-content');

            modalContent.innerHTML = `
                <span class="close">&times;</span>
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2>${moduleData.title}</h2>
                    <p style="font-size: 1.1rem; color: #666;">Comprehensive disaster preparedness and institutional risk assessment</p>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <!-- What to Do Section -->
                    <div style="background: linear-gradient(135deg, #e3f2fd, #f0f7ff); padding: 25px; border-radius: 15px; border-left: 5px solid #2196f3;">
                        <h3 style="color: #1976d2; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-list-check"></i> What to Do When This Disaster Occurs
                        </h3>
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            ${moduleData.whatToDo.map(action => `
                                <li style="margin-bottom: 12px; padding: 10px; background: rgba(255,255,255,0.7); border-radius: 8px; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-check-circle" style="color: #4caf50;"></i>
                                    <span>${action}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    
                    <!-- Institutional Risks Section -->
                    <div style="background: linear-gradient(135deg, #fff3e0, #fff8f0); padding: 25px; border-radius: 15px; border-left: 5px solid #ff9800;">
                        <h3 style="color: #f57c00; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-exclamation-triangle"></i> Institutional Risk Factors
                        </h3>
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            ${moduleData.institutionalRisks.map(risk => `
                                <li style="margin-bottom: 12px; padding: 10px; background: rgba(255,255,255,0.7); border-radius: 8px; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-exclamation-circle" style="color: #ff9800;"></i>
                                    <span>${risk}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                </div>
                
                <!-- High Risk Areas Section -->
                <div style="background: linear-gradient(135deg, #ffebee, #fff5f5); padding: 25px; border-radius: 15px; border-left: 5px solid #f44336; margin-bottom: 30px;">
                    <h3 style="color: #d32f2f; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-building"></i> High-Risk Areas in Educational Institutions
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        ${moduleData.highRiskAreas.map(area => `
                            <div style="padding: 15px; background: rgba(255,255,255,0.8); border-radius: 10px; border: 1px solid rgba(244,67,54,0.2);">
                                <i class="fas fa-map-marker-alt" style="color: #f44336; margin-right: 8px;"></i>
                                <span>${area}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn-primary" onclick="startVRExperience('${disasterType}')" style="margin-right: 15px; padding: 15px 30px;">
                        <i class="fas fa-vr-cardboard"></i> Start VR Training
                    </button>
                    <button class="btn-secondary" onclick="downloadResourceKit('${disasterType}')" style="padding: 15px 30px;">
                        <i class="fas fa-download"></i> Download Resource Kit
                    </button>
                </div>
            `;

            modal.style.display = 'block';

            // Re-attach close event
            modal.querySelector('.close').addEventListener('click', function () {
                modal.style.display = 'none';
            });
        }

        // Institutional risk assessment function
        function assessInstitutionalRisk(disasterType) {
            const riskData = {
                earthquake: {
                    title: 'Earthquake Risk Assessment',
                    icon: 'fas fa-home',
                    color: '#8B4513',
                    questions: [
                        'Is your building constructed before 1980?',
                        'Does your building have unreinforced masonry walls?',
                        'Are there heavy objects mounted on walls or ceilings?',
                        'Is your building located near known fault lines?',
                        'Does your building lack seismic retrofitting?'
                    ],
                    recommendations: [
                        'Secure heavy furniture and equipment to walls',
                        'Create earthquake emergency kits',
                        'Practice Drop, Cover, and Hold drills regularly',
                        'Identify safe spots in each room',
                        'Consider professional seismic retrofitting'
                    ]
                },
                fire: {
                    title: 'Fire Risk Assessment',
                    icon: 'fas fa-fire',
                    color: '#FF4500',
                    questions: [
                        'Does your building have outdated electrical wiring?',
                        'Are there flammable materials stored improperly?',
                        'Do all areas have working smoke detectors?',
                        'Are evacuation routes clearly marked and unobstructed?',
                        'Is fire safety equipment regularly maintained?'
                    ],
                    recommendations: [
                        'Install and maintain smoke detectors',
                        'Keep evacuation routes clear',
                        'Store flammable materials safely',
                        'Regular fire drill practice',
                        'Upgrade electrical systems if needed'
                    ]
                },
                flood: {
                    title: 'Flood Risk Assessment',
                    icon: 'fas fa-water',
                    color: '#1E90FF',
                    questions: [
                        'Is your building in a flood-prone area?',
                        'Are important systems located in basements?',
                        'Does your building have adequate drainage?',
                        'Are electrical systems elevated above potential flood levels?',
                        'Do you have flood barriers or protection systems?'
                    ],
                    recommendations: [
                        'Elevate critical equipment above flood levels',
                        'Improve drainage systems',
                        'Create flood emergency action plan',
                        'Install flood barriers where appropriate',
                        'Relocate valuable items from basements'
                    ]
                },
                chemical: {
                    title: 'Chemical Hazard Assessment',
                    icon: 'fas fa-flask',
                    color: '#9932CC',
                    questions: [
                        'Are chemicals properly labeled and stored?',
                        'Do staff know chemical safety procedures?',
                        'Are safety equipment and eyewash stations available?',
                        'Is there proper ventilation in chemical storage areas?',
                        'Are chemical spill kits readily available?'
                    ],
                    recommendations: [
                        'Ensure proper chemical labeling and storage',
                        'Train all staff in chemical safety procedures',
                        'Install adequate ventilation systems',
                        'Maintain emergency spill response kits',
                        'Regular safety equipment inspections'
                    ]
                }
            };

            const data = riskData[disasterType];
            if (!data) return;

            showRiskAssessment(data);
        }

        function showRiskAssessment(data) {
            const modal = document.getElementById('arModal');
            const modalContent = modal.querySelector('.modal-content');

            modalContent.innerHTML = `
                <span class="close">&times;</span>
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="background: ${data.color}; color: white; width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 2rem;">
                        <i class="${data.icon}"></i>
                    </div>
                    <h2>${data.title}</h2>
                    <p style="color: #666;">Assess your institution's vulnerability and get personalized recommendations</p>
                </div>
                
                <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                    <h3 style="color: #333; margin-bottom: 20px;">
                        <i class="fas fa-clipboard-list" style="color: ${data.color}; margin-right: 10px;"></i>
                        Risk Assessment Questions
                    </h3>
                    <form id="riskAssessmentForm">
                        ${data.questions.map((question, index) => `
                            <div style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 10px; border-left: 4px solid ${data.color};">
                                <label style="display: block; margin-bottom: 10px; font-weight: 500;">${question}</label>
                                <div style="display: flex; gap: 20px;">
                                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                        <input type="radio" name="question${index}" value="yes" style="margin: 0;">
                                        <span>Yes</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                        <input type="radio" name="question${index}" value="no" style="margin: 0;">
                                        <span>No</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                        <input type="radio" name="question${index}" value="unsure" style="margin: 0;">
                                        <span>Not Sure</span>
                                    </label>
                                </div>
                            </div>
                        `).join('')}
                    </form>
                </div>
                
                <div style="background: linear-gradient(135deg, #e8f5e8, #f0f8f0); padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                    <h3 style="color: #2e7d32; margin-bottom: 20px;">
                        <i class="fas fa-lightbulb" style="color: #4caf50; margin-right: 10px;"></i>
                        Recommended Safety Measures
                    </h3>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        ${data.recommendations.map(rec => `
                            <li style="margin-bottom: 12px; padding: 12px; background: rgba(255,255,255,0.8); border-radius: 8px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-check-circle" style="color: #4caf50;"></i>
                                <span>${rec}</span>
                            </li>
                        `).join('')}
                    </ul>
                </div>
                
                <div style="text-align: center;">
                    <button class="btn-primary" onclick="calculateRiskScore()" style="margin-right: 15px; padding: 15px 30px;">
                        <i class="fas fa-calculator"></i> Calculate Risk Score
                    </button>
                    <button class="btn-secondary" onclick="generateRiskReport()" style="padding: 15px 30px;">
                        <i class="fas fa-file-pdf"></i> Generate Report
                    </button>
                </div>
                
                <div id="riskResults" style="display: none; margin-top: 25px;"></div>
            `;

            modal.style.display = 'block';

            // Re-attach close event
            modal.querySelector('.close').addEventListener('click', function () {
                modal.style.display = 'none';
            });
        }

        function calculateRiskScore() {
            const form = document.getElementById('riskAssessmentForm');
            const formData = new FormData(form);
            let yesCount = 0;
            let totalQuestions = 0;

            for (let [key, value] of formData.entries()) {
                totalQuestions++;
                if (value === 'yes') yesCount++;
            }

            if (totalQuestions === 0) {
                alert('Please answer all questions before calculating risk score.');
                return;
            }

            const riskPercentage = Math.round((yesCount / totalQuestions) * 100);
            let riskLevel, riskColor, recommendations;

            if (riskPercentage >= 80) {
                riskLevel = 'Very High Risk';
                riskColor = '#d32f2f';
                recommendations = 'Immediate action required. Contact emergency management professionals.';
            } else if (riskPercentage >= 60) {
                riskLevel = 'High Risk';
                riskColor = '#f57c00';
                recommendations = 'Priority improvements needed. Develop action plan within 30 days.';
            } else if (riskPercentage >= 40) {
                riskLevel = 'Moderate Risk';
                riskColor = '#fbc02d';
                recommendations = 'Some improvements recommended. Review and upgrade systems.';
            } else if (riskPercentage >= 20) {
                riskLevel = 'Low Risk';
                riskColor = '#689f38';
                recommendations = 'Good safety measures in place. Continue regular maintenance.';
            } else {
                riskLevel = 'Very Low Risk';
                riskColor = '#388e3c';
                recommendations = 'Excellent safety measures. Maintain current standards.';
            }

            const resultsDiv = document.getElementById('riskResults');
            resultsDiv.innerHTML = `
                <div style="background: linear-gradient(135deg, #fff, #f8f9fa); padding: 25px; border-radius: 15px; border: 2px solid ${riskColor};">
                    <h3 style="text-align: center; color: ${riskColor}; margin-bottom: 20px;">
                        <i class="fas fa-chart-bar"></i> Risk Assessment Results
                    </h3>
                    <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 20px;">
                        <div style="width: 150px; height: 150px; border-radius: 50%; background: conic-gradient(${riskColor} ${riskPercentage * 3.6}deg, #e0e0e0 0deg); display: flex; align-items: center; justify-content: center; position: relative;">
                            <div style="width: 120px; height: 120px; border-radius: 50%; background: white; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                                <div style="font-size: 2rem; font-weight: bold; color: ${riskColor};">${riskPercentage}%</div>
                                <div style="font-size: 0.9rem; color: #666;">Risk Score</div>
                            </div>
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <h4 style="color: ${riskColor}; margin-bottom: 15px;">${riskLevel}</h4>
                        <p style="color: #666; line-height: 1.6;">${recommendations}</p>
                    </div>
                </div>
            `;
            resultsDiv.style.display = 'block';
        }

        function generateRiskReport() {
            alert('Generating comprehensive risk assessment report...\n\nThe report will include:\n• Detailed risk analysis\n• Specific recommendations\n• Implementation timeline\n• Contact information for experts\n\nReport will be sent to your email.');
        }

        function startVRExperience(disasterType) {
            alert(`Launching ${disasterType.toUpperCase()} VR Training Experience...\n\nYou will experience:\n• Immersive disaster scenarios\n• Real-time decision making\n• Performance feedback\n• Skill certification\n\nMake sure your VR headset is connected!`);
        }

        function downloadResourceKit(disasterType) {
            alert(`Downloading ${disasterType.toUpperCase()} Resource Kit...\n\nKit includes:\n• Emergency procedure guides\n• Training materials\n• Assessment checklists\n• Contact information\n• Educational videos\n\nDownload will begin shortly.`);
        }
    </script>
</body>

</html>