<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamified Learning - DisasterSafe</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #0d47a1;
            --secondary: #34a853;
            --accent: #f25c54;
            --warning: #f9a825;
            --card-bg: #ffffff;
            --text-dark: #202124;
            --light-bg: #f5f7fb;

            --p1: #309ad4;
            --p2: #e69c42;
            --p3: #ea8d99;
            --p4: #faafa4;
            --p5: #e2afd3;
            --p6: #c8e5f3;
            --p7: #fae8c7;

            --shadow: 0 8px 20px rgba(18, 38, 63, 0.08);
            --transition: all 0.25s ease;
            --glass: rgba(255, 255, 255, 0.72);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: var(--light-bg);
            color: var(--text-dark);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-family: "Ubuntu", sans-serif;
            font-weight: 400;
            font-style: normal;
        }

        /* Layout */
        .dashboard-container {
            display: grid;
            grid-template-columns: 240px 1fr;
            min-height: 100vh;
        }

        .sidebar {
            background: linear-gradient(180deg, var(--primary), var(--primary-dark));
            color: #fff;
            padding: 22px;
            position: fixed;
            width: 240px;
            height: 100%;
            overflow-y: auto;
            box-shadow: var(--shadow);
            z-index: 200;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06)
        }

        .logo i {
            font-size: 22px;
            color: var(--p6)
        }

        .logo h1 {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 0.2px
        }

        .menu-items {
            margin-top: 18px;
            display: flex;
            flex-direction: column;
            gap: 8px
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            color: rgba(255, 255, 255, 0.95)
        }

        .menu-item i {
            width: 20px;
            text-align: center
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.06)
        }

        .menu-item.active {
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.14), rgba(255, 255, 255, 0.06));
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08)
        }

        /* Main content */
        .main-content {
            grid-column: 2;
            padding: 20px;
            min-height: 100vh
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header-section {
            text-align: center;
            margin-bottom: 50px;
            color: var(--text-dark);
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .header-section h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header-section p {
            font-size: 1.1rem;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        /* Game Filter Bar */
        .game-filter-bar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .filter-option {
            padding: 12px 24px;
            border: 2px solid transparent;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .filter-option:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            border-color: var(--primary);
        }

        .filter-option.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
        }

        .filter-option i {
            font-size: 16px;
        }

        /* Responsive filter bar */
        @media (max-width: 768px) {
            .game-filter-bar {
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
                padding: 15px;
            }
            
            .filter-option {
                padding: 10px 18px;
                font-size: 13px;
                flex: 1;
                min-width: 120px;
                justify-content: center;
            }
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 50px;
        }

        .game-card {
            background: var(--card-bg);
            border-radius: 14px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }

        .game-card:hover {
            transform: translateY(-6px);
        }

        .game-header {
            height: 160px;
            position: relative;
            background: linear-gradient(90deg, var(--p6), var(--p1));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .game-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .game-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(90deg, var(--p3), var(--accent));
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .game-content {
            padding: 24px;
        }

        .game-content h3 {
            font-size: 1.5rem;
            margin-bottom: 12px;
            color: var(--text-dark);
        }

        .game-content p {
            color: #6c757d;
            margin-bottom: 18px;
            line-height: 1.6;
        }

        .game-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 18px;
            padding: 15px;
            background: rgba(26, 115, 232, 0.05);
            border-radius: 12px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .game-features {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 18px;
        }

        .feature-tag {
            padding: 5px 10px;
            background: rgba(52, 168, 83, 0.1);
            color: var(--secondary);
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .game-actions {
            display: flex;
            gap: 12px;
        }

        .btn-primary {
            flex: 1;
            padding: 12px 18px;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(26, 115, 232, 0.3);
        }

        .btn-secondary {
            padding: 12px 18px;
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        /* DisasterPoly Game Board */
        .disasterpoly-section {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(16, 24, 32, 0.03);
        }

        .game-board {
            width: 500px;
            height: 500px;
            margin: 0 auto;
            position: relative;
            background: rgba(26, 115, 232, 0.05);
            border: 3px solid var(--primary);
            border-radius: 14px;
        }

        .board-square {
            position: absolute;
            width: 70px;
            height: 70px;
            border: 2px solid var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            text-align: center;
            background: var(--card-bg);
            cursor: pointer;
            transition: var(--transition);
            border-radius: 8px;
        }

        .board-square:hover {
            background: rgba(26, 115, 232, 0.1);
            transform: scale(1.05);
        }

        .board-square.corner {
            background: linear-gradient(90deg, var(--p1), var(--primary));
            color: white;
            font-weight: 600;
        }

        .board-square.disaster {
            background: linear-gradient(90deg, var(--p3), var(--accent));
            color: white;
        }

        .board-square.safe {
            background: linear-gradient(90deg, var(--secondary), var(--p2));
            color: white;
        }

        .board-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 250px;
            height: 250px;
            background: linear-gradient(90deg, var(--p6), var(--p1));
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .board-center h2 {
            font-size: 1.6rem;
            margin-bottom: 8px;
        }

        .board-center p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 18px;
            margin-top: 25px;
        }

        .dice {
            width: 50px;
            height: 50px;
            background: var(--card-bg);
            border: 3px solid var(--primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary);
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .dice:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.1);
        }

        .player-info {
            display: flex;
            justify-content: space-around;
            margin-top: 25px;
            gap: 18px;
        }

        .player-card {
            background: rgba(26, 115, 232, 0.05);
            padding: 18px;
            border-radius: 12px;
            text-align: center;
            flex: 1;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }

        .player-card h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .player-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        /* Quiz Section */
        .quiz-section {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(16, 24, 32, 0.03);
        }

        /* Game Modal Styles */
        .game-modal {
            display: none;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999 !important;
            backdrop-filter: blur(3px);
        }

        .game-modal.active {
            display: flex !important;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #ffffff;
            border-radius: 15px;
            max-width: 800px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
            border: 1px solid #e0e0e0;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            padding: 25px 30px 20px 30px;
            text-align: center;
            background: #ffffff;
            color: var(--text-dark);
            border-radius: 15px 15px 0 0;
            position: relative;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: #f5f5f5;
            border: none;
            color: #666;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            transition: var(--transition);
            font-weight: bold;
        }

        .modal-close:hover {
            background: #e0e0e0;
            color: #333;
            transform: scale(1.1);
        }

        .modal-game-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .modal-title {
            font-size: 1.8rem;
            margin-bottom: 8px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .modal-subtitle {
            font-size: 1rem;
            color: #666;
            margin-bottom: 0;
        }

        .modal-body {
            padding: 30px;
            background: #ffffff;
        }

        .game-description {
            font-size: 1rem;
            line-height: 1.6;
            color: var(--text-dark);
            margin-bottom: 25px;
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }

        .game-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .detail-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .detail-section h4 {
            color: var(--primary);
            font-size: 1.1rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .detail-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .detail-section li {
            padding: 6px 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-dark);
            font-size: 0.9rem;
        }

        .detail-section li:last-child {
            border-bottom: none;
        }

        .detail-section li i {
            color: var(--secondary);
            width: 14px;
            font-size: 0.8rem;
        }

        .game-stats-modal {
            display: flex;
            justify-content: space-around;
            background: var(--primary);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .stat-item-modal {
            text-align: center;
        }

        .stat-number-modal {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label-modal {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }

        .btn-start-game {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-start-game:hover {
            background: #2e7d32;
            transform: translateY(-2px);
        }

        .btn-cancel {
            background: #ffffff;
            color: #666;
            border: 2px solid #ddd;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-cancel:hover {
            background: #f5f5f5;
            border-color: #bbb;
            transform: translateY(-2px);
        }

        /* Full Game Interface */
        .game-interface {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--light-bg);
            z-index: 1500;
            overflow-y: auto;
        }

        .game-interface.active {
            display: block;
            animation: gameInterfaceSlideIn 0.4s ease-out;
        }

        @keyframes gameInterfaceSlideIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .game-header-interface {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }

        .game-title-interface {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .game-controls-interface {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .btn-minimize {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-minimize:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .btn-exit-game {
            background: var(--accent);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .btn-exit-game:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }

        .game-content-interface {
            padding: 30px;
            min-height: calc(100vh - 80px);
            overflow-y: auto;
        }

        .game-stats-display {
            background: rgba(26, 115, 232, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .stat-display {
            text-align: center;
        }

        .stat-display .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-display .stat-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }

        .game-instructions {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .instructions-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .instructions-icon {
            font-size: 2rem;
            color: var(--primary);
        }

        .instructions-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .instructions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .instruction-section {
            background: rgba(26, 115, 232, 0.05);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }

        .instruction-section h4 {
            color: var(--primary);
            margin-bottom: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .instruction-list {
            list-style: none;
            padding: 0;
        }

        .instruction-list li {
            padding: 6px 0;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .instruction-list li i {
            color: var(--secondary);
            margin-top: 2px;
            flex-shrink: 0;
        }

        .game-area {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            min-height: 400px;
        }

        .game-loading {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .game-ready {
            text-align: center;
            padding: 40px 20px;
        }

        .game-ready h3 {
            color: var(--primary);
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        .game-ready p {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .start-playing-btn {
            background: linear-gradient(135deg, var(--secondary), #2e7d32);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0 auto;
        }

        .start-playing-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 168, 83, 0.3);
        }

        .achievement-popup {
            position: fixed;
            top: 100px;
            right: 30px;
            background: linear-gradient(135deg, var(--secondary), #2e7d32);
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            transform: translateX(400px);
            transition: transform 0.4s ease;
            max-width: 300px;
        }

        .achievement-popup.show {
            transform: translateX(0);
        }

        .achievement-popup .achievement-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .achievement-popup .achievement-title {
            font-weight: 700;
            margin-bottom: 5px;
        }

        .achievement-popup .achievement-desc {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .game-placeholder {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 60px;
            text-align: center;
            box-shadow: var(--shadow);
            max-width: 800px;
            width: 100%;
        }

        .game-placeholder h2 {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .game-placeholder p {
            font-size: 1.2rem;
            color: #666;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .coming-soon-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--warning), var(--p2));
            color: white;
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 1rem;
        }

        /* General Info Popup Styles */
        .info-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            backdrop-filter: blur(4px);
            animation: fadeIn 0.3s ease-out;
        }

        .info-popup.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .popup-content {
            background: #ffffff;
            border-radius: 16px;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            animation: slideInUp 0.4s ease-out;
            border: 1px solid #e0e0e0;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(40px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }

        .popup-header {
            padding: 25px 30px 20px 30px;
            text-align: center;
            background: #ffffff;
            border-radius: 16px 16px 0 0;
            position: relative;
            border-bottom: 2px solid #f5f5f5;
        }

        .popup-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: #f8f9fa;
            border: none;
            color: #666;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            transition: var(--transition);
            font-weight: bold;
        }

        .popup-close:hover {
            background: #e9ecef;
            color: #333;
            transform: scale(1.1);
        }

        .popup-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .popup-title {
            font-size: 1.8rem;
            margin-bottom: 8px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .popup-subtitle {
            font-size: 1rem;
            color: #666;
            margin-bottom: 0;
        }

        .popup-body {
            padding: 25px 30px 30px 30px;
            background: #ffffff;
            border-radius: 0 0 16px 16px;
        }

        .popup-description {
            font-size: 1rem;
            line-height: 1.7;
            color: var(--text-dark);
            margin-bottom: 25px;
            text-align: left;
        }

        .popup-section {
            margin-bottom: 25px;
        }

        .popup-section h4 {
            color: var(--primary);
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 8px;
        }

        .popup-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .popup-list li {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            color: var(--text-dark);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .popup-list li:last-child {
            border-bottom: none;
        }

        .popup-list li i {
            color: var(--secondary);
            width: 16px;
            font-size: 0.9rem;
            margin-top: 2px;
            flex-shrink: 0;
        }

        .popup-highlight {
            background: rgba(26, 115, 232, 0.05);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            margin: 15px 0;
            font-weight: 500;
        }

        .popup-warning {
            background: rgba(249, 168, 37, 0.1);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--warning);
            margin: 15px 0;
            color: #8a6914;
        }

        .popup-tip {
            background: rgba(52, 168, 83, 0.1);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--secondary);
            margin: 15px 0;
            color: #2e7d32;
        }

        .popup-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .popup-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e9ecef;
        }

        .popup-card h5 {
            color: var(--primary);
            margin-bottom: 12px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .popup-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }

        .btn-popup-action {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-popup-action:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-popup-secondary {
            background: #ffffff;
            color: #666;
            border: 2px solid #ddd;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-popup-secondary:hover {
            background: #f5f5f5;
            border-color: #bbb;
            transform: translateY(-2px);
        }

        /* Mobile responsiveness for popups */
        @media (max-width: 768px) {
            .popup-content {
                width: 95%;
                max-height: 90vh;
                margin: 10px;
            }
            
            .popup-header {
                padding: 20px 20px 15px 20px;
            }
            
            .popup-body {
                padding: 20px;
            }
            
            .popup-title {
                font-size: 1.5rem;
            }
            
            .popup-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .popup-actions {
                flex-direction: column;
            }
        }

        .quiz-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .quiz-progress {
            width: 100%;
            height: 8px;
            background: rgba(26, 115, 232, 0.1);
            border-radius: 4px;
            margin-bottom: 25px;
            overflow: hidden;
        }

        .quiz-progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--p1), var(--secondary));
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-card {
            background: rgba(26, 115, 232, 0.05);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 18px;
        }

        .question-number {
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .question-points {
            background: linear-gradient(90deg, var(--secondary), var(--p2));
            color: white;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: var(--text-dark);
            line-height: 1.4;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 12px;
        }

        .option-button {
            padding: 12px 16px;
            border: 2px solid rgba(26, 115, 232, 0.2);
            background: var(--card-bg);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            text-align: left;
            font-size: 0.95rem;
        }

        .option-button:hover {
            border-color: var(--primary);
            background: rgba(26, 115, 232, 0.05);
            transform: translateY(-2px);
        }

        .option-button.selected {
            border-color: var(--primary);
            background: rgba(26, 115, 232, 0.1);
        }

        .option-button.correct {
            border-color: var(--secondary);
            background: rgba(52, 168, 83, 0.1);
        }

        .option-button.incorrect {
            border-color: var(--accent);
            background: rgba(242, 92, 84, 0.1);
        }

        .quiz-results {
            background: linear-gradient(90deg, var(--p1), var(--secondary));
            color: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            margin-top: 25px;
            box-shadow: var(--shadow);
        }

        .score-display {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .achievement-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            margin: 8px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        @media (max-width: 992px) {
            .dashboard-container {
                grid-template-columns: 1fr
            }

            .sidebar {
                position: relative;
                width: 100%;
                height: auto
            }

            .main-content {
                padding: 18px
            }

            .header-section h1 {
                font-size: 2rem;
            }

            .games-grid {
                grid-template-columns: 1fr;
            }

            .game-board {
                width: 100%;
                height: auto;
                aspect-ratio: 1;
                max-width: 400px;
            }

            .board-square {
                width: 50px;
                height: 50px;
                font-size: 0.55rem;
            }

            .board-center {
                width: 180px;
                height: 180px;
            }

            .board-center h2 {
                font-size: 1.2rem;
            }
        }

        /* Game Popup Styles */
        .game-popup {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
        }

        .popup-content {
            background-color: #fff;
            margin: 3% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
            animation: popupSlideIn 0.3s ease-out;
        }

        @keyframes popupSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .popup-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            position: relative;
        }

        .close-popup {
            color: #fff;
            float: right;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.3s;
            position: absolute;
            right: 20px;
            top: 20px;
        }

        .close-popup:hover {
            opacity: 0.7;
        }

        .popup-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .progress-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f6f9fc, #e9ecef);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #e0e6ed;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .games-progress {
            margin-top: 20px;
        }

        .game-progress-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            transition: background-color 0.2s;
        }

        .game-progress-item:hover {
            background: #e9ecef;
        }

        .game-info h4 {
            margin: 0 0 5px 0;
            color: #333;
        }

        .game-meta {
            font-size: 0.85rem;
            color: #666;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 8px;
            width: 120px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .play-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }

        .play-btn:hover {
            background: var(--primary-dark);
        }

        .completed {
            opacity: 0.7;
        }

        .completed .play-btn {
            background: #28a745;
        }

        .achievement-badge {
            display: inline-block;
            background: gold;
            color: #333;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
                <h1>ResQ</h1>
            </div>
            <div class="menu-items">
                <div class="menu-item"><i class="fas fa-home"></i><span>Dashboard</span></div>
                <div class="menu-item"><i class="fas fa-book"></i><span>Education Modules</span></div>
                <div class="menu-item"><i class="fas fa-gamepad"></i><span>Sandbox Simulator</span></div>
                <div class="menu-item"><i class="fas fa-phone-alt"></i><span>Emergency Contacts</span></div>
                <div class="menu-item"><i class="fas fa-map-marked-alt"></i><span>Disaster Map</span></div>
                <div class="menu-item"><i class="fas fa-robot"></i><span>AI Helper</span></div>
                <div class="menu-item active"><i class="fas fa-graduation-cap"></i><span>Gamified Learning</span></div>
                <div class="menu-item"><i class="fas fa-user"></i><span>Profile & Badges</span></div>
                <div class="menu-item"><i class="fas fa-cog"></i><span>Settings</span></div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
        <div class="header-section">
            <h1>Gamified Disaster Learning</h1>
            <p>Learn disaster management through engaging games and challenges</p>
        </div>

        <!-- Game Filter Bar -->
        <div class="game-filter-bar">
            <div class="filter-option active" onclick="filterGames('all')" data-filter="all">
                <i class="fas fa-th-large"></i>
                <span>All Games</span>
            </div>
            <div class="filter-option" onclick="filterGames('multiplayer')" data-filter="multiplayer">
                <i class="fas fa-users"></i>
                <span>Multiplayer</span>
            </div>
            <div class="filter-option" onclick="filterGames('solo')" data-filter="solo">
                <i class="fas fa-user"></i>
                <span>Solo Play</span>
            </div>
            <div class="filter-option" onclick="filterGames('city-building')" data-filter="city-building">
                <i class="fas fa-city"></i>
                <span>City Building</span>
            </div>
            <div class="filter-option" onclick="filterGames('trivia')" data-filter="trivia">
                <i class="fas fa-brain"></i>
                <span>Trivia & Quiz</span>
            </div>
            <div class="filter-option" onclick="filterGames('strategy')" data-filter="strategy">
                <i class="fas fa-chess"></i>
                <span>Strategy</span>
            </div>
        </div>

        <div class="games-grid" id="gamesGrid">
            <div class="game-card" data-category="multiplayer strategy">
                <div class="game-header">
                    <div class="game-badge">Multiplayer</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="fas fa-dice"></i>
                        </div>
                        <h3>DisasterPoly</h3>
                    </div>
                </div>
                <div class="game-content">
                    <h3>DisasterPoly Board Game</h3>
                    <p>Navigate through disaster scenarios, make strategic decisions, and learn emergency management in this exciting board game.</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">2-6</div>
                            <div class="stat-label">Players</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">30-45</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">â˜… 4.8</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="game-features">
                        <span class="feature-tag">Strategy</span>
                        <span class="feature-tag">Multiplayer</span>
                        <span class="feature-tag">Educational</span>
                        <span class="feature-tag">Real-time</span>
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="window.open('games/disasterpoly.html', '_blank')">Play Now</button>
                        <button class="btn-secondary" onclick="viewRules()">Rules</button>
                    </div>
                </div>
            </div>

            <div class="game-card" data-category="solo trivia">
                <div class="game-header">
                    <div class="game-badge">Solo Play</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <h3>Knowledge Quiz</h3>
                    </div>
                </div>
                <div class="game-content">
                    <h3>Disaster Knowledge Quiz</h3>
                    <p>Test your disaster preparedness knowledge with challenging questions and earn points for correct answers.</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">50</div>
                            <div class="stat-label">Questions</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">15</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">500</div>
                            <div class="stat-label">Max Points</div>
                        </div>
                    </div>

                    <div class="game-features">
                        <span class="feature-tag">Quiz</span>
                        <span class="feature-tag">Timed</span>
                        <span class="feature-tag">Points</span>
                        <span class="feature-tag">Badges</span>
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="window.open('games/quiz.html', '_blank')">Start Quiz</button>
                        <button class="btn-secondary" onclick="viewQuizHistory()">History</button>
                    </div>
                </div>
            </div>

            <!-- New Game: SimCity Disaster Manager -->
            <div class="game-card" data-category="city-building solo strategy">
                <div class="game-header" style="background: linear-gradient(90deg, var(--p2), var(--warning));">
                    <div class="game-badge">City Building</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="fas fa-city"></i>
                        </div>
                        <h3>SimCity: Disaster Manager</h3>
                    </div>
                </div>
                <div class="game-content">
                    <h3>SimCity: Disaster Manager ðŸ™ï¸</h3>
                    <p>Build resilient cities that can withstand natural disasters. Plan emergency services, create evacuation routes, and manage post-disaster recovery.</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">1-4</div>
                            <div class="stat-label">Players</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">45-90</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">â˜… 4.9</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="game-features">
                        <span class="feature-tag">City Building</span>
                        <span class="feature-tag">Strategy</span>
                        <span class="feature-tag">Disaster Prep</span>
                        <span class="feature-tag">Resource Management</span>
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="window.open('games/simCity.html', '_blank')">Build City</button>
                        <button class="btn-secondary" onclick="viewCityGuide()">Guide</button>
                    </div>
                </div>
            </div>

            <!-- New Game: Tsunami Escape -->
            <div class="game-card" data-category="solo strategy">
                <div class="game-header" style="background: linear-gradient(90deg, var(--p1), var(--primary));">
                    <div class="game-badge">Fast-Paced</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="fas fa-water"></i>
                        </div>
                        <h3>Tsunami Escape</h3>
                    </div>
                </div>
                <div class="game-content">
                    <h3>Tsunami Escape ðŸŒŠ</h3>
                    <p>Race against time to reach high ground before a tsunami hits. Solve puzzles, clear paths, and learn critical warning signs.</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">1</div>
                            <div class="stat-label">Player</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">10-20</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">â˜… 4.7</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="game-features">
                        <span class="feature-tag">Puzzle</span>
                        <span class="feature-tag">Time Pressure</span>
                        <span class="feature-tag">Survival</span>
                        <span class="feature-tag">Educational</span>
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="window.open('games/tsunamiEscape.html', '_blank')">Start Escape</button>
                        <button class="btn-secondary" onclick="viewTsunamiTips()">Safety Tips</button>
                    </div>
                </div>
            </div>

            <!-- New Game: Hurricane Hero -->
            <div class="game-card" data-category="solo strategy">
                <div class="game-header" style="background: linear-gradient(90deg, var(--p3), var(--accent));">
                    <div class="game-badge">Strategy</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="fas fa-wind"></i>
                        </div>
                        <h3>Hurricane Hero</h3>
                    </div>
                </div>
                <div class="game-content">
                    <h3>Hurricane Hero: Resource Dash ðŸŒ€</h3>
                    <p>Prepare your home and community for an approaching hurricane. Make critical decisions about resource allocation and community support.</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">1-3</div>
                            <div class="stat-label">Players</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">25-40</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">â˜… 4.6</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="game-features">
                        <span class="feature-tag">Preparation</span>
                        <span class="feature-tag">Decision Making</span>
                        <span class="feature-tag">Community</span>
                        <span class="feature-tag">Time Management</span>
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="window.open('games/hurricaneHero.html', '_blank')">Prepare Now</button>
                        <button class="btn-secondary" onclick="viewHurricaneGuide()">Prep Guide</button>
                    </div>
                </div>
            </div>

            <!-- New Game: Wildfire Watch -->
            <div class="game-card" data-category="solo strategy">
                <div class="game-header" style="background: linear-gradient(90deg, var(--warning), var(--accent));">
                    <div class="game-badge">RTS</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="fas fa-fire"></i>
                        </div>
                        <h3>Wildfire Watch</h3>
                    </div>
                </div>
                <div class="game-content">
                    <h3>Wildfire Watch ðŸ”¥</h3>
                    <p>Command firefighting teams to contain growing wildfires. Manage resources, assess terrain, and adapt to changing conditions.</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">1</div>
                            <div class="stat-label">Player</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">30-60</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">â˜… 4.8</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="game-features">
                        <span class="feature-tag">Real-time Strategy</span>
                        <span class="feature-tag">Resource Management</span>
                        <span class="feature-tag">Dynamic Events</span>
                        <span class="feature-tag">Quick Decisions</span>
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="window.open('games/WildfireWatch.html', '_blank')">Command Team</button>
                        <button class="btn-secondary" onclick="viewFireStrategy()">Strategy Guide</button>
                    </div>
                </div>
            </div>

            <!-- New Game: Quake Response -->
            <div class="game-card">
                <div class="game-header" style="background: linear-gradient(90deg, var(--p4), var(--p5));">
                    <div class="game-badge">Simulation</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="fas fa-house-damage"></i>
                        </div>
                        <h3>Quake Response</h3>
                    </div>
                </div>
                <div class="game-content">
                    <h3>Quake Response ðŸ—ï¸</h3>
                    <p>Search and rescue survivors after a major earthquake. Make critical decisions about structural safety and provide first aid.</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">1-2</div>
                            <div class="stat-label">Players</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">20-35</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">â˜… 4.7</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="game-features">
                        <span class="feature-tag">Search & Rescue</span>
                        <span class="feature-tag">Risk Assessment</span>
                        <span class="feature-tag">First Aid</span>
                        <span class="feature-tag">Critical Thinking</span>
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="window.open('games/quackResponse.html', '_blank')">Start Rescue</button>
                        <button class="btn-secondary" onclick="viewRescueGuide()">Rescue Guide</button>
                    </div>
                </div>
            </div>

            <!-- New Game: The Floodplain Project -->
            <div class="game-card">
                <div class="game-header" style="background: linear-gradient(90deg, var(--p6), var(--secondary));">
                    <div class="game-badge">Collaborative</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="fas fa-water"></i>
                        </div>
                        <h3>Floodplain Project</h3>
                    </div>
                </div>
                <div class="game-content">
                    <h3>The Floodplain Project ðŸ’§</h3>
                    <p>Work together as a community to mitigate flood risks. Design defenses, organize drills, and build long-term resilience.</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">3-6</div>
                            <div class="stat-label">Players</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">60-90</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">â˜… 4.9</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="game-features">
                        <span class="feature-tag">Collaboration</span>
                        <span class="feature-tag">Long-term Planning</span>
                        <span class="feature-tag">Community Building</span>
                        <span class="feature-tag">Sustainable Management</span>
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="window.open('games/floodPain.html', '_blank')">Join Community</button>
                        <button class="btn-secondary" onclick="viewFloodGuide()">Flood Prevention</button>
                    </div>
                </div>
            </div>

            <!-- Stop Disasters! (UNDRR) -->
            <div class="game-card">
                <div class="game-header" style="background: linear-gradient(90deg, var(--primary), var(--primary-dark));">
                    <div class="game-badge">UNDRR Official</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="fas fa-globe-americas"></i>
                        </div>
                        <h3>Stop Disasters!</h3>
                    </div>
                </div>
                <div class="game-content">
                    <h3>Stop Disasters! (UNDRR) ðŸŒ</h3>
                    <p>Act as a disaster risk manager building safer communities. Handle tsunamis, wildfires, hurricanes, earthquakes, and floods under time and resource constraints.</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">1</div>
                            <div class="stat-label">Player</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">30-45</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">â˜… 4.9</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="game-features">
                        <span class="feature-tag">UN Official</span>
                        <span class="feature-tag">Risk Management</span>
                        <span class="feature-tag">Global Disasters</span>
                        <span class="feature-tag">Community Building</span>
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="window.open('games/StopDisasters.html', '_blank')">Manage Risks</button>
                        <button class="btn-secondary" onclick="viewUNDRRGuide()">UNDRR Guide</button>
                    </div>
                </div>
            </div>

            <!-- Disaster Response Game -->
            <div class="game-card">
                <div class="game-header" style="background: linear-gradient(90deg, var(--accent), var(--warning));">
                    <div class="game-badge">Quick Response</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="fas fa-stopwatch"></i>
                        </div>
                        <h3>Disaster Response</h3>
                    </div>
                </div>
                <div class="game-content">
                    <h3>Disaster Response Game ðŸš¨</h3>
                    <p>Respond quickly to emerging crises like wildfires, hurricanes, and pandemics. Make rapid decisions with limited information in real-world scenarios.</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">1-4</div>
                            <div class="stat-label">Players</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">15-30</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">â˜… 4.7</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="game-features">
                        <span class="feature-tag">Rapid Response</span>
                        <span class="feature-tag">Limited Info</span>
                        <span class="feature-tag">Crisis Management</span>
                        <span class="feature-tag">Time Pressure</span>
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="window.open('games/disasterResponseGame.html', '_blank')">Respond Now</button>
                        <button class="btn-secondary" onclick="viewResponseGuide()">Response Guide</button>
                    </div>
                </div>
            </div>

            <!-- Road to Safety -->
            <div class="game-card">
                <div class="game-header" style="background: linear-gradient(90deg, var(--p5), var(--p3));">
                    <div class="game-badge">Tabletop</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="fas fa-road"></i>
                        </div>
                        <h3>Road to Safety</h3>
                    </div>
                </div>
                <div class="game-content">
                    <h3>Road to Safety (Listos California) ðŸ›£ï¸</h3>
                    <p>Navigate disaster scenarios with diverse avatars, experiencing real-life obstacles. Promotes empathy and awareness of how circumstances affect preparedness.</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">2-8</div>
                            <div class="stat-label">Players</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">45-60</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">â˜… 4.8</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="game-features">
                        <span class="feature-tag">Empathy Building</span>
                        <span class="feature-tag">Avatar-Based</span>
                        <span class="feature-tag">Real Obstacles</span>
                        <span class="feature-tag">Problem Solving</span>
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="window.open('games/roadtosafety.html', '_blank')">Choose Avatar</button>
                        <button class="btn-secondary" onclick="viewSafetyGuide()">Safety Guide</button>
                    </div>
                </div>
            </div>

            <!-- Disaster Mind -->
            <div class="game-card" data-category="solo strategy">
                <div class="game-header" style="background: linear-gradient(90deg, var(--p2), var(--p4));">
                    <div class="game-badge">FEMA Simulation</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <h3>Disaster Mind</h3>
                    </div>
                </div>
                <div class="game-content">
                    <h3>Disaster Mind (iThrive Sim) ðŸ§ </h3>
                    <p>FEMA-supported simulation promoting preparedness and critical thinking through immersive disaster management scenarios that mirror actual crises.</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">1-3</div>
                            <div class="stat-label">Players</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">40-60</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">â˜… 4.8</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="game-features">
                        <span class="feature-tag">FEMA Official</span>
                        <span class="feature-tag">Critical Thinking</span>
                        <span class="feature-tag">Realistic Scenarios</span>
                        <span class="feature-tag">Preparedness Focus</span>
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="window.open('games/disasterMind.html', '_blank')">Enter Simulation</button>
                        <button class="btn-secondary" onclick="viewFEMAGuide()">FEMA Guide</button>
                    </div>
                </div>
            </div>

            <!-- FloodQuest -->
            <div class="game-card" data-category="solo city-building strategy">
                <div class="game-header" style="background: linear-gradient(90deg, var(--p1), var(--p6));">
                    <div class="game-badge">Flood Specialist</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="fas fa-tint"></i>
                        </div>
                        <h3>FloodQuest</h3>
                    </div>
                </div>
                <div class="game-content">
                    <h3>FloodQuest ðŸŒŠ</h3>
                    <p>Specialized flood preparedness education game. Anticipate, simulate, and respond to urban flooding scenarios while learning planning and emergency responses.</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">1-4</div>
                            <div class="stat-label">Players</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">25-40</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">â˜… 4.6</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="game-features">
                        <span class="feature-tag">Flood Focus</span>
                        <span class="feature-tag">Urban Planning</span>
                        <span class="feature-tag">Simulation</span>
                        <span class="feature-tag">Emergency Response</span>
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="window.open('games/floodQuest.html', '_blank')">Start Quest</button>
                        <button class="btn-secondary" onclick="viewFloodQuestGuide()">Flood Prep</button>
                    </div>
                </div>
            </div>

            <!-- Disaster Quest Escape Room -->
            <div class="game-card">
                <div class="game-header" style="background: linear-gradient(90deg, var(--accent), var(--p3));">
                    <div class="game-badge">Escape Room</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="fas fa-door-open"></i>
                        </div>
                        <h3>Disaster Quest</h3>
                    </div>
                </div>
                <div class="game-content">
                    <h3>Disaster Quest (Escape Challenge) ðŸšª</h3>
                    <p>Timed escape-room experience with simulated disasters. Solve puzzles to evacuate safely by choosing right emergency kit items and finding safe exit routes.</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">2-6</div>
                            <div class="stat-label">Players</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">20-35</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">â˜… 4.7</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="game-features">
                        <span class="feature-tag">Escape Room</span>
                        <span class="feature-tag">Puzzle Solving</span>
                        <span class="feature-tag">Team Coordination</span>
                        <span class="feature-tag">Time Pressure</span>
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="window.open('games/disasterQuest.html', '_blank')">Enter Room</button>
                        <button class="btn-secondary" onclick="viewEscapeGuide()">Escape Tips</button>
                    </div>
                </div>
            </div>

            <!-- Survival Kit Builder -->
            <div class="game-card">
                <div class="game-header" style="background: linear-gradient(90deg, var(--secondary), var(--p2));">
                    <div class="game-badge">Resource Management</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="fas fa-toolbox"></i>
                        </div>
                        <h3>Survival Kit Builder</h3>
                    </div>
                </div>
                <div class="game-content">
                    <h3>Survival Kit Builder ðŸŽ’</h3>
                    <p>Build emergency survival kits with limited budget. Choose correct essentials while avoiding wrong items. Different disasters require different kits!</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">1-4</div>
                            <div class="stat-label">Players</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">15-25</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">â˜… 4.5</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="game-features">
                        <span class="feature-tag">Budget Management</span>
                        <span class="feature-tag">Kit Building</span>
                        <span class="feature-tag">Disaster-Specific</span>
                        <span class="feature-tag">Educational</span>
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="window.open('games/survivalKit.html', '_blank')">Build Kit</button>
                        <button class="btn-secondary" onclick="viewKitGuide()">Kit Essentials</button>
                    </div>
                </div>
            </div>

            <!-- Rescue Mission Simulator -->
            <div class="game-card">
                <div class="game-header" style="background: linear-gradient(90deg, var(--warning), var(--accent));">
                    <div class="game-badge">Role-Play</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="fas fa-ambulance"></i>
                        </div>
                        <h3>Rescue Mission</h3>
                    </div>
                </div>
                <div class="game-content">
                    <h3>Rescue Mission Simulator ðŸš‘</h3>
                    <p>Role-play as first responders (firefighter, paramedic, volunteer). Prioritize rescue tasks under pressure - help injured, clear paths, call backup.</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">1-3</div>
                            <div class="stat-label">Players</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">20-30</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">â˜… 4.8</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="game-features">
                        <span class="feature-tag">First Responder</span>
                        <span class="feature-tag">Priority Tasks</span>
                        <span class="feature-tag">Role-Playing</span>
                        <span class="feature-tag">Decision Speed</span>
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="window.open('games/rescueMission.html', '_blank')">Respond Now</button>
                        <button class="btn-secondary" onclick="viewRescueProtocol()">Response Protocol</button>
                    </div>
                </div>
            </div>

            <!-- Disaster Trivia Battle -->
            <div class="game-card" data-category="multiplayer trivia">
                <div class="game-header" style="background: linear-gradient(90deg, var(--p3), var(--p5));">
                    <div class="game-badge">Multiplayer Quiz</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <h3>Trivia Battle</h3>
                    </div>
                </div>
                <div class="game-content">
                    <h3>Disaster Trivia Battle ðŸ†</h3>
                    <p>Multiplayer quiz with rapid-fire questions on disaster do's and don'ts. Power-ups and lifelines keep it competitive!</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">2-8</div>
                            <div class="stat-label">Players</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">10-20</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">â˜… 4.6</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="game-features">
                        <span class="feature-tag">Rapid-Fire</span>
                        <span class="feature-tag">Power-Ups</span>
                        <span class="feature-tag">Competitive</span>
                        <span class="feature-tag">Multiplayer</span>
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="window.open('games/disasterTrivia.html', '_blank')">Join Battle</button>
                        <button class="btn-secondary" onclick="viewTriviaGuide()">Game Rules</button>
                    </div>
                </div>
            </div>

            <!-- Virtual Drill Race -->
            <div class="game-card">
                <div class="game-header" style="background: linear-gradient(90deg, var(--p4), var(--primary));">
                    <div class="game-badge">Evacuation Drill</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="fas fa-running"></i>
                        </div>
                        <h3>Virtual Drill Race</h3>
                    </div>
                </div>
                <div class="game-content">
                    <h3>Virtual Drill Race ðŸƒâ€â™‚ï¸</h3>
                    <p>Conduct virtual evacuation drills for schools/communities. Guide groups to safety while handling blocked exits and panic situations.</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">1-2</div>
                            <div class="stat-label">Players</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">15-25</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">â˜… 4.7</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="game-features">
                        <span class="feature-tag">Evacuation</span>
                        <span class="feature-tag">Performance Metrics</span>
                        <span class="feature-tag">Stress Management</span>
                        <span class="feature-tag">Group Leadership</span>
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="window.open('games/virtualDrill.html', '_blank')">Start Drill</button>
                        <button class="btn-secondary" onclick="viewDrillGuide()">Drill Protocol</button>
                    </div>
                </div>
            </div>

            <!-- Disaster Detective -->
            <div class="game-card">
                <div class="game-header" style="background: linear-gradient(90deg, var(--p6), var(--p1));">
                    <div class="game-badge">Myth Busting</div>
                    <div style="text-align: center;">
                        <div class="game-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <h3>Disaster Detective</h3>
                    </div>
                </div>
                <div class="game-content">
                    <h3>Disaster Detective (Myth vs Fact) ðŸ”</h3>
                    <p>Mystery-style game investigating disaster rumors and misinformation. Separate myths from facts to solve cases and unlock clues!</p>
                    
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-number">1-4</div>
                            <div class="stat-label">Players</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">20-35</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">â˜… 4.8</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>

                    <div class="game-features">
                        <span class="feature-tag">Myth Busting</span>
                        <span class="feature-tag">Investigation</span>
                        <span class="feature-tag">Fact Checking</span>
                        <span class="feature-tag">Mystery Solving</span>
                    </div>

                    <div class="game-actions">
                        <button class="btn-primary" onclick="window.open('games/factVsMyth.html', '_blank')">Start Investigation</button>
                        <button class="btn-secondary" onclick="viewFactGuide()">Fact vs Myth</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- DisasterPoly Game Section -->
        <div class="disasterpoly-section" id="disasterPolyGame" style="display: none;">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">DisasterPoly Game Board</h2>
            
            <div class="game-board" id="gameBoard">
                <div class="board-center">
                    <h2>DisasterPoly</h2>
                    <p>Emergency Management Board Game</p>
                </div>
                <!-- Board squares will be generated by JavaScript -->
            </div>

            <div class="game-controls">
                <button class="btn-primary" onclick="rollDice()">Roll Dice</button>
                <div class="dice" id="diceDisplay">?</div>
                <button class="btn-secondary" onclick="endTurn()">End Turn</button>
            </div>

            <div class="player-info" id="playerInfo">
                <div class="player-card">
                    <h4>Player 1</h4>
                    <div class="player-stats">
                        <span>Position: <strong id="p1Position">0</strong></span>
                        <span>Score: <strong id="p1Score">0</strong></span>
                        <span>Lives: <strong id="p1Lives">3</strong></span>
                    </div>
                </div>
                <div class="player-card">
                    <h4>Player 2</h4>
                    <div class="player-stats">
                        <span>Position: <strong id="p2Position">0</strong></span>
                        <span>Score: <strong id="p2Score">0</strong></span>
                        <span>Lives: <strong id="p2Lives">3</strong></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quiz Section -->
        <div class="quiz-section" id="quizGame" style="display: none;">
            <div class="quiz-header">
                <h2 style="color: var(--primary);">Disaster Knowledge Quiz</h2>
                <div class="quiz-progress">
                    <div class="quiz-progress-fill" id="quizProgress"></div>
                </div>
                <p>Question <span id="currentQuestion">1</span> of <span id="totalQuestions">10</span></p>
            </div>

            <div class="question-card" id="questionCard">
                <div class="question-header">
                    <span class="question-number">Question <span id="questionNumber">1</span></span>
                    <span class="question-points" id="questionPoints">+10 points</span>
                </div>
                <div class="question-text" id="questionText">
                    What is the most important thing to do during an earthquake?
                </div>
                <div class="options-grid" id="optionsGrid">
                    <button class="option-button" onclick="selectAnswer(0)">Run outside immediately</button>
                    <button class="option-button" onclick="selectAnswer(1)">Drop, cover, and hold on</button>
                    <button class="option-button" onclick="selectAnswer(2)">Stand in a doorway</button>
                    <button class="option-button" onclick="selectAnswer(3)">Look for the nearest exit</button>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn-primary" id="nextButton" onclick="nextQuestion()" disabled>Next Question</button>
                <button class="btn-secondary" onclick="exitQuiz()">Exit Quiz</button>
            </div>

            <div class="quiz-results" id="quizResults" style="display: none;">
                <div class="score-display" id="finalScore">0</div>
                <h3>Quiz Completed!</h3>
                <p>You answered <span id="correctAnswers">0</span> out of <span id="totalAnswered">0</span> questions correctly.</p>
                <div id="badgesEarned"></div>
                <button class="btn-primary" onclick="restartQuiz()" style="margin-top: 20px;">Play Again</button>
            </div>
            </div>
        </div>
        </main>
    </div>

    <!-- Game Information Modal -->
    <div class="game-modal" id="gameModal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="modal-close" onclick="closeGameModal()">&times;</button>
                <div class="modal-game-icon" id="modalGameIcon">
                    <i class="fas fa-gamepad"></i>
                </div>
                <h2 class="modal-title" id="modalGameTitle">Game Title</h2>
                <p class="modal-subtitle" id="modalGameSubtitle">Game Subtitle</p>
            </div>
            <div class="modal-body">
                <div class="game-description" id="modalGameDescription">
                    Game description goes here...
                </div>
                
                <div class="game-stats-modal" id="modalGameStats">
                    <div class="stat-item-modal">
                        <div class="stat-number-modal" id="modalPlayers">1-4</div>
                        <div class="stat-label-modal">Players</div>
                    </div>
                    <div class="stat-item-modal">
                        <div class="stat-number-modal" id="modalDuration">30-45</div>
                        <div class="stat-label-modal">Minutes</div>
                    </div>
                    <div class="stat-item-modal">
                        <div class="stat-number-modal" id="modalRating">â˜… 4.8</div>
                        <div class="stat-label-modal">Rating</div>
                    </div>
                </div>

                <div class="game-details-grid">
                    <div class="detail-section">
                        <h4><i class="fas fa-target"></i> Objectives</h4>
                        <ul id="modalObjectives">
                            <li><i class="fas fa-check"></i> Sample objective 1</li>
                            <li><i class="fas fa-check"></i> Sample objective 2</li>
                        </ul>
                    </div>
                    
                    <div class="detail-section">
                        <h4><i class="fas fa-lightbulb"></i> Key Features</h4>
                        <ul id="modalFeatures">
                            <li><i class="fas fa-star"></i> Feature 1</li>
                            <li><i class="fas fa-star"></i> Feature 2</li>
                        </ul>
                    </div>
                    
                    <div class="detail-section">
                        <h4><i class="fas fa-graduation-cap"></i> Learning Outcomes</h4>
                        <ul id="modalLearning">
                            <li><i class="fas fa-brain"></i> Learning outcome 1</li>
                            <li><i class="fas fa-brain"></i> Learning outcome 2</li>
                        </ul>
                    </div>
                    
                    <div class="detail-section">
                        <h4><i class="fas fa-exclamation-triangle"></i> Important Notes</h4>
                        <ul id="modalNotes">
                            <li><i class="fas fa-info-circle"></i> Important note 1</li>
                            <li><i class="fas fa-info-circle"></i> Important note 2</li>
                        </ul>
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="btn-start-game" onclick="startActualGame()">
                        <i class="fas fa-play"></i> Start Game
                    </button>
                    <button class="btn-cancel" onclick="closeGameModal()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Full Game Interface -->
    <div class="game-interface" id="gameInterface">
        <div class="game-header-interface">
            <div class="game-title-interface">
                <i class="fas fa-gamepad"></i>
                <span id="interfaceGameTitle">Game Title</span>
            </div>
            <div class="game-controls-interface">
                <button class="btn-minimize" onclick="minimizeGame()" title="Minimize">
                    <i class="fas fa-window-minimize"></i>
                </button>
                <button class="btn-exit-game" onclick="exitGame()">
                    <i class="fas fa-times"></i> Exit Game
                </button>
            </div>
        </div>
        <div class="game-content-interface">
            <!-- Player Stats Display -->
            <div class="game-stats-display" id="gameStatsDisplay">
                <div class="stat-display">
                    <div class="stat-value" id="gamesPlayedCount">0</div>
                    <div class="stat-label">Games Played</div>
                </div>
                <div class="stat-display">
                    <div class="stat-value" id="lastGamePoints">0</div>
                    <div class="stat-label">Last Game Points</div>
                </div>
                <div class="stat-display">
                    <div class="stat-value" id="maxPointsEver">0</div>
                    <div class="stat-label">Max Points</div>
                </div>
                <div class="stat-display">
                    <div class="stat-value" id="currentGamePoints">0</div>
                    <div class="stat-label">Current Game</div>
                </div>
            </div>

            <!-- Game Instructions -->
            <div class="game-instructions" id="gameInstructions">
                <div class="instructions-header">
                    <div class="instructions-icon" id="instructionsIcon">
                        <i class="fas fa-gamepad"></i>
                    </div>
                    <div>
                        <div class="instructions-title" id="instructionsTitle">Game Instructions</div>
                        <div style="font-size: 0.9rem; color: #666;" id="instructionsSubtitle">Learn how to play</div>
                    </div>
                </div>
                
                <div class="instructions-grid" id="instructionsGrid">
                    <!-- Instructions will be populated by JavaScript -->
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="start-playing-btn" id="startPlayingBtn" onclick="startActualGameplay()">
                        <i class="fas fa-play"></i>
                        Start Playing
                    </button>
                </div>
            </div>

            <!-- Game Area -->
            <div class="game-area" id="gameArea">
                <div class="game-loading" id="gameLoading">
                    <div class="loading-spinner"></div>
                    <h3>Preparing Game...</h3>
                    <p>Setting up your disaster management challenge</p>
                </div>
                
                <div class="game-ready" id="gameReady" style="display: none;">
                    <h3>Game Ready!</h3>
                    <p>Your disaster preparedness challenge is loaded and ready to play.</p>
                    <button class="start-playing-btn" onclick="startActualGameplay()">
                        <i class="fas fa-play"></i>
                        Begin Challenge
                    </button>
                </div>
                
                <!-- Actual game content will be loaded here -->
                <div id="actualGameContent" style="display: none;">
                    <!-- Game-specific content will be injected here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Game Rules Modal -->
    <div class="game-modal" id="rulesModal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="modal-close" onclick="closeRulesModal()">&times;</button>
                <div class="modal-game-icon">
                    <i class="fas fa-book-open"></i>
                </div>
                <h2 class="modal-title" id="rulesModalTitle">Game Rules</h2>
                <p class="modal-subtitle" id="rulesModalSubtitle">How to Play</p>
            </div>
            <div class="modal-body">
                <div class="game-description" id="rulesModalDescription">
                    Game rules and instructions will appear here...
                </div>
                
                <div class="game-details-grid">
                    <div class="detail-section">
                        <h4><i class="fas fa-play"></i> Getting Started</h4>
                        <ul id="rulesGettingStarted">
                            <li><i class="fas fa-check"></i> Setup instructions</li>
                        </ul>
                    </div>
                    
                    <div class="detail-section">
                        <h4><i class="fas fa-gamepad"></i> Gameplay</h4>
                        <ul id="rulesGameplay">
                            <li><i class="fas fa-star"></i> Basic gameplay rules</li>
                        </ul>
                    </div>
                    
                    <div class="detail-section">
                        <h4><i class="fas fa-trophy"></i> Winning</h4>
                        <ul id="rulesWinning">
                            <li><i class="fas fa-crown"></i> Victory conditions</li>
                        </ul>
                    </div>
                    
                    <div class="detail-section">
                        <h4><i class="fas fa-exclamation-triangle"></i> Important Rules</h4>
                        <ul id="rulesImportant">
                            <li><i class="fas fa-info-circle"></i> Key rules to remember</li>
                        </ul>
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="btn-start-game" onclick="closeRulesModal(); openGameModal(currentRulesGame);">
                        <i class="fas fa-play"></i> Start Game
                    </button>
                    <button class="btn-cancel" onclick="closeRulesModal()">
                        <i class="fas fa-times"></i> Close Rules
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- General Info Popup Modal -->
    <div class="info-popup" id="infoPopup">
        <div class="popup-content">
            <div class="popup-header">
                <button class="popup-close" onclick="closeInfoPopup()">&times;</button>
                <div class="popup-icon" id="popupIcon">
                    <i class="fas fa-info-circle"></i>
                </div>
                <h2 class="popup-title" id="popupTitle">Information</h2>
                <p class="popup-subtitle" id="popupSubtitle">Details and guidance</p>
            </div>
            <div class="popup-body" id="popupBody">
                <div class="popup-description" id="popupDescription">
                    Content will be loaded here...
                </div>
            </div>
        </div>
    </div>

    <!-- Achievement Popup -->
    <div class="achievement-popup" id="achievementPopup">
        <div class="achievement-icon" id="achievementIcon">ðŸ†</div>
        <div class="achievement-title" id="achievementTitle">Achievement Unlocked!</div>
        <div class="achievement-desc" id="achievementDesc">You've earned a new badge!</div>
    </div>

    <!-- Game Progress Popup -->
    <div class="game-popup" id="gameProgressPopup">
        <div class="popup-content">
            <div class="popup-header">
                <h2>ðŸŽ® Game Progress & Statistics</h2>
                <span class="close-popup" onclick="closeGameProgressPopup()">&times;</span>
            </div>
            <div class="popup-body">
                <div class="progress-overview">
                    <div class="stat-card">
                        <div class="stat-number" id="totalGamesPlayed">0</div>
                        <div class="stat-label">Games Played</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalScore">0</div>
                        <div class="stat-label">Total Score</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="averageScore">0</div>
                        <div class="stat-label">Average Score</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completionRate">0%</div>
                        <div class="stat-label">Completion Rate</div>
                    </div>
                </div>

                <div class="games-progress">
                    <h3>ðŸ“Š Individual Game Progress</h3>
                    <div id="gameProgressList">
                        <!-- Game progress items will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Menu Navigation
        function initializeMenuNavigation() {
            const menuItems = document.querySelectorAll('.menu-item');
            
            const pageMapping = {
                'Dashboard': 'dashboard-student.html',
                'Education Modules': 'education-modules.html',
                'Sandbox Simulator': 'sandbox-simulator.html',
                'Emergency Contacts': 'dashboard-student.html#emergency-contacts',
                'Disaster Map': '../advanced-map.html',
                'AI Helper': 'chatbot.html',
                'Gamified Learning': 'gamified-learning.html',
                'Profile & Badges': 'profile-badges.html',
                'Settings': 'settings.html'
            };

            menuItems.forEach(item => {
                item.addEventListener('click', function () {
                    menuItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');

                    const menuText = this.querySelector('span').textContent.trim();
                    const targetPage = pageMapping[menuText];

                    if (targetPage && !targetPage.includes('gamified-learning')) {
                        window.location.href = targetPage;
                    }
                });

                item.addEventListener('mouseenter', function () {
                    if (!this.classList.contains('active')) {
                        this.style.backgroundColor = 'rgba(255, 255, 255, 0.15)';
                    }
                });

                item.addEventListener('mouseleave', function () {
                    if (!this.classList.contains('active')) {
                        this.style.backgroundColor = '';
                    }
                });
            });
        }

        // Initialize menu navigation when page loads
        document.addEventListener('DOMContentLoaded', initializeMenuNavigation);

        // Game state variables
        let currentGame = null;
        let quizData = [];
        let currentQuestionIndex = 0;
        let quizScore = 0;
        let selectedAnswer = null;
        let currentGameData = null;
        let currentRulesGame = null;

        // DisasterPoly game variables
        let currentPlayer = 1;
        let player1 = { position: 0, score: 0, lives: 3 };
        let player2 = { position: 0, score: 0, lives: 3 };

        // Player Statistics System
        class PlayerStats {
            constructor() {
                this.loadStats();
            }

            loadStats() {
                const saved = localStorage.getItem('disasterGameStats');
                if (saved) {
                    this.stats = JSON.parse(saved);
                } else {
                    this.stats = {
                        gamesPlayed: 0,
                        lastGamePoints: 0,
                        maxPoints: 0,
                        totalPoints: 0,
                        gamesCompleted: {},
                        achievements: [],
                        timeSpent: 0,
                        lastPlayDate: null,
                        favoriteGame: null,
                        winStreak: 0,
                        currentStreak: 0
                    };
                }
            }

            saveStats() {
                localStorage.setItem('disasterGameStats', JSON.stringify(this.stats));
            }

            recordGameStart(gameId) {
                this.stats.gamesPlayed++;
                this.stats.lastPlayDate = new Date().toISOString();
                this.saveStats();
            }

            recordGameComplete(gameId, points, timeSpent) {
                this.stats.lastGamePoints = points;
                this.stats.totalPoints += points;
                this.stats.timeSpent += timeSpent;
                
                if (points > this.stats.maxPoints) {
                    this.stats.maxPoints = points;
                    this.checkAchievement('high_score', points);
                }

                if (!this.stats.gamesCompleted[gameId]) {
                    this.stats.gamesCompleted[gameId] = 0;
                }
                this.stats.gamesCompleted[gameId]++;

                // Track favorite game
                const favGame = Object.keys(this.stats.gamesCompleted).reduce((a, b) => 
                    this.stats.gamesCompleted[a] > this.stats.gamesCompleted[b] ? a : b
                );
                this.stats.favoriteGame = favGame;

                // Check various achievements
                this.checkAchievements(gameId, points);
                this.saveStats();
            }

            checkAchievements(gameId, points) {
                const achievements = [];

                // First game achievement
                if (this.stats.gamesPlayed === 1) {
                    achievements.push({ id: 'first_game', name: 'First Responder', description: 'Played your first disaster game!' });
                }

                // Points-based achievements
                if (points >= 100 && !this.hasAchievement('points_100')) {
                    achievements.push({ id: 'points_100', name: 'Centurion', description: 'Scored 100+ points in a single game!' });
                }
                if (points >= 500 && !this.hasAchievement('points_500')) {
                    achievements.push({ id: 'points_500', name: 'Expert Responder', description: 'Scored 500+ points in a single game!' });
                }

                // Games played achievements
                if (this.stats.gamesPlayed >= 5 && !this.hasAchievement('games_5')) {
                    achievements.push({ id: 'games_5', name: 'Dedicated Learner', description: 'Played 5 disaster games!' });
                }
                if (this.stats.gamesPlayed >= 10 && !this.hasAchievement('games_10')) {
                    achievements.push({ id: 'games_10', name: 'Safety Enthusiast', description: 'Played 10 disaster games!' });
                }

                // Perfect score achievements
                if (gameId === 'quiz' && points === 100 && !this.hasAchievement('quiz_perfect')) {
                    achievements.push({ id: 'quiz_perfect', name: 'Quiz Master', description: 'Perfect score on the disaster quiz!' });
                }

                // Add new achievements
                achievements.forEach(achievement => {
                    if (!this.hasAchievement(achievement.id)) {
                        this.stats.achievements.push(achievement);
                    }
                });

                return achievements;
            }

            hasAchievement(achievementId) {
                return this.stats.achievements.some(a => a.id === achievementId);
            }

            getStats() {
                return { ...this.stats };
            }

            getGameCount(gameId) {
                return this.stats.gamesCompleted[gameId] || 0;
            }

            reset() {
                localStorage.removeItem('disasterGameStats');
                this.loadStats();
            }
        }

        // Initialize player stats
        const playerStats = new PlayerStats();

        // Game Logic Functions

        // DisasterPoly Game Logic
        let currentGameState = {
            position: 0,
            score: 0,
            round: 1,
            maxRounds: 3
        };

        function initializeDisasterPolyGameplay() {
            createDisasterPolyBoard();
            updateStatsDisplay();
            currentGameState = {
                position: 0,
                score: 0,
                round: 1,
                maxRounds: 3,
                boardSquares: [
                    { name: "START", type: "start", tip: "Beginning of your disaster preparedness journey!" },
                    { name: "Flood Zone", type: "disaster", tip: "Move to higher ground! Never drive through flood water." },
                    { name: "Safe House", type: "safe", tip: "Well prepared home with emergency supplies!" },
                    { name: "Fire Alert", type: "disaster", tip: "Stay low, get out, stay out! Smoke is deadly." },
                    { name: "Hospital", type: "safe", tip: "Medical help available. Know your local hospitals!" },
                    { name: "Earthquake", type: "disaster", tip: "Drop, Cover, Hold On! Don't run outside." },
                    { name: "Emergency Kit", type: "safe", tip: "72-hour kit saves lives! Water, food, supplies." },
                    { name: "SHELTER", type: "corner", tip: "Safe shelter protects from all disasters!" },
                    { name: "Tornado", type: "disaster", tip: "Get to lowest floor, interior room, away from windows!" },
                    { name: "First Aid", type: "safe", tip: "CPR and first aid knowledge saves lives!" },
                    { name: "Landslide", type: "disaster", tip: "Listen for unusual sounds, evacuate immediately!" },
                    { name: "Rescue Team", type: "safe", tip: "Trained responders ready to help!" }
                ]
            };
        }

        function createDisasterPolyBoard() {
            const gameBoard = document.getElementById('gameBoard');
            if (!gameBoard) return;
            
            // Clear existing board
            gameBoard.innerHTML = '';
            
            const squares = [
                { name: "START", type: "start", color: "#4caf50" },
                { name: "Flood", type: "disaster", color: "#2196f3" },
                { name: "Safe House", type: "safe", color: "#8bc34a" },
                { name: "Fire", type: "disaster", color: "#f44336" },
                { name: "Hospital", type: "safe", color: "#8bc34a" },
                { name: "Quake", type: "disaster", color: "#ff9800" },
                { name: "Kit", type: "safe", color: "#8bc34a" },
                { name: "SHELTER", type: "corner", color: "#4caf50" },
                { name: "Tornado", type: "disaster", color: "#9c27b0" },
                { name: "First Aid", type: "safe", color: "#8bc34a" },
                { name: "Slide", type: "disaster", color: "#795548" },
                { name: "Rescue", type: "safe", color: "#8bc34a" }
            ];

            // Create board squares positioned around the perimeter
            squares.forEach((square, index) => {
                const squareDiv = document.createElement('div');
                squareDiv.style.cssText = `
                    position: absolute;
                    width: 60px;
                    height: 40px;
                    background: ${square.color};
                    color: white;
                    border: 2px solid #333;
                    border-radius: 6px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 0.7rem;
                    font-weight: bold;
                    text-align: center;
                    cursor: pointer;
                    transition: transform 0.2s ease;
                `;
                
                // Position squares around board perimeter (3x4 grid layout)
                if (index < 3) { // Top row
                    squareDiv.style.left = `${20 + index * 80}px`;
                    squareDiv.style.top = '20px';
                } else if (index < 6) { // Right column
                    squareDiv.style.right = '20px';
                    squareDiv.style.top = `${20 + (index - 3) * 60}px`;
                } else if (index < 9) { // Bottom row (reversed)
                    squareDiv.style.right = `${20 + (index - 6) * 80}px`;
                    squareDiv.style.bottom = '20px';
                } else { // Left column (reversed)
                    squareDiv.style.left = '20px';
                    squareDiv.style.bottom = `${20 + (index - 9) * 60}px`;
                }

                squareDiv.textContent = square.name;
                squareDiv.id = `square-${index}`;
                squareDiv.addEventListener('mouseenter', () => {
                    squareDiv.style.transform = 'scale(1.1)';
                });
                squareDiv.addEventListener('mouseleave', () => {
                    squareDiv.style.transform = 'scale(1)';
                });
                
                gameBoard.appendChild(squareDiv);
            });

            // Add center logo
            const centerDiv = document.createElement('div');
            centerDiv.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                text-align: center;
                background: linear-gradient(135deg, var(--primary), var(--primary-dark));
                color: white;
                padding: 20px;
                border-radius: 50%;
                width: 120px;
                height: 120px;
                display: flex;
                flex-direction: column;
                justify-content: center;
                box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            `;
            centerDiv.innerHTML = '<div style="font-weight: bold; font-size: 1.1rem;">DisasterPoly</div><div style="font-size: 0.8rem; opacity: 0.9;">Emergency Prep</div>';
            gameBoard.appendChild(centerDiv);

            // Add player piece
            const playerPiece = document.createElement('div');
            playerPiece.id = 'playerPiece';
            playerPiece.style.cssText = `
                position: absolute;
                width: 15px;
                height: 15px;
                background: #ff4444;
                border-radius: 50%;
                border: 2px solid white;
                z-index: 100;
                left: 40px;
                bottom: 40px;
                transition: all 0.5s ease;
                box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            `;
            gameBoard.appendChild(playerPiece);
        }

        function rollDiceGame() {
            const dice = Math.floor(Math.random() * 6) + 1;
            document.getElementById('diceResult').textContent = dice;
            
            // Add dice rolling animation
            const diceElement = document.getElementById('diceResult');
            diceElement.style.transform = 'rotate(360deg)';
            setTimeout(() => {
                diceElement.style.transform = 'rotate(0deg)';
            }, 500);
            
            currentGameState.position = (currentGameState.position + dice) % 12;
            
            // Move player piece visually
            movePlayerPiece(currentGameState.position);
            
            // Handle square effects
            const square = currentGameState.boardSquares[currentGameState.position];
            let pointChange = 0;
            let message = '';
            
            switch(square.type) {
                case 'disaster':
                    pointChange = -30;
                    message = `âš ï¸ ${square.name}!\n${square.tip}\nLost 30 points but gained knowledge!`;
                    break;
                case 'safe':
                    pointChange = 50;
                    message = `âœ… ${square.name}!\n${square.tip}\nGained 50 points!`;
                    break;
                case 'corner':
                    pointChange = 100;
                    message = `ðŸ† ${square.name}!\n${square.tip}\nGained 100 points!`;
                    break;
                case 'start':
                    pointChange = 25;
                    message = `ðŸŽ¯ ${square.name}!\n${square.tip}\nGained 25 points!`;
                    if (currentGameState.position === 0) {
                        currentGameState.round++;
                        message += `\n\nðŸ”„ Round ${currentGameState.round} complete!`;
                        if (currentGameState.round > currentGameState.maxRounds) {
                            setTimeout(() => {
                                const finalScore = Math.max(0, currentGameState.score + pointChange);
                                alert(`ðŸŽ‰ Game Complete!\n\nFinal Score: ${finalScore} points\nYou've learned valuable disaster preparedness skills!`);
                                completeGame('disasterpoly', finalScore, (Date.now() - window.currentGameStartTime) / 1000);
                            }, 1000);
                            return;
                        }
                    }
                    break;
            }
            
            currentGameState.score = Math.max(0, currentGameState.score + pointChange);
            updateCurrentGamePoints(currentGameState.score);
            
            // Update display
            document.getElementById('playerPosition').textContent = square.name;
            document.getElementById('playerScore').textContent = currentGameState.score;
            document.getElementById('currentRound').textContent = currentGameState.round;
            
            // Update progress bar
            const progress = ((currentGameState.round - 1) * 100 + (currentGameState.position / 12) * 100) / currentGameState.maxRounds;
            document.getElementById('gameProgress').style.width = Math.min(100, progress) + '%';
            
            setTimeout(() => {
                alert(message);
            }, 600);
        }

        function movePlayerPiece(position) {
            const playerPiece = document.getElementById('playerPiece');
            if (!playerPiece) return;
            
            // Calculate position based on board layout
            let x, y;
            if (position < 3) { // Top row
                x = 50 + position * 80;
                y = 40;
            } else if (position < 6) { // Right column
                x = 320;
                y = 40 + (position - 3) * 60;
            } else if (position < 9) { // Bottom row (reversed)
                x = 320 - (position - 6) * 80;
                y = 320;
            } else { // Left column (reversed)
                x = 40;
                y = 320 - (position - 9) * 60;
            }
            
            playerPiece.style.left = x + 'px';
            playerPiece.style.bottom = (400 - y) + 'px';
        }

        let quizGameState = {
            questions: [
                {
                    question: "During an earthquake, what should you do first?",
                    options: ["Run outside", "Drop, Cover, Hold", "Stand in doorway", "Call for help"],
                    correct: 1,
                    points: 10,
                    explanation: "Drop, Cover, and Hold On is the recommended action. Running outside can be dangerous due to falling debris."
                },
                {
                    question: "How much water should you store per person per day for emergencies?",
                    options: ["1/2 gallon", "1 gallon", "2 gallons", "3 gallons"],
                    correct: 1,
                    points: 10,
                    explanation: "Store at least 1 gallon per person per day. This covers drinking, cooking, and basic hygiene needs."
                },
                {
                    question: "What is the universal emergency number in India?",
                    options: ["100", "101", "112", "108"],
                    correct: 2,
                    points: 5,
                    explanation: "112 is the universal emergency number in India, connecting you to police, fire, and medical services."
                },
                {
                    question: "During a flood, you should never:",
                    options: ["Move to higher ground", "Drive through flood water", "Turn off utilities", "Evacuate immediately"],
                    correct: 1,
                    points: 15,
                    explanation: "Never drive through flood water! 'Turn Around, Don't Drown' - just 6 inches of moving water can knock you down."
                },
                {
                    question: "In a building fire, smoke is most dangerous because:",
                    options: ["It blocks vision", "It causes most fire deaths", "It damages property", "It attracts attention"],
                    correct: 1,
                    points: 15,
                    explanation: "Smoke inhalation causes most fire deaths, not burns. Stay low where air is cleaner."
                },
                {
                    question: "The best place to take shelter during a tornado is:",
                    options: ["Under an overpass", "In a car", "Basement interior room", "Top floor"],
                    correct: 2,
                    points: 20,
                    explanation: "Go to the lowest floor, in an interior room, away from windows. Overpasses and cars are dangerous!"
                },
                {
                    question: "How often should you test smoke detectors?",
                    options: ["Monthly", "Every 6 months", "Yearly", "Only when battery is low"],
                    correct: 0,
                    points: 10,
                    explanation: "Test smoke detectors monthly and replace batteries at least once a year."
                },
                {
                    question: "The 'Triangle of Life' earthquake safety method is:",
                    options: ["Recommended by experts", "Outdated and dangerous", "Only for children", "Used in schools"],
                    correct: 1,
                    points: 20,
                    explanation: "The 'Triangle of Life' is an outdated and dangerous myth. Drop, Cover, and Hold On is the correct method."
                },
                {
                    question: "What should be in a basic emergency kit?",
                    options: ["Only food and water", "Water, food, flashlight, first aid", "Just important documents", "Only communication devices"],
                    correct: 1,
                    points: 15,
                    explanation: "A basic kit needs water (1 gal/person/day), food (3 days), flashlight, first aid supplies, and more."
                },
                {
                    question: "During a hurricane, the 'eye' means:",
                    options: ["The storm is over", "Temporary calm, more wind coming", "Time to evacuate", "The most dangerous part"],
                    correct: 1,
                    points: 25,
                    explanation: "The eye brings temporary calm, but winds will resume from the opposite direction. Stay sheltered!"
                }
            ],
            currentQuestion: 0,
            score: 0,
            correctAnswers: 0,
            selectedAnswer: null,
            timeRemaining: 900, // 15 minutes
            startTime: null,
            timerInterval: null
        };

        function initializeQuizGameplay() {
            quizGameState.currentQuestion = 0;
            quizGameState.score = 0;
            quizGameState.correctAnswers = 0;
            quizGameState.timeRemaining = 900;
            quizGameState.startTime = Date.now();
            
            // Shuffle questions for variety
            quizGameState.questions = quizGameState.questions.sort(() => Math.random() - 0.5);
            
            startQuizTimer();
            loadQuizQuestion();
            
            document.getElementById('quizCompleteSection').style.display = 'none';
            document.getElementById('questionCard').style.display = 'block';
        }

        function startQuizTimer() {
            quizGameState.timerInterval = setInterval(() => {
                quizGameState.timeRemaining--;
                updateQuizTimer();
                
                if (quizGameState.timeRemaining <= 0) {
                    clearInterval(quizGameState.timerInterval);
                    finishQuiz();
                }
            }, 1000);
        }

        function updateQuizTimer() {
            const minutes = Math.floor(quizGameState.timeRemaining / 60);
            const seconds = quizGameState.timeRemaining % 60;
            document.getElementById('quizTimeLeft').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
            // Change color when time is running low
            const timerElement = document.getElementById('quizTimeLeft');
            if (quizGameState.timeRemaining < 60) {
                timerElement.style.color = '#f44336'; // Red
            } else if (quizGameState.timeRemaining < 300) {
                timerElement.style.color = '#ff9800'; // Orange
            }
        }

        function loadQuizQuestion() {
            if (quizGameState.currentQuestion >= quizGameState.questions.length) {
                finishQuiz();
                return;
            }
            
            const question = quizGameState.questions[quizGameState.currentQuestion];
            const progress = (quizGameState.currentQuestion / quizGameState.questions.length) * 100;
            
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('questionNumber').textContent = quizGameState.currentQuestion + 1;
            document.getElementById('questionPoints').textContent = question.points;
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('quizCurrentScore').textContent = quizGameState.score;
            
            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.style.cssText = `
                    display: block;
                    width: 100%;
                    padding: 12px;
                    margin: 8px 0;
                    background: white;
                    border: 2px solid #ddd;
                    border-radius: 8px;
                    cursor: pointer;
                    text-align: left;
                    transition: all 0.3s ease;
                    font-size: 0.95rem;
                `;
                button.textContent = option;
                button.onclick = () => selectQuizAnswer(index, button);
                container.appendChild(button);
            });
            
            document.getElementById('nextQuestionBtn').disabled = true;
            document.getElementById('questionExplanation').style.display = 'none';
            quizGameState.selectedAnswer = null;
        }

        function selectQuizAnswer(answerIndex, buttonElement) {
            const question = quizGameState.questions[quizGameState.currentQuestion];
            const buttons = document.querySelectorAll('#optionsContainer button');
            
            // Disable all buttons to prevent multiple selections
            buttons.forEach(btn => btn.disabled = true);
            
            // Mark selected
            buttonElement.style.background = '#e3f2fd';
            buttonElement.style.borderColor = '#2196f3';
            
            quizGameState.selectedAnswer = answerIndex;
            
            setTimeout(() => {
                // Show correct answer
                buttons[question.correct].style.background = '#e8f5e8';
                buttons[question.correct].style.borderColor = '#4caf50';
                
                if (answerIndex !== question.correct) {
                    buttonElement.style.background = '#ffebee';
                    buttonElement.style.borderColor = '#f44336';
                } else {
                    quizGameState.score += question.points;
                    quizGameState.correctAnswers++;
                    updateCurrentGamePoints(quizGameState.score);
                    
                    // Add celebration effect for correct answer
                    buttonElement.style.animation = 'pulse 0.5s ease-in-out';
                }
                
                // Show explanation
                document.getElementById('explanationText').textContent = question.explanation;
                document.getElementById('questionExplanation').style.display = 'block';
                
                document.getElementById('nextQuestionBtn').disabled = false;
            }, 500);
        }

        function nextQuizQuestion() {
            quizGameState.currentQuestion++;
            
            // Re-enable buttons for next question
            const buttons = document.querySelectorAll('#optionsContainer button');
            buttons.forEach(btn => {
                btn.disabled = false;
                btn.style.animation = '';
            });
            
            loadQuizQuestion();
        }

        function finishQuiz() {
            clearInterval(quizGameState.timerInterval);
            
            const timeTakenSeconds = Math.floor((Date.now() - quizGameState.startTime) / 1000);
            const timeTakenMinutes = Math.floor(timeTakenSeconds / 60);
            const timeTakenSecondsRemainder = timeTakenSeconds % 60;
            
            const accuracy = Math.round((quizGameState.correctAnswers / quizGameState.questions.length) * 100);
            
            // Hide question card and show results
            document.getElementById('questionCard').style.display = 'none';
            document.getElementById('quizCompleteSection').style.display = 'block';
            
            // Update results display
            document.getElementById('finalQuizScore').textContent = quizGameState.score + ' points';
            document.getElementById('correctCount').textContent = quizGameState.correctAnswers;
            document.getElementById('accuracyPercent').textContent = accuracy + '%';
            document.getElementById('timeTaken').textContent = 
                `${timeTakenMinutes}:${timeTakenSecondsRemainder.toString().padStart(2, '0')}`;
            
            // Show achievements
            const achievementsContainer = document.getElementById('achievementsEarned');
            achievementsContainer.innerHTML = '';
            
            const achievements = [];
            if (accuracy === 100) achievements.push('ðŸŽ¯ Perfect Score');
            if (accuracy >= 80) achievements.push('ðŸ§  Safety Expert');
            if (quizGameState.score >= 150) achievements.push('â­ High Scorer');
            if (timeTakenSeconds < 600) achievements.push('âš¡ Speed Demon');
            
            if (achievements.length > 0) {
                achievements.forEach(achievement => {
                    const badge = document.createElement('span');
                    badge.style.cssText = `
                        display: inline-block;
                        background: linear-gradient(135deg, var(--secondary), #2e7d32);
                        color: white;
                        padding: 8px 16px;
                        border-radius: 20px;
                        margin: 4px;
                        font-size: 0.9rem;
                        font-weight: 600;
                    `;
                    badge.textContent = achievement;
                    achievementsContainer.appendChild(badge);
                });
            } else {
                achievementsContainer.innerHTML = '<p style="color: #666;">Keep practicing to earn achievements!</p>';
            }
            
            // Complete the game
            setTimeout(() => {
                completeGame('quiz', quizGameState.score, (Date.now() - window.currentGameStartTime) / 1000);
            }, 2000);
        }

        function pauseQuiz() {
            if (quizGameState.timerInterval) {
                clearInterval(quizGameState.timerInterval);
                quizGameState.timerInterval = null;
                alert('â¸ï¸ Quiz Paused\n\nTake your time to think. Click OK to resume.');
                startQuizTimer();
            }
        }

        function restartQuiz() {
            initializeQuizGameplay();
        }

        // Tsunami Escape Game Logic (old implementation - superseded)
        /* let tsunamiGameState = {
            timeRemaining: 300, // 5 minutes
            playerPosition: { x: 50, y: 90 }, // Start at bottom
            distanceToSafety: 90,
            obstaclesCleared: 0,
            requiredObstacles: 3,
            isGameActive: false
        }; */

        function initializeTsunamiEscapeGameplay() {
            tsunamiGameState.isGameActive = true;
            startTsunamiTimer();
            updateTsunamiDisplay();
        }

        function startTsunamiTimer() {
            const timer = setInterval(() => {
                if (!tsunamiGameState.isGameActive) {
                    clearInterval(timer);
                    return;
                }
                
                tsunamiGameState.timeRemaining--;
                const minutes = Math.floor(tsunamiGameState.timeRemaining / 60);
                const seconds = tsunamiGameState.timeRemaining % 60;
                document.getElementById('timeRemaining').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                // Update tsunami animation
                const tsunamiHeight = Math.min(70, 30 + (300 - tsunamiGameState.timeRemaining) * 0.1);
                document.getElementById('tsunami').style.height = tsunamiHeight + '%';
                
                if (tsunamiGameState.timeRemaining <= 0) {
                    clearInterval(timer);
                    alert('ðŸ’€ Time\'s up! The tsunami reached you. In real life, every second counts!');
                    completeGame('tsunamiescape', Math.max(0, tsunamiGameState.distanceToSafety * -1), (Date.now() - window.currentGameStartTime) / 1000);
                }
            }, 1000);
        }

        function movePlayer(direction) {
            if (!tsunamiGameState.isGameActive) return;
            
            const player = document.getElementById('player');
            
            switch(direction) {
                case 'up':
                    tsunamiGameState.playerPosition.y = Math.max(10, tsunamiGameState.playerPosition.y - 15);
                    tsunamiGameState.distanceToSafety = Math.max(0, tsunamiGameState.distanceToSafety - 15);
                    break;
                case 'left':
                    tsunamiGameState.playerPosition.x = Math.max(5, tsunamiGameState.playerPosition.x - 10);
                    if (Math.random() < 0.3) { // Chance to find alternate route
                        tsunamiGameState.obstaclesCleared++;
                        alert('ðŸ›¤ï¸ Found alternate evacuation route!');
                    }
                    break;
                case 'right':
                    tsunamiGameState.playerPosition.x = Math.min(95, tsunamiGameState.playerPosition.x + 10);
                    if (Math.random() < 0.3) { // Chance to help others
                        tsunamiGameState.obstaclesCleared++;
                        alert('ðŸ¤ Helped someone reach safety!');
                    }
                    break;
            }
            
            player.style.bottom = tsunamiGameState.playerPosition.y + '%';
            player.style.left = tsunamiGameState.playerPosition.x + '%';
            
            updateTsunamiDisplay();
            
            // Check if reached safety
            if (tsunamiGameState.distanceToSafety <= 0) {
                tsunamiGameState.isGameActive = false;
                const bonus = tsunamiGameState.timeRemaining * 2 + tsunamiGameState.obstaclesCleared * 50;
                alert('ðŸŽ‰ You reached safety! Time bonus and helping others earned extra points!');
                completeGame('tsunamiescape', 200 + bonus, (Date.now() - window.currentGameStartTime) / 1000);
            }
        }

        function updateTsunamiDisplay() {
            document.getElementById('distanceToSafety').textContent = tsunamiGameState.distanceToSafety + '%';
            document.getElementById('obstaclesCleared').textContent = tsunamiGameState.obstaclesCleared;
        }

        // Hurricane Hero Game Logic (old implementation - superseded)
        /* let hurricaneGameState = {
            budget: 500,
            waterSupply: 0,
            foodSupply: 0,
            shelterItems: 0,
            familiesHelped: 0,
            sheltersReady: 0,
            evacuationRoutes: 0,
            timeRemaining: 24
        };

        function initializeHurricaneHeroGameplay() {
            updateHurricaneDisplay();
            startHurricaneTimer();
        }

        function startHurricaneTimer() {
            const timer = setInterval(() => {
                hurricaneGameState.timeRemaining -= 0.1;
                document.getElementById('hurricaneTime').textContent = 
                    hurricaneGameState.timeRemaining.toFixed(1) + ' hours';
                
                if (hurricaneGameState.timeRemaining <= 0) {
                    clearInterval(timer);
                    completePreparation();
                }
            }, 500);
        }

        function buySupply(type, cost) {
            if (hurricaneGameState.budget < cost) {
                alert('ðŸ’° Not enough budget! Make tough choices.');
                return;
            }
            
            hurricaneGameState.budget -= cost;
            
            switch(type) {
                case 'water':
                    hurricaneGameState.waterSupply += 5;
                    hurricaneGameState.familiesHelped = Math.min(10, hurricaneGameState.familiesHelped + 1);
                    break;
                case 'food':
                    hurricaneGameState.foodSupply += 3;
                    hurricaneGameState.familiesHelped = Math.min(10, hurricaneGameState.familiesHelped + 1);
                    break;
                case 'shelter':
                    hurricaneGameState.shelterItems += 1;
                    hurricaneGameState.sheltersReady = Math.min(3, hurricaneGameState.sheltersReady + 1);
                    break;
                case 'medical':
                    hurricaneGameState.familiesHelped = Math.min(10, hurricaneGameState.familiesHelped + 2);
                    hurricaneGameState.evacuationRoutes = Math.min(5, hurricaneGameState.evacuationRoutes + 1);
                    break;
            }
            
            updateHurricaneDisplay();
            updateCurrentGamePoints(calculateHurricaneScore());
        }

        function updateHurricaneDisplay() {
            document.getElementById('budget').textContent = hurricaneGameState.budget;
            document.getElementById('waterSupply').textContent = hurricaneGameState.waterSupply;
            document.getElementById('foodSupply').textContent = hurricaneGameState.foodSupply;
            document.getElementById('shelterItems').textContent = hurricaneGameState.shelterItems;
            document.getElementById('familiesHelped').textContent = hurricaneGameState.familiesHelped;
            document.getElementById('sheltersReady').textContent = hurricaneGameState.sheltersReady;
            document.getElementById('evacuationRoutes').textContent = hurricaneGameState.evacuationRoutes;
        }

        function calculateHurricaneScore() {
            return (hurricaneGameState.familiesHelped * 20) + 
                   (hurricaneGameState.sheltersReady * 50) + 
                   (hurricaneGameState.evacuationRoutes * 30) +
                   (hurricaneGameState.waterSupply * 2) +
                   (hurricaneGameState.foodSupply * 3);
        }

        function completePreparation() {
            const finalScore = calculateHurricaneScore();
            let message = `ðŸŒ€ Hurricane made landfall!\n\nPreparation Results:\n`;
            message += `â€¢ Families Helped: ${hurricaneGameState.familiesHelped}/10\n`;
            message += `â€¢ Shelters Ready: ${hurricaneGameState.sheltersReady}/3\n`;
            message += `â€¢ Evacuation Routes: ${hurricaneGameState.evacuationRoutes}/5\n`;
            message += `\nFinal Score: ${finalScore} points`;
            
            if (hurricaneGameState.familiesHelped >= 8 && hurricaneGameState.sheltersReady >= 2) {
                message += `\n\nðŸ† Community Hero! Your preparation saved lives!`;
            }
            
            alert(message);
            completeGame('hurricanehero', finalScore, (Date.now() - window.currentGameStartTime) / 1000);
        } */

        // Initialize stats display when page loads
        document.addEventListener('DOMContentLoaded', function() {
            updateStatsDisplay();
            addProgressMenuItem();
            
            // Initialize any other systems
            initializeMenuNavigation();
            
            // Update game cards with progress after a short delay
            setTimeout(() => {
                updateGameCardsWithProgress();
            }, 500);
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    if (document.getElementById('gameInterface').classList.contains('active')) {
                        exitGame();
                    } else if (document.getElementById('gameModal').classList.contains('active')) {
                        closeGameModal();
                    } else if (document.getElementById('rulesModal').classList.contains('active')) {
                        closeRulesModal();
                    } else if (document.getElementById('infoPopup').classList.contains('active')) {
                        closeInfoPopup();
                    }
                }
                
                // Debug shortcut to show progress (Ctrl+P)
                if (e.ctrlKey && e.key === 'p') {
                    e.preventDefault();
                    showPlayerProgress();
                }
                
                // Debug shortcut to reset progress (Ctrl+Shift+R)
                if (e.ctrlKey && e.shiftKey && e.key === 'R') {
                    e.preventDefault();
                    resetProgress();
                }
            });
            
            // Check for first time visitor
            const stats = playerStats.getStats();
            if (stats.gamesPlayed === 0) {
                setTimeout(() => {
                    alert('ðŸŽ® Welcome to Disaster Learning Games!\n\nLearn emergency preparedness through interactive gameplay. Your progress will be tracked, and you can earn achievements!\n\nTip: Try different games to unlock more achievements.');
                }, 1000);
            }
        });

        // Game data structure
        const gameDatabase = {
            'disasterpoly': {
                title: 'DisasterPoly Board Game',
                subtitle: 'Strategic Disaster Management Challenge',
                icon: 'fas fa-dice',
                description: 'Navigate through disaster scenarios, make strategic decisions, and learn emergency management in this exciting multiplayer board game. Experience the challenges of disaster preparedness and response.',
                players: '2-6',
                duration: '30-45',
                rating: 'â˜… 4.8',
                objectives: [
                    'Navigate disaster scenarios safely',
                    'Make strategic resource decisions',
                    'Learn emergency protocols',
                    'Survive with limited lives'
                ],
                features: [
                    'Multiplayer board game experience',
                    'Real disaster scenarios',
                    'Strategic decision making',
                    'Educational disaster facts'
                ],
                learning: [
                    'Emergency preparedness strategies',
                    'Risk assessment skills',
                    'Resource management',
                    'Team coordination'
                ],
                notes: [
                    'Requires 2-6 players for optimal experience',
                    'Each game lasts approximately 30-45 minutes',
                    'Lives are limited - play carefully!'
                ],
                rules: {
                    description: 'DisasterPoly is a strategic board game where players navigate through various disaster scenarios while learning emergency management principles. Each player starts with 3 lives and must make decisions that affect their survival and score.',
                    gettingStarted: [
                        'Each player chooses a playing piece',
                        'Place all pieces on the START square',
                        'Each player begins with 3 lives and 0 points',
                        'Youngest player goes first'
                    ],
                    gameplay: [
                        'Roll the dice to move around the board',
                        'Follow the instructions on the square you land on',
                        'Disaster squares: Lose 1 life and 50 points',
                        'Safe squares: Gain 100 points',
                        'Corner squares: Gain 200 points and special benefits',
                        'Answer disaster-related questions when prompted'
                    ],
                    winning: [
                        'First player to complete 3 full rounds wins',
                        'Alternative: Last player with lives remaining',
                        'Bonus points for correct answers to questions',
                        'Tie-breaker: Player with highest score wins'
                    ],
                    important: [
                        'If you lose all 3 lives, you are eliminated',
                        'Some squares allow you to help other players',
                        'Educational cards provide real disaster facts',
                        'Strategy tip: Help others to build alliances'
                    ]
                }
            },
            'quiz': {
                title: 'Disaster Knowledge Quiz',
                subtitle: 'Test Your Emergency Preparedness',
                icon: 'fas fa-brain',
                description: 'Challenge yourself with comprehensive questions about disaster preparedness, emergency response, and safety protocols. Earn points and badges for correct answers.',
                players: '1',
                duration: '15',
                rating: 'â˜… 4.7',
                objectives: [
                    'Answer disaster preparedness questions',
                    'Earn maximum points possible',
                    'Learn from mistakes',
                    'Unlock achievement badges'
                ],
                features: [
                    'Timed quiz challenges',
                    'Multiple choice questions',
                    'Points and badge system',
                    'Progress tracking'
                ],
                learning: [
                    'Emergency response procedures',
                    'Disaster preparedness facts',
                    'Safety protocols',
                    'First aid knowledge'
                ],
                notes: [
                    'Questions cover all disaster types',
                    'Time limit adds challenge',
                    'Review answers to learn more'
                ],
                rules: {
                    description: 'The Disaster Knowledge Quiz tests your understanding of emergency preparedness, disaster response, and safety protocols. Answer questions correctly to earn points and unlock achievement badges.',
                    gettingStarted: [
                        'Click "Start Quiz" to begin',
                        'Read each question carefully',
                        'You have 15 minutes to complete all questions',
                        'Select your answer before time runs out'
                    ],
                    gameplay: [
                        'Answer multiple choice questions',
                        'Each correct answer earns points (5-20 points)',
                        'Points vary based on question difficulty',
                        'No penalty for wrong answers',
                        'Progress bar shows completion status',
                        'Review mode available after completion'
                    ],
                    winning: [
                        'Complete all questions to finish',
                        'Score 80%+ for "Safety Expert" badge',
                        'Perfect score earns "Quiz Master" badge',
                        'Score 100+ points for "Preparedness Pro" badge',
                        'High scores unlock new question sets'
                    ],
                    important: [
                        'No cheating - test your real knowledge',
                        'Learn from incorrect answers',
                        'Take your time but watch the clock',
                        'Questions cover all disaster types equally'
                    ]
                }
            },
            'citymanager': {
                title: 'SimCity: Disaster Manager',
                subtitle: 'Build Resilient Communities',
                icon: 'fas fa-city',
                description: 'Design and build cities that can withstand natural disasters. Plan emergency services, create evacuation routes, and manage post-disaster recovery in this comprehensive city-building simulation.',
                players: '1-4',
                duration: '45-90',
                rating: 'â˜… 4.9',
                objectives: [
                    'Build disaster-resistant infrastructure',
                    'Plan effective evacuation routes',
                    'Manage emergency services',
                    'Coordinate post-disaster recovery'
                ],
                features: [
                    'City building simulation',
                    'Disaster scenario challenges',
                    'Resource management',
                    'Recovery planning'
                ],
                learning: [
                    'Urban disaster preparedness',
                    'Infrastructure resilience',
                    'Emergency service coordination',
                    'Community recovery processes'
                ],
                notes: [
                    'Complex strategy game requiring planning',
                    'Multiple disaster types to handle',
                    'Long-term thinking required'
                ]
            },
            'tsunamiescape': {
                title: 'Tsunami Escape Challenge',
                subtitle: 'Race to Safety',
                icon: 'fas fa-water',
                description: 'A high-stakes survival game where you must reach high ground before a tsunami hits. Solve puzzles, clear paths, and learn critical tsunami warning signs and evacuation procedures.',
                players: '1',
                duration: '10-20',
                rating: 'â˜… 4.7',
                objectives: [
                    'Reach high ground before tsunami',
                    'Solve evacuation puzzles',
                    'Learn tsunami warning signs',
                    'Help others escape safely'
                ],
                features: [
                    'Fast-paced puzzle solving',
                    'Time pressure challenges',
                    'Educational warning signs',
                    'Multiple escape routes'
                ],
                learning: [
                    'Tsunami warning recognition',
                    'Quick evacuation procedures',
                    'Coastal safety protocols',
                    'Emergency decision making'
                ],
                notes: [
                    'Time is critical - act fast!',
                    'Watch for natural warning signs',
                    'Every second counts in real tsunamis'
                ]
            },
            'hurricanehero': {
                title: 'Hurricane Hero: Resource Dash',
                subtitle: 'Community Preparedness Challenge',
                icon: 'fas fa-wind',
                description: 'Prepare your home and community for an approaching hurricane. Make critical decisions about resource allocation, community support, and emergency preparations under time pressure.',
                players: '1-3',
                duration: '25-40',
                rating: 'â˜… 4.6',
                objectives: [
                    'Secure home and community',
                    'Allocate resources effectively',
                    'Help neighbors prepare',
                    'Make critical decisions quickly'
                ],
                features: [
                    'Resource management challenges',
                    'Community cooperation',
                    'Time pressure decisions',
                    'Hurricane preparation realism'
                ],
                learning: [
                    'Hurricane preparation steps',
                    'Resource prioritization',
                    'Community support systems',
                    'Emergency supply planning'
                ],
                notes: [
                    'Balance personal and community needs',
                    'Limited time and resources',
                    'Decisions affect entire community'
                ]
            },
            'wildfirewatch': {
                title: 'Wildfire Watch',
                subtitle: 'Incident Command Simulation',
                icon: 'fas fa-fire',
                description: 'Command firefighting teams to contain growing wildfires. Manage resources, assess terrain, and adapt to changing wind conditions in this real-time strategy game.',
                players: '1',
                duration: '30-60',
                rating: 'â˜… 4.8',
                objectives: [
                    'Contain wildfire spread',
                    'Deploy resources strategically',
                    'Adapt to changing conditions',
                    'Protect structures and lives'
                ],
                features: [
                    'Real-time strategy gameplay',
                    'Dynamic weather changes',
                    'Resource management',
                    'Multiple firefighting units'
                ],
                learning: [
                    'Wildfire behavior patterns',
                    'Incident command structure',
                    'Resource deployment tactics',
                    'Emergency decision making'
                ],
                notes: [
                    'Wind direction affects fire spread',
                    'Multiple active fires possible',
                    'Quick decisions under pressure required'
                ]
            },
            'quakeresponse': {
                title: 'Quake Response',
                subtitle: 'Search & Rescue Simulation',
                icon: 'fas fa-house-damage',
                description: 'Lead search and rescue operations after a major earthquake. Make critical decisions about structural safety, survivor triage, and emergency medical care.',
                players: '1-2',
                duration: '20-35',
                rating: 'â˜… 4.7',
                objectives: [
                    'Rescue trapped survivors',
                    'Assess building safety',
                    'Provide emergency first aid',
                    'Coordinate rescue teams'
                ],
                features: [
                    'Realistic rescue scenarios',
                    'Structural assessment challenges',
                    'Medical triage decisions',
                    'Time pressure elements'
                ],
                learning: [
                    'Search and rescue procedures',
                    'Structural damage assessment',
                    'Emergency medical protocols',
                    'Team coordination skills'
                ],
                notes: [
                    'Safety assessment is critical',
                    'Triage saves more lives',
                    'Work in teams for safety'
                ]
            },
            'floodplainproject': {
                title: 'The Floodplain Project',
                subtitle: 'Community Resilience Building',
                icon: 'fas fa-water',
                description: 'Collaborate with community members to build long-term flood resilience. Take on different roles to design defenses, organize drills, and plan sustainable solutions.',
                players: '3-6',
                duration: '60-90',
                rating: 'â˜… 4.9',
                objectives: [
                    'Build community flood defenses',
                    'Organize emergency drills',
                    'Plan sustainable solutions',
                    'Coordinate multiple stakeholders'
                ],
                features: [
                    'Role-based collaboration',
                    'Long-term planning focus',
                    'Seasonal challenges',
                    'Community decision making'
                ],
                learning: [
                    'Community resilience planning',
                    'Stakeholder coordination',
                    'Sustainable development',
                    'Long-term risk management'
                ],
                notes: [
                    'Requires multiple players',
                    'Spans multiple seasons',
                    'Collaborative decisions are key'
                ]
            },
            'stopdisasters': {
                title: 'Stop Disasters! (UNDRR)',
                subtitle: 'Official UN Risk Management Game',
                icon: 'fas fa-globe-americas',
                description: 'Official UNDRR game where you act as a disaster risk manager building safer communities. Handle multiple disaster types while working under time and resource constraints.',
                players: '1',
                duration: '30-45',
                rating: 'â˜… 4.9',
                objectives: [
                    'Build disaster-resilient communities',
                    'Reduce disaster impacts',
                    'Manage limited resources',
                    'Handle multiple disaster types'
                ],
                features: [
                    'UN official certification',
                    'Global disaster scenarios',
                    'Evidence-based strategies',
                    'Policy decision making'
                ],
                learning: [
                    'Disaster risk reduction principles',
                    'Community resilience building',
                    'Policy impact assessment',
                    'International best practices'
                ],
                notes: [
                    'Based on real UN frameworks',
                    'Scientifically accurate scenarios',
                    'Policy decisions have consequences'
                ]
            },
            'drillrace': {
                title: 'Virtual Drill Race',
                subtitle: 'Emergency Evacuation Challenge',
                icon: 'fas fa-running',
                description: 'Conduct virtual evacuation drills for schools and communities. Guide groups to safety while handling blocked exits, panic situations, and time pressure in realistic emergency scenarios.',
                players: '1-2',
                duration: '15-25',
                rating: 'â˜… 4.7',
                objectives: [
                    'Guide 150 people to safety within time limit',
                    'Navigate around blocked exits and obstacles',
                    'Manage panic situations and crowd control',
                    'Make quick decisions under pressure',
                    'Minimize evacuation time and stress levels'
                ],
                features: [
                    'Realistic evacuation scenarios',
                    'Dynamic obstacles and challenges',
                    'Crowd behavior simulation',
                    'Performance metrics tracking',
                    'Multiple difficulty levels'
                ],
                learning: [
                    'Emergency evacuation procedures',
                    'Crowd management techniques',
                    'Crisis leadership skills',
                    'Decision making under pressure',
                    'Building safety protocols'
                ],
                notes: [
                    'Based on real evacuation drills',
                    'Performance affects final score',
                    'Quick decisions save lives'
                ],
                rules: {
                    description: 'Virtual Drill Race simulates emergency evacuation scenarios where you must guide people to safety efficiently. Your performance is measured by evacuation time, people saved, and stress management.',
                    gettingStarted: [
                        'Fire alarm or emergency alert is triggered',
                        'You have 5 minutes to evacuate all 150 people',
                        'Choose evacuation routes and manage crowd flow',
                        'Adapt to changing situations and obstacles'
                    ],
                    gameplay: [
                        'Click on groups of people to direct them to exits',
                        'Choose primary and alternate evacuation routes',
                        'Handle special situations (disabled persons, panic, etc.)',
                        'Monitor evacuation progress and crowd stress levels',
                        'Make decisions when exits become blocked',
                        'Coordinate with emergency services'
                    ],
                    winning: [
                        'Evacuate all people within 5 minutes for maximum score',
                        'Bonus points for: speed, low stress levels, helping disabled',
                        'Points deducted for: delays, high panic, blocked routes',
                        'Perfect evacuation: 1000+ points possible',
                        'Unlock achievements for exceptional performance'
                    ],
                    important: [
                        'Primary exits may become blocked - have backup plans',
                        'Some people move slower and need assistance',
                        'Panic spreads if not managed quickly',
                        'Leadership decisions affect group behavior'
                    ]
                }
            },
            'disasterresponse': {
                title: 'Disaster Response Game',
                subtitle: 'Rapid Crisis Management',
                icon: 'fas fa-stopwatch',
                description: 'Respond quickly to emerging crises with limited information. Make rapid decisions for wildfires, hurricanes, and pandemics in realistic emergency scenarios.',
                players: '1-4',
                duration: '15-30',
                rating: 'â˜… 4.7',
                objectives: [
                    'Respond to crisis rapidly',
                    'Make decisions with limited info',
                    'Coordinate emergency teams',
                    'Minimize casualties and damage'
                ],
                features: [
                    'Real-time decision making',
                    'Limited information scenarios',
                    'Multiple crisis types',
                    'Pressure testing'
                ],
                learning: [
                    'Crisis decision making',
                    'Information prioritization',
                    'Team coordination',
                    'Stress management'
                ],
                notes: [
                    'Time pressure is intense',
                    'Information is often incomplete',
                    'Quick decisions required'
                ]
            }
            // Add more games as needed...
        };

        // Modal functions
        function openGameModal(gameId) {
            const gameData = gameDatabase[gameId];
            if (!gameData) return;

            currentGameData = { id: gameId, ...gameData };

            // Update modal content
            document.getElementById('modalGameIcon').innerHTML = `<i class="${gameData.icon}"></i>`;
            document.getElementById('modalGameTitle').textContent = gameData.title;
            document.getElementById('modalGameSubtitle').textContent = gameData.subtitle;
            document.getElementById('modalGameDescription').textContent = gameData.description;
            
            // Update stats
            document.getElementById('modalPlayers').textContent = gameData.players;
            document.getElementById('modalDuration').textContent = gameData.duration;
            document.getElementById('modalRating').textContent = gameData.rating;

            // Update objectives
            const objectivesList = document.getElementById('modalObjectives');
            objectivesList.innerHTML = gameData.objectives.map(obj => 
                `<li><i class="fas fa-check"></i> ${obj}</li>`
            ).join('');

            // Update features
            const featuresList = document.getElementById('modalFeatures');
            featuresList.innerHTML = gameData.features.map(feature => 
                `<li><i class="fas fa-star"></i> ${feature}</li>`
            ).join('');

            // Update learning outcomes
            const learningList = document.getElementById('modalLearning');
            learningList.innerHTML = gameData.learning.map(outcome => 
                `<li><i class="fas fa-brain"></i> ${outcome}</li>`
            ).join('');

            // Update notes
            const notesList = document.getElementById('modalNotes');
            notesList.innerHTML = gameData.notes.map(note => 
                `<li><i class="fas fa-info-circle"></i> ${note}</li>`
            ).join('');

            // Ensure modal is properly positioned and displayed
            const modal = document.getElementById('gameModal');
            
            // Reset any conflicting styles
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.zIndex = '1000';
            modal.style.display = 'flex';
            
            // Show modal
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Scroll to top to ensure modal is visible
            window.scrollTo(0, 0);
        }

        function closeGameModal() {
            document.getElementById('gameModal').classList.remove('active');
            document.body.style.overflow = 'auto';
            currentGameData = null;
        }

        // Rules Modal Functions
        function openRulesModal(gameId) {
            const gameData = gameDatabase[gameId];
            if (!gameData || !gameData.rules) {
                alert('Rules for this game are not yet available.');
                return;
            }

            currentRulesGame = gameId;
            const rules = gameData.rules;

            // Update modal content
            document.getElementById('rulesModalTitle').textContent = `${gameData.title} - Rules`;
            document.getElementById('rulesModalSubtitle').textContent = 'How to Play';
            document.getElementById('rulesModalDescription').textContent = rules.description;

            // Update getting started
            const gettingStartedList = document.getElementById('rulesGettingStarted');
            gettingStartedList.innerHTML = rules.gettingStarted.map(step => 
                `<li><i class="fas fa-check"></i> ${step}</li>`
            ).join('');

            // Update gameplay
            const gameplayList = document.getElementById('rulesGameplay');
            gameplayList.innerHTML = rules.gameplay.map(rule => 
                `<li><i class="fas fa-star"></i> ${rule}</li>`
            ).join('');

            // Update winning conditions
            const winningList = document.getElementById('rulesWinning');
            winningList.innerHTML = rules.winning.map(condition => 
                `<li><i class="fas fa-crown"></i> ${condition}</li>`
            ).join('');

            // Update important rules
            const importantList = document.getElementById('rulesImportant');
            importantList.innerHTML = rules.important.map(rule => 
                `<li><i class="fas fa-info-circle"></i> ${rule}</li>`
            ).join('');

            // Show modal
            document.getElementById('rulesModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeRulesModal() {
            document.getElementById('rulesModal').classList.remove('active');
            document.body.style.overflow = 'auto';
            currentRulesGame = null;
        }

        function startActualGame() {
            if (!currentGameData) return;

            // Record game start
            playerStats.recordGameStart(currentGameData.id);
            updateStatsDisplay();

            // Close modal
            closeGameModal();

            // Update game interface
            document.getElementById('interfaceGameTitle').textContent = currentGameData.title;
            
            // Show game interface
            document.getElementById('gameInterface').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Load game instructions and setup
            loadGameInstructions(currentGameData);
            
            // Store the game start time for scoring
            window.currentGameStartTime = Date.now();
            
            // Simulate loading time
            setTimeout(() => {
                document.getElementById('gameLoading').style.display = 'none';
                document.getElementById('gameReady').style.display = 'block';
            }, 2000);
        }

        function loadGameInstructions(gameData) {
            // Update instructions header
            document.getElementById('instructionsIcon').innerHTML = `<i class="${gameData.icon}"></i>`;
            document.getElementById('instructionsTitle').textContent = `${gameData.title} - How to Play`;
            document.getElementById('instructionsSubtitle').textContent = gameData.subtitle;

            // Create instructions grid
            const instructionsGrid = document.getElementById('instructionsGrid');
            instructionsGrid.innerHTML = '';

            // Objectives section
            const objectivesSection = document.createElement('div');
            objectivesSection.className = 'instruction-section';
            objectivesSection.innerHTML = `
                <h4><i class="fas fa-target"></i> Objectives</h4>
                <ul class="instruction-list">
                    ${gameData.objectives.map(obj => `<li><i class="fas fa-check"></i> ${obj}</li>`).join('')}
                </ul>
            `;
            instructionsGrid.appendChild(objectivesSection);

            // Controls section
            const controlsSection = document.createElement('div');
            controlsSection.className = 'instruction-section';
            controlsSection.innerHTML = `
                <h4><i class="fas fa-keyboard"></i> Controls</h4>
                <ul class="instruction-list">
                    <li><i class="fas fa-mouse"></i> Use mouse to interact with game elements</li>
                    <li><i class="fas fa-keyboard"></i> Use keyboard for quick actions</li>
                    <li><i class="fas fa-question-circle"></i> Click help button for hints</li>
                    <li><i class="fas fa-pause"></i> Press ESC to pause the game</li>
                </ul>
            `;
            instructionsGrid.appendChild(controlsSection);

            // Scoring section
            const scoringSection = document.createElement('div');
            scoringSection.className = 'instruction-section';
            scoringSection.innerHTML = `
                <h4><i class="fas fa-star"></i> Scoring</h4>
                <ul class="instruction-list">
                    <li><i class="fas fa-plus"></i> Correct decisions earn points</li>
                    <li><i class="fas fa-clock"></i> Speed bonuses for quick thinking</li>
                    <li><i class="fas fa-medal"></i> Perfect completion earns achievements</li>
                    <li><i class="fas fa-chart-line"></i> Track your progress over time</li>
                </ul>
            `;
            instructionsGrid.appendChild(scoringSection);

            // Tips section
            const tipsSection = document.createElement('div');
            tipsSection.className = 'instruction-section';
            tipsSection.innerHTML = `
                <h4><i class="fas fa-lightbulb"></i> Tips for Success</h4>
                <ul class="instruction-list">
                    <li><i class="fas fa-brain"></i> Think about real-world applications</li>
                    <li><i class="fas fa-users"></i> Consider community impact</li>
                    <li><i class="fas fa-shield-alt"></i> Safety is always the priority</li>
                    <li><i class="fas fa-redo"></i> Learn from mistakes and retry</li>
                </ul>
            `;
            instructionsGrid.appendChild(tipsSection);
        }

        function startActualGameplay() {
            // Hide instructions and show game content
            document.getElementById('gameInstructions').style.display = 'none';
            document.getElementById('gameReady').style.display = 'none';
            document.getElementById('actualGameContent').style.display = 'block';

            // Load the specific game content
            loadGameContent(currentGameData.id);
        }

        function updateStatsDisplay() {
            const stats = playerStats.getStats();
            document.getElementById('gamesPlayedCount').textContent = stats.gamesPlayed;
            document.getElementById('lastGamePoints').textContent = stats.lastGamePoints;
            document.getElementById('maxPointsEver').textContent = stats.maxPoints;
        }

        function updateCurrentGamePoints(points) {
            document.getElementById('currentGamePoints').textContent = points;
        }

        function showGameCompletionPopup(gameId, finalPoints) {
            const stats = playerStats.getStats();
            
            // Create popup overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(0, 0, 0, 0.85);
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            // Create popup content
            const popup = document.createElement('div');
            popup.style.cssText = `
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 20px;
                padding: 30px;
                max-width: 900px;
                width: 95%;
                max-height: 85vh;
                overflow-y: auto;
                color: white;
                text-align: center;
                box-shadow: 0 25px 50px rgba(0,0,0,0.5);
                animation: slideIn 0.4s ease;
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                z-index: 10001;
            `;
            
            // Get recommended games (excluding the current one)
            const allGames = [
                { id: 'disasterpoly', name: 'DisasterPoly Board Game', icon: 'ðŸŽ²', category: 'Strategy' },
                { id: 'quiz', name: 'Emergency Quiz Challenge', icon: 'ðŸ§ ', category: 'Knowledge' },
                { id: 'tsunami-escape', name: 'Tsunami Escape', icon: 'ðŸŒŠ', category: 'Simulation' },
                { id: 'hurricane-hero', name: 'Hurricane Hero', icon: 'ðŸŒªï¸', category: 'Simulation' },
                { id: 'wildfire-watch', name: 'Wildfire Watch', icon: 'ðŸ”¥', category: 'Strategy' },
                { id: 'earthquake-response', name: 'Earthquake Response', icon: 'ðŸ—ï¸', category: 'Action' },
                { id: 'flood-quest', name: 'FloodQuest', icon: 'ðŸ’§', category: 'Strategy' },
                { id: 'disaster-detective', name: 'Disaster Detective', icon: 'ðŸ”', category: 'Investigation' }
            ];
            
            const recommendedGames = allGames.filter(game => game.id !== gameId).slice(0, 4);
            
            popup.innerHTML = `
                <div style="margin-bottom: 30px;">
                    <h2 style="margin: 0 0 10px 0; font-size: 2rem;">ðŸŽ‰ Game Complete!</h2>
                    <p style="font-size: 1.1rem; opacity: 0.9; margin: 0;">Congratulations on completing your disaster preparedness training!</p>
                </div>
                
                <div style="display: flex; gap: 30px; margin: 30px 0; flex-wrap: wrap;">
                    <!-- Left Side: Player Statistics -->
                    <div style="flex: 1; min-width: 300px; background: rgba(255,255,255,0.1); padding: 25px; border-radius: 15px;">
                        <h3 style="margin: 0 0 20px 0; color: #FFD700;">ðŸ“Š Your Points & Progress</h3>
                        
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                            <div style="font-size: 2.5rem; font-weight: bold; color: #FFD700; margin-bottom: 10px;">
                                ${finalPoints}
                            </div>
                            <div style="font-size: 1.1rem; opacity: 0.9;">Points This Game</div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="font-size: 1.8rem; font-weight: bold; color: #4CAF50;">${stats.totalPoints}</div>
                                <div style="font-size: 0.9rem; opacity: 0.8;">Total Points</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="font-size: 1.8rem; font-weight: bold; color: #2196F3;">${stats.maxPoints}</div>
                                <div style="font-size: 0.9rem; opacity: 0.8;">Best Score</div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="font-size: 1.8rem; font-weight: bold; color: #FF9800;">${stats.gamesPlayed}</div>
                                <div style="font-size: 0.9rem; opacity: 0.8;">Games Played</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="font-size: 1.8rem; font-weight: bold; color: #9C27B0;">${stats.achievements.length}</div>
                                <div style="font-size: 0.9rem; opacity: 0.8;">Achievements</div>
                            </div>
                        </div>
                        
                        ${finalPoints >= stats.maxPoints && finalPoints > 0 ? 
                            '<div style="background: linear-gradient(45deg, #FFD700, #FFA000); padding: 15px; border-radius: 10px; margin-top: 15px; color: #333; font-weight: bold;">ðŸ† NEW HIGH SCORE! ðŸ†</div>' : 
                            ''
                        }
                    </div>
                    
                    <!-- Right Side: Game Selection -->
                    <div style="flex: 1; min-width: 300px; background: rgba(255,255,255,0.1); padding: 25px; border-radius: 15px;">
                        <h3 style="margin: 0 0 20px 0; color: #FFD700;">ðŸŽ® Continue Learning</h3>
                        <p style="font-size: 0.95rem; opacity: 0.9; margin-bottom: 20px;">Choose your next disaster preparedness challenge:</p>
                        
                        <div style="display: grid; gap: 12px;">
                            ${recommendedGames.map(game => `
                                <div onclick="selectNextGame('${game.id}')" style="
                                    background: rgba(255,255,255,0.15);
                                    padding: 15px;
                                    border-radius: 12px;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                    border: 2px solid transparent;
                                    display: flex;
                                    align-items: center;
                                    gap: 15px;
                                " onmouseover="this.style.background='rgba(255,255,255,0.25)'; this.style.borderColor='#FFD700';" 
                                   onmouseout="this.style.background='rgba(255,255,255,0.15)'; this.style.borderColor='transparent';">
                                    <div style="font-size: 2rem;">${game.icon}</div>
                                    <div style="text-align: left; flex: 1;">
                                        <div style="font-weight: bold; margin-bottom: 5px;">${game.name}</div>
                                        <div style="font-size: 0.85rem; opacity: 0.8;">${game.category} â€¢ Interactive Learning</div>
                                    </div>
                                    <div style="color: #FFD700; font-size: 1.2rem;">â†’</div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.2);">
                            <button onclick="viewAllGames()" style="
                                background: linear-gradient(45deg, #4CAF50, #45a049);
                                color: white;
                                border: none;
                                padding: 12px 25px;
                                border-radius: 25px;
                                cursor: pointer;
                                font-weight: bold;
                                font-size: 1rem;
                                transition: all 0.3s ease;
                                width: 100%;
                            " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(76,175,80,0.4)';"
                               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                                ðŸŽ¯ View All Games
                            </button>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px; display: flex; gap: 15px; justify-content: center;">
                    <button onclick="closeGameCompletionPopup()" style="
                        background: rgba(255,255,255,0.2);
                        color: white;
                        border: 2px solid rgba(255,255,255,0.3);
                        padding: 12px 25px;
                        border-radius: 25px;
                        cursor: pointer;
                        font-weight: bold;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.background='rgba(255,255,255,0.3)';"
                       onmouseout="this.style.background='rgba(255,255,255,0.2)';">
                        âœ¨ Continue Exploring
                    </button>
                    
                    <button onclick="shareProgress(${finalPoints}, ${stats.totalPoints})" style="
                        background: linear-gradient(45deg, #2196F3, #1976D2);
                        color: white;
                        border: none;
                        padding: 12px 25px;
                        border-radius: 25px;
                        cursor: pointer;
                        font-weight: bold;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(33,150,243,0.4)';"
                       onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                        ðŸ“¤ Share Achievement
                    </button>
                </div>
            `;
            
            overlay.appendChild(popup);
            document.body.appendChild(overlay);
            document.body.appendChild(popup);
            
            // Add click outside to close
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    closeGameCompletionPopup();
                }
            });
            
            // Store references for closing
            window.currentCompletionPopup = overlay;
            window.currentCompletionPopupModal = popup;
        }

        function selectNextGame(gameId) {
            closeGameCompletionPopup();
            
            // Show a brief loading message
            const loadingMsg = document.createElement('div');
            loadingMsg.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: #4CAF50;
                color: white;
                padding: 20px 30px;
                border-radius: 10px;
                z-index: 10001;
                font-weight: bold;
                text-align: center;
            `;
            loadingMsg.textContent = 'ðŸŽ® Loading next game...';
            document.body.appendChild(loadingMsg);
            
            setTimeout(() => {
                document.body.removeChild(loadingMsg);
                
                // Map game IDs to their start functions
                const gameMap = {
                    'disasterpoly': 'startDisasterPoly',
                    'quiz': 'startQuiz',
                    'tsunami-escape': 'startTsunamiEscape',
                    'hurricane-hero': 'startHurricaneHero',
                    'wildfire-watch': 'startWildfireWatch',
                    'earthquake-response': 'startQuakeResponse',
                    'flood-quest': 'startFloodplainProject',
                    'disaster-detective': 'startDetectiveGame'
                };
                
                const functionName = gameMap[gameId];
                if (functionName && window[functionName]) {
                    window[functionName]();
                } else {
                    // Fallback: try to find and click the game button
                    const gameButtons = document.querySelectorAll('.game-card .btn-primary');
                    gameButtons.forEach(button => {
                        const onclick = button.getAttribute('onclick');
                        if (onclick && onclick.includes(functionName || gameId)) {
                            button.click();
                        }
                    });
                }
            }, 1000);
        }

        function viewAllGames() {
            closeGameCompletionPopup();
            
            // Scroll to games section
            const gamesSection = document.getElementById('gamesGrid');
            if (gamesSection) {
                gamesSection.scrollIntoView({ behavior: 'smooth' });
                
                // Highlight the games section briefly
                const originalBg = gamesSection.style.background;
                gamesSection.style.background = 'rgba(76, 175, 80, 0.1)';
                gamesSection.style.transition = 'background 0.5s ease';
                
                setTimeout(() => {
                    gamesSection.style.background = originalBg;
                }, 2000);
            }
        }

        function shareProgress(gamePoints, totalPoints) {
            const shareText = `ðŸŽ‰ Just completed a disaster preparedness game!\n\nðŸ† Earned ${gamePoints} points\nðŸ“Š Total: ${totalPoints} points\n\nðŸ’ª Building resilience through #DisasterPreparedness gaming! #StaySafe #EmergencyReady`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Disaster Preparedness Achievement',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('ðŸŽ‰ Achievement copied to clipboard!\n\nShare your progress on social media to inspire others!');
                }).catch(() => {
                    alert('ðŸŽ‰ Share your achievement:\n\n' + shareText);
                });
            }
        }

        function closeGameCompletionPopup() {
            if (window.currentCompletionPopup) {
                window.currentCompletionPopup.style.animation = 'fadeOut 0.3s ease';
                if (window.currentCompletionPopupModal) {
                    window.currentCompletionPopupModal.style.animation = 'fadeOut 0.3s ease';
                }
                
                setTimeout(() => {
                    if (document.body.contains(window.currentCompletionPopup)) {
                        document.body.removeChild(window.currentCompletionPopup);
                    }
                    if (window.currentCompletionPopupModal && document.body.contains(window.currentCompletionPopupModal)) {
                        document.body.removeChild(window.currentCompletionPopupModal);
                    }
                    window.currentCompletionPopup = null;
                    window.currentCompletionPopupModal = null;
                }, 300);
            }
        }

        function completeGame(gameId, finalPoints, timeSpent = 0) {
            // Record completion
            const achievements = playerStats.recordGameComplete(gameId, finalPoints, timeSpent);
            
            // Update display
            updateStatsDisplay();
            
            // Show achievements if any
            if (achievements.length > 0) {
                achievements.forEach((achievement, index) => {
                    setTimeout(() => {
                        showAchievement(achievement);
                    }, index * 2000);
                });
            }

            // Show game completion popup with points and game selection
            setTimeout(() => {
                showGameCompletionPopup(gameId, finalPoints);
            }, achievements.length * 2000 + 1000);
        }

        function showAchievement(achievement) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementIcon').textContent = 'ðŸ†';
            document.getElementById('achievementTitle').textContent = achievement.name;
            document.getElementById('achievementDesc').textContent = achievement.description;
            
            popup.classList.add('show');
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 4000);
        }

        function loadGameContent(gameId) {
            const gameContent = document.getElementById('actualGameContent');
            let gameStartTime = Date.now();
            
            switch(gameId) {
                case 'disasterpoly':
                    gameContent.innerHTML = createDisasterPolyGame();
                    initializeDisasterPolyGameplay();
                    break;
                case 'quiz':
                    gameContent.innerHTML = createQuizGame();
                    initializeQuizGameplay();
                    break;
                case 'tsunamiescape':
                    gameContent.innerHTML = createTsunamiEscapeGame();
                    initializeTsunamiEscapeGameplay();
                    break;
                case 'hurricanehero':
                    gameContent.innerHTML = createHurricaneHeroGame();
                    initializeHurricaneHeroGameplay();
                    break;
                case 'drillrace':
                    gameContent.innerHTML = createDrillRaceGame();
                    initializeDrillRaceGameplay();
                    break;
                default:
                    gameContent.innerHTML = createDefaultGame(gameId);
                    break;
            }
            
            // Store game start time for scoring
            window.currentGameStartTime = gameStartTime;
        }

        function createDisasterPolyGame() {
            return `
                <div style="text-align: center;">
                    <h2 style="color: var(--primary); margin-bottom: 20px;">ðŸŽ² DisasterPoly Board Game</h2>
                    <div class="game-board" style="width: 400px; height: 400px; margin: 0 auto 20px; position: relative; background: #f0f8ff; border: 3px solid var(--primary); border-radius: 15px;">
                        <div id="gameBoard" style="position: relative; width: 100%; height: 100%;">
                            <!-- Board squares will be created by JavaScript -->
                        </div>
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; background: var(--primary); color: white; padding: 20px; border-radius: 50%; width: 120px; height: 120px; display: flex; flex-direction: column; justify-content: center;">
                            <div style="font-weight: bold;">DisasterPoly</div>
                            <div style="font-size: 0.8rem;">Emergency Prep</div>
                        </div>
                        <div id="playerPiece" style="position: absolute; width: 15px; height: 15px; background: #ff4444; border-radius: 50%; border: 2px solid white; z-index: 100; left: 40px; bottom: 40px; transition: all 0.5s ease;"></div>
                    </div>
                    <div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 20px;">
                        <button class="btn-primary" onclick="rollDiceGame()">ðŸŽ² Roll Dice</button>
                        <div style="background: white; border: 2px solid var(--primary); width: 50px; height: 50px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold;" id="diceResult">?</div>
                    </div>
                    <div style="background: rgba(26, 115, 232, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <h4>Your Progress</h4>
                        <p>Position: <span id="playerPosition">Start</span> | Score: <span id="playerScore">0</span> | Round: <span id="currentRound">1</span>/3</p>
                        <div style="margin-top: 10px;">
                            <div style="font-size: 0.9rem; color: #666;">Game Progress:</div>
                            <div style="width: 100%; height: 6px; background: #f0f0f0; border-radius: 3px; margin-top: 5px;">
                                <div id="gameProgress" style="height: 100%; background: linear-gradient(to right, var(--primary), var(--secondary)); border-radius: 3px; width: 0%; transition: width 0.3s;"></div>
                            </div>
                        </div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: var(--shadow);">
                        <h4 style="color: var(--primary); margin-bottom: 10px;">Game Instructions</h4>
                        <ul style="text-align: left; font-size: 0.9rem; line-height: 1.6;">
                            <li>ðŸŽ¯ Goal: Complete 3 rounds around the board</li>
                            <li>ðŸŽ² Roll dice to move around the board</li>
                            <li>ðŸŸ¢ Safe zones: +50 points</li>
                            <li>ðŸ”´ Disaster zones: -30 points (learn safety tips!)</li>
                            <li>â­ Corner squares: +100 points bonus</li>
                            <li>ðŸ”„ Passing START: +25 points</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function createQuizGame() {
            return `
                <div style="max-width: 600px; margin: 0 auto;">
                    <h2 style="color: var(--primary); text-align: center; margin-bottom: 20px;">ðŸ§  Disaster Knowledge Quiz</h2>
                    <div style="background: rgba(26, 115, 232, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
                        <h4 style="color: var(--primary); margin-bottom: 10px;">Quiz Statistics</h4>
                        <div style="display: flex; justify-content: space-around;">
                            <div><strong>Questions:</strong> <span id="quizQuestionCount">10</span></div>
                            <div><strong>Time Left:</strong> <span id="quizTimeLeft">15:00</span></div>
                            <div><strong>Score:</strong> <span id="quizCurrentScore">0</span></div>
                        </div>
                    </div>
                    <div id="quizProgress" style="width: 100%; height: 8px; background: #f0f0f0; border-radius: 4px; margin-bottom: 20px;">
                        <div id="progressBar" style="height: 100%; background: linear-gradient(to right, var(--primary), var(--secondary)); border-radius: 4px; width: 0%; transition: width 0.3s;"></div>
                    </div>
                    <div id="questionCard" style="background: white; padding: 25px; border-radius: 12px; box-shadow: var(--shadow); margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                            <span style="background: var(--primary); color: white; padding: 8px 15px; border-radius: 20px; font-size: 0.9rem;">Question <span id="questionNumber">1</span>/10</span>
                            <span style="background: var(--secondary); color: white; padding: 8px 15px; border-radius: 20px; font-size: 0.9rem;">+<span id="questionPoints">10</span> points</span>
                        </div>
                        <h3 id="questionText" style="margin-bottom: 20px; color: var(--text-dark);">Loading question...</h3>
                        <div id="optionsContainer">
                            <!-- Options will be populated by JavaScript -->
                        </div>
                        <div id="questionExplanation" style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid var(--primary); display: none;">
                            <h5 style="color: var(--primary); margin-bottom: 8px;">ðŸ’¡ Did You Know?</h5>
                            <p id="explanationText" style="margin: 0; font-size: 0.9rem; line-height: 1.5;"></p>
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <button class="btn-primary" id="nextQuestionBtn" onclick="nextQuizQuestion()" disabled>Next Question</button>
                        <button class="btn-secondary" onclick="pauseQuiz()" style="margin-left: 10px;">â¸ï¸ Pause</button>
                    </div>
                    <div id="quizCompleteSection" style="display: none; text-align: center; background: white; padding: 30px; border-radius: 12px; box-shadow: var(--shadow);">
                        <h2 style="color: var(--primary);">ðŸŽ‰ Quiz Complete!</h2>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--secondary); margin: 20px 0;" id="finalQuizScore">0</div>
                        <div id="quizPerformance" style="background: rgba(26, 115, 232, 0.1); padding: 20px; border-radius: 10px; margin: 20px 0;">
                            <div>Correct Answers: <strong id="correctCount">0</strong>/10</div>
                            <div>Accuracy: <strong id="accuracyPercent">0%</strong></div>
                            <div>Time Taken: <strong id="timeTaken">0:00</strong></div>
                        </div>
                        <div id="achievementsEarned" style="margin: 20px 0;"></div>
                        <button class="btn-primary" onclick="restartQuiz()">ðŸ”„ Play Again</button>
                    </div>
                </div>
            `;
        }

        function createTsunamiEscapeGame() {
            return `
                <div style="max-width: 700px; margin: 0 auto;">
                    <h2 style="color: var(--primary); text-align: center; margin-bottom: 20px;">ðŸŒŠ Tsunami Escape Challenge</h2>
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
                        <h4 style="color: #1976d2; margin-bottom: 10px;">âš ï¸ TSUNAMI WARNING</h4>
                        <p>A major earthquake has occurred offshore. Tsunami waves are approaching the coast. You have <span id="timeRemaining" style="font-weight: bold; color: #d32f2f;">5:00</span> minutes to reach safety!</p>
                    </div>
                    <div id="gameMap" style="background: linear-gradient(to top, #87ceeb 0%, #87ceeb 30%, #f4a460 30%, #f4a460 70%, #228b22 70%); height: 300px; border-radius: 10px; position: relative; overflow: hidden; margin-bottom: 20px;">
                        <div id="player" style="position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); width: 20px; height: 20px; background: #ff4444; border-radius: 50%; z-index: 100;">ðŸƒ</div>
                        <div id="tsunami" style="position: absolute; bottom: 0; left: 0; width: 100%; height: 30%; background: linear-gradient(to top, #1976d2, #42a5f5); opacity: 0.8; z-index: 50;"></div>
                        <div style="position: absolute; top: 10%; left: 50%; transform: translateX(-50%); background: #8bc34a; padding: 10px; border-radius: 5px; color: white; font-weight: bold;">ðŸ”ï¸ SAFETY ZONE</div>
                    </div>
                    <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 20px;">
                        <button class="btn-primary" onclick="movePlayer('up')">â¬†ï¸ Move Inland</button>
                        <button class="btn-primary" onclick="movePlayer('left')">â¬…ï¸ Move Left</button>
                        <button class="btn-primary" onclick="movePlayer('right')">âž¡ï¸ Move Right</button>
                    </div>
                    <div style="background: rgba(26, 115, 232, 0.1); padding: 15px; border-radius: 10px;">
                        <h4>Escape Status</h4>
                        <p>Distance to Safety: <span id="distanceToSafety">90%</span> | Obstacles Cleared: <span id="obstaclesCleared">0</span>/3</p>
                    </div>
                </div>
            `;
        }

        function createHurricaneHeroGame() {
            return `
                <div style="max-width: 700px; margin: 0 auto;">
                    <h2 style="color: var(--primary); text-align: center; margin-bottom: 20px;">ðŸŒ€ Hurricane Hero: Resource Dash</h2>
                    <div style="background: #fff3e0; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #ff9800;">
                        <h4 style="color: #f57c00; margin-bottom: 10px;">ðŸŒ€ HURRICANE APPROACHING</h4>
                        <p>Category 3 Hurricane making landfall in <span id="hurricaneTime" style="font-weight: bold; color: #d32f2f;">24 hours</span>. Prepare your community!</p>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: var(--shadow);">
                            <h4 style="color: var(--primary);">ðŸ“¦ Resources</h4>
                            <div>Budget: $<span id="budget">500</span></div>
                            <div>Water: <span id="waterSupply">0</span> gallons</div>
                            <div>Food: <span id="foodSupply">0</span> days</div>
                            <div>Shelter Items: <span id="shelterItems">0</span></div>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: var(--shadow);">
                            <h4 style="color: var(--primary);">ðŸ‘¥ Community</h4>
                            <div>Families Helped: <span id="familiesHelped">0</span>/10</div>
                            <div>Shelters Ready: <span id="sheltersReady">0</span>/3</div>
                            <div>Evacuation Routes: <span id="evacuationRoutes">0</span>/5</div>
                        </div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: var(--shadow); margin-bottom: 20px;">
                        <h4 style="color: var(--primary);">ðŸ›’ Supply Store</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                            <button class="btn-secondary" onclick="buySupply('water', 50)">Water (5 gal) - $50</button>
                            <button class="btn-secondary" onclick="buySupply('food', 30)">Food (3 days) - $30</button>
                            <button class="btn-secondary" onclick="buySupply('shelter', 25)">Tarp/Rope - $25</button>
                            <button class="btn-secondary" onclick="buySupply('medical', 40)">First Aid Kit - $40</button>
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <button class="btn-primary" onclick="completePreparation()">ðŸš¨ Complete Preparation</button>
                    </div>
                </div>
            `;
        }

        function createDrillRaceGame() {
            return `
                <div style="max-width: 800px; margin: 0 auto;">
                    <h2 style="color: var(--primary); text-align: center; margin-bottom: 20px;">ðŸƒâ€â™‚ï¸ Virtual Drill Race</h2>
                    
                    <div style="background: linear-gradient(135deg, #FF6B35, #F7931E); color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div style="display: flex; gap: 20px; align-items: center;">
                                <div>
                                    <strong>â±ï¸ Time: <span id="drillTimeLeft">5:00</span></strong>
                                </div>
                                <div>
                                    <strong>ðŸ‘¥ People: <span id="peopleEvacuated">0</span>/150</strong>
                                </div>
                                <div>
                                    <strong>ðŸ† Score: <span id="drillScore">0</span></strong>
                                </div>
                            </div>
                            <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 10px;">
                                <div>Stress Level: <span id="stressLevel">ðŸ˜Œ Low</span></div>
                            </div>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                            <h4 style="margin-bottom: 10px;">ðŸš¨ EMERGENCY EVACUATION DRILL</h4>
                            <p style="margin: 0;">Fire alarm activated! All personnel must evacuate the building immediately. Guide everyone to safety!</p>
                        </div>
                        
                        <div id="buildingLayout" style="background: rgba(255,255,255,0.9); color: #333; padding: 20px; border-radius: 10px; position: relative; height: 300px; overflow: hidden;">
                            <!-- Building layout will be created here -->
                            <div style="position: absolute; top: 10px; left: 10px; background: #f44336; color: white; padding: 5px 10px; border-radius: 5px; font-weight: bold;">
                                ðŸ”¥ FIRE - MAIN EXIT BLOCKED
                            </div>
                            
                            <!-- Rooms with people -->
                            <div class="room" style="position: absolute; top: 50px; left: 50px; width: 100px; height: 80px; background: #e3f2fd; border: 2px solid #2196f3; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer;" onclick="evacuateGroup(1, this)">
                                <div style="font-size: 0.8rem; font-weight: bold;">Room 101</div>
                                <div style="font-size: 1.5rem;">ðŸ‘¥</div>
                                <div style="font-size: 0.7rem;" id="room1-count">25 people</div>
                            </div>
                            
                            <div class="room" style="position: absolute; top: 50px; right: 50px; width: 100px; height: 80px; background: #e8f5e8; border: 2px solid #4caf50; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer;" onclick="evacuateGroup(2, this)">
                                <div style="font-size: 0.8rem; font-weight: bold;">Room 102</div>
                                <div style="font-size: 1.5rem;">ðŸ‘¥</div>
                                <div style="font-size: 0.7rem;" id="room2-count">30 people</div>
                            </div>
                            
                            <div class="room" style="position: absolute; bottom: 80px; left: 50px; width: 100px; height: 80px; background: #fff3e0; border: 2px solid #ff9800; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer;" onclick="evacuateGroup(3, this)">
                                <div style="font-size: 0.8rem; font-weight: bold;">Room 201</div>
                                <div style="font-size: 1.5rem;">ðŸ‘¥</div>
                                <div style="font-size: 0.7rem;" id="room3-count">35 people</div>
                            </div>
                            
                            <div class="room" style="position: absolute; bottom: 80px; right: 50px; width: 100px; height: 80px; background: #fce4ec; border: 2px solid #e91e63; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer;" onclick="evacuateGroup(4, this)">
                                <div style="font-size: 0.8rem; font-weight: bold;">Room 202</div>
                                <div style="font-size: 1.5rem;">ðŸ‘¥</div>
                                <div style="font-size: 0.7rem;" id="room4-count">40 people</div>
                            </div>
                            
                            <div class="room" style="position: absolute; top: 140px; left: 250px; width: 120px; height: 60px; background: #f3e5f5; border: 2px solid #9c27b0; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer;" onclick="evacuateGroup(5, this)">
                                <div style="font-size: 0.8rem; font-weight: bold;">Auditorium</div>
                                <div style="font-size: 1.5rem;">ðŸ‘¥</div>
                                <div style="font-size: 0.7rem;" id="room5-count">20 people</div>
                            </div>
                            
                            <!-- Exit doors -->
                            <div id="mainExit" style="position: absolute; bottom: 10px; left: 45%; width: 60px; height: 20px; background: #f44336; color: white; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold;">
                                ðŸš« BLOCKED
                            </div>
                            
                            <div class="exit" style="position: absolute; top: 10px; right: 10px; width: 60px; height: 20px; background: #4caf50; color: white; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold; cursor: pointer;" onclick="useExit('emergency')">
                                ðŸšª EMERGENCY
                            </div>
                            
                            <div class="exit" style="position: absolute; left: 10px; top: 45%; width: 20px; height: 60px; background: #2196f3; color: white; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold; writing-mode: vertical-rl; cursor: pointer;" onclick="useExit('side')">
                                ðŸšª SIDE
                            </div>
                            
                            <div class="exit" style="position: absolute; right: 10px; top: 45%; width: 20px; height: 60px; background: #ff9800; color: white; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold; writing-mode: vertical-rl; cursor: pointer;" onclick="useExit('rear')">
                                ðŸšª REAR
                            </div>
                            
                            <!-- Special situations -->
                            <div id="wheelchairUser" style="position: absolute; top: 200px; left: 300px; width: 40px; height: 40px; background: #fff; border: 2px solid #9c27b0; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer;" onclick="helpSpecialNeeds('wheelchair')" title="Person in wheelchair needs assistance">
                                â™¿
                            </div>
                            
                            <div id="elderlyPerson" style="position: absolute; top: 180px; left: 400px; width: 40px; height: 40px; background: #fff; border: 2px solid #ff5722; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer;" onclick="helpSpecialNeeds('elderly')" title="Elderly person needs assistance">
                                ðŸ‘´
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 15px;">
                            <button onclick="makeEmergencyAnnouncement()" class="game-btn" style="background: #2196f3; color: white;">
                                ðŸ“¢ Make Announcement
                            </button>
                            <button onclick="callFireDepartment()" class="game-btn" style="background: #f44336; color: white;">
                                ðŸš’ Call Fire Dept
                            </button>
                            <button onclick="activateAlarms()" class="game-btn" style="background: #ff9800; color: white;">
                                ðŸš¨ Activate Alarms
                            </button>
                            <button onclick="coordinateWithSecurity()" class="game-btn" style="background: #9c27b0; color: white;">
                                ðŸ‘®â€â™‚ï¸ Coordinate Security
                            </button>
                        </div>
                        
                        <div id="evacuationProgress" style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; margin-top: 15px;">
                            <h4>ðŸ“Š Evacuation Progress</h4>
                            <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                                <span>Evacuation Speed:</span>
                                <span id="evacuationSpeed">Normal</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                                <span>Leadership Actions:</span>
                                <span id="leadershipActions">0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                                <span>Special Assistance:</span>
                                <span id="specialAssistance">0/2</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: var(--shadow); margin-bottom: 20px;">
                        <h4 style="color: var(--primary); margin-bottom: 15px;">ðŸŽ¯ Instructions</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                            <div>
                                <h5>ðŸ‘¥ Evacuate Groups</h5>
                                <p style="font-size: 0.9rem;">Click on rooms to evacuate groups of people. Different rooms have different evacuation speeds.</p>
                            </div>
                            <div>
                                <h5>ðŸšª Choose Exits</h5>
                                <p style="font-size: 0.9rem;">Click on available exits to direct people. Main exit is blocked, use emergency exits!</p>
                            </div>
                            <div>
                                <h5>ðŸ¤ Special Assistance</h5>
                                <p style="font-size: 0.9rem;">Help wheelchair users and elderly people for bonus points and safety.</p>
                            </div>
                            <div>
                                <h5>ðŸ‘¨â€ðŸ’¼ Leadership Actions</h5>
                                <p style="font-size: 0.9rem;">Make announcements, call emergency services, and coordinate for better results.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center;">
                        <button onclick="restartDrillRace()" class="game-btn" style="background: var(--secondary);">
                            ðŸ”„ Restart Drill
                        </button>
                        <button onclick="pauseDrillRace()" class="game-btn">
                            â¸ï¸ Pause Drill
                        </button>
                    </div>
                </div>
            `;
        }

        // Virtual Drill Race Game Logic
        let drillRaceGameState = {
            timeRemaining: 300, // 5 minutes
            peopleEvacuated: 0,
            totalPeople: 150,
            score: 0,
            stressLevel: 1, // 1=low, 2=medium, 3=high
            gameActive: false,
            timerInterval: null,
            rooms: {
                1: { people: 25, evacuated: false, evacuating: false },
                2: { people: 30, evacuated: false, evacuating: false },
                3: { people: 35, evacuated: false, evacuating: false },
                4: { people: 40, evacuated: false, evacuating: false },
                5: { people: 20, evacuated: false, evacuating: false }
            },
            specialNeeds: {
                wheelchair: { helped: false, points: 50 },
                elderly: { helped: false, points: 30 }
            },
            leadershipActions: 0,
            evacuationSpeed: 1.0, // multiplier
            exitUsage: {
                emergency: 0,
                side: 0,
                rear: 0
            }
        };

        function initializeDrillRaceGameplay() {
            window.currentGameStartTime = Date.now();
            drillRaceGameState.timeRemaining = 300;
            drillRaceGameState.peopleEvacuated = 0;
            drillRaceGameState.score = 0;
            drillRaceGameState.stressLevel = 1;
            drillRaceGameState.gameActive = true;
            drillRaceGameState.leadershipActions = 0;
            drillRaceGameState.evacuationSpeed = 1.0;
            
            // Reset rooms
            Object.keys(drillRaceGameState.rooms).forEach(roomId => {
                const room = drillRaceGameState.rooms[roomId];
                room.evacuated = false;
                room.evacuating = false;
            });
            
            // Reset special needs
            Object.keys(drillRaceGameState.specialNeeds).forEach(person => {
                drillRaceGameState.specialNeeds[person].helped = false;
            });
            
            startDrillRaceTimer();
            updateDrillRaceDisplay();
        }

        function startDrillRaceTimer() {
            drillRaceGameState.timerInterval = setInterval(() => {
                drillRaceGameState.timeRemaining--;
                updateDrillRaceTimer();
                
                // Increase stress level over time
                if (drillRaceGameState.timeRemaining < 180 && drillRaceGameState.stressLevel === 1) {
                    drillRaceGameState.stressLevel = 2;
                    updateStressLevel();
                } else if (drillRaceGameState.timeRemaining < 90 && drillRaceGameState.stressLevel === 2) {
                    drillRaceGameState.stressLevel = 3;
                    updateStressLevel();
                }
                
                if (drillRaceGameState.timeRemaining <= 0) {
                    clearInterval(drillRaceGameState.timerInterval);
                    gameOverDrillRace(false);
                }
            }, 1000);
        }

        function updateDrillRaceTimer() {
            const timerElement = document.getElementById('drillTimeLeft');
            if (!timerElement) return;
            
            const minutes = Math.floor(drillRaceGameState.timeRemaining / 60);
            const seconds = drillRaceGameState.timeRemaining % 60;
            timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Change color when time is running low
            if (drillRaceGameState.timeRemaining < 60) {
                timerElement.style.color = '#f44336';
            } else if (drillRaceGameState.timeRemaining < 120) {
                timerElement.style.color = '#ff9800';
            }
        }

        function updateDrillRaceDisplay() {
            const scoreElement = document.getElementById('drillScore');
            if (scoreElement) scoreElement.textContent = drillRaceGameState.score;
            
            const peopleElement = document.getElementById('peopleEvacuated');
            if (peopleElement) peopleElement.textContent = drillRaceGameState.peopleEvacuated;
            
            const speedElement = document.getElementById('evacuationSpeed');
            if (speedElement) {
                if (drillRaceGameState.evacuationSpeed > 1.3) speedElement.textContent = 'Very Fast';
                else if (drillRaceGameState.evacuationSpeed > 1.1) speedElement.textContent = 'Fast';
                else speedElement.textContent = 'Normal';
            }
            
            const actionsElement = document.getElementById('leadershipActions');
            if (actionsElement) actionsElement.textContent = drillRaceGameState.leadershipActions;
            
            const assistanceElement = document.getElementById('specialAssistance');
            if (assistanceElement) {
                const helpedCount = Object.values(drillRaceGameState.specialNeeds).filter(person => person.helped).length;
                assistanceElement.textContent = `${helpedCount}/2`;
            }
            
            updateCurrentGamePoints(drillRaceGameState.score);
        }

        function updateStressLevel() {
            const stressElement = document.getElementById('stressLevel');
            if (!stressElement) return;
            
            switch(drillRaceGameState.stressLevel) {
                case 1:
                    stressElement.textContent = 'ðŸ˜Œ Low';
                    stressElement.style.color = '#4caf50';
                    break;
                case 2:
                    stressElement.textContent = 'ðŸ˜ Medium';
                    stressElement.style.color = '#ff9800';
                    drillRaceGameState.evacuationSpeed *= 0.9; // Slightly slower
                    break;
                case 3:
                    stressElement.textContent = 'ðŸ˜° High';
                    stressElement.style.color = '#f44336';
                    drillRaceGameState.evacuationSpeed *= 0.8; // Much slower
                    break;
            }
        }

        function evacuateGroup(roomId, roomElement) {
            if (!drillRaceGameState.gameActive) return;
            
            const room = drillRaceGameState.rooms[roomId];
            if (room.evacuated || room.evacuating) return;
            
            room.evacuating = true;
            roomElement.style.opacity = '0.6';
            roomElement.style.pointerEvents = 'none';
            
            // Add evacuating animation
            roomElement.style.animation = 'pulse 0.5s infinite';
            
            const evacuationTime = Math.max(1000, 3000 / drillRaceGameState.evacuationSpeed);
            
            setTimeout(() => {
                room.evacuated = true;
                room.evacuating = false;
                drillRaceGameState.peopleEvacuated += room.people;
                
                // Calculate points based on speed and stress level
                let points = room.people * 2;
                if (drillRaceGameState.stressLevel === 1) points *= 1.5;
                else if (drillRaceGameState.stressLevel === 3) points *= 0.7;
                
                drillRaceGameState.score += Math.floor(points);
                
                // Update room display
                roomElement.innerHTML = `
                    <div style="font-size: 0.8rem; font-weight: bold;">Room ${roomId < 5 ? (roomId < 3 ? '10' + roomId : '20' + (roomId-2)) : 'Auditorium'}</div>
                    <div style="font-size: 1.5rem;">âœ…</div>
                    <div style="font-size: 0.7rem; color: #4caf50;">EVACUATED</div>
                `;
                roomElement.style.background = '#e8f5e8';
                roomElement.style.border = '2px solid #4caf50';
                roomElement.style.animation = '';
                
                showDrillMessage(`âœ… ${room.people} people evacuated! +${Math.floor(points)} points`, points);
                updateDrillRaceDisplay();
                
                // Check if all people evacuated
                if (drillRaceGameState.peopleEvacuated >= drillRaceGameState.totalPeople) {
                    setTimeout(() => gameOverDrillRace(true), 1000);
                }
            }, evacuationTime);
        }

        function useExit(exitType) {
            if (!drillRaceGameState.gameActive) return;
            
            drillRaceGameState.exitUsage[exitType]++;
            drillRaceGameState.score += 10;
            
            // Bonus for using multiple exits
            const exitsUsed = Object.values(drillRaceGameState.exitUsage).filter(count => count > 0).length;
            if (exitsUsed >= 2) {
                drillRaceGameState.evacuationSpeed = Math.min(1.5, drillRaceGameState.evacuationSpeed + 0.2);
            }
            
            showDrillMessage(`ðŸšª ${exitType.toUpperCase()} exit in use! +10 points`, 10);
            updateDrillRaceDisplay();
        }

        function helpSpecialNeeds(personType) {
            if (!drillRaceGameState.gameActive) return;
            
            const person = drillRaceGameState.specialNeeds[personType];
            if (person.helped) return;
            
            person.helped = true;
            drillRaceGameState.score += person.points;
            
            const personElement = document.getElementById(personType === 'wheelchair' ? 'wheelchairUser' : 'elderlyPerson');
            personElement.style.background = '#4caf50';
            personElement.style.color = 'white';
            personElement.innerHTML = 'âœ…';
            personElement.style.pointerEvents = 'none';
            
            showDrillMessage(`ðŸ¤ Helped ${personType === 'wheelchair' ? 'wheelchair user' : 'elderly person'}! +${person.points} points`, person.points);
            updateDrillRaceDisplay();
        }

        function makeEmergencyAnnouncement() {
            if (!drillRaceGameState.gameActive) return;
            
            drillRaceGameState.leadershipActions++;
            drillRaceGameState.evacuationSpeed = Math.min(1.8, drillRaceGameState.evacuationSpeed + 0.3);
            drillRaceGameState.score += 25;
            
            if (drillRaceGameState.stressLevel > 1) {
                drillRaceGameState.stressLevel = Math.max(1, drillRaceGameState.stressLevel - 1);
                updateStressLevel();
            }
            
            showDrillMessage('ðŸ“¢ Emergency announcement made! People are moving faster and staying calmer! +25 points', 25);
            updateDrillRaceDisplay();
        }

        function callFireDepartment() {
            if (!drillRaceGameState.gameActive) return;
            
            drillRaceGameState.leadershipActions++;
            drillRaceGameState.score += 30;
            
            showDrillMessage('ðŸš’ Fire department called! Emergency services are on the way! +30 points', 30);
            updateDrillRaceDisplay();
        }

        function activateAlarms() {
            if (!drillRaceGameState.gameActive) return;
            
            drillRaceGameState.leadershipActions++;
            drillRaceGameState.evacuationSpeed = Math.min(1.6, drillRaceGameState.evacuationSpeed + 0.2);
            drillRaceGameState.score += 20;
            
            showDrillMessage('ðŸš¨ All alarms activated! Building-wide evacuation alert! +20 points', 20);
            updateDrillRaceDisplay();
        }

        function coordinateWithSecurity() {
            if (!drillRaceGameState.gameActive) return;
            
            drillRaceGameState.leadershipActions++;
            drillRaceGameState.evacuationSpeed = Math.min(1.7, drillRaceGameState.evacuationSpeed + 0.25);
            drillRaceGameState.score += 35;
            
            showDrillMessage('ðŸ‘®â€â™‚ï¸ Security coordinated! Additional help managing crowds! +35 points', 35);
            updateDrillRaceDisplay();
        }

        function showDrillMessage(message, points) {
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: ${points > 0 ? '#4caf50' : '#2196f3'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                z-index: 1000;
                text-align: center;
                font-weight: bold;
                animation: fadeInOut 1.5s ease;
                max-width: 300px;
            `;
            messageDiv.textContent = message;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                if (document.body.contains(messageDiv)) {
                    document.body.removeChild(messageDiv);
                }
            }, 1500);
        }

        function gameOverDrillRace(success) {
            clearInterval(drillRaceGameState.timerInterval);
            drillRaceGameState.gameActive = false;
            
            // Calculate final bonuses
            let timeBonus = 0;
            let leadershipBonus = drillRaceGameState.leadershipActions * 10;
            let specialNeedsBonus = Object.values(drillRaceGameState.specialNeeds)
                .filter(person => person.helped)
                .reduce((sum, person) => sum + person.points, 0);
            
            if (success) {
                timeBonus = Math.floor(drillRaceGameState.timeRemaining * 2);
                drillRaceGameState.score += 200; // Completion bonus
            }
            
            const finalScore = drillRaceGameState.score + timeBonus + leadershipBonus;
            
            setTimeout(() => {
                let message = success ? 
                    `ðŸ† EVACUATION SUCCESSFUL!\n\n` :
                    `â° TIME'S UP!\n\n`;
                
                message += `People Evacuated: ${drillRaceGameState.peopleEvacuated}/${drillRaceGameState.totalPeople}\n`;
                message += `Final Score: ${finalScore} points\n\n`;
                message += `Breakdown:\n`;
                message += `â€¢ Base Score: ${drillRaceGameState.score - (success ? 200 : 0)} points\n`;
                if (success) message += `â€¢ Completion Bonus: 200 points\n`;
                if (timeBonus > 0) message += `â€¢ Time Bonus: ${timeBonus} points\n`;
                if (leadershipBonus > 0) message += `â€¢ Leadership Bonus: ${leadershipBonus} points\n`;
                if (specialNeedsBonus > 0) message += `â€¢ Special Assistance: ${specialNeedsBonus} points\n`;
                
                message += `\n${success ? 'Excellent leadership and evacuation management!' : 'Keep practicing evacuation procedures!'}`;
                
                alert(message);
                
                completeGame('drillrace', finalScore, (Date.now() - window.currentGameStartTime) / 1000);
            }, 500);
        }

        function pauseDrillRace() {
            if (drillRaceGameState.timerInterval) {
                clearInterval(drillRaceGameState.timerInterval);
                drillRaceGameState.timerInterval = null;
                alert('â¸ï¸ Drill Paused\n\nTake time to assess the situation. Click OK to resume the evacuation.');
                startDrillRaceTimer();
            }
        }

        function restartDrillRace() {
            clearInterval(drillRaceGameState.timerInterval);
            initializeDrillRaceGameplay();
        }

        function createDefaultGame(gameId) {
            const gameData = gameDatabase[gameId] || { title: 'Game', description: 'Coming soon!' };
            return `
                <div style="text-align: center; padding: 40px;">
                    <h2 style="color: var(--primary); margin-bottom: 20px;">${gameData.title}</h2>
                    <p style="font-size: 1.1rem; margin-bottom: 30px; color: #666;">This game is coming soon with full interactive features!</p>
                    <div style="background: rgba(26, 115, 232, 0.1); padding: 30px; border-radius: 15px; margin-bottom: 20px;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">ðŸš§ In Development</h3>
                        <p>${gameData.description}</p>
                    </div>
                    <button class="btn-primary" onclick="completeGame('${gameId}', 50, 120)">
                        ðŸŽ® Experience Demo (50 points)
                    </button>
                </div>
            `;
        }

        function minimizeGame() {
            document.getElementById('gameInterface').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function exitGame() {
            // Save any current progress
            if (window.currentGameStartTime && currentGameData) {
                const timeSpent = (Date.now() - window.currentGameStartTime) / 1000;
                // Save partial progress if game was in progress
                if (confirm('Exit game? Your progress will be saved.')) {
                    const currentPoints = parseInt(document.getElementById('currentGamePoints').textContent) || 0;
                    if (currentPoints > 0) {
                        completeGame(currentGameData.id, Math.floor(currentPoints * 0.5), timeSpent); // Half points for partial completion
                    }
                } else {
                    return; // Don't exit
                }
            }
            
            // Reset game interface
            document.getElementById('gameInterface').classList.remove('active');
            document.getElementById('gameInstructions').style.display = 'block';
            document.getElementById('gameReady').style.display = 'none';
            document.getElementById('actualGameContent').style.display = 'none';
            document.getElementById('gameLoading').style.display = 'block';
            document.getElementById('currentGamePoints').textContent = '0';
            document.body.style.overflow = 'auto';
            
            currentGameData = null;
            currentGame = null;
            window.currentGameStartTime = null;
        }

        // Add progress tracking functions
        function showPlayerProgress() {
            const stats = playerStats.getStats();
            openInfoPopup(
                'Your Progress & Achievements',
                'Disaster Preparedness Journey',
                {
                    description: 'Track your learning progress and celebrate your achievements in disaster preparedness!',
                    sections: [
                        {
                            title: 'Game Statistics',
                            icon: 'fas fa-chart-line',
                            items: [
                                `Total Games Played: ${stats.gamesPlayed}`,
                                `Highest Score: ${stats.maxPoints} points`,
                                `Total Points Earned: ${stats.totalPoints} points`,
                                `Time Spent Learning: ${Math.floor(stats.timeSpent / 60)} minutes`,
                                `Favorite Game: ${stats.favoriteGame || 'None yet'}`,
                                `Last Played: ${stats.lastPlayDate ? new Date(stats.lastPlayDate).toLocaleDateString() : 'Never'}`
                            ]
                        },
                        {
                            title: 'Games Completed',
                            icon: 'fas fa-gamepad',
                            items: Object.keys(stats.gamesCompleted).length > 0 ? 
                                Object.entries(stats.gamesCompleted).map(([game, count]) => 
                                    `${gameDatabase[game]?.title || game}: ${count} times`
                                ) : ['No games completed yet']
                        },
                        {
                            title: 'Achievements Unlocked',
                            icon: 'fas fa-trophy',
                            items: stats.achievements.length > 0 ? 
                                stats.achievements.map(achievement => 
                                    `ðŸ† ${achievement.name}: ${achievement.description}`
                                ) : ['No achievements yet - keep playing!']
                        }
                    ],
                    tips: [
                        'Play different types of games to unlock more achievements',
                        'Try to beat your high score in each game',
                        'Share your knowledge with friends and family'
                    ]
                },
                'fas fa-user-graduate'
            );
        }

        // Add to menu item click handlers
        function addProgressMenuItem() {
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => {
                if (item.querySelector('span').textContent.trim() === 'Profile & Badges') {
                    item.addEventListener('click', showPlayerProgress);
                }
            });
        }

        // Enhanced achievement system
        function checkSpecialAchievements() {
            const stats = playerStats.getStats();
            const achievements = [];

            // Time-based achievements
            if (stats.timeSpent >= 3600 && !playerStats.hasAchievement('time_1hour')) { // 1 hour
                achievements.push({ 
                    id: 'time_1hour', 
                    name: 'Dedicated Student', 
                    description: 'Spent 1 hour learning disaster preparedness!' 
                });
            }

            // Streak achievements
            if (stats.currentStreak >= 3 && !playerStats.hasAchievement('streak_3')) {
                achievements.push({ 
                    id: 'streak_3', 
                    name: 'On Fire!', 
                    description: 'Completed 3 games in a row!' 
                });
            }

            // Game variety achievements
            const uniqueGames = Object.keys(stats.gamesCompleted).length;
            if (uniqueGames >= 3 && !playerStats.hasAchievement('variety_3')) {
                achievements.push({ 
                    id: 'variety_3', 
                    name: 'Well Rounded', 
                    description: 'Played 3 different types of games!' 
                });
            }

            if (uniqueGames >= 5 && !playerStats.hasAchievement('variety_5')) {
                achievements.push({ 
                    id: 'variety_5', 
                    name: 'Game Master', 
                    description: 'Played 5 different types of games!' 
                });
            }

            // High score achievements
            if (stats.maxPoints >= 1000 && !playerStats.hasAchievement('score_1000')) {
                achievements.push({ 
                    id: 'score_1000', 
                    name: 'Elite Responder', 
                    description: 'Scored over 1000 points in a single game!' 
                });
            }

            // Add any new achievements
            achievements.forEach(achievement => {
                if (!playerStats.hasAchievement(achievement.id)) {
                    playerStats.stats.achievements.push(achievement);
                    showAchievement(achievement);
                }
            });

            if (achievements.length > 0) {
                playerStats.saveStats();
            }
        }

        // Game completion with enhanced tracking
        function completeGame(gameId, finalPoints, timeSpent = 0) {
            // Record completion
            const achievements = playerStats.recordGameComplete(gameId, finalPoints, timeSpent);
            
            // Update display
            updateStatsDisplay();
            
            // Check for special achievements
            checkSpecialAchievements();
            
            // Show achievements if any
            if (achievements.length > 0) {
                achievements.forEach((achievement, index) => {
                    setTimeout(() => {
                        showAchievement(achievement);
                    }, index * 2000);
                });
            }

            // Show completion message with more detail
            setTimeout(() => {
                const stats = playerStats.getStats();
                let message = `ðŸŽ‰ Game Complete!\n\n`;
                message += `Your Score: ${finalPoints} points\n`;
                message += `Time Played: ${Math.floor(timeSpent / 60)} minutes\n`;
                message += `Total Games: ${stats.gamesPlayed}\n`;
                message += `Your Best: ${stats.maxPoints} points\n`;
                
                if (finalPoints >= stats.maxPoints && finalPoints > 0) {
                    message += `\nðŸ† NEW HIGH SCORE! ðŸ†`;
                }
                
                message += `\n\nKeep learning and stay prepared!`;
                
                alert(message);
                
                // Reset game interface
                exitGame();
            }, achievements.length * 2000 + 1000);
        }

        // Enhanced stats display with more information
        function updateStatsDisplay() {
            const stats = playerStats.getStats();
            document.getElementById('gamesPlayedCount').textContent = stats.gamesPlayed;
            document.getElementById('lastGamePoints').textContent = stats.lastGamePoints;
            document.getElementById('maxPointsEver').textContent = stats.maxPoints;
            
            // Add visual indicators for achievements
            const gamesPlayedElement = document.getElementById('gamesPlayedCount');
            if (stats.gamesPlayed >= 10) {
                gamesPlayedElement.style.color = '#4caf50';
                gamesPlayedElement.parentElement.querySelector('.stat-label').innerHTML = 'Games Played ðŸ†';
            }
            
            const maxPointsElement = document.getElementById('maxPointsEver');
            if (stats.maxPoints >= 500) {
                maxPointsElement.style.color = '#ff9800';
                maxPointsElement.parentElement.querySelector('.stat-label').innerHTML = 'Max Points â­';
            }
        }

        // Add reset progress function for testing
        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                playerStats.reset();
                updateStatsDisplay();
                document.getElementById('currentGamePoints').textContent = '0';
                alert('Progress reset successfully!');
            }
        }

        // Enhanced achievement popup with better styling
        function showAchievement(achievement) {
            const popup = document.getElementById('achievementPopup');
            
            // Determine icon based on achievement type
            let icon = 'ðŸ†';
            if (achievement.id.includes('score')) icon = 'â­';
            if (achievement.id.includes('time')) icon = 'â°';
            if (achievement.id.includes('streak')) icon = 'ðŸ”¥';
            if (achievement.id.includes('variety')) icon = 'ðŸŽ®';
            if (achievement.id.includes('perfect')) icon = 'ðŸ’Ž';
            
            document.getElementById('achievementIcon').textContent = icon;
            document.getElementById('achievementTitle').textContent = `${achievement.name} Unlocked!`;
            document.getElementById('achievementDesc').textContent = achievement.description;
            
            popup.classList.add('show');
            
            // Play achievement sound effect (if you have one)
            // new Audio('achievement.mp3').play().catch(() => {});
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 4000);
        }

        // Updated game starter functions
        function startDisasterPoly() {
            openGameModal('disasterpoly');
        }

        function startQuiz() {
            openGameModal('quiz');
        }

        function startCityManager() {
            openGameModal('citymanager');
        }

        function startTsunamiEscape() {
            openGameModal('tsunamiescape');
        }

        function startHurricaneHero() {
            openGameModal('hurricanehero');
        }

        function startWildfireWatch() {
            openGameModal('wildfirewatch');
        }

        function startQuakeResponse() {
            openGameModal('quakeresponse');
        }

        function startFloodplainProject() {
            openGameModal('floodplainproject');
        }

        function startStopDisasters() {
            openGameModal('stopdisasters');
        }

        function startDisasterResponse() {
            openGameModal('disasterresponse');
        }

        function startRoadToSafety() {
            alert('Road to Safety game will be available soon with full avatar selection and scenario navigation!');
        }

        function startDisasterMind() {
            alert('Disaster Mind FEMA simulation will be available soon with comprehensive training modules!');
        }

        function startFloodQuest() {
            alert('FloodQuest urban flooding game will be available soon with city planning challenges!');
        }

        function startDisasterQuest() {
            alert('Disaster Quest escape room will be available soon with immersive puzzle challenges!');
        }

        function startKitBuilder() {
            alert('Survival Kit Builder will be available soon with budget management and scenario-specific kits!');
        }

        function startRescueMission() {
            alert('Rescue Mission Simulator will be available soon with role-playing first responder scenarios!');
        }

        function startTriviaBattle() {
            alert('Disaster Trivia Battle will be available soon with multiplayer competitive gameplay!');
        }

        function startDrillRace() {
            console.log('startDrillRace called');
            console.log('gameDatabase:', gameDatabase);
            console.log('drillrace entry:', gameDatabase['drillrace']);
            alert('startDrillRace function called - check console for details');
            openGameModal('drillrace');
        }

        function startDetectiveGame() {
            alert('Disaster Detective will be available soon with myth-busting investigation gameplay!');
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('game-modal')) {
                if (e.target.id === 'gameModal') {
                    closeGameModal();
                } else if (e.target.id === 'rulesModal') {
                    closeRulesModal();
                }
            }
            if (e.target.classList.contains('info-popup')) {
                closeInfoPopup();
            }
        });

        // General Info Popup Functions
        function openInfoPopup(title, subtitle, content, icon = 'fas fa-info-circle') {
            document.getElementById('popupIcon').innerHTML = `<i class="${icon}"></i>`;
            document.getElementById('popupTitle').textContent = title;
            document.getElementById('popupSubtitle').textContent = subtitle;
            
            // Handle different content types
            const popupBody = document.getElementById('popupBody');
            if (typeof content === 'string') {
                popupBody.innerHTML = `<div class="popup-description">${content}</div>`;
            } else {
                // Content is an object with structured data
                let bodyHTML = '';
                
                if (content.description) {
                    bodyHTML += `<div class="popup-description">${content.description}</div>`;
                }
                
                if (content.sections) {
                    content.sections.forEach(section => {
                        bodyHTML += `
                            <div class="popup-section">
                                <h4><i class="${section.icon}"></i> ${section.title}</h4>
                                <ul class="popup-list">
                                    ${section.items.map(item => `<li><i class="fas fa-check"></i> ${item}</li>`).join('')}
                                </ul>
                            </div>
                        `;
                    });
                }
                
                if (content.highlights) {
                    content.highlights.forEach(highlight => {
                        bodyHTML += `<div class="popup-highlight">${highlight}</div>`;
                    });
                }
                
                if (content.warnings) {
                    content.warnings.forEach(warning => {
                        bodyHTML += `<div class="popup-warning"><strong>âš ï¸ Warning:</strong> ${warning}</div>`;
                    });
                }
                
                if (content.tips) {
                    content.tips.forEach(tip => {
                        bodyHTML += `<div class="popup-tip"><strong>ðŸ’¡ Tip:</strong> ${tip}</div>`;
                    });
                }
                
                if (content.grid) {
                    bodyHTML += '<div class="popup-grid">';
                    content.grid.forEach(card => {
                        bodyHTML += `
                            <div class="popup-card">
                                <h5>${card.title}</h5>
                                <ul class="popup-list">
                                    ${card.items.map(item => `<li><i class="fas fa-arrow-right"></i> ${item}</li>`).join('')}
                                </ul>
                            </div>
                        `;
                    });
                    bodyHTML += '</div>';
                }
                
                popupBody.innerHTML = bodyHTML;
            }
            
            document.getElementById('infoPopup').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeInfoPopup() {
            document.getElementById('infoPopup').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (document.getElementById('gameInterface').classList.contains('active')) {
                    exitGame();
                } else if (document.getElementById('gameModal').classList.contains('active')) {
                    closeGameModal();
                } else if (document.getElementById('rulesModal').classList.contains('active')) {
                    closeRulesModal();
                } else if (document.getElementById('infoPopup').classList.contains('active')) {
                    closeInfoPopup();
                }
            }
        });

        // Updated game action functions
        function viewRules() {
            openInfoPopup(
                'DisasterPoly Rules',
                'Board Game Instructions',
                {
                    description: 'Learn how to play DisasterPoly - the disaster preparedness board game!',
                    sections: [
                        {
                            title: 'Game Setup',
                            icon: 'fas fa-dice',
                            items: [
                                'Each player starts at GO with 3 lives and 0 points',
                                'Roll the dice to move around the board',
                                'Take turns in clockwise order',
                                'Keep track of your lives and points'
                            ]
                        },
                        {
                            title: 'Gameplay Rules',
                            icon: 'fas fa-gamepad',
                            items: [
                                'Landing on disaster squares costs you 1 life and 50 points',
                                'Landing on safe zones gives you 100 points',
                                'Corner squares give bonus 200 points',
                                'Passing GO gives you 50 points',
                                'Answer quiz questions for bonus points'
                            ]
                        },
                        {
                            title: 'Winning & Losing',
                            icon: 'fas fa-trophy',
                            items: [
                                'First player to complete 3 rounds wins!',
                                'If you lose all lives, you\'re eliminated',
                                'Game ends when someone completes 3 rounds or all players are eliminated',
                                'Player with most points wins if multiple complete'
                            ]
                        }
                    ]
                },
                'fas fa-dice'
            );
        }

        function viewQuizHistory() {
            openInfoPopup(
                'Quiz History',
                'Your Past Performance',
                {
                    description: 'Track your quiz progress and achievements over time.',
                    sections: [
                        {
                            title: 'Recent Scores',
                            icon: 'fas fa-chart-line',
                            items: [
                                'Last Quiz: 85% - Safety Expert Badge Earned',
                                'Previous Quiz: 72% - Good Progress',
                                'Average Score: 78%',
                                'Best Score: 95% - Quiz Master Badge'
                            ]
                        },
                        {
                            title: 'Achievements Unlocked',
                            icon: 'fas fa-trophy',
                            items: [
                                'Quiz Master - Perfect score achieved',
                                'Safety Expert - 80%+ score achieved',
                                'Preparedness Pro - 100+ points in single quiz',
                                'Consistent Learner - 5 quizzes completed'
                            ]
                        }
                    ],
                    tips: [
                        'Take quizzes regularly to improve your disaster preparedness knowledge',
                        'Review incorrect answers to learn from mistakes'
                    ]
                },
                'fas fa-history'
            );
        }

        function viewCityGuide() {
            openInfoPopup(
                'City Building Guide',
                'Build Disaster-Resilient Communities',
                {
                    description: 'Learn how to design and manage cities that can withstand natural disasters through strategic planning and infrastructure development.',
                    sections: [
                        {
                            title: 'Pre-Disaster Phase',
                            icon: 'fas fa-hard-hat',
                            items: [
                                'Place fire stations every 10 blocks for rapid response',
                                'Build hospitals near residential areas',
                                'Create multiple evacuation routes',
                                'Reinforce critical infrastructure against disasters',
                                'Install early warning systems',
                                'Develop emergency shelters'
                            ]
                        },
                        {
                            title: 'During Disaster',
                            icon: 'fas fa-exclamation-triangle',
                            items: [
                                'Deploy first responders efficiently',
                                'Manage water and power systems',
                                'Minimize civilian casualties',
                                'Coordinate emergency services',
                                'Maintain communication networks',
                                'Execute evacuation plans'
                            ]
                        },
                        {
                            title: 'Post-Disaster Recovery',
                            icon: 'fas fa-tools',
                            items: [
                                'Clear debris systematically',
                                'Rebuild stronger infrastructure',
                                'Support community recovery programs',
                                'Learn from the disaster experience',
                                'Update emergency plans',
                                'Strengthen building codes'
                            ]
                        }
                    ],
                    highlights: [
                        'Strategic placement of emergency services can reduce response times by up to 50%',
                        'Multiple evacuation routes prevent bottlenecks during emergencies'
                    ]
                },
                'fas fa-city'
            );
        }

        // Quiz questions data
        const quizQuestions = [
            {
                question: "What is the most important thing to do during an earthquake?",
                options: ["Run outside immediately", "Drop, cover, and hold on", "Stand in a doorway", "Look for the nearest exit"],
                correct: 1,
                points: 10
            },
            {
                question: "How many days of water should you store for emergency preparedness?",
                options: ["1 day", "3 days", "7 days", "14 days"],
                correct: 1,
                points: 10
            },
            {
                question: "What is the emergency number in India?",
                options: ["911", "100", "112", "108"],
                correct: 2,
                points: 5
            },
            {
                question: "During a flood, you should:",
                options: ["Drive through flood water", "Walk through moving water", "Move to higher ground", "Stay in the basement"],
                correct: 2,
                points: 15
            },
            {
                question: "What does CPR stand for?",
                options: ["Cardiac Pulse Recovery", "Cardiopulmonary Resuscitation", "Critical Patient Response", "Chest Pressure Relief"],
                correct: 1,
                points: 10
            },
            {
                question: "In case of a fire, you should:",
                options: ["Use elevators to escape", "Open windows for fresh air", "Stay low and crawl", "Fight the fire yourself"],
                correct: 2,
                points: 15
            },
            {
                question: "How often should you test your smoke detectors?",
                options: ["Once a year", "Every 6 months", "Once a month", "Never"],
                correct: 2,
                points: 10
            },
            {
                question: "What is the best way to purify water during an emergency?",
                options: ["Let it sit in sunlight", "Boil for 1 minute", "Add salt", "Strain through cloth"],
                correct: 1,
                points: 15
            },
            {
                question: "During a tornado, the safest place is:",
                options: ["In a car", "Basement or interior room", "Near windows", "On the roof"],
                correct: 1,
                points: 20
            },
            {
                question: "What should be in a basic first aid kit?",
                options: ["Only bandages", "Bandages, antiseptic, pain relievers", "Just medicines", "Only emergency numbers"],
                correct: 1,
                points: 10
            }
        ];

        function startDisasterPoly() {
            document.getElementById('disasterPolyGame').style.display = 'block';
            document.getElementById('quizGame').style.display = 'none';
            currentGame = 'disasterpoly';
            initializeBoard();
        }

        function startQuiz() {
            document.getElementById('quizGame').style.display = 'block';
            document.getElementById('disasterPolyGame').style.display = 'none';
            currentGame = 'quiz';
            initializeQuiz();
        }

        function initializeBoard() {
            const board = document.getElementById('gameBoard');
            const squares = [];
            
            // Create board squares
            const squareTypes = [
                {name: "START", type: "corner"},
                {name: "Flood\nZone", type: "disaster"},
                {name: "Safe\nHouse", type: "safe"},
                {name: "Fire\nAlert", type: "disaster"},
                {name: "Hospital", type: "safe"},
                {name: "Earthquake", type: "disaster"},
                {name: "Emergency\nKit", type: "safe"},
                {name: "SHELTER", type: "corner"},
                {name: "Tornado", type: "disaster"},
                {name: "First Aid", type: "safe"},
                {name: "Landslide", type: "disaster"},
                {name: "Rescue\nTeam", type: "safe"},
                {name: "Hurricane", type: "disaster"},
                {name: "Safe\nZone", type: "safe"},
                {name: "EVACUATION", type: "corner"},
                {name: "Tsunami", type: "disaster"}
            ];

            // Position squares around the board
            for (let i = 0; i < 16; i++) {
                const square = document.createElement('div');
                square.className = `board-square ${squareTypes[i].type}`;
                square.textContent = squareTypes[i].name;
                square.id = `square-${i}`;
                
                // Position calculation for a square board
                const side = Math.floor(i / 4);
                const pos = i % 4;
                
                if (side === 0) { // Top
                    square.style.left = `${pos * 120 + 40}px`;
                    square.style.top = '0px';
                } else if (side === 1) { // Right
                    square.style.right = '0px';
                    square.style.top = `${pos * 120 + 40}px`;
                } else if (side === 2) { // Bottom
                    square.style.right = `${pos * 120 + 40}px`;
                    square.style.bottom = '0px';
                } else { // Left
                    square.style.left = '0px';
                    square.style.bottom = `${pos * 120 + 40}px`;
                }
                
                board.appendChild(square);
            }
        }

        function rollDice() {
            const diceValue = Math.floor(Math.random() * 6) + 1;
            document.getElementById('diceDisplay').textContent = diceValue;
            
            // Move current player
            const player = currentPlayer === 1 ? player1 : player2;
            player.position = (player.position + diceValue) % 16;
            
            // Update display
            document.getElementById(`p${currentPlayer}Position`).textContent = player.position;
            
            // Handle square effects
            handleSquareEffect(player);
            
            // Update score display
            document.getElementById(`p${currentPlayer}Score`).textContent = player.score;
            document.getElementById(`p${currentPlayer}Lives`).textContent = player.lives;
        }

        function handleSquareEffect(player) {
            const squareElement = document.getElementById(`square-${player.position}`);
            const squareType = squareElement.className.includes('disaster') ? 'disaster' : 
                              squareElement.className.includes('safe') ? 'safe' : 'corner';
            
            switch(squareType) {
                case 'disaster':
                    player.lives--;
                    player.score = Math.max(0, player.score - 50);
                    alert(`Disaster! You lost a life and 50 points.`);
                    break;
                case 'safe':
                    player.score += 100;
                    alert(`Safe zone! You gained 100 points.`);
                    break;
                case 'corner':
                    player.score += 200;
                    alert(`Special location! You gained 200 points.`);
                    break;
            }
            
            if (player.lives <= 0) {
                alert(`Game Over for Player ${currentPlayer}!`);
            }
        }

        function endTurn() {
            currentPlayer = currentPlayer === 1 ? 2 : 1;
            alert(`Player ${currentPlayer}'s turn!`);
        }

        function initializeQuiz() {
            quizData = [...quizQuestions];
            currentQuestionIndex = 0;
            quizScore = 0;
            selectedAnswer = null;
            
            document.getElementById('totalQuestions').textContent = quizData.length;
            document.getElementById('quizResults').style.display = 'none';
            document.getElementById('questionCard').style.display = 'block';
            
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestionIndex >= quizData.length) {
                showQuizResults();
                return;
            }
            
            const question = quizData[currentQuestionIndex];
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('questionNumber').textContent = currentQuestionIndex + 1;
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('questionPoints').textContent = `+${question.points} points`;
            
            const optionsGrid = document.getElementById('optionsGrid');
            optionsGrid.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-button';
                button.textContent = option;
                button.onclick = () => selectAnswer(index);
                optionsGrid.appendChild(button);
            });
            
            document.getElementById('nextButton').disabled = true;
            selectedAnswer = null;
            
            // Update progress
            const progress = ((currentQuestionIndex) / quizData.length) * 100;
            document.getElementById('quizProgress').style.width = progress + '%';
        }

        function selectAnswer(answerIndex) {
            const question = quizData[currentQuestionIndex];
            const options = document.querySelectorAll('.option-button');
            
            // Remove previous selections
            options.forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect');
            });
            
            // Mark selected answer
            options[answerIndex].classList.add('selected');
            selectedAnswer = answerIndex;
            
            // Show correct/incorrect after selection
            setTimeout(() => {
                options[question.correct].classList.add('correct');
                if (answerIndex !== question.correct) {
                    options[answerIndex].classList.add('incorrect');
                } else {
                    quizScore += question.points;
                }
                
                document.getElementById('nextButton').disabled = false;
            }, 500);
        }

        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        function showQuizResults() {
            document.getElementById('questionCard').style.display = 'none';
            document.getElementById('quizResults').style.display = 'block';
            
            const correctCount = quizData.filter((q, i) => selectedAnswer === q.correct).length;
            
            document.getElementById('finalScore').textContent = quizScore;
            document.getElementById('correctAnswers').textContent = correctCount;
            document.getElementById('totalAnswered').textContent = quizData.length;
            
            // Award badges
            const badgesContainer = document.getElementById('badgesEarned');
            badgesContainer.innerHTML = '';
            
            const badges = [];
            if (quizScore >= 100) badges.push('Quiz Master');
            if (correctCount === quizData.length) badges.push('Perfect Score');
            if (quizScore >= 75) badges.push('Safety Expert');
            
            badges.forEach(badge => {
                const badgeElement = document.createElement('span');
                badgeElement.className = 'achievement-badge';
                badgeElement.textContent = badge;
                badgesContainer.appendChild(badgeElement);
            });
            
            // Update progress to 100%
            document.getElementById('quizProgress').style.width = '100%';
        }

        function restartQuiz() {
            initializeQuiz();
        }

        function exitQuiz() {
            document.getElementById('quizGame').style.display = 'none';
            currentGame = null;
        }

        // New Game Functions

        // SimCity: Disaster Manager
        function startCityManager() {
            alert(`Welcome to SimCity: Disaster Manager! ðŸ™ï¸

Build a resilient city that can withstand disasters:
â€¢ Plan emergency services strategically
â€¢ Create evacuation routes  
â€¢ Build reinforced structures
â€¢ Manage post-disaster recovery

Features:
âœ“ Pre-disaster planning phase
âœ“ Real-time disaster management
âœ“ Resource allocation challenges
âœ“ Community recovery scenarios

Game starting soon...`);
        }

        // Tsunami Escape
        function startTsunamiEscape() {
            alert(`Tsunami Escape Challenge! ðŸŒŠ

MISSION: Reach high ground before the tsunami hits!

Warning Signs to Watch For:
â€¢ Ocean water suddenly receding
â€¢ Loud roar from the ocean
â€¢ Ground shaking from earthquake
â€¢ Animals acting strangely

Your Tasks:
âœ“ Solve puzzles to clear escape routes
âœ“ Help others find safe paths
âœ“ Use tools to open blocked doors
âœ“ Move inland and uphill quickly

Remember: Every second counts!
Game loading...`);
        }

        function viewTsunamiTips() {
            openInfoPopup(
                'Tsunami Safety Tips',
                'Life-Saving Tsunami Preparedness',
                {
                    description: 'Tsunamis can strike with little warning. Learn the essential safety measures to protect yourself and your family.',
                    sections: [
                        {
                            title: 'Before a Tsunami',
                            icon: 'fas fa-shield-alt',
                            items: [
                                'Know your evacuation zone and routes',
                                'Plan escape routes to high ground (100+ feet elevation)',
                                'Practice evacuation drills with your family',
                                'Prepare emergency kits for quick evacuation',
                                'Learn natural warning signs',
                                'Sign up for emergency alerts'
                            ]
                        },
                        {
                            title: 'During a Tsunami',
                            icon: 'fas fa-running',
                            items: [
                                'Move inland and uphill immediately',
                                'Don\'t wait for official warnings',
                                'Stay away from the beach and coast',
                                'Help others evacuate if safely possible',
                                'Abandon your car if stuck in traffic',
                                'Get to high ground or upper floors of sturdy buildings'
                            ]
                        },
                        {
                            title: 'After a Tsunami',
                            icon: 'fas fa-exclamation-triangle',
                            items: [
                                'Stay away from damaged areas',
                                'Watch for additional waves (tsunamis come in series)',
                                'Listen for official all-clear announcements',
                                'Be careful of debris and flooding',
                                'Avoid driving through flood waters',
                                'Check for injuries and provide first aid'
                            ]
                        }
                    ],
                    warnings: [
                        'Tsunamis can travel inland for miles - don\'t think you\'re safe just because you\'re not at the beach',
                        'The first wave may not be the largest - stay away until authorities give the all-clear'
                    ],
                    tips: [
                        'If you feel a strong earthquake or see the ocean receding, evacuate immediately',
                        'A tsunami can move faster than you can run - start evacuating as soon as you recognize the signs'
                    ]
                },
                'fas fa-water'
            );
        }

        // Hurricane Hero
        function startHurricaneHero() {
            alert(`Hurricane Hero: Resource Dash! ðŸŒ€

Hurricane approaching in 48 hours!

Your Mission:
â€¢ Secure windows and doors
â€¢ Stock up on water (1 gallon per person per day)
â€¢ Gather non-perishable food
â€¢ Prepare emergency go-bags
â€¢ Help neighbors prepare

Decision Challenges:
âš¡ Limited time and resources
âš¡ Choose between personal/community needs
âš¡ Adapt to changing storm predictions
âš¡ Coordinate with emergency services

Ready to be a hero?`);
        }

        function viewHurricaneGuide() {
            openInfoPopup(
                'Hurricane Preparation Guide',
                'Essential Hurricane Preparedness Steps',
                {
                    description: 'Hurricanes give you time to prepare, but that time is limited. Follow this timeline to maximize your safety and readiness.',
                    grid: [
                        {
                            title: '72 Hours Before',
                            items: [
                                'Monitor weather updates constantly',
                                'Review and practice evacuation plans',
                                'Secure or bring in outdoor items',
                                'Stock up on supplies (food, water, medicine)',
                                'Fill up vehicle gas tanks',
                                'Withdraw cash for emergencies'
                            ]
                        },
                        {
                            title: '48 Hours Before',
                            items: [
                                'Board up windows with plywood',
                                'Fill bathtubs and containers with water',
                                'Charge all electronic devices',
                                'Prepare to evacuate if ordered',
                                'Move to interior rooms away from windows',
                                'Review insurance policies'
                            ]
                        },
                        {
                            title: '24 Hours Before',
                            items: [
                                'Stay indoors and avoid travel',
                                'Avoid using candles (use flashlights)',
                                'Keep away from windows and glass doors',
                                'Stay tuned to emergency broadcasts',
                                'Keep emergency kit accessible',
                                'Maintain communication with family'
                            ]
                        },
                        {
                            title: 'During the Storm',
                            items: [
                                'Stay in the safest room (interior, away from windows)',
                                'Do not go outside during the eye',
                                'Listen for tornado warnings',
                                'Avoid flooded roads and areas',
                                'Use battery-powered radio for updates',
                                'Stay calm and patient'
                            ]
                        }
                    ],
                    warnings: [
                        'The eye of the hurricane is NOT the end - devastating winds will return from the opposite direction',
                        'Storm surge can be the most deadly aspect of a hurricane'
                    ],
                    tips: [
                        'One gallon of water per person per day for at least 3 days',
                        'Have a battery-powered or hand-crank radio',
                        'Keep important documents in waterproof containers'
                    ]
                },
                'fas fa-wind'
            );
        }

        // Wildfire Watch
        function startWildfireWatch() {
            alert(`Wildfire Watch - Incident Command! ðŸ”¥

You are the Incident Commander!

Your Resources:
â€¢ Ground firefighting crews
â€¢ Air tankers and helicopters
â€¢ Bulldozers for firebreaks
â€¢ Emergency evacuation teams

Challenges:
âš¡ Changing wind directions
âš¡ Limited water resources
âš¡ Civilian evacuations
âš¡ Protecting structures
âš¡ New fire outbreaks

Strategic decisions await you!
Command post activating...`);
        }

        function viewFireStrategy() {
            openInfoPopup(
                'Wildfire Strategy Guide',
                'Incident Command Best Practices',
                {
                    description: 'Effective wildfire management requires strategic thinking, rapid decision-making, and coordinated response efforts.',
                    sections: [
                        {
                            title: 'Initial Assessment',
                            icon: 'fas fa-search',
                            items: [
                                'Check wind speed and direction (critical factor)',
                                'Identify fuel sources (dry vegetation, structures)',
                                'Locate available water sources',
                                'Map primary and secondary evacuation routes',
                                'Assess terrain and accessibility',
                                'Evaluate weather forecasts'
                            ]
                        },
                        {
                            title: 'Tactical Operations',
                            icon: 'fas fa-fire-extinguisher',
                            items: [
                                'Create firebreaks to stop fire spread',
                                'Deploy air support for spot fires and remote areas',
                                'Protect critical infrastructure (hospitals, schools)',
                                'Coordinate evacuation zones and timing',
                                'Position crews for maximum effectiveness',
                                'Establish water supply and access routes'
                            ]
                        },
                        {
                            title: 'Adaptive Management',
                            icon: 'fas fa-sync-alt',
                            items: [
                                'Monitor weather changes constantly',
                                'Reposition crews based on fire behavior',
                                'Maintain communication with all teams',
                                'Plan for worst-case scenarios',
                                'Adjust tactics based on fire progression',
                                'Coordinate with mutual aid resources'
                            ]
                        }
                    ],
                    warnings: [
                        'Wind changes can dramatically alter fire behavior in minutes',
                        'Never put crews in positions where they cannot escape safely'
                    ],
                    tips: [
                        'The first hour is critical - aggressive initial attack often prevents large fires',
                        'Always have an escape route and safety zone identified'
                    ]
                },
                'fas fa-fire'
            );
        }

        // Quake Response
        function startQuakeResponse() {
            alert(`Earthquake Search & Rescue! ðŸ—ï¸

Major earthquake just struck!

Your Mission:
â€¢ Search collapsed buildings safely
â€¢ Assess structural integrity
â€¢ Rescue trapped civilians
â€¢ Provide emergency first aid

Critical Skills:
âœ“ Risk assessment of damaged structures
âœ“ Safe debris removal techniques
âœ“ Triage and first aid procedures
âœ“ Team coordination under pressure

Time is critical - lives depend on you!
Rescue operation starting...`);
        }

        function viewRescueGuide() {
            openInfoPopup(
                'Search & Rescue Guide',
                'Emergency Response Protocols',
                {
                    description: 'Search and rescue operations save lives, but they must be conducted safely and systematically to be effective.',
                    sections: [
                        {
                            title: 'Safety First Principles',
                            icon: 'fas fa-hard-hat',
                            items: [
                                'Assess building stability before entering',
                                'Use proper protective equipment (PPE)',
                                'Work in teams of at least 2, never alone',
                                'Watch for aftershocks and secondary hazards',
                                'Establish communication with command post',
                                'Know your escape routes at all times'
                            ]
                        },
                        {
                            title: 'Search Techniques',
                            icon: 'fas fa-search',
                            items: [
                                'Call out loudly and listen for responses',
                                'Use systematic search patterns (grid method)',
                                'Mark searched areas clearly with spray paint',
                                'Document survivor locations and conditions',
                                'Use search dogs when available',
                                'Check voids and protected spaces first'
                            ]
                        },
                        {
                            title: 'Rescue Priorities',
                            icon: 'fas fa-sort-amount-down',
                            items: [
                                'Most severely injured first (life-threatening)',
                                'Easiest rescues when injury severity is equal',
                                'Consider available resources and time',
                                'Don\'t risk more lives unnecessarily',
                                'Coordinate with medical teams',
                                'Document all rescue activities'
                            ]
                        }
                    ],
                    warnings: [
                        'Do not attempt rescues beyond your training and capabilities',
                        'Unstable structures can collapse without warning'
                    ],
                    tips: [
                        'Listen carefully - trapped victims may be weak and barely audible',
                        'Use the CERT marking system to track search progress'
                    ]
                },
                'fas fa-hands-helping'
            );
        }

        // The Floodplain Project
        function startFloodplainProject() {
            alert(`The Floodplain Project! ðŸ’§

Welcome to our collaborative community!

Choose Your Role:
ðŸ”§ Engineer - Design flood defenses
ðŸ‘¥ Community Leader - Organize drills
ðŸ  Homeowner - Protect your property
ðŸš¨ Emergency Manager - Plan responses

Seasonal Challenges:
â€¢ Spring: Heavy rains and snowmelt
â€¢ Summer: Flash flood risks
â€¢ Fall: Hurricane season
â€¢ Winter: Ice jam flooding

Together we build resilience!
Community meeting starting...`);
        }

        function viewFloodGuide() {
            openInfoPopup(
                'Flood Prevention & Management',
                'Building Community Flood Resilience',
                {
                    description: 'Comprehensive flood management requires engineering solutions, community preparedness, individual actions, and long-term planning.',
                    sections: [
                        {
                            title: 'Engineering Solutions',
                            icon: 'fas fa-tools',
                            items: [
                                'Build levees and floodwalls in high-risk areas',
                                'Improve drainage systems and storm sewers',
                                'Create retention ponds and detention basins',
                                'Restore natural floodplains and wetlands',
                                'Install flood barriers and gates',
                                'Upgrade infrastructure to handle extreme weather'
                            ]
                        },
                        {
                            title: 'Community Preparedness',
                            icon: 'fas fa-users',
                            items: [
                                'Conduct regular evacuation drills',
                                'Establish emergency shelters and staging areas',
                                'Create robust communication networks',
                                'Train local response teams and volunteers',
                                'Develop early warning systems',
                                'Create flood response plans'
                            ]
                        },
                        {
                            title: 'Individual Actions',
                            icon: 'fas fa-home',
                            items: [
                                'Elevate utilities above potential flood levels',
                                'Install sump pumps and backflow valves',
                                'Maintain emergency supply kits',
                                'Know evacuation routes and shelter locations',
                                'Purchase flood insurance',
                                'Create family emergency communication plans'
                            ]
                        },
                        {
                            title: 'Long-term Resilience',
                            icon: 'fas fa-seedling',
                            items: [
                                'Implement sustainable land use planning',
                                'Develop green infrastructure solutions',
                                'Regular maintenance and system updates',
                                'Community education and awareness programs',
                                'Climate adaptation planning',
                                'Post-flood recovery and improvement strategies'
                            ]
                        }
                    ],
                    tips: [
                        'Six inches of moving water can knock you down',
                        'Turn Around, Don\'t Drown - most flood deaths occur in vehicles',
                        'Flash floods can occur with little to no warning'
                    ]
                },
                'fas fa-tint'
            );
        }

        // Additional Active Disaster Management Games

        // Stop Disasters! (UNDRR)
        function startStopDisasters() {
            alert(`Stop Disasters! - UNDRR Official Game ðŸŒ

Welcome, Disaster Risk Manager!

Your Mission:
â€¢ Build safer communities
â€¢ Reduce disaster impacts
â€¢ Manage time and resource constraints
â€¢ Handle multiple disaster types

Disasters to Manage:
ðŸŒŠ Tsunamis - Coastal warning systems
ðŸ”¥ Wildfires - Firebreaks and evacuation
ðŸŒ€ Hurricanes - Shelters and preparations  
ðŸ—ï¸ Earthquakes - Building codes and safety
ðŸ’§ Floods - Drainage and barriers

Start building resilience now!`);
        }

        function viewUNDRRGuide() {
            openInfoPopup(
                'UNDRR Disaster Risk Reduction Guide',
                'Sendai Framework for Disaster Risk Reduction',
                {
                    description: 'The United Nations Office for Disaster Risk Reduction (UNDRR) provides the global framework for reducing disaster risks and building resilient communities.',
                    sections: [
                        {
                            title: 'Sendai Framework Priorities',
                            icon: 'fas fa-list-ol',
                            items: [
                                '1. Understanding disaster risk',
                                '2. Strengthening disaster risk governance',
                                '3. Investing in disaster risk reduction',
                                '4. Enhancing disaster preparedness for effective response'
                            ]
                        },
                        {
                            title: 'Key Strategies',
                            icon: 'fas fa-strategy',
                            items: [
                                'Build back better after disasters',
                                'Mainstream disaster risk reduction in policies',
                                'Ensure inclusive and accessible approaches',
                                'Promote international cooperation',
                                'Strengthen early warning systems',
                                'Reduce underlying disaster risk factors'
                            ]
                        },
                        {
                            title: 'Community Actions',
                            icon: 'fas fa-users',
                            items: [
                                'Risk-informed development planning',
                                'Implement multi-hazard early warning systems',
                                'Conduct public awareness and education campaigns',
                                'Use multi-hazard approach to planning',
                                'Strengthen local governance for disaster risk management',
                                'Build community resilience and social cohesion'
                            ]
                        }
                    ],
                    highlights: [
                        'Every $1 invested in disaster risk reduction saves $4 in disaster response',
                        'The Sendai Framework aims to substantially reduce disaster risk and losses by 2030'
                    ],
                    tips: [
                        'Disaster risk reduction is everyone\'s responsibility',
                        'Prevention and preparedness are more cost-effective than response and recovery'
                    ]
                },
                'fas fa-globe-americas'
            );
        }

        // Disaster Response Game
        function startDisasterResponse() {
            alert(`Disaster Response Game - Quick Decision Challenge! ðŸš¨

SITUATION: Multiple emergencies emerging!

Your Challenges:
âš¡ Limited information available
âš¡ Time-critical decisions required
âš¡ Resource allocation under pressure
âš¡ Coordinating multiple response teams

Crisis Scenarios:
ðŸ”¥ Wildfire spreading rapidly
ðŸŒ€ Hurricane approaching coast
ðŸ¦  Pandemic outbreak response
ðŸŒŠ Flash flood warnings

Every second counts - lives depend on your decisions!
Emergency Operations Center activating...`);
        }

        function viewResponseGuide() {
            openInfoPopup(
                'Emergency Response Protocol',
                'Systematic Disaster Response Framework',
                {
                    description: 'Effective disaster response follows a structured timeline with specific priorities and actions for each phase.',
                    grid: [
                        {
                            title: 'Immediate Response (0-72 hours)',
                            items: [
                                'Assess situation and gather intelligence',
                                'Activate emergency operations center',
                                'Deploy first responders and emergency teams',
                                'Establish communication networks',
                                'Evacuate at-risk populations',
                                'Provide immediate life safety measures'
                            ]
                        },
                        {
                            title: 'Short-term Response (3-30 days)',
                            items: [
                                'Continue search and rescue operations',
                                'Provide emergency shelter and humanitarian aid',
                                'Restore critical infrastructure (power, water)',
                                'Coordinate with relief organizations',
                                'Establish temporary services',
                                'Begin damage assessment'
                            ]
                        },
                        {
                            title: 'Long-term Recovery (30+ days)',
                            items: [
                                'Rebuild damaged infrastructure stronger',
                                'Support community recovery programs',
                                'Implement lessons learned',
                                'Enhance future preparedness',
                                'Restore economic activity',
                                'Address long-term housing needs'
                            ]
                        },
                        {
                            title: 'Mitigation & Preparedness',
                            items: [
                                'Conduct post-disaster assessments',
                                'Update emergency plans',
                                'Strengthen building codes',
                                'Improve early warning systems',
                                'Train response personnel',
                                'Build community resilience'
                            ]
                        }
                    ],
                    highlights: [
                        'The first 72 hours are critical for life safety operations',
                        'Recovery can take months to years depending on disaster severity'
                    ],
                    tips: [
                        'Coordination between all levels of government is essential',
                        'Community involvement accelerates recovery'
                    ]
                },
                'fas fa-stopwatch'
            );
        }

        // Road to Safety
        function startRoadToSafety() {
            alert(`Road to Safety - Choose Your Avatar! ðŸ›£ï¸

Select your character and experience disaster preparedness from different perspectives:

ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ Single parent with young children
ðŸ‘´ Elderly person with mobility issues  
ðŸ§‘â€ðŸ¦¯ Person with visual impairment
ðŸ  Homeowner in flood-prone area
ðŸ‘¨â€ðŸ’¼ Office worker downtown
ðŸ§‘â€ðŸŒ¾ Rural farm family

Each avatar faces unique challenges:
â€¢ Different resources and constraints
â€¢ Various support systems
â€¢ Diverse preparedness needs
â€¢ Real-world obstacles and barriers

Experience empathy through gameplay!`);
        }

        function viewSafetyGuide() {
            openInfoPopup(
                'Inclusive Safety Planning',
                'Emergency Preparedness for All',
                {
                    description: 'Learn how to create emergency plans that consider all community members and their unique needs.',
                    sections: [
                        {
                            title: 'Consider All Populations',
                            icon: 'fas fa-users',
                            items: [
                                'People with disabilities and special needs',
                                'Elderly adults and young children',
                                'Non-English speakers and diverse cultures',
                                'Low-income families with limited resources',
                                'Pet owners and service animal handlers'
                            ]
                        },
                        {
                            title: 'Accessibility Needs',
                            icon: 'fas fa-universal-access',
                            items: [
                                'Visual and audio emergency alert systems',
                                'Wheelchair accessible shelters and routes',
                                'Medical equipment backup power supplies',
                                'Transportation assistance for evacuation',
                                'Service animal accommodations and care'
                            ]
                        },
                        {
                            title: 'Community Support',
                            icon: 'fas fa-hands-helping',
                            items: [
                                'Neighbor helping networks and buddy systems',
                                'Cultural and language considerations',
                                'Address economic barriers to preparedness',
                                'Overcome social isolation factors',
                                'Build inclusive community partnerships'
                            ]
                        }
                    ]
                },
                'fas fa-shield-alt'
            );
        }

        // Disaster Mind
        function startDisasterMind() {
            alert(`Disaster Mind - FEMA Simulation Training! ðŸ§ 

Welcome to iThrive Sim - FEMA Partnership

Simulation Modules:
ðŸ  Household Preparedness
ðŸ¢ Workplace Emergency Planning
ðŸ« School Safety Protocols
ðŸ¥ Healthcare Facility Response
ðŸ™ï¸ Community Coordination

Critical Thinking Challenges:
â€¢ Resource prioritization decisions
â€¢ Multi-hazard planning scenarios
â€¢ Stakeholder coordination
â€¢ Risk communication strategies
â€¢ Recovery planning processes

FEMA standards met - begin training!`);
        }

        function viewFEMAGuide() {
            openInfoPopup(
                'FEMA Preparedness Guidelines',
                'Building National Resilience',
                {
                    description: 'FEMA promotes a whole community approach to emergency preparedness, emphasizing that preparedness is everyone\'s responsibility.',
                    sections: [
                        {
                            title: 'Individual/Family Preparedness',
                            icon: 'fas fa-home',
                            items: [
                                'Make a family emergency plan',
                                'Build an emergency supply kit',
                                'Stay informed about hazards in your area',
                                'Get involved in community preparedness',
                                'Practice your emergency plan regularly',
                                'Know your evacuation routes'
                            ]
                        },
                        {
                            title: 'Business Preparedness',
                            icon: 'fas fa-building',
                            items: [
                                'Develop business continuity planning',
                                'Provide employee emergency training',
                                'Protect critical infrastructure and assets',
                                'Create recovery procedures and protocols',
                                'Establish communication systems',
                                'Partner with local emergency management'
                            ]
                        },
                        {
                            title: 'Community Preparedness',
                            icon: 'fas fa-users',
                            items: [
                                'Use whole community approach to planning',
                                'Foster public-private partnerships',
                                'Conduct capability assessments',
                                'Implement exercise and training programs',
                                'Build social cohesion and networks',
                                'Address needs of vulnerable populations'
                            ]
                        }
                    ],
                    highlights: [
                        'Ready.gov provides comprehensive preparedness resources',
                        'FEMA emphasizes building capabilities before disasters strike'
                    ],
                    tips: [
                        'Start with simple steps - make a plan and build a kit',
                        'Preparedness is an ongoing process, not a one-time event'
                    ]
                },
                'fas fa-shield-alt'
            );
        }

        // FloodQuest
        function startFloodQuest() {
            alert(`FloodQuest - Urban Flooding Challenge! ðŸŒŠ

Mission: Protect your city from flooding!

Flood Scenarios:
ðŸŒ§ï¸ Heavy rainfall events
â„ï¸ Rapid snowmelt
ðŸŒŠ Storm surge flooding
ðŸ—ï¸ Dam or levee failure
ðŸš° Infrastructure flooding

Your Tools:
â€¢ Flood prediction models
â€¢ Early warning systems
â€¢ Evacuation planning
â€¢ Infrastructure improvements
â€¢ Community education

Navigate the complexities of urban flood management!`);
        }

        function viewFloodQuestGuide() {
            openInfoPopup(
                'Urban Flood Preparedness',
                'Comprehensive Flood Management Strategy',
                {
                    description: 'Master urban flood preparedness with strategic planning, emergency response, and community recovery methods.',
                    sections: [
                        {
                            title: 'Planning Phase',
                            icon: 'fas fa-map-marked-alt',
                            items: [
                                'Identify flood-prone areas and risk zones',
                                'Develop multiple evacuation routes',
                                'Improve drainage and stormwater systems',
                                'Create temporary flood barriers and defenses',
                                'Map critical infrastructure vulnerabilities'
                            ]
                        },
                        {
                            title: 'Response Phase',
                            icon: 'fas fa-exclamation-triangle',
                            items: [
                                'Monitor weather conditions continuously',
                                'Issue timely warnings to all residents',
                                'Coordinate safe evacuations efficiently',
                                'Deploy emergency resources strategically',
                                'Maintain communication with all agencies'
                            ]
                        },
                        {
                            title: 'Recovery Phase',
                            icon: 'fas fa-tools',
                            items: [
                                'Assess damage safely before re-entry',
                                'Restore essential services quickly',
                                'Support affected residents and businesses',
                                'Implement lessons learned improvements',
                                'Build flood-resilient infrastructure'
                            ]
                        },
                        {
                            title: 'Community Actions',
                            icon: 'fas fa-hand-holding-water',
                            items: [
                                'Never drive through flood water ("Turn Around, Don\'t Drown")',
                                'Stay informed during weather events',
                                'Maintain property drainage systems',
                                'Support flood-resilient development policies'
                            ]
                        }
                    ]
                },
                'fas fa-water'
            );
        }

        // Disaster Quest Escape Room
        function startDisasterQuest() {
            alert(`Disaster Quest - Escape Room Challenge! ðŸšª

SCENARIO: You're trapped in a building during a disaster!

Your Mission:
â° Escape within the time limit
ðŸ§© Solve evacuation puzzles
ðŸŽ’ Choose correct emergency supplies
ðŸšª Find safe exit routes
ðŸ”Œ Shut off utilities safely

Disaster Scenarios:
ðŸ”¥ Building fire - find safe exits
ðŸ—ï¸ Earthquake - avoid falling debris  
ðŸ’§ Flood - reach higher ground
ðŸ’¨ Chemical spill - avoid contamination

Work together - every second counts!
Room sealed... escape sequence initiated!`);
        }

        function viewEscapeGuide() {
            openInfoPopup(
                'Escape Room Strategy Guide',
                'Emergency Evacuation and Problem-Solving',
                {
                    description: 'Master escape room challenges while learning real emergency preparedness and evacuation skills.',
                    sections: [
                        {
                            title: 'Team Coordination',
                            icon: 'fas fa-users-cog',
                            items: [
                                'Assign specific roles to team members',
                                'Communicate findings clearly and quickly',
                                'Work on different puzzles simultaneously',
                                'Share important discoveries immediately',
                                'Establish clear leadership for decisions'
                            ]
                        },
                        {
                            title: 'Puzzle Solving Strategy',
                            icon: 'fas fa-puzzle-piece',
                            items: [
                                'Look for patterns and logical connections',
                                'Read all instructions carefully first',
                                'Try different combinations systematically',
                                'Don\'t overthink simple solutions',
                                'Keep track of what you\'ve already tried'
                            ]
                        },
                        {
                            title: 'Emergency Knowledge Application',
                            icon: 'fas fa-route',
                            items: [
                                'Know basic evacuation procedures',
                                'Understand utility shut-off locations',
                                'Recognize emergency signals and alarms',
                                'Practice situational awareness constantly',
                                'Apply real-world safety protocols'
                            ]
                        },
                        {
                            title: 'Stay Calm Under Pressure',
                            icon: 'fas fa-brain',
                            items: [
                                'Manage time pressure effectively',
                                'Support struggling team members',
                                'Focus on logical problem-solving',
                                'Celebrate small victories for morale',
                                'Take deep breaths when overwhelmed'
                            ]
                        }
                    ]
                },
                'fas fa-door-open'
            );
        }

        // Survival Kit Builder
        function startKitBuilder() {
            alert(`Survival Kit Builder - Budget Challenge! ðŸŽ’

Budget: $200 | Time Limit: 10 minutes

Essential Categories:
ðŸ’§ Water & Hydration (1 gal/person/day)
ðŸž Food & Nutrition (3-day supply)
ðŸ”¦ Light & Power (flashlights, batteries)
ðŸ¥ First Aid & Medicine
ðŸ“» Communication & Information
ðŸ§¥ Shelter & Warmth

Disaster-Specific Additions:
ðŸŒ€ Hurricane: Tarps, rope, duct tape
ðŸ”¥ Wildfire: N95 masks, fire extinguisher
ðŸ—ï¸ Earthquake: Crowbar, work gloves
â„ï¸ Winter Storm: Blankets, hand warmers

Choose wisely - lives depend on your kit!`);
        }

        function viewKitGuide() {
            openInfoPopup(
                'Emergency Kit Essentials',
                'Build Your Survival Kit',
                {
                    description: 'A well-stocked emergency kit can sustain you and your family for at least 72 hours during a disaster when normal services may be unavailable.',
                    sections: [
                        {
                            title: 'Basic Supplies (Everyone Needs)',
                            icon: 'fas fa-toolbox',
                            items: [
                                'Water: 1 gallon per person per day for 3 days minimum',
                                'Non-perishable food: 3-day supply per person',
                                'Battery-powered or hand crank radio',
                                'Flashlight and extra batteries',
                                'First aid kit and prescription medications',
                                'Whistle for signaling help',
                                'Cell phone with chargers and backup battery',
                                'Cash in small bills and coins',
                                'Emergency contact information',
                                'Copies of important documents (waterproof container)'
                            ]
                        },
                        {
                            title: 'Additional Important Items',
                            icon: 'fas fa-plus',
                            items: [
                                'Infant formula, diapers, baby supplies',
                                'Pet food, water, and supplies',
                                'Tools: crowbar, duct tape, plastic sheeting',
                                'Local area maps',
                                'Sleeping bags and blankets',
                                'Change of clothing and sturdy shoes',
                                'Fire extinguisher and waterproof matches',
                                'Personal hygiene items and sanitation supplies'
                            ]
                        },
                        {
                            title: 'Kit Maintenance',
                            icon: 'fas fa-sync-alt',
                            items: [
                                'Replace expired food and water every 6 months',
                                'Test and replace batteries regularly',
                                'Update documents and emergency contacts annually',
                                'Practice using your kit and equipment',
                                'Store kit in easily accessible location',
                                'Consider multiple kits (home, work, car)'
                            ]
                        }
                    ],
                    tips: [
                        'Store at least 1 gallon of water per person per day',
                        'Choose foods that require no refrigeration, preparation, or cooking',
                        'Keep a smaller kit in your car and at work'
                    ]
                },
                'fas fa-suitcase'
            );
        }

        // Rescue Mission Simulator
        function startRescueMission() {
            alert(`Rescue Mission Simulator - Choose Your Role! ðŸš‘

Available Roles:
ðŸš’ Firefighter - Fire suppression & rescue
ðŸš‘ Paramedic - Medical emergency response
ðŸ‘¨â€âš•ï¸ Emergency Medical Technician - Patient care
ðŸ‘·â€â™‚ï¸ Search & Rescue Specialist - Find survivors
ðŸ‘®â€â™€ï¸ Emergency Coordinator - Manage operations
ðŸ§‘â€ðŸš’ Community Volunteer - Support operations

Mission Objectives:
â° Respond within golden hour
ðŸ¥ Triage patients by severity
ðŸš¨ Coordinate with other teams
ðŸ“ž Communicate with dispatch
ðŸ†˜ Prioritize life-saving actions

Emergency dispatch activated!`);
        }

        function viewRescueProtocol() {
            openInfoPopup(
                'First Responder Protocol',
                'Emergency Response Procedures',
                {
                    description: 'First responders follow established protocols to ensure safe and effective emergency operations.',
                    sections: [
                        {
                            title: 'Scene Safety (First Priority)',
                            icon: 'fas fa-shield-alt',
                            items: [
                                'Assess for immediate hazards (fire, chemicals, unstable structures)',
                                'Secure the scene and establish perimeter',
                                'Establish incident command post',
                                'Request additional resources as needed',
                                'Ensure responder safety first',
                                'Document scene conditions'
                            ]
                        },
                        {
                            title: 'Patient Triage System',
                            icon: 'fas fa-user-md',
                            items: [
                                'Red (Immediate) - Life-threatening injuries requiring immediate care',
                                'Yellow (Delayed) - Serious but stable injuries, can wait',
                                'Green (Walking wounded) - Minor injuries, self-care possible',
                                'Black (Deceased) - No vital signs, beyond medical help',
                                'Use triage tags to track patient status',
                                'Reassess patients regularly'
                            ]
                        },
                        {
                            title: 'Response Priorities',
                            icon: 'fas fa-list-ol',
                            items: [
                                '1. Life safety (civilian and responder)',
                                '2. Incident stabilization',
                                '3. Property conservation',
                                '4. Environmental protection',
                                '5. Restoration of services',
                                '6. Investigation and documentation'
                            ]
                        },
                        {
                            title: 'Communication & Coordination',
                            icon: 'fas fa-radio',
                            items: [
                                'Use clear, concise language',
                                'Confirm all transmissions',
                                'Maintain situational awareness',
                                'Follow incident command system',
                                'Share critical information with all agencies',
                                'Document all actions taken'
                            ]
                        }
                    ],
                    warnings: [
                        'Scene safety is paramount - don\'t become a victim yourself',
                        'Triage decisions may be difficult but save the most lives possible'
                    ]
                },
                'fas fa-first-aid'
            );
        }

        // Disaster Trivia Battle
        function startTriviaBattle() {
            alert(`Disaster Trivia Battle - Join the Competition! ðŸ†

Game Modes:
âš¡ Lightning Round - 30 seconds per question
ðŸ”¥ Survival Mode - Wrong answer eliminates
ðŸ† Tournament - Bracket-style competition
ðŸ‘¥ Team Battle - Collaborative play

Power-Ups Available:
ðŸ” 50/50 - Remove two wrong answers
â° Extra Time - Add 15 seconds
ðŸ“ž Phone a Friend - Get expert help
ðŸ‘¥ Ask the Audience - Community vote

Sample Questions:
"During a flood, what's the safest action?"
"How much water per person per day for emergencies?"
"What does the acronym CERT stand for?"

Ready to test your disaster knowledge?`);
        }

        function viewTriviaGuide() {
            openInfoPopup(
                'Trivia Battle Rules',
                'Competitive Quiz Game Instructions',
                {
                    description: 'Master the rules of Disaster Trivia Battle and compete with confidence!',
                    sections: [
                        {
                            title: 'Scoring System',
                            icon: 'fas fa-chart-line',
                            items: [
                                'Correct answer: +10 points',
                                'Speed bonus: +1-5 points (faster = more points)',
                                'Power-up usage: No penalty',
                                'Wrong answer: 0 points',
                                'Bonus rounds: Double points'
                            ]
                        },
                        {
                            title: 'Power-Up Rules',
                            icon: 'fas fa-magic',
                            items: [
                                'Each player gets 3 power-ups per game',
                                '50/50: Remove two wrong answers',
                                'Extra Time: Add 15 seconds to timer',
                                'Phone a Friend: Get expert help',
                                'Ask Audience: See community vote results'
                            ]
                        },
                        {
                            title: 'Winning Conditions',
                            icon: 'fas fa-trophy',
                            items: [
                                'Highest score wins the round',
                                'Sudden death round for ties',
                                'Tournament: Advance through brackets',
                                'Team mode: Combined team scores',
                                'Unlock achievements and badges'
                            ]
                        },
                        {
                            title: 'Question Categories',
                            icon: 'fas fa-question-circle',
                            items: [
                                'Natural disasters (earthquakes, floods, etc.)',
                                'Emergency response protocols',
                                'First aid basics and safety',
                                'Community preparedness',
                                'Disaster myths vs facts'
                            ]
                        }
                    ]
                },
                'fas fa-brain'
            );
        }

        function viewDrillGuide() {
            openInfoPopup(
                'Evacuation Drill Best Practices',
                'Effective Emergency Drill Management',
                {
                    description: 'Regular evacuation drills save lives by building muscle memory and identifying problems before real emergencies occur.',
                    sections: [
                        {
                            title: 'Drill Preparation',
                            icon: 'fas fa-clipboard-list',
                            items: [
                                'Know all primary and secondary exit routes',
                                'Identify designated assembly points',
                                'Practice drills regularly (monthly recommended)',
                                'Train drill wardens and floor coordinators',
                                'Post clear evacuation maps throughout building',
                                'Announce drill schedule to building occupants'
                            ]
                        },
                        {
                            title: 'During Evacuation',
                            icon: 'fas fa-running',
                            items: [
                                'Stay calm and move quickly but safely',
                                'Use stairs, never elevators during emergencies',
                                'Help those who need assistance',
                                'Don\'t stop for personal items',
                                'Close doors behind you to slow fire spread',
                                'Follow designated evacuation routes'
                            ]
                        },
                        {
                            title: 'Leadership Actions',
                            icon: 'fas fa-bullhorn',
                            items: [
                                'Give clear, calm directions',
                                'Account for all personnel at assembly point',
                                'Communicate with emergency services',
                                'Manage crowd flow and prevent bottlenecks',
                                'Handle special situations (disabilities, visitors)',
                                'Coordinate with building management'
                            ]
                        },
                        {
                            title: 'Post-Drill Assessment',
                            icon: 'fas fa-chart-line',
                            items: [
                                'Conduct accurate headcount',
                                'Time the evacuation process',
                                'Identify areas for improvement',
                                'Update procedures based on lessons learned',
                                'Provide feedback to all participants',
                                'Document drill results and improvements'
                            ]
                        }
                    ],
                    tips: [
                        'Practice makes perfect - regular drills save lives',
                        'Include people with disabilities in drill planning',
                        'Consider different scenarios (blocked exits, weather)'
                    ]
                },
                'fas fa-door-open'
            );
        }

        // Disaster Detective
        function startDetectiveGame() {
            alert(`Disaster Detective - Myth vs Fact Investigation! ðŸ”

Case Files Open:

ðŸ“‹ CASE 1: "Earthquake Doorway Safety"
Rumor: "Always stand in doorways during earthquakes"
Your mission: Investigate the truth!

ðŸ“‹ CASE 2: "Tornado Weather Myths"  
Rumor: "Open windows during tornadoes to equalize pressure"
Your mission: Fact or fiction?

ðŸ“‹ CASE 3: "Hurricane Category Confusion"
Rumor: "Only Category 5 hurricanes are dangerous"
Your mission: Uncover the reality!

Detective Tools:
ðŸ” Evidence scanner
ðŸ“š Scientific research database
ðŸ‘¥ Expert witness interviews
ðŸ“Š Statistical analysis

Solve cases to unlock new investigations!`);
        }

        function viewFactGuide() {
            openInfoPopup(
                'Disaster Myths vs Facts',
                'Separating Truth from Fiction',
                {
                    description: 'Misinformation about disasters can be deadly. Learn the facts to make life-saving decisions.',
                    sections: [
                        {
                            title: 'Earthquake Myths & Facts',
                            icon: 'fas fa-house-damage',
                            items: [
                                'âŒ MYTH: Stand in doorways (outdated 1900s advice)',
                                'âœ… FACT: Drop, Cover, and Hold On under sturdy furniture',
                                'âŒ MYTH: "Triangle of Life" saves lives (dangerous myth)',
                                'âœ… FACT: Get under sturdy desk/table or cover head and neck',
                                'âŒ MYTH: Large earthquakes always cause tsunami',
                                'âœ… FACT: Only underwater or coastal earthquakes may cause tsunami'
                            ]
                        },
                        {
                            title: 'Tornado Myths & Facts',
                            icon: 'fas fa-wind',
                            items: [
                                'âŒ MYTH: Open windows to equalize pressure',
                                'âœ… FACT: Get to lowest floor, interior room immediately',
                                'âŒ MYTH: Overpasses provide safe shelter',
                                'âœ… FACT: Stay in vehicle, drive away perpendicular to tornado',
                                'âŒ MYTH: Tornadoes don\'t hit cities or mountains',
                                'âœ… FACT: Tornadoes can occur anywhere, including urban areas'
                            ]
                        },
                        {
                            title: 'Flood Myths & Facts',
                            icon: 'fas fa-water',
                            items: [
                                'âŒ MYTH: Cars can drive through any flood depth',
                                'âœ… FACT: Turn around, don\'t drown - 6 inches can sweep you away',
                                'âŒ MYTH: Flash floods are predictable',
                                'âœ… FACT: Flash floods can occur anywhere, anytime',
                                'âŒ MYTH: Flowing water is always safe to cross',
                                'âœ… FACT: 2 feet of moving water can move vehicles'
                            ]
                        },
                        {
                            title: 'Fire Myths & Facts',
                            icon: 'fas fa-fire',
                            items: [
                                'âŒ MYTH: Smoke won\'t hurt you immediately',
                                'âœ… FACT: Smoke is the #1 killer in fires, not flames',
                                'âŒ MYTH: You have lots of time to escape',
                                'âœ… FACT: Modern fires spread in 2-3 minutes',
                                'âŒ MYTH: Stay low means crawl on floor',
                                'âœ… FACT: Stay below smoke level, usually 3-4 feet high'
                            ]
                        }
                    ],
                    warnings: [
                        'Outdated advice can be deadly - verify information with official sources',
                        'Social media often spreads disaster misinformation rapidly'
                    ],
                    tips: [
                        'Always verify emergency information with official sources like NOAA, FEMA, or local emergency management',
                        'When in doubt, choose the most conservative safety action'
                    ]
                },
                'fas fa-search'
            );
        }

        // Game Filtering Function
        function filterGames(category) {
            // Remove active class from all filter options
            document.querySelectorAll('.filter-option').forEach(option => {
                option.classList.remove('active');
            });
            
            // Add active class to clicked filter
            document.querySelector(`[data-filter="${category}"]`).classList.add('active');
            
            // Get all game cards
            const gameCards = document.querySelectorAll('.game-card');
            
            gameCards.forEach(card => {
                if (category === 'all') {
                    // Show all games
                    card.style.display = 'block';
                    card.style.animation = 'fadeIn 0.5s ease-in-out';
                } else {
                    // Check if game card has the category
                    const cardCategories = card.getAttribute('data-category') || '';
                    
                    if (cardCategories.includes(category)) {
                        card.style.display = 'block';
                        card.style.animation = 'fadeIn 0.5s ease-in-out';
                    } else {
                        card.style.display = 'none';
                    }
                }
            });
            
            // Update the games grid layout
            setTimeout(() => {
                const gamesGrid = document.getElementById('gamesGrid');
                gamesGrid.style.animation = 'fadeIn 0.3s ease-in-out';
            }, 100);
        }

        // Enhanced game cards with personal progress
        function updateGameCardsWithProgress() {
            const stats = playerStats.getStats();
            const gameCards = document.querySelectorAll('.game-card');
            
            gameCards.forEach(card => {
                const gameActions = card.querySelector('.game-actions');
                if (gameActions) {
                    // Find the game ID from the onclick attribute
                    const playButton = gameActions.querySelector('.btn-primary');
                    if (playButton && playButton.onclick) {
                        const gameId = extractGameIdFromButton(playButton);
                        if (gameId && stats.gamesCompleted[gameId]) {
                            // Add progress indicator
                            const progressDiv = document.createElement('div');
                            progressDiv.style.cssText = `
                                background: rgba(76, 175, 80, 0.1);
                                padding: 8px;
                                margin-top: 10px;
                                border-radius: 8px;
                                font-size: 0.8rem;
                                text-align: center;
                                color: #4caf50;
                                font-weight: 600;
                            `;
                            progressDiv.innerHTML = `âœ… Played ${stats.gamesCompleted[gameId]} time${stats.gamesCompleted[gameId] > 1 ? 's' : ''}`;
                            
                            // Insert before game actions
                            card.querySelector('.game-content').insertBefore(progressDiv, gameActions);
                        }
                    }
                }
            });
        }

        function extractGameIdFromButton(button) {
            const onclick = button.getAttribute('onclick');
            if (!onclick) return null;
            
            // Extract game ID from function calls like startDisasterPoly(), startQuiz(), etc.
            const gameMap = {
                'startDisasterPoly': 'disasterpoly',
                'startQuiz': 'quiz',
                'startTsunamiEscape': 'tsunamiescape',
                'startHurricaneHero': 'hurricanehero',
                'startWildfireWatch': 'wildfirewatch',
                'startQuakeResponse': 'quakeresponse',
                'startCityManager': 'citymanager'
            };
            
            for (const [funcName, gameId] of Object.entries(gameMap)) {
                if (onclick.includes(funcName)) {
                    return gameId;
                }
            }
            
            return null;
        }

        // Add CSS animation for smooth transitions
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            
            .game-card {
                transition: all 0.3s ease;
            }
        `;
        document.head.appendChild(style);

        // Tsunami Escape Game Logic
        let tsunamiGameState = {
            playerPosition: 0,
            escapeRoute: [
                { name: "Beach", danger: 10, description: "You're at the beach when the earthquake hits!" },
                { name: "Low Ground", danger: 8, description: "Water is rising behind you!" },
                { name: "Hill Road", danger: 5, description: "You're climbing to higher ground" },
                { name: "Safe Zone", danger: 0, description: "You've reached safety on high ground!" }
            ],
            score: 0,
            timeLeft: 120, // 2 minutes to escape
            timerInterval: null,
            gameActive: false
        };

        function createTsunamiEscapeGame(container) {
            container.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">ðŸŒŠ Tsunami Escape Challenge</h3>
                    
                    <div style="background: linear-gradient(to bottom, #87CEEB, #1E90FF); padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <strong>â±ï¸ Time Left: <span id="tsunamiTimeLeft">2:00</span></strong>
                            </div>
                            <div>
                                <strong>ðŸ† Score: <span id="tsunamiScore">0</span></strong>
                            </div>
                        </div>
                        
                        <div id="tsunamiEscapeRoute" style="display: flex; justify-content: space-between; margin: 20px 0;">
                            <!-- Escape route will be populated here -->
                        </div>
                        
                        <div id="tsunamiPlayerPosition" style="font-size: 2rem; margin: 20px 0;">
                            ðŸƒâ€â™‚ï¸ <!-- Player icon -->
                        </div>
                        
                        <div id="tsunamiCurrentLocation" style="background: rgba(255,255,255,0.9); padding: 15px; border-radius: 10px; margin: 15px 0;">
                            <h4 id="locationName">Beach</h4>
                            <p id="locationDescription">You're at the beach when the earthquake hits!</p>
                            <div id="dangerLevel" style="margin: 10px 0;">
                                <strong>Danger Level: <span id="dangerValue">10</span>/10</strong>
                                <div style="background: #ddd; height: 10px; border-radius: 5px; margin-top: 5px;">
                                    <div id="dangerBar" style="background: red; height: 100%; width: 100%; border-radius: 5px; transition: all 0.5s;"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="tsunamiActions" style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                            <button onclick="makeTsunamiChoice('evacuate')" class="game-btn" style="background: #4CAF50;">
                                ðŸƒâ€â™‚ï¸ Evacuate Inland
                            </button>
                            <button onclick="makeTsunamiChoice('higher')" class="game-btn" style="background: #2196F3;">
                                â›°ï¸ Seek Higher Ground
                            </button>
                            <button onclick="makeTsunamiChoice('help')" class="game-btn" style="background: #FF9800;">
                                ðŸ¤ Help Others
                            </button>
                            <button onclick="makeTsunamiChoice('wait')" class="game-btn" style="background: #f44336;">
                                â° Wait and See
                            </button>
                        </div>
                        
                        <div id="tsunamiTips" style="background: rgba(255,255,255,0.9); padding: 15px; border-radius: 10px; margin-top: 20px;">
                            <h4>ðŸ’¡ Tsunami Safety Tips:</h4>
                            <ul style="text-align: left; margin: 10px 0;">
                                <li>Move inland and to higher ground immediately</li>
                                <li>Don't wait for official warnings</li>
                                <li>Stay away from beaches and waterways</li>
                                <li>A receding ocean is a warning sign</li>
                                <li>Tsunamis can travel up rivers and streams</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="restartTsunamiGame()" class="game-btn" style="background: var(--secondary);">
                            ðŸ”„ Restart Game
                        </button>
                        <button onclick="pauseTsunamiGame()" class="game-btn">
                            â¸ï¸ Pause
                        </button>
                    </div>
                </div>
            `;
            
            initializeTsunamiGameplay();
        }

        function initializeTsunamiGameplay() {
            tsunamiGameState.playerPosition = 0;
            tsunamiGameState.score = 0;
            tsunamiGameState.timeLeft = 120;
            tsunamiGameState.gameActive = true;
            
            startTsunamiTimer();
            updateTsunamiDisplay();
            createEscapeRoute();
        }

        function createEscapeRoute() {
            const routeContainer = document.getElementById('tsunamiEscapeRoute');
            if (!routeContainer) return;
            
            routeContainer.innerHTML = '';
            
            tsunamiGameState.escapeRoute.forEach((location, index) => {
                const locationDiv = document.createElement('div');
                locationDiv.style.cssText = `
                    text-align: center;
                    padding: 10px;
                    border-radius: 10px;
                    margin: 5px;
                    flex: 1;
                    transition: all 0.3s ease;
                    ${index === tsunamiGameState.playerPosition ? 
                        'background: #FFD700; border: 3px solid #FF6B35; transform: scale(1.1);' : 
                        'background: rgba(255,255,255,0.7); border: 2px solid #ddd;'}
                `;
                
                locationDiv.innerHTML = `
                    <div style="font-size: 1.5rem; margin-bottom: 5px;">
                        ${index === 0 ? 'ðŸ–ï¸' : index === 1 ? 'ðŸŒŠ' : index === 2 ? 'â›°ï¸' : 'ðŸ”ï¸'}
                    </div>
                    <div style="font-weight: bold; font-size: 0.9rem;">${location.name}</div>
                `;
                
                routeContainer.appendChild(locationDiv);
            });
        }

        function startTsunamiTimer() {
            tsunamiGameState.timerInterval = setInterval(() => {
                tsunamiGameState.timeLeft--;
                updateTsunamiTimer();
                
                if (tsunamiGameState.timeLeft <= 0) {
                    clearInterval(tsunamiGameState.timerInterval);
                    gameOverTsunami(false);
                }
            }, 1000);
        }

        function updateTsunamiTimer() {
            const timerElement = document.getElementById('tsunamiTimeLeft');
            if (!timerElement) return;
            
            const minutes = Math.floor(tsunamiGameState.timeLeft / 60);
            const seconds = tsunamiGameState.timeLeft % 60;
            timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
            // Change color when time is running low
            if (tsunamiGameState.timeLeft < 30) {
                timerElement.style.color = '#f44336';
            } else if (tsunamiGameState.timeLeft < 60) {
                timerElement.style.color = '#ff9800';
            }
        }

        function updateTsunamiDisplay() {
            const currentLocation = tsunamiGameState.escapeRoute[tsunamiGameState.playerPosition];
            
            const scoreElement = document.getElementById('tsunamiScore');
            if (scoreElement) scoreElement.textContent = tsunamiGameState.score;
            
            const locationNameElement = document.getElementById('locationName');
            if (locationNameElement) locationNameElement.textContent = currentLocation.name;
            
            const locationDescElement = document.getElementById('locationDescription');
            if (locationDescElement) locationDescElement.textContent = currentLocation.description;
            
            const dangerValueElement = document.getElementById('dangerValue');
            if (dangerValueElement) dangerValueElement.textContent = currentLocation.danger;
            
            const dangerBar = document.getElementById('dangerBar');
            if (dangerBar) {
                const dangerPercentage = (currentLocation.danger / 10) * 100;
                dangerBar.style.width = dangerPercentage + '%';
                
                if (currentLocation.danger > 7) {
                    dangerBar.style.background = '#f44336';
                } else if (currentLocation.danger > 4) {
                    dangerBar.style.background = '#ff9800';
                } else {
                    dangerBar.style.background = '#4caf50';
                }
            }
            
            updateCurrentGamePoints(tsunamiGameState.score);
            createEscapeRoute();
        }

        function makeTsunamiChoice(choice) {
            if (!tsunamiGameState.gameActive) return;
            
            const currentLocation = tsunamiGameState.escapeRoute[tsunamiGameState.playerPosition];
            let pointsEarned = 0;
            let moveForward = false;
            let message = '';
            
            switch(choice) {
                case 'evacuate':
                    if (tsunamiGameState.playerPosition < 2) {
                        pointsEarned = 25;
                        moveForward = true;
                        message = 'âœ… Great choice! You\'re moving to safety!';
                    } else {
                        pointsEarned = 10;
                        message = 'âœ… You\'re already evacuating well!';
                    }
                    break;
                    
                case 'higher':
                    pointsEarned = 30;
                    moveForward = true;
                    message = 'âœ… Excellent! Higher ground is the safest option!';
                    break;
                    
                case 'help':
                    pointsEarned = 15;
                    if (Math.random() > 0.5) {
                        moveForward = true;
                        message = 'âœ… You helped others escape safely together!';
                    } else {
                        message = 'âš ï¸ Helping is noble, but be quick about it!';
                    }
                    break;
                    
                case 'wait':
                    pointsEarned = -10;
                    message = 'âŒ Never wait during a tsunami! Every second counts!';
                    break;
            }
            
            tsunamiGameState.score += pointsEarned;
            
            if (moveForward && tsunamiGameState.playerPosition < tsunamiGameState.escapeRoute.length - 1) {
                tsunamiGameState.playerPosition++;
            }
            
            // Show choice result
            showTsunamiMessage(message, pointsEarned);
            
            setTimeout(() => {
                updateTsunamiDisplay();
                
                // Check if player reached safety
                if (tsunamiGameState.playerPosition >= tsunamiGameState.escapeRoute.length - 1) {
                    gameOverTsunami(true);
                }
            }, 1500);
        }

        function showTsunamiMessage(message, points) {
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: ${points > 0 ? '#4caf50' : points < 0 ? '#f44336' : '#2196f3'};
                color: white;
                padding: 20px;
                border-radius: 10px;
                z-index: 1000;
                text-align: center;
                font-weight: bold;
                animation: fadeInOut 1.5s ease;
            `;
            messageDiv.innerHTML = `
                ${message}
                ${points !== 0 ? `<br><span style="font-size: 1.2rem;">${points > 0 ? '+' : ''}${points} points</span>` : ''}
            `;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                if (document.body.contains(messageDiv)) {
                    document.body.removeChild(messageDiv);
                }
            }, 1500);
        }

        function gameOverTsunami(success) {
            clearInterval(tsunamiGameState.timerInterval);
            tsunamiGameState.gameActive = false;
            
            const bonusPoints = success ? 100 : 0;
            tsunamiGameState.score += bonusPoints;
            
            setTimeout(() => {
                alert(success ? 
                    `ðŸ† Congratulations! You escaped the tsunami safely!\n\nFinal Score: ${tsunamiGameState.score} points\nTime Bonus: ${bonusPoints} points\n\nYou demonstrated excellent tsunami safety knowledge!` :
                    `â° Time's up! The tsunami caught up to you.\n\nFinal Score: ${tsunamiGameState.score} points\n\nRemember: In a real tsunami, move to higher ground immediately!`
                );
                
                completeGame('tsunami-escape', tsunamiGameState.score, (Date.now() - window.currentGameStartTime) / 1000);
            }, 500);
        }

        function pauseTsunamiGame() {
            if (tsunamiGameState.timerInterval) {
                clearInterval(tsunamiGameState.timerInterval);
                tsunamiGameState.timerInterval = null;
                alert('â¸ï¸ Game Paused\n\nTake a moment to think about your strategy. Click OK to resume.');
                startTsunamiTimer();
            }
        }

        function restartTsunamiGame() {
            clearInterval(tsunamiGameState.timerInterval);
            initializeTsunamiGameplay();
        }

        // Hurricane Hero Game Logic
        let hurricaneGameState = {
            preparationLevel: 0,
            stormIntensity: 1,
            familySafety: 100,
            suppliesLevel: 0,
            score: 0,
            currentPhase: 'preparation', // preparation, storm, aftermath
            timeRemaining: 180, // 3 minutes
            timerInterval: null,
            gameActive: false,
            decisions: []
        };

        function createHurricaneHeroGame(container) {
            container.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">ðŸŒªï¸ Hurricane Hero Challenge</h3>
                    
                    <div style="background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <strong>â±ï¸ Time: <span id="hurricaneTimeLeft">3:00</span></strong>
                            </div>
                            <div>
                                <strong>ðŸ† Score: <span id="hurricaneScore">0</span></strong>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0;">
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                                <h4>ðŸ  Preparation</h4>
                                <div style="background: #ddd; height: 10px; border-radius: 5px; margin: 10px 0;">
                                    <div id="preparationBar" style="background: #4caf50; height: 100%; width: 0%; border-radius: 5px; transition: all 0.5s;"></div>
                                </div>
                                <span id="preparationLevel">0%</span>
                            </div>
                            
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                                <h4>ðŸŒªï¸ Storm Intensity</h4>
                                <div style="background: #ddd; height: 10px; border-radius: 5px; margin: 10px 0;">
                                    <div id="intensityBar" style="background: #f44336; height: 100%; width: 20%; border-radius: 5px; transition: all 0.5s;"></div>
                                </div>
                                <span id="intensityLevel">Category 1</span>
                            </div>
                            
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                                <h4>ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ Family Safety</h4>
                                <div style="background: #ddd; height: 10px; border-radius: 5px; margin: 10px 0;">
                                    <div id="safetyBar" style="background: #4caf50; height: 100%; width: 100%; border-radius: 5px; transition: all 0.5s;"></div>
                                </div>
                                <span id="safetyLevel">100%</span>
                            </div>
                        </div>
                        
                        <div id="hurricaneCurrentPhase" style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; margin: 15px 0;">
                            <h4 id="phaseTitle">ðŸ  Preparation Phase</h4>
                            <p id="phaseDescription">A hurricane is approaching! You have time to prepare. Make smart decisions to protect your family.</p>
                        </div>
                        
                        <div id="hurricaneChoices" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin: 20px 0;">
                            <!-- Choices will be populated here -->
                        </div>
                        
                        <div id="hurricaneTips" style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; margin-top: 20px;">
                            <h4>ðŸ’¡ Hurricane Safety Tips:</h4>
                            <ul style="text-align: left; margin: 10px 0;">
                                <li>Prepare emergency kit 72 hours before landfall</li>
                                <li>Board up windows and secure outdoor items</li>
                                <li>Know your evacuation route</li>
                                <li>Stay away from windows during the storm</li>
                                <li>Don't go outside during the eye of the storm</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="restartHurricaneGame()" class="game-btn" style="background: var(--secondary);">
                            ðŸ”„ Restart Game
                        </button>
                        <button onclick="pauseHurricaneGame()" class="game-btn">
                            â¸ï¸ Pause
                        </button>
                    </div>
                </div>
            `;
            
            initializeHurricaneGameplay();
        }

        function initializeHurricaneGameplay() {
            hurricaneGameState.preparationLevel = 0;
            hurricaneGameState.stormIntensity = 1;
            hurricaneGameState.familySafety = 100;
            hurricaneGameState.suppliesLevel = 0;
            hurricaneGameState.score = 0;
            hurricaneGameState.currentPhase = 'preparation';
            hurricaneGameState.timeRemaining = 180;
            hurricaneGameState.gameActive = true;
            hurricaneGameState.decisions = [];
            
            startHurricaneTimer();
            updateHurricaneDisplay();
            showHurricaneChoices();
        }

        function startHurricaneTimer() {
            hurricaneGameState.timerInterval = setInterval(() => {
                hurricaneGameState.timeRemaining--;
                updateHurricaneTimer();
                
                // Progress through phases
                if (hurricaneGameState.timeRemaining === 120 && hurricaneGameState.currentPhase === 'preparation') {
                    hurricaneGameState.currentPhase = 'storm';
                    hurricaneGameState.stormIntensity = Math.min(5, hurricaneGameState.stormIntensity + 1);
                    showHurricaneChoices();
                } else if (hurricaneGameState.timeRemaining === 60 && hurricaneGameState.currentPhase === 'storm') {
                    hurricaneGameState.currentPhase = 'aftermath';
                    showHurricaneChoices();
                }
                
                if (hurricaneGameState.timeRemaining <= 0) {
                    clearInterval(hurricaneGameState.timerInterval);
                    gameOverHurricane();
                }
            }, 1000);
        }

        function updateHurricaneTimer() {
            const timerElement = document.getElementById('hurricaneTimeLeft');
            if (!timerElement) return;
            
            const minutes = Math.floor(hurricaneGameState.timeRemaining / 60);
            const seconds = hurricaneGameState.timeRemaining % 60;
            timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateHurricaneDisplay() {
            const scoreElement = document.getElementById('hurricaneScore');
            if (scoreElement) scoreElement.textContent = hurricaneGameState.score;
            
            const prepLevelElement = document.getElementById('preparationLevel');
            if (prepLevelElement) prepLevelElement.textContent = hurricaneGameState.preparationLevel + '%';
            
            const prepBarElement = document.getElementById('preparationBar');
            if (prepBarElement) prepBarElement.style.width = hurricaneGameState.preparationLevel + '%';
            
            const safetyLevelElement = document.getElementById('safetyLevel');
            if (safetyLevelElement) safetyLevelElement.textContent = hurricaneGameState.familySafety + '%';
            
            const safetyBarElement = document.getElementById('safetyBar');
            if (safetyBarElement) safetyBarElement.style.width = hurricaneGameState.familySafety + '%';
            
            const intensityNames = ['', 'Category 1', 'Category 2', 'Category 3', 'Category 4', 'Category 5'];
            const intensityLevelElement = document.getElementById('intensityLevel');
            if (intensityLevelElement) intensityLevelElement.textContent = intensityNames[hurricaneGameState.stormIntensity];
            
            const intensityBarElement = document.getElementById('intensityBar');
            if (intensityBarElement) intensityBarElement.style.width = (hurricaneGameState.stormIntensity * 20) + '%';
            
            updateCurrentGamePoints(hurricaneGameState.score);
        }

        function showHurricaneChoices() {
            const choicesContainer = document.getElementById('hurricaneChoices');
            const phaseTitle = document.getElementById('phaseTitle');
            const phaseDescription = document.getElementById('phaseDescription');
            
            if (!choicesContainer || !phaseTitle || !phaseDescription) return;
            
            let choices = [];
            
            switch(hurricaneGameState.currentPhase) {
                case 'preparation':
                    phaseTitle.textContent = 'ðŸ  Preparation Phase';
                    phaseDescription.textContent = 'A hurricane is approaching! You have time to prepare. Make smart decisions to protect your family.';
                    choices = [
                        { text: 'ðŸ¥« Stock Emergency Supplies', action: 'supplies', points: 20 },
                        { text: 'ðŸ”¨ Board Up Windows', action: 'board', points: 25 },
                        { text: 'ðŸš— Plan Evacuation Route', action: 'evacuate_plan', points: 30 },
                        { text: 'ðŸ“± Charge All Devices', action: 'charge', points: 15 }
                    ];
                    break;
                    
                case 'storm':
                    phaseTitle.textContent = 'ðŸŒªï¸ Storm Phase';
                    phaseDescription.textContent = 'The hurricane has arrived! Stay safe and make survival decisions.';
                    choices = [
                        { text: 'ðŸ  Stay in Safe Room', action: 'safe_room', points: 25 },
                        { text: 'ðŸ“» Monitor Weather Radio', action: 'radio', points: 20 },
                        { text: 'ðŸš« Avoid Windows', action: 'avoid_windows', points: 30 },
                        { text: 'ðŸ”¦ Use Flashlight Only', action: 'flashlight', points: 15 }
                    ];
                    break;
                    
                case 'aftermath':
                    phaseTitle.textContent = 'ðŸ” Aftermath Phase';
                    phaseDescription.textContent = 'The storm has passed. Navigate the aftermath safely.';
                    choices = [
                        { text: 'âš¡ Check for Hazards', action: 'check_hazards', points: 25 },
                        { text: 'ðŸ“ž Contact Family', action: 'contact', points: 20 },
                        { text: 'ðŸ¥ Give First Aid', action: 'first_aid', points: 30 },
                        { text: 'ðŸ¤ Help Neighbors', action: 'help_neighbors', points: 35 }
                    ];
                    break;
            }
            
            choicesContainer.innerHTML = '';
            choices.forEach(choice => {
                const button = document.createElement('button');
                button.style.cssText = `
                    padding: 15px;
                    background: rgba(255,255,255,0.9);
                    border: none;
                    border-radius: 10px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    font-weight: bold;
                    color: #333;
                `;
                button.textContent = choice.text;
                button.onclick = () => makeHurricaneChoice(choice);
                choicesContainer.appendChild(button);
            });
        }

        function makeHurricaneChoice(choice) {
            if (!hurricaneGameState.gameActive) return;
            
            hurricaneGameState.score += choice.points;
            hurricaneGameState.decisions.push(choice);
            
            // Update game state based on choice
            switch(choice.action) {
                case 'supplies':
                case 'board':
                case 'evacuate_plan':
                case 'charge':
                    hurricaneGameState.preparationLevel = Math.min(100, hurricaneGameState.preparationLevel + 25);
                    break;
                    
                case 'safe_room':
                case 'avoid_windows':
                    hurricaneGameState.familySafety = Math.min(100, hurricaneGameState.familySafety + 10);
                    break;
                    
                case 'check_hazards':
                case 'first_aid':
                    hurricaneGameState.familySafety = Math.min(100, hurricaneGameState.familySafety + 15);
                    break;
            }
            
            // Show choice result
            showHurricaneMessage(`âœ… Great choice! +${choice.points} points`, choice.points);
            
            setTimeout(() => {
                updateHurricaneDisplay();
            }, 1000);
        }

        function showHurricaneMessage(message, points) {
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: #4caf50;
                color: white;
                padding: 20px;
                border-radius: 10px;
                z-index: 1000;
                text-align: center;
                font-weight: bold;
                animation: fadeInOut 1s ease;
            `;
            messageDiv.textContent = message;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                if (document.body.contains(messageDiv)) {
                    document.body.removeChild(messageDiv);
                }
            }, 1000);
        }

        function gameOverHurricane() {
            clearInterval(hurricaneGameState.timerInterval);
            hurricaneGameState.gameActive = false;
            
            // Calculate final bonus
            const preparationBonus = hurricaneGameState.preparationLevel;
            const safetyBonus = hurricaneGameState.familySafety;
            const totalBonus = preparationBonus + safetyBonus;
            hurricaneGameState.score += totalBonus;
            
            setTimeout(() => {
                alert(`ðŸ† Hurricane Hero Challenge Complete!\n\nFinal Score: ${hurricaneGameState.score} points\nPreparation Bonus: ${preparationBonus} points\nSafety Bonus: ${safetyBonus} points\n\nYou made ${hurricaneGameState.decisions.length} important decisions to protect your family!`);
                
                completeGame('hurricane-hero', hurricaneGameState.score, (Date.now() - window.currentGameStartTime) / 1000);
            }, 500);
        }

        function pauseHurricaneGame() {
            if (hurricaneGameState.timerInterval) {
                clearInterval(hurricaneGameState.timerInterval);
                hurricaneGameState.timerInterval = null;
                alert('â¸ï¸ Game Paused\n\nTake time to think about hurricane safety. Click OK to resume.');
                startHurricaneTimer();
            }
        }

        function restartHurricaneGame() {
            clearInterval(hurricaneGameState.timerInterval);
            initializeHurricaneGameplay();
        }

        // Game Progress Popup Functionality
        function openGameProgressPopup() {
            const popup = document.getElementById('gameProgressPopup');
            popup.style.display = 'block';
            updateProgressPopup();
        }

        function closeGameProgressPopup() {
            const popup = document.getElementById('gameProgressPopup');
            popup.style.display = 'none';
        }

        function updateProgressPopup() {
            const gameStats = JSON.parse(localStorage.getItem('gameStats') || '{}');
            const allGames = ['disasterpoly', 'quiz', 'citymanager', 'tsunamiescape', 'hurricanehero', 'wildfirewatch', 'quakeresponse', 'floodplainproject', 'stopdisasters', 'disasterresponse'];
            
            // Calculate overall statistics
            let totalGamesPlayed = 0;
            let totalScore = 0;
            let completedGames = 0;
            
            allGames.forEach(gameId => {
                if (gameStats[gameId] && gameStats[gameId].plays > 0) {
                    totalGamesPlayed += gameStats[gameId].plays;
                    totalScore += gameStats[gameId].totalScore || 0;
                    if (gameStats[gameId].completed) completedGames++;
                }
            });
            
            const averageScore = totalGamesPlayed > 0 ? Math.round(totalScore / totalGamesPlayed) : 0;
            const completionRate = Math.round((completedGames / allGames.length) * 100);
            
            // Update statistics display
            document.getElementById('totalGamesPlayed').textContent = totalGamesPlayed;
            document.getElementById('totalScore').textContent = totalScore.toLocaleString();
            document.getElementById('averageScore').textContent = averageScore;
            document.getElementById('completionRate').textContent = completionRate + '%';
            
            // Populate individual game progress
            const gameProgressList = document.getElementById('gameProgressList');
            gameProgressList.innerHTML = '';
            
            const gameNames = {
                'disasterpoly': 'DisasterPoly',
                'quiz': 'Disaster Quiz',
                'citymanager': 'City Manager',
                'tsunamiescape': 'Tsunami Escape',
                'hurricanehero': 'Hurricane Hero',
                'wildfirewatch': 'Wildfire Watch',
                'quakeresponse': 'Quake Response',
                'floodplainproject': 'Floodplain Project',
                'stopdisasters': 'Stop Disasters',
                'disasterresponse': 'Disaster Response'
            };
            
            allGames.forEach(gameId => {
                const stats = gameStats[gameId] || { plays: 0, bestScore: 0, totalScore: 0, completed: false };
                const progressPercentage = stats.completed ? 100 : Math.min((stats.plays * 20), 80);
                
                const gameItem = document.createElement('div');
                gameItem.className = `game-progress-item ${stats.completed ? 'completed' : ''}`;
                gameItem.innerHTML = `
                    <div class="game-info">
                        <h4>${gameNames[gameId] || gameId}</h4>
                        <div class="game-meta">
                            Plays: ${stats.plays} | Best Score: ${stats.bestScore || 0}
                            ${stats.completed ? '<span class="achievement-badge">âœ“ Completed</span>' : ''}
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                        </div>
                        <button class="play-btn" onclick="closeGameProgressPopup(); openGameModal('${gameId}')">
                            ${stats.completed ? 'Play Again' : 'Play Now'}
                        </button>
                    </div>
                `;
                gameProgressList.appendChild(gameItem);
            });
        }

        // Add progress button to navigation
        function addProgressButtonToNav() {
            const sidebar = document.querySelector('.sidebar .menu');
            if (sidebar) {
                const progressButton = document.createElement('div');
                progressButton.className = 'menu-item';
                progressButton.style.cursor = 'pointer';
                progressButton.innerHTML = '<i class="fas fa-chart-bar"></i><span>Game Progress</span>';
                progressButton.onclick = openGameProgressPopup;
                sidebar.insertBefore(progressButton, sidebar.lastElementChild);
            }
        }

        // Close popup when clicking outside
        window.onclick = function(event) {
            const popup = document.getElementById('gameProgressPopup');
            if (event.target === popup) {
                closeGameProgressPopup();
            }
        }

        // Initialize default categories for games without data-category
        document.addEventListener('DOMContentLoaded', function() {
            const gameCards = document.querySelectorAll('.game-card');
            gameCards.forEach(card => {
                if (!card.getAttribute('data-category')) {
                    // Default category for uncategorized games
                    card.setAttribute('data-category', 'solo');
                }
            });
            
            // Add progress button to navigation
            addProgressButtonToNav();
        });
    </script>
</body>
</html>