<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamified Learning - DisasterSafe</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #1a73e8;
            /* original blue navbar */
            --primary-dark: #0d47a1;
            --secondary: #34a853;
            --accent: #f25c54;
            --warning: #f9a825;
            --card-bg: #ffffff;
            --text-dark: #202124;
            --light-bg: #f5f7fb;

            /* user palette to use across cards/overlays */
            --p1: #309ad4;
            --p2: #e69c42;
            --p3: #ea8d99;
            --p4: #faafa4;
            --p5: #e2afd3;
            --p6: #c8e5f3;
            --p7: #fae8c7;

            --shadow: 0 8px 20px rgba(18, 38, 63, 0.08);
            --transition: all 0.25s ease;
            --glass: rgba(255, 255, 255, 0.72);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: var(--light-bg);
            color: var(--text-dark);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-family: "Ubuntu", sans-serif;
            font-weight: 400;
            font-style: normal;
        }

        /* Layout */
        .dashboard-container {
            display: grid;
            grid-template-columns: 240px 1fr;
            min-height: 100vh;
        }

        .sidebar {
            background: linear-gradient(180deg, var(--primary), var(--primary-dark));
            color: #fff;
            padding: 22px;
            position: fixed;
            width: 240px;
            height: 100%;
            overflow-y: auto;
            box-shadow: var(--shadow);
            z-index: 200;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06)
        }

        .logo i {
            font-size: 22px;
            color: var(--p6)
        }

        .logo h1 {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 0.2px
        }

        .menu-items {
            margin-top: 18px;
            display: flex;
            flex-direction: column;
            gap: 8px
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            color: rgba(255, 255, 255, 0.95)
        }

        .menu-item i {
            width: 20px;
            text-align: center
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.06)
        }

        .menu-item.active {
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.14), rgba(255, 255, 255, 0.06));
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08)
        }

        /* Sidebar User Profile */
        .sidebar-user-profile {
            margin-top: auto;
            padding: 12px;
            margin: 0 -12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: var(--transition);
            cursor: pointer;
        }

        .sidebar-user-profile:hover {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--p6), var(--p1));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 700;
            color: var(--primary-dark);
            text-transform: uppercase;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .user-info {
            flex: 1;
            min-width: 0;
        }

        .user-info h4 {
            font-size: 14px;
            font-weight: 600;
            color: white;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-info p {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            margin: 0;
        }


        /* Main content */
        .main-content {
            grid-column: 2;
            padding: 20px;
            min-height: 100vh
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header-section {
            text-align: center;
            margin-bottom: 50px;
            color: var(--text-dark);
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .header-section h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header-section p {
            font-size: 1.1rem;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 50px;
        }

        .game-card {
            background: var(--card-bg);
            border-radius: 14px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }

        .game-card:hover {
            transform: translateY(-6px);
        }

        .game-header {
            height: 160px;
            position: relative;
            background: linear-gradient(90deg, var(--p6), var(--p1));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .game-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .game-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(90deg, var(--p3), var(--accent));
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .game-content {
            padding: 24px;
        }

        .game-content h3 {
            font-size: 1.5rem;
            margin-bottom: 12px;
            color: var(--text-dark);
        }

        .game-content p {
            color: #6c757d;
            margin-bottom: 18px;
            line-height: 1.6;
        }

        .game-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 18px;
            padding: 15px;
            background: rgba(26, 115, 232, 0.05);
            border-radius: 12px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .game-features {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 18px;
        }

        .feature-tag {
            padding: 5px 10px;
            background: rgba(52, 168, 83, 0.1);
            color: var(--secondary);
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .game-actions {
            display: flex;
            gap: 12px;
        }

        .btn-primary {
            flex: 1;
            padding: 12px 18px;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(26, 115, 232, 0.3);
        }

        .btn-secondary {
            padding: 12px 18px;
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        /* DisasterPoly Game Board */
        .disasterpoly-section {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(16, 24, 32, 0.03);
        }

        .game-board {
            width: 500px;
            height: 500px;
            margin: 0 auto;
            position: relative;
            background: rgba(26, 115, 232, 0.05);
            border: 3px solid var(--primary);
            border-radius: 14px;
        }

        .board-square {
            position: absolute;
            width: 70px;
            height: 70px;
            border: 2px solid var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            text-align: center;
            background: var(--card-bg);
            cursor: pointer;
            transition: var(--transition);
            border-radius: 8px;
        }

        .board-square:hover {
            background: rgba(26, 115, 232, 0.1);
            transform: scale(1.05);
        }

        .board-square.corner {
            background: linear-gradient(90deg, var(--p1), var(--primary));
            color: white;
            font-weight: 600;
        }

        .board-square.disaster {
            background: linear-gradient(90deg, var(--p3), var(--accent));
            color: white;
        }

        .board-square.safe {
            background: linear-gradient(90deg, var(--secondary), var(--p2));
            color: white;
        }

        .board-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 250px;
            height: 250px;
            background: linear-gradient(90deg, var(--p6), var(--p1));
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .board-center h2 {
            font-size: 1.6rem;
            margin-bottom: 8px;
        }

        .board-center p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 18px;
            margin-top: 25px;
        }

        .dice {
            width: 50px;
            height: 50px;
            background: var(--card-bg);
            border: 3px solid var(--primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary);
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .dice:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.1);
        }

        .player-info {
            display: flex;
            justify-content: space-around;
            margin-top: 25px;
            gap: 18px;
        }

        .player-card {
            background: rgba(26, 115, 232, 0.05);
            padding: 18px;
            border-radius: 12px;
            text-align: center;
            flex: 1;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }

        .player-card h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .player-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        /* Quiz Section */
        .quiz-section {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(16, 24, 32, 0.03);
        }

        .quiz-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .quiz-progress {
            width: 100%;
            height: 8px;
            background: rgba(26, 115, 232, 0.1);
            border-radius: 4px;
            margin-bottom: 25px;
            overflow: hidden;
        }

        .quiz-progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--p1), var(--secondary));
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-card {
            background: rgba(26, 115, 232, 0.05);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(16, 24, 32, 0.03);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 18px;
        }

        .question-number {
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .question-points {
            background: linear-gradient(90deg, var(--secondary), var(--p2));
            color: white;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: var(--text-dark);
            line-height: 1.4;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 12px;
        }

        .option-button {
            padding: 12px 16px;
            border: 2px solid rgba(26, 115, 232, 0.2);
            background: var(--card-bg);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            text-align: left;
            font-size: 0.95rem;
        }

        .option-button:hover {
            border-color: var(--primary);
            background: rgba(26, 115, 232, 0.05);
            transform: translateY(-2px);
        }

        .option-button.selected {
            border-color: var(--primary);
            background: rgba(26, 115, 232, 0.1);
        }

        .option-button.correct {
            border-color: var(--secondary);
            background: rgba(52, 168, 83, 0.1);
        }

        .option-button.incorrect {
            border-color: var(--accent);
            background: rgba(242, 92, 84, 0.1);
        }

        .quiz-results {
            background: linear-gradient(90deg, var(--p1), var(--secondary));
            color: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            margin-top: 25px;
            box-shadow: var(--shadow);
        }

        .score-display {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .achievement-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            margin: 8px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        @media (max-width: 992px) {
            .dashboard-container {
                grid-template-columns: 1fr
            }

            .sidebar {
                position: relative;
                width: 100%;
                height: auto
            }

            .main-content {
                padding: 18px
            }

            .header-section h1 {
                font-size: 2rem;
            }

            .games-grid {
                grid-template-columns: 1fr;
            }

            .game-board {
                width: 100%;
                height: auto;
                aspect-ratio: 1;
                max-width: 400px;
            }

            .board-square {
                width: 50px;
                height: 50px;
                font-size: 0.55rem;
            }

            .board-center {
                width: 180px;
                height: 180px;
            }

            .board-center h2 {
                font-size: 1.2rem;
            }
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
                <h1>ResQ</h1>
            </div>
            <div class="menu-items">
                <div class="menu-item"><i class="fas fa-home"></i><span>Dashboard</span></div>
                <div class="menu-item"><i class="fas fa-book"></i><span>Education Modules</span></div>
                <div class="menu-item"><i class="fas fa-gamepad"></i><span>Sandbox Simulator</span></div>
                <div class="menu-item"><i class="fas fa-phone-alt"></i><span>Emergency Contacts</span></div>
                <div class="menu-item"><i class="fas fa-map-marked-alt"></i><span>Disaster Map</span></div>
                <div class="menu-item"><i class="fas fa-robot"></i><span>AI Helper</span></div>
                <div class="menu-item active"><i class="fas fa-graduation-cap"></i><span>Gamified Learning</span></div>
                <div class="menu-item"><i class="fas fa-user"></i><span>Profile & Badges</span></div>
                <div class="menu-item"><i class="fas fa-cog"></i><span>Settings</span></div>
            </div>

            <!-- User Profile at Bottom -->
            <div class="sidebar-user-profile">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-info">
                    <h4 id="sidebarUserName">User</h4>
                    <p>Student</p>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <div class="header-section">
                    <h1>Gamified Disaster Learning</h1>
                    <p>Learn disaster management through engaging games and challenges</p>
                </div>

                <div class="games-grid">
                    <div class="game-card">
                        <div class="game-header">
                            <div class="game-badge">Multiplayer</div>
                            <div style="text-align: center;">
                                <div class="game-icon">
                                    <i class="fas fa-dice"></i>
                                </div>
                                <h3>DisasterPoly</h3>
                            </div>
                        </div>
                        <div class="game-content">
                            <h3>DisasterPoly Board Game</h3>
                            <p>Navigate through disaster scenarios, make strategic decisions, and learn emergency
                                management in this exciting board game.</p>

                            <div class="game-stats">
                                <div class="stat-item">
                                    <div class="stat-number">2-6</div>
                                    <div class="stat-label">Players</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">30-45</div>
                                    <div class="stat-label">Minutes</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">â˜… 4.8</div>
                                    <div class="stat-label">Rating</div>
                                </div>
                            </div>

                            <div class="game-features">
                                <span class="feature-tag">Strategy</span>
                                <span class="feature-tag">Multiplayer</span>
                                <span class="feature-tag">Educational</span>
                                <span class="feature-tag">Real-time</span>
                            </div>

                            <div class="game-actions">
                                <button class="btn-primary" onclick="startDisasterPoly()">Play Now</button>
                                <button class="btn-secondary" onclick="viewRules()">Rules</button>
                            </div>
                        </div>
                    </div>

                    <div class="game-card">
                        <div class="game-header">
                            <div class="game-badge">Solo Play</div>
                            <div style="text-align: center;">
                                <div class="game-icon">
                                    <i class="fas fa-brain"></i>
                                </div>
                                <h3>Knowledge Quiz</h3>
                            </div>
                        </div>
                        <div class="game-content">
                            <h3>Disaster Knowledge Quiz</h3>
                            <p>Test your disaster preparedness knowledge with challenging questions and earn points for
                                correct answers.</p>

                            <div class="game-stats">
                                <div class="stat-item">
                                    <div class="stat-number">50</div>
                                    <div class="stat-label">Questions</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">15</div>
                                    <div class="stat-label">Minutes</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">500</div>
                                    <div class="stat-label">Max Points</div>
                                </div>
                            </div>

                            <div class="game-features">
                                <span class="feature-tag">Quiz</span>
                                <span class="feature-tag">Timed</span>
                                <span class="feature-tag">Points</span>
                                <span class="feature-tag">Badges</span>
                            </div>

                            <div class="game-actions">
                                <button class="btn-primary" onclick="startQuiz()">Start Quiz</button>
                                <button class="btn-secondary" onclick="viewQuizHistory()">History</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- DisasterPoly Game Section -->
                <div class="disasterpoly-section" id="disasterPolyGame" style="display: none;">
                    <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">DisasterPoly Game Board
                    </h2>

                    <div class="game-board" id="gameBoard">
                        <div class="board-center">
                            <h2>DisasterPoly</h2>
                            <p>Emergency Management Board Game</p>
                        </div>
                        <!-- Board squares will be generated by JavaScript -->
                    </div>

                    <div class="game-controls">
                        <button class="btn-primary" onclick="rollDice()">Roll Dice</button>
                        <div class="dice" id="diceDisplay">?</div>
                        <button class="btn-secondary" onclick="endTurn()">End Turn</button>
                    </div>

                    <div class="player-info" id="playerInfo">
                        <div class="player-card">
                            <h4>Player 1</h4>
                            <div class="player-stats">
                                <span>Position: <strong id="p1Position">0</strong></span>
                                <span>Score: <strong id="p1Score">0</strong></span>
                                <span>Lives: <strong id="p1Lives">3</strong></span>
                            </div>
                        </div>
                        <div class="player-card">
                            <h4>Player 2</h4>
                            <div class="player-stats">
                                <span>Position: <strong id="p2Position">0</strong></span>
                                <span>Score: <strong id="p2Score">0</strong></span>
                                <span>Lives: <strong id="p2Lives">3</strong></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quiz Section -->
                <div class="quiz-section" id="quizGame" style="display: none;">
                    <div class="quiz-header">
                        <h2 style="color: var(--primary);">Disaster Knowledge Quiz</h2>
                        <div class="quiz-progress">
                            <div class="quiz-progress-fill" id="quizProgress"></div>
                        </div>
                        <p>Question <span id="currentQuestion">1</span> of <span id="totalQuestions">10</span></p>
                    </div>

                    <div class="question-card" id="questionCard">
                        <div class="question-header">
                            <span class="question-number">Question <span id="questionNumber">1</span></span>
                            <span class="question-points" id="questionPoints">+10 points</span>
                        </div>
                        <div class="question-text" id="questionText">
                            What is the most important thing to do during an earthquake?
                        </div>
                        <div class="options-grid" id="optionsGrid">
                            <button class="option-button" onclick="selectAnswer(0)">Run outside immediately</button>
                            <button class="option-button" onclick="selectAnswer(1)">Drop, cover, and hold on</button>
                            <button class="option-button" onclick="selectAnswer(2)">Stand in a doorway</button>
                            <button class="option-button" onclick="selectAnswer(3)">Look for the nearest exit</button>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn-primary" id="nextButton" onclick="nextQuestion()" disabled>Next
                            Question</button>
                        <button class="btn-secondary" onclick="exitQuiz()">Exit Quiz</button>
                    </div>

                    <div class="quiz-results" id="quizResults" style="display: none;">
                        <div class="score-display" id="finalScore">0</div>
                        <h3>Quiz Completed!</h3>
                        <p>You answered <span id="correctAnswers">0</span> out of <span id="totalAnswered">0</span>
                            questions correctly.</p>
                        <div id="badgesEarned"></div>
                        <button class="btn-primary" onclick="restartQuiz()" style="margin-top: 20px;">Play
                            Again</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            loadUserInfo(); // This will load the user info when page loads
            initializeMenuNavigation();
        });
        // Load User Information from database/session
        async function loadUserInfo() {
            try {
                // First try to get user data from session/localStorage
                let userData = null;

                // Check localStorage for stored user data
                const localData = localStorage.getItem('resq_user') || localStorage.getItem('currentUser') || localStorage.getItem('user');
                if (localData) {
                    userData = JSON.parse(localData);
                }

                // If no local data or token exists, try to fetch from backend
                const token = localStorage.getItem('token') || localStorage.getItem('authToken') || localStorage.getItem('jwt');
                if (!userData && token) {
                    try {
                        const response = await fetch('http://localhost:5000/api/auth/current', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (response.ok) {
                            userData = await response.json();
                            // Save to localStorage for future use
                            localStorage.setItem('resq_user', JSON.stringify(userData));
                        } else {
                            console.log('Failed to fetch user from backend:', response.status);
                        }
                    } catch (fetchError) {
                        console.log('Could not fetch user from backend:', fetchError.message);
                    }
                }

                if (userData) {
                    const firstName = userData.firstName || userData.name || userData.username || userData.email?.split('@')[0] || 'User';
                    const lastName = userData.lastName || '';
                    const fullName = lastName ? `${firstName} ${lastName}` : firstName;

                    // Update sidebar user profile
                    const userNameElement = document.getElementById('sidebarUserName');
                    const userAvatarElement = document.getElementById('userAvatar');

                    if (userNameElement) userNameElement.textContent = fullName;
                    if (userAvatarElement) userAvatarElement.textContent = firstName.charAt(0).toUpperCase();

                    console.log('User loaded:', fullName);
                } else {
                    // Fallback to default values
                    console.log('No user data found');
                    setDefaultUser();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
                setDefaultUser();
            }
        }


        function setDefaultUser() {
            const userNameElement = document.getElementById('sidebarUserName');
            const userAvatarElement = document.getElementById('userAvatar');

            if (userNameElement) userNameElement.textContent = 'Guest User';
            if (userAvatarElement) userAvatarElement.textContent = 'G';
        }


        // Menu Navigation
        function initializeMenuNavigation() {
            const menuItems = document.querySelectorAll('.menu-item');

            const pageMapping = {
                'Dashboard': 'dashboard-student.html',
                'Education Modules': 'education-modules.html',
                'Sandbox Simulator': 'sandbox-simulator.html',
                'Emergency Contacts': 'dashboard-student.html#emergency-contacts',
                'Disaster Map': '../advanced-map.html',
                'AI Helper': 'chatbot.html',
                'Gamified Learning': 'gamified-learning.html',
                'Profile & Badges': 'profile-badges.html',
                'Settings': 'settings.html'
            };

            menuItems.forEach(item => {
                item.addEventListener('click', function () {
                    menuItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');

                    const menuText = this.querySelector('span').textContent.trim();
                    const targetPage = pageMapping[menuText];

                    if (targetPage && !targetPage.includes('gamified-learning')) {
                        window.location.href = targetPage;
                    }
                });

                item.addEventListener('mouseenter', function () {
                    if (!this.classList.contains('active')) {
                        this.style.backgroundColor = 'rgba(255, 255, 255, 0.15)';
                    }
                });

                item.addEventListener('mouseleave', function () {
                    if (!this.classList.contains('active')) {
                        this.style.backgroundColor = '';
                    }
                });
            });
        }

        // Initialize menu navigation when page loads
        document.addEventListener('DOMContentLoaded', initializeMenuNavigation);

        // Game state variables
        let currentGame = null;
        let quizData = [];
        let currentQuestionIndex = 0;
        let quizScore = 0;
        let selectedAnswer = null;

        // DisasterPoly game variables
        let currentPlayer = 1;
        let player1 = { position: 0, score: 0, lives: 3 };
        let player2 = { position: 0, score: 0, lives: 3 };

        // Quiz questions data
        const quizQuestions = [
            {
                question: "What is the most important thing to do during an earthquake?",
                options: ["Run outside immediately", "Drop, cover, and hold on", "Stand in a doorway", "Look for the nearest exit"],
                correct: 1,
                points: 10
            },
            {
                question: "How many days of water should you store for emergency preparedness?",
                options: ["1 day", "3 days", "7 days", "14 days"],
                correct: 1,
                points: 10
            },
            {
                question: "What is the emergency number in India?",
                options: ["911", "100", "112", "108"],
                correct: 2,
                points: 5
            },
            {
                question: "During a flood, you should:",
                options: ["Drive through flood water", "Walk through moving water", "Move to higher ground", "Stay in the basement"],
                correct: 2,
                points: 15
            },
            {
                question: "What does CPR stand for?",
                options: ["Cardiac Pulse Recovery", "Cardiopulmonary Resuscitation", "Critical Patient Response", "Chest Pressure Relief"],
                correct: 1,
                points: 10
            },
            {
                question: "In case of a fire, you should:",
                options: ["Use elevators to escape", "Open windows for fresh air", "Stay low and crawl", "Fight the fire yourself"],
                correct: 2,
                points: 15
            },
            {
                question: "How often should you test your smoke detectors?",
                options: ["Once a year", "Every 6 months", "Once a month", "Never"],
                correct: 2,
                points: 10
            },
            {
                question: "What is the best way to purify water during an emergency?",
                options: ["Let it sit in sunlight", "Boil for 1 minute", "Add salt", "Strain through cloth"],
                correct: 1,
                points: 15
            },
            {
                question: "During a tornado, the safest place is:",
                options: ["In a car", "Basement or interior room", "Near windows", "On the roof"],
                correct: 1,
                points: 20
            },
            {
                question: "What should be in a basic first aid kit?",
                options: ["Only bandages", "Bandages, antiseptic, pain relievers", "Just medicines", "Only emergency numbers"],
                correct: 1,
                points: 10
            }
        ];

        function startDisasterPoly() {
            document.getElementById('disasterPolyGame').style.display = 'block';
            document.getElementById('quizGame').style.display = 'none';
            currentGame = 'disasterpoly';
            initializeBoard();
        }

        function startQuiz() {
            document.getElementById('quizGame').style.display = 'block';
            document.getElementById('disasterPolyGame').style.display = 'none';
            currentGame = 'quiz';
            initializeQuiz();
        }

        function initializeBoard() {
            const board = document.getElementById('gameBoard');
            const squares = [];

            // Create board squares
            const squareTypes = [
                { name: "START", type: "corner" },
                { name: "Flood\nZone", type: "disaster" },
                { name: "Safe\nHouse", type: "safe" },
                { name: "Fire\nAlert", type: "disaster" },
                { name: "Hospital", type: "safe" },
                { name: "Earthquake", type: "disaster" },
                { name: "Emergency\nKit", type: "safe" },
                { name: "SHELTER", type: "corner" },
                { name: "Tornado", type: "disaster" },
                { name: "First Aid", type: "safe" },
                { name: "Landslide", type: "disaster" },
                { name: "Rescue\nTeam", type: "safe" },
                { name: "Hurricane", type: "disaster" },
                { name: "Safe\nZone", type: "safe" },
                { name: "EVACUATION", type: "corner" },
                { name: "Tsunami", type: "disaster" }
            ];

            // Position squares around the board
            for (let i = 0; i < 16; i++) {
                const square = document.createElement('div');
                square.className = `board-square ${squareTypes[i].type}`;
                square.textContent = squareTypes[i].name;
                square.id = `square-${i}`;

                // Position calculation for a square board
                const side = Math.floor(i / 4);
                const pos = i % 4;

                if (side === 0) { // Top
                    square.style.left = `${pos * 120 + 40}px`;
                    square.style.top = '0px';
                } else if (side === 1) { // Right
                    square.style.right = '0px';
                    square.style.top = `${pos * 120 + 40}px`;
                } else if (side === 2) { // Bottom
                    square.style.right = `${pos * 120 + 40}px`;
                    square.style.bottom = '0px';
                } else { // Left
                    square.style.left = '0px';
                    square.style.bottom = `${pos * 120 + 40}px`;
                }

                board.appendChild(square);
            }
        }

        function rollDice() {
            const diceValue = Math.floor(Math.random() * 6) + 1;
            document.getElementById('diceDisplay').textContent = diceValue;

            // Move current player
            const player = currentPlayer === 1 ? player1 : player2;
            player.position = (player.position + diceValue) % 16;

            // Update display
            document.getElementById(`p${currentPlayer}Position`).textContent = player.position;

            // Handle square effects
            handleSquareEffect(player);

            // Update score display
            document.getElementById(`p${currentPlayer}Score`).textContent = player.score;
            document.getElementById(`p${currentPlayer}Lives`).textContent = player.lives;
        }

        function handleSquareEffect(player) {
            const squareElement = document.getElementById(`square-${player.position}`);
            const squareType = squareElement.className.includes('disaster') ? 'disaster' :
                squareElement.className.includes('safe') ? 'safe' : 'corner';

            switch (squareType) {
                case 'disaster':
                    player.lives--;
                    player.score = Math.max(0, player.score - 50);
                    alert(`Disaster! You lost a life and 50 points.`);
                    break;
                case 'safe':
                    player.score += 100;
                    alert(`Safe zone! You gained 100 points.`);
                    break;
                case 'corner':
                    player.score += 200;
                    alert(`Special location! You gained 200 points.`);
                    break;
            }

            if (player.lives <= 0) {
                alert(`Game Over for Player ${currentPlayer}!`);
            }
        }

        function endTurn() {
            currentPlayer = currentPlayer === 1 ? 2 : 1;
            alert(`Player ${currentPlayer}'s turn!`);
        }

        function initializeQuiz() {
            quizData = [...quizQuestions];
            currentQuestionIndex = 0;
            quizScore = 0;
            selectedAnswer = null;

            document.getElementById('totalQuestions').textContent = quizData.length;
            document.getElementById('quizResults').style.display = 'none';
            document.getElementById('questionCard').style.display = 'block';

            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestionIndex >= quizData.length) {
                showQuizResults();
                return;
            }

            const question = quizData[currentQuestionIndex];
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('questionNumber').textContent = currentQuestionIndex + 1;
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('questionPoints').textContent = `+${question.points} points`;

            const optionsGrid = document.getElementById('optionsGrid');
            optionsGrid.innerHTML = '';

            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-button';
                button.textContent = option;
                button.onclick = () => selectAnswer(index);
                optionsGrid.appendChild(button);
            });

            document.getElementById('nextButton').disabled = true;
            selectedAnswer = null;

            // Update progress
            const progress = ((currentQuestionIndex) / quizData.length) * 100;
            document.getElementById('quizProgress').style.width = progress + '%';
        }

        function selectAnswer(answerIndex) {
            const question = quizData[currentQuestionIndex];
            const options = document.querySelectorAll('.option-button');

            // Remove previous selections
            options.forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect');
            });

            // Mark selected answer
            options[answerIndex].classList.add('selected');
            selectedAnswer = answerIndex;

            // Show correct/incorrect after selection
            setTimeout(() => {
                options[question.correct].classList.add('correct');
                if (answerIndex !== question.correct) {
                    options[answerIndex].classList.add('incorrect');
                } else {
                    quizScore += question.points;
                }

                document.getElementById('nextButton').disabled = false;
            }, 500);
        }

        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        function showQuizResults() {
            document.getElementById('questionCard').style.display = 'none';
            document.getElementById('quizResults').style.display = 'block';

            const correctCount = quizData.filter((q, i) => selectedAnswer === q.correct).length;

            document.getElementById('finalScore').textContent = quizScore;
            document.getElementById('correctAnswers').textContent = correctCount;
            document.getElementById('totalAnswered').textContent = quizData.length;

            // Award badges
            const badgesContainer = document.getElementById('badgesEarned');
            badgesContainer.innerHTML = '';

            const badges = [];
            if (quizScore >= 100) badges.push('Quiz Master');
            if (correctCount === quizData.length) badges.push('Perfect Score');
            if (quizScore >= 75) badges.push('Safety Expert');

            badges.forEach(badge => {
                const badgeElement = document.createElement('span');
                badgeElement.className = 'achievement-badge';
                badgeElement.textContent = badge;
                badgesContainer.appendChild(badgeElement);
            });

            // Update progress to 100%
            document.getElementById('quizProgress').style.width = '100%';
        }

        function restartQuiz() {
            initializeQuiz();
        }

        function exitQuiz() {
            document.getElementById('quizGame').style.display = 'none';
            currentGame = null;
        }

        function viewRules() {
            alert(`DisasterPoly Rules:
            
1. Roll the dice to move around the board
2. Landing on disaster squares costs you a life and points
3. Landing on safe zones gives you points
4. Corner squares give bonus points
5. First player to complete 3 rounds wins!
6. If you lose all lives, you're out!
            
Good luck and stay safe!`);
        }

        function viewQuizHistory() {
            alert('Quiz history feature would show your past quiz scores and achievements.');
        }
    </script>
</body>

</html>