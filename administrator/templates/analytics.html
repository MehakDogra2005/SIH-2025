{% extends "base_new.html" %}

{% block title %}Emergency Analytics - Emergency Management System{% endblock %}

{% block page_title %}Emergency Analytics{% endblock %}

{% block extra_css %}
<link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
<style>
    :root {
        /* Student Dashboard Color Palette */
        --primary: #1a73e8;
        --primary-dark: #0d47a1;
        --secondary: #34a853;
        --accent: #f25c54;
        --warning: #f9a825;
        --card-bg: #ffffff;
        --text-dark: #202124;
        --light-bg: #f5f7fb;

        /* Modern Color Palette */
        --p1: #309ad4;
        --p2: #e69c42;
        --p3: #ea8d99;
        --p4: #faafa4;
        --p5: #e2afd3;
        --p6: #c8e5f3;
        --p7: #fae8c7;

        --shadow: 0 8px 20px rgba(18, 38, 63, 0.08);
        --transition: all 0.25s ease;
        --glass: rgba(255, 255, 255, 0.72);
    }

    body {
        background: var(--light-bg);
        color: var(--text-dark);
        font-family: "Ubuntu", sans-serif;
        font-weight: 400;
        font-style: normal;
    }

    /* Override base content wrapper */
    .content-wrapper {
        background: var(--light-bg);
    }

    /* Modern Page Header */
    .page-header {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        padding: 2rem;
        border-radius: 16px;
        color: white;
        margin-bottom: 2rem;
        box-shadow: var(--shadow);
    }

    .page-header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .page-header p {
        font-size: 1.1rem;
        opacity: 0.9;
        margin: 0;
    }

    /* Modern Info Cards */
    .info-card {
        background: var(--card-bg);
        border-radius: 8px;
        padding: 1.5rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: var(--transition);
        border: 1px solid rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
    }

    .info-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    /* Modern Summary Cards with White Background and Black Text */
    .info-card.bg-primary {
        background: white !important;
        border: 1px solid #1a73e8;
        color: #1a73e8 !important;
    }

    .info-card.bg-warning {
        background: white !important;
        border: 1px solid #e69c42;
        color: #e69c42 !important;
    }

    .info-card.bg-success {
        background: white !important;
        border: 1px solid #34a853;
        color: #34a853 !important;
    }

    .info-card.bg-info {
        background: white !important;
        border: 1px solid #309ad4;
        color: #309ad4 !important;
    }

    /* Override text color for card content */
    .info-card .card-title,
    .info-card h6,
    .info-card h2,
    .info-card small {
        color: #202124 !important;
    }

    .info-card .text-warning {
        color: #f9a825 !important;
    }

    .info-card .text-primary {
        color: #1a73e8 !important;
    }

    /* Card Headers */
    .card-header {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        border-radius: 16px 16px 0 0 !important;
        border: none;
        padding: 1.25rem 1.5rem;
    }

    .card-header h5 {
        margin: 0;
        font-weight: 600;
        font-size: 1.1rem;
    }

    .card-title {
        color: white !important;
        font-weight: 600;
    }

    /* Card Body */
    .card-body {
        padding: 1.5rem;
        background: white;
        border-radius: 0 0 16px 16px;
    }

    /* Section Title */
    .section-title {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 1.8rem;
        color: var(--primary);
        padding-bottom: 1rem;
        border-bottom: 2px solid rgba(26, 115, 232, 0.08);
        margin-bottom: 1.5rem;
        font-weight: 600;
    }

    /* Tables */
    .table {
        border-radius: 12px;
        overflow: hidden;
        box-shadow: var(--shadow);
    }

    .table-dark {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    }

    .table-striped > tbody > tr:nth-of-type(odd) > td {
        background-color: rgba(26, 115, 232, 0.02);
    }

    .table-hover > tbody > tr:hover > td {
        background-color: rgba(26, 115, 232, 0.05);
    }

    /* Progress Bars */
    .progress {
        height: 24px;
        border-radius: 12px;
        background-color: rgba(26, 115, 232, 0.1);
        overflow: hidden;
    }

    .progress-bar {
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.85rem;
    }

    .progress-bar.bg-success {
        background: linear-gradient(135deg, var(--secondary), #2ea044) !important;
    }

    .progress-bar.bg-warning {
        background: linear-gradient(135deg, var(--p2), #f2b25e) !important;
    }

    .progress-bar.bg-danger {
        background: linear-gradient(135deg, var(--p3), #f56b77) !important;
    }

    /* Badges */
    .badge {
        border-radius: 8px;
        font-weight: 600;
        padding: 0.5rem 0.75rem;
        font-size: 0.8rem;
    }

    .badge.bg-secondary {
        background: linear-gradient(135deg, var(--p6), var(--p1)) !important;
        color: var(--primary-dark);
    }

    /* Empty State */
    .text-center.text-muted {
        background: rgba(26, 115, 232, 0.02);
        border-radius: 12px;
        padding: 3rem 2rem;
        margin: 1rem 0;
    }

    .text-center.text-muted i {
        color: var(--p1);
        opacity: 0.7;
    }

    /* Buttons */
    .btn {
        border-radius: 10px;
        font-weight: 600;
        padding: 0.75rem 1.5rem;
        transition: var(--transition);
    }

    .btn-warning {
        background: linear-gradient(135deg, var(--p2), #f2b25e);
        border: none;
        color: white;
    }

    .btn-warning:hover {
        background: linear-gradient(135deg, #f2b25e, var(--p2));
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(230, 156, 66, 0.3);
        color: white;
    }

    /* Chart Canvas */
    canvas {
        border-radius: 12px;
    }

    /* Hide top navigation bar completely */
    .top-navbar {
        display: none !important;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .page-header {
            padding: 1.5rem;
            text-align: center;
        }

        .page-header h1 {
            font-size: 2rem;
        }

        .info-card {
            padding: 1rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-content">
    <!-- Modern Page Header -->
    <div class="page-header">
        <h1><i class="fas fa-chart-line me-3"></i>Emergency Analytics</h1>
        <p>Comprehensive analysis of emergency management data with real-time insights</p>
    </div>
    
    <!-- Summary Cards with Modern Design -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="info-card bg-primary">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-2">Total Incidents</h6>
                            <h2 class="mb-0 fw-bold">
                                {% if analytics.incident_types %}
                                    {{ analytics.incident_types.values() | list | sum }}
                                {% else %}
                                    <span class="text-warning">No Data</span>
                                {% endif %}
                            </h2>
                            <small>
                                {% if analytics.incident_types %}
                                    Across {{ analytics.incident_types.keys() | list | length }} categories
                                {% else %}
                                    Start by reporting incidents
                                {% endif %}
                            </small>
                        </div>
                        <div class="align-self-center">
                            <div style="width: 60px; height: 60px; background: rgba(26, 115, 232, 0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-exclamation-triangle fa-2x" style="color: #1a73e8;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="info-card bg-warning">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-2">Total Drills</h6>
                            <h2 class="mb-0 fw-bold">
                                {% if analytics.drill_stats %}
                                    {{ analytics.drill_stats | length }}
                                {% else %}
                                    <span class="text-primary">No Data</span>
                                {% endif %}
                            </h2>
                            <small>
                                {% if analytics.drill_stats %}
                                    Emergency preparedness training
                                {% else %}
                                    Create emergency drills
                                {% endif %}
                            </small>
                        </div>
                        <div class="align-self-center">
                            <div style="width: 60px; height: 60px; background: rgba(230, 156, 66, 0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-users-cog fa-2x" style="color: #e69c42;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="info-card bg-success">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-2">Avg Drill Score</h6>
                            <h2 class="mb-0 fw-bold">
                                {% if analytics.drill_stats %}
                                    {{ "%.1f" | format((analytics.drill_stats | map(attribute='avg_score') | list | sum) / (analytics.drill_stats | length)) }}%
                                {% else %}
                                    <span class="text-warning">No Data</span>
                                {% endif %}
                            </h2>
                            <small>
                                {% if analytics.drill_stats %}
                                    Performance metric
                                {% else %}
                                    Conduct drills to see scores
                                {% endif %}
                            </small>
                        </div>
                        <div class="align-self-center">
                            <div style="width: 60px; height: 60px; background: rgba(52, 168, 83, 0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-chart-line fa-2x" style="color: #34a853;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="info-card bg-info">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-2">Active Cases</h6>
                            <h2 class="mb-0 fw-bold">
                                {% if analytics.incident_status %}
                                    {{ analytics.incident_status.get('open', 0) + analytics.incident_status.get('acknowledged', 0) + analytics.incident_status.get('assigned', 0) }}
                                {% else %}
                                    <span class="text-warning">No Data</span>
                                {% endif %}
                            </h2>
                            <small>
                                {% if analytics.incident_status %}
                                    Pending resolution
                                {% else %}
                                    No active incidents
                                {% endif %}
                            </small>
                        </div>
                        <div class="align-self-center">
                            <div style="width: 60px; height: 60px; background: rgba(48, 154, 212, 0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-clock fa-2x" style="color: #309ad4;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row with Modern Design -->
    <div class="row mb-5">
        <!-- Incident Types Chart -->
        <div class="col-lg-6 mb-4">
            <div class="info-card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-pie me-2"></i>
                        Incidents by Type
                    </h5>
                </div>
                <div class="card-body">
                    {% if analytics.incident_types %}
                        <div class="mb-3">
                            <p class="text-muted small mb-2">
                                <i class="fas fa-info-circle me-1"></i>
                                This chart shows the distribution of different types of incidents reported. 
                                Hover over each section to see detailed information including count and percentage.
                            </p>
                        </div>
                        <div style="height: 250px; display: flex; align-items: center; justify-content: center;">
                            <canvas id="incidentTypesChart"></canvas>
                        </div>
                    {% else %}
                        <div class="text-center text-muted py-5">
                            <i class="fas fa-chart-pie fa-4x mb-4" style="color: #c8e5f3;"></i>
                            <h5 class="mb-3">No Incident Data Available</h5>
                            <p class="mb-4">Start tracking incidents to see detailed analytics and trends</p>
                            <a href="{{ url_for('create_incident') }}" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>Report First Incident
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Incident Status Chart -->
        <div class="col-lg-6 mb-4">
            <div class="info-card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-donut me-2"></i>
                        Incidents by Status
                    </h5>
                </div>
                <div class="card-body">
                    {% if analytics.incident_status %}
                        <div class="mb-3">
                            <p class="text-muted small mb-2">
                                <i class="fas fa-info-circle me-1"></i>
                                This chart displays the current status of all incidents. Each section represents 
                                how many incidents are open, resolved, or in progress. Legend shows exact counts and percentages.
                            </p>
                        </div>
                        <div style="height: 250px; display: flex; align-items: center; justify-content: center;">
                            <canvas id="incidentStatusChart"></canvas>
                        </div>
                    {% else %}
                        <div class="text-center text-muted py-5">
                            <i class="fas fa-chart-donut fa-4x mb-4" style="color: #c8e5f3;"></i>
                            <h5 class="mb-3">No Status Data Available</h5>
                            <p class="mb-4">Incident status tracking will appear here once you have reported incidents</p>
                            <a href="{{ url_for('incidents') }}" class="btn btn-outline-primary">
                                <i class="fas fa-eye me-2"></i>View All Incidents
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Monthly Trends with Enhanced Design -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="info-card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-area me-2"></i>
                        Monthly Incident Trends
                    </h5>
                </div>
                <div class="card-body">
                    {% if analytics.monthly_incidents %}
                        <canvas id="monthlyTrendsChart" height="100"></canvas>
                    {% else %}
                        <div class="text-center text-muted py-5">
                            <i class="fas fa-chart-area fa-4x mb-4" style="color: #c8e5f3;"></i>
                            <h5 class="mb-3">No Monthly Trend Data Available</h5>
                            <p class="mb-4">Historical incident patterns and trends will appear here as data accumulates over time</p>
                            <div class="row justify-content-center">
                                <div class="col-auto">
                                    <a href="{{ url_for('create_incident') }}" class="btn btn-primary me-2">
                                        <i class="fas fa-plus me-2"></i>Report Incident
                                    </a>
                                    <a href="{{ url_for('incidents') }}" class="btn btn-outline-primary">
                                        <i class="fas fa-list me-2"></i>View History
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Drill Statistics Table with Modern Design -->
    <div class="row">
        <div class="col-12">
            <div class="info-card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-table me-2"></i>
                        Drill Performance Statistics
                    </h5>
                </div>
                <div class="card-body">
                    {% if analytics.drill_stats %}
                    <div class="table-responsive">
                        <table class="table table-striped table-hover mb-0">
                            <thead class="table-dark">
                                <tr>
                                    <th class="border-0"><i class="fas fa-tag me-2"></i>Drill Type</th>
                                    <th class="border-0"><i class="fas fa-hashtag me-2"></i>Total Drills</th>
                                    <th class="border-0"><i class="fas fa-star me-2"></i>Average Score</th>
                                    <th class="border-0"><i class="fas fa-chart-bar me-2"></i>Performance</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for stat in analytics.drill_stats %}
                                <tr>
                                    <td>
                                        <span class="badge bg-secondary me-2">
                                            {{ stat.type.title() }}
                                        </span>
                                    </td>
                                    <td class="fw-semibold">{{ stat.total }}</td>
                                    <td class="fw-semibold">{{ stat.avg_score }}%</td>
                                    <td>
                                        <div class="progress" style="height: 24px;">
                                            <div class="progress-bar 
                                                {% if stat.avg_score >= 80 %}bg-success
                                                {% elif stat.avg_score >= 60 %}bg-warning
                                                {% else %}bg-danger{% endif %}" 
                                                role="progressbar" 
                                                style="width: {{ stat.avg_score }}%"
                                                aria-valuenow="{{ stat.avg_score }}" 
                                                aria-valuemin="0" 
                                                aria-valuemax="100">
                                                {{ stat.avg_score }}%
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center text-muted py-5">
                        <i class="fas fa-table fa-4x mb-4" style="color: #c8e5f3;"></i>
                        <h5 class="mb-3">No Drill Statistics Available</h5>
                        <p class="mb-4">Create and conduct emergency drills to track performance metrics and analyze preparedness levels</p>
                        <div class="row justify-content-center">
                            <div class="col-auto">
                                <a href="{{ url_for('create_drill') }}" class="btn btn-warning me-2">
                                    <i class="fas fa-plus me-2"></i>Create First Drill
                                </a>
                                <a href="{{ url_for('drills') }}" class="btn btn-outline-warning">
                                    <i class="fas fa-list me-2"></i>View Drills
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Modern Chart Configuration
    Chart.defaults.font.family = 'Ubuntu, sans-serif';
    Chart.defaults.font.size = 12;
    Chart.defaults.plugins.legend.labels.usePointStyle = true;
    Chart.defaults.plugins.legend.labels.padding = 20;

    // Modern Color Palette from Student Dashboard
    const modernColors = {
        primary: ['#1a73e8', '#0d47a1'],
        secondary: ['#34a853', '#2ea044'],
        accent: ['#f25c54', '#ea4335'],
        warning: ['#f9a825', '#e65100'],
        info: ['#309ad4', '#2f8fc1'],
        palette: ['#309ad4', '#e69c42', '#ea8d99', '#faafa4', '#e2afd3', '#c8e5f3', '#fae8c7']
    };

    // Chart Data
    {% if analytics.incident_types %}
    const incidentTypesData = {
        labels: {{ analytics.incident_types.keys() | list | tojson }},
        datasets: [{
            data: {{ analytics.incident_types.values() | list | tojson }},
            backgroundColor: modernColors.palette,
            borderWidth: 2,
            borderColor: '#f8f9fa',
            hoverBorderWidth: 3,
            hoverBorderColor: '#dee2e6'
        }]
    };

    new Chart(document.getElementById('incidentTypesChart'), {
        type: 'doughnut',
        data: incidentTypesData,
        options: {
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1.2,
            cutout: '50%',
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 15,
                        font: { size: 12, weight: '500' },
                        usePointStyle: true,
                        pointStyle: 'circle',
                        generateLabels: function(chart) {
                            const data = chart.data;
                            if (data.labels.length && data.datasets.length) {
                                const dataset = data.datasets[0];
                                const total = dataset.data.reduce((a, b) => a + b, 0);
                                return data.labels.map((label, i) => {
                                    const value = dataset.data[i];
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return {
                                        text: `${label}: ${value} (${percentage}%)`,
                                        fillStyle: dataset.backgroundColor[i],
                                        strokeStyle: dataset.borderColor,
                                        lineWidth: dataset.borderWidth,
                                        hidden: false,
                                        index: i
                                    };
                                });
                            }
                            return [];
                        }
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.parsed;
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((value / total) * 100).toFixed(1);
                            return `${label}: ${value} incidents (${percentage}%)`;
                        },
                        afterLabel: function(context) {
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            return `Total Incidents: ${total}`;
                        }
                    },
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    titleColor: '#ffffff',
                    bodyColor: '#ffffff',
                    borderColor: '#dee2e6',
                    borderWidth: 1,
                    cornerRadius: 6,
                    displayColors: true
                }
            },
            elements: {
                arc: {
                    borderWidth: 2,
                    borderColor: '#f8f9fa'
                }
            }
        }
    });
    {% endif %}

    {% if analytics.incident_status %}
    const incidentStatusData = {
        labels: {{ analytics.incident_status.keys() | list | tojson }},
        datasets: [{
            data: {{ analytics.incident_status.values() | list | tojson }},
            backgroundColor: modernColors.palette.slice(0, {{ analytics.incident_status | length }}),
            borderWidth: 2,
            borderColor: '#f8f9fa',
            hoverBorderWidth: 3,
            hoverBorderColor: '#dee2e6'
        }]
    };

    new Chart(document.getElementById('incidentStatusChart'), {
        type: 'pie',
        data: incidentStatusData,
        options: {
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1.2,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 15,
                        font: { size: 12, weight: '500' },
                        usePointStyle: true,
                        pointStyle: 'circle',
                        generateLabels: function(chart) {
                            const data = chart.data;
                            if (data.labels.length && data.datasets.length) {
                                const dataset = data.datasets[0];
                                const total = dataset.data.reduce((a, b) => a + b, 0);
                                return data.labels.map((label, i) => {
                                    const value = dataset.data[i];
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return {
                                        text: `${label.charAt(0).toUpperCase() + label.slice(1)}: ${value} (${percentage}%)`,
                                        fillStyle: dataset.backgroundColor[i],
                                        strokeStyle: dataset.borderColor,
                                        lineWidth: dataset.borderWidth,
                                        hidden: false,
                                        index: i
                                    };
                                });
                            }
                            return [];
                        }
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.parsed;
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((value / total) * 100).toFixed(1);
                            return `${label.charAt(0).toUpperCase() + label.slice(1)}: ${value} cases (${percentage}%)`;
                        },
                        afterLabel: function(context) {
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            return `Total Cases: ${total}`;
                        }
                    },
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    titleColor: '#ffffff',
                    bodyColor: '#ffffff',
                    borderColor: '#dee2e6',
                    borderWidth: 1,
                    cornerRadius: 6,
                    displayColors: true
                }
            },
            elements: {
                arc: {
                    borderWidth: 2,
                    borderColor: '#f8f9fa'
                }
            }
        }
    });
    {% endif %}

    {% if analytics.monthly_incidents %}
    const monthlyTrendsData = {
        labels: {{ analytics.monthly_incidents | map(attribute='month') | list | tojson }},
        datasets: [{
            label: 'Incidents',
            data: {{ analytics.monthly_incidents | map(attribute='count') | list | tojson }},
            borderColor: modernColors.primary[0],
            backgroundColor: 'rgba(26, 115, 232, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointBackgroundColor: modernColors.primary[0],
            pointBorderColor: '#ffffff',
            pointBorderWidth: 2,
            pointRadius: 6
        }]
    };

    new Chart(document.getElementById('monthlyTrendsChart'), {
        type: 'line',
        data: monthlyTrendsData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(0,0,0,0.05)'
                    },
                    ticks: {
                        font: { size: 12 }
                    }
                },
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        font: { size: 12 }
                    }
                }
            }
        }
    });
    {% endif %}

    // Add subtle animations on load
    document.addEventListener('DOMContentLoaded', function() {
        const cards = document.querySelectorAll('.info-card');
        cards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            setTimeout(() => {
                card.style.transition = 'all 0.5s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });
    });
</script>
{% endblock %}
