{% extends "base.html" %}

{% block title %}Emergency Contacts - Emergency Management System{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="display-6 fw-bold text-primary">
                        <i class="fas fa-phone me-3"></i>Emergency Contacts Directory
                    </h1>
                    <p class="text-muted mb-0">Quick access to emergency services and response teams</p>
                </div>
                <div>
                    {% if session.user_role in ['admin', 'spoc'] %}
                    <a href="{{ url_for('create_contact') }}" class="btn btn-primary btn-lg">
                        <i class="fas fa-plus-circle me-2"></i>Add Contact
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Access Emergency Numbers -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-danger text-white">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-exclamation-triangle me-2"></i>Emergency Hotlines - Call Immediately
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <div class="text-center">
                                <a href="tel:112" class="btn btn-light btn-lg w-100 text-danger fw-bold">
                                    <i class="fas fa-phone fa-2x d-block mb-2"></i>
                                    <div class="h4 mb-1">112</div>
                                    <small>National Emergency</small>
                                </a>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <a href="tel:101" class="btn btn-light btn-lg w-100 text-danger fw-bold">
                                    <i class="fas fa-fire fa-2x d-block mb-2"></i>
                                    <div class="h4 mb-1">101</div>
                                    <small>Fire Department</small>
                                </a>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <a href="tel:100" class="btn btn-light btn-lg w-100 text-danger fw-bold">
                                    <i class="fas fa-shield-alt fa-2x d-block mb-2"></i>
                                    <div class="h4 mb-1">100</div>
                                    <small>Police</small>
                                </a>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <a href="tel:108" class="btn btn-light btn-lg w-100 text-danger fw-bold">
                                    <i class="fas fa-ambulance fa-2x d-block mb-2"></i>
                                    <div class="h4 mb-1">108</div>
                                    <small>Ambulance</small>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Search and Filter -->
    <div class="row mb-4">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-body">
                    <div class="row g-3 align-items-end">
                        <div class="col-md-4">
                            <label class="form-label fw-600">Search Contacts</label>
                            <input type="text" class="form-control" id="searchInput" 
                                   placeholder="Search by name, organization, role...">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-600">Filter by Role</label>
                            <select class="form-select" id="roleFilter" onchange="filterContacts()">
                                <option value="">All Roles</option>
                                <option value="fire">Fire Department</option>
                                <option value="police">Police</option>
                                <option value="ambulance">Medical/Ambulance</option>
                                <option value="NDRF">NDRF</option>
                                <option value="hospital">Hospital</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-600">Filter by Region</label>
                            <select class="form-select" id="regionFilter" onchange="filterContacts()">
                                <option value="">All Regions</option>
                                <option value="central">Central District</option>
                                <option value="north">Northern Region</option>
                                <option value="south">Southern Region</option>
                                <option value="east">Eastern Region</option>
                                <option value="west">Western Region</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-outline-primary w-100" onclick="exportContacts()">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card bg-light">
                <div class="card-body text-center">
                    <h6 class="fw-bold mb-3">Quick Stats</h6>
                    <div class="row text-center">
                        <div class="col-3">
                            <div class="text-primary">
                                <i class="fas fa-fire fa-2x"></i>
                                <div class="fw-bold mt-1">{{ contacts|selectattr('role', 'equalto', 'fire')|list|length }}</div>
                                <small class="text-muted">Fire</small>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="text-info">
                                <i class="fas fa-shield-alt fa-2x"></i>
                                <div class="fw-bold mt-1">{{ contacts|selectattr('role', 'equalto', 'police')|list|length }}</div>
                                <small class="text-muted">Police</small>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="text-success">
                                <i class="fas fa-ambulance fa-2x"></i>
                                <div class="fw-bold mt-1">{{ contacts|selectattr('role', 'equalto', 'ambulance')|list|length }}</div>
                                <small class="text-muted">Medical</small>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="text-warning">
                                <i class="fas fa-users fa-2x"></i>
                                <div class="fw-bold mt-1">{{ contacts|selectattr('role', 'equalto', 'NDRF')|list|length }}</div>
                                <small class="text-muted">NDRF</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contacts Grid -->
    <div class="row" id="contactsGrid">
        {% if contacts %}
        {% for contact in contacts %}
        <div class="col-lg-4 col-md-6 mb-4 contact-card" data-role="{{ contact.role }}" data-region="{{ contact.region.lower().replace(' ', '') if contact.region else '' }}">
            <div class="card h-100 shadow-sm border-0">
                <div class="card-header 
                    {% if contact.role == 'fire' %}bg-danger text-white
                    {% elif contact.role == 'police' %}bg-primary text-white
                    {% elif contact.role == 'ambulance' %}bg-success text-white
                    {% elif contact.role == 'NDRF' %}bg-warning text-dark
                    {% elif contact.role == 'hospital' %}bg-info text-white
                    {% else %}bg-secondary text-white{% endif %}">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            {% if contact.role == 'fire' %}
                                <i class="fas fa-fire me-2"></i>Fire Department
                            {% elif contact.role == 'police' %}
                                <i class="fas fa-shield-alt me-2"></i>Police
                            {% elif contact.role == 'ambulance' %}
                                <i class="fas fa-ambulance me-2"></i>Medical Services
                            {% elif contact.role == 'NDRF' %}
                                <i class="fas fa-users me-2"></i>NDRF
                            {% elif contact.role == 'hospital' %}
                                <i class="fas fa-hospital me-2"></i>Hospital
                            {% else %}
                                <i class="fas fa-phone me-2"></i>{{ contact.role.title() }}
                            {% endif %}
                        </h6>
                        <div class="btn-group btn-group-sm">
                            <a href="tel:{{ contact.phone }}" class="btn btn-light btn-sm" title="Call">
                                <i class="fas fa-phone text-success"></i>
                            </a>
                            {% if contact.email %}
                            <a href="mailto:{{ contact.email }}" class="btn btn-light btn-sm" title="Email">
                                <i class="fas fa-envelope text-primary"></i>
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title fw-bold">{{ contact.name }}</h5>
                    {% if contact.organization %}
                    <p class="text-muted mb-2">{{ contact.organization }}</p>
                    {% endif %}
                    
                    <div class="contact-details">
                        <div class="mb-2">
                            <i class="fas fa-phone text-success me-2"></i>
                            <a href="tel:{{ contact.phone }}" class="text-decoration-none fw-600">
                                {{ contact.phone }}
                            </a>
                        </div>
                        
                        {% if contact.email %}
                        <div class="mb-2">
                            <i class="fas fa-envelope text-primary me-2"></i>
                            <a href="mailto:{{ contact.email }}" class="text-decoration-none small">
                                {{ contact.email }}
                            </a>
                        </div>
                        {% endif %}
                        
                        {% if contact.region %}
                        <div class="mb-2">
                            <i class="fas fa-map-marker-alt text-info me-2"></i>
                            <span class="small">{{ contact.region }}</span>
                        </div>
                        {% endif %}
                        
                        {% if contact.address %}
                        <div class="mb-2">
                            <i class="fas fa-location-arrow text-secondary me-2"></i>
                            <span class="small">{{ contact.address[:50] }}{% if contact.address|length > 50 %}...{% endif %}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
                <div class="card-footer bg-light">
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">
                            <i class="fas fa-clock me-1"></i>
                            Added {{ contact.created_at.strftime('%Y-%m-%d') if contact.created_at else 'Unknown' }}
                        </small>
                        {% if session.user_role in ['admin', 'spoc'] %}
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" title="Edit" 
                                    onclick="editContact({{ contact.id }})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline-danger" title="Delete" 
                                    onclick="deleteContact({{ contact.id }})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="col-12">
            <div class="card">
                <div class="card-body text-center py-5">
                    <i class="fas fa-address-book fa-4x text-muted mb-3"></i>
                    <h5 class="text-muted">No emergency contacts found</h5>
                    <p class="text-muted mb-4">No emergency contacts have been added to the directory yet</p>
                    {% if session.user_role in ['admin', 'spoc'] %}
                    <a href="{{ url_for('create_contact') }}" class="btn btn-primary">
                        <i class="fas fa-plus-circle me-2"></i>Add First Contact
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Emergency Procedures -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                        <i class="fas fa-exclamation-triangle me-2"></i>Emergency Contact Procedures
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="fw-bold text-danger">
                                <i class="fas fa-fire me-2"></i>Fire Emergency
                            </h6>
                            <ol class="small">
                                <li>Call Fire Department (101) immediately</li>
                                <li>Evacuate building using nearest exit</li>
                                <li>Do not use elevators</li>
                                <li>Report to assembly point</li>
                                <li>Wait for further instructions</li>
                            </ol>
                        </div>
                        <div class="col-md-6">
                            <h6 class="fw-bold text-warning">
                                <i class="fas fa-mountain me-2"></i>Earthquake
                            </h6>
                            <ol class="small">
                                <li>Drop, cover, and hold on</li>
                                <li>Stay away from windows and heavy objects</li>
                                <li>If outdoors, move away from buildings</li>
                                <li>After shaking stops, evacuate if safe</li>
                                <li>Call emergency services if needed</li>
                            </ol>
                        </div>
                        <div class="col-md-6">
                            <h6 class="fw-bold text-success">
                                <i class="fas fa-ambulance me-2"></i>Medical Emergency
                            </h6>
                            <ol class="small">
                                <li>Call Ambulance (108) immediately</li>
                                <li>Provide first aid if trained</li>
                                <li>Keep patient calm and comfortable</li>
                                <li>Clear airway if necessary</li>
                                <li>Stay with patient until help arrives</li>
                            </ol>
                        </div>
                        <div class="col-md-6">
                            <h6 class="fw-bold text-primary">
                                <i class="fas fa-shield-alt me-2"></i>Security Threat
                            </h6>
                            <ol class="small">
                                <li>Call Police (100) immediately</li>
                                <li>Move to secure location</li>
                                <li>Lock doors and windows</li>
                                <li>Stay quiet and hidden</li>
                                <li>Follow official instructions only</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Search functionality
document.getElementById('searchInput').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const contactCards = document.querySelectorAll('.contact-card');
    
    contactCards.forEach(card => {
        const text = card.textContent.toLowerCase();
        if (text.includes(searchTerm)) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
});

// Filter contacts
function filterContacts() {
    const roleFilter = document.getElementById('roleFilter').value;
    const regionFilter = document.getElementById('regionFilter').value;
    const contactCards = document.querySelectorAll('.contact-card');
    
    contactCards.forEach(card => {
        let showCard = true;
        
        if (roleFilter && card.dataset.role !== roleFilter) {
            showCard = false;
        }
        
        if (regionFilter && card.dataset.region !== regionFilter) {
            showCard = false;
        }
        
        card.style.display = showCard ? 'block' : 'none';
    });
}

// Edit contact
function editContact(contactId) {
    // In a real app, this would open an edit modal
    showAlert('Edit functionality would open here', 'info');
}

// Delete contact
function deleteContact(contactId) {
    if (confirm('Are you sure you want to delete this contact?')) {
        // In a real app, this would send a delete request
        showAlert('Contact deleted successfully', 'success');
    }
}

// Export contacts
function exportContacts() {
    // In a real app, this would export to CSV/PDF
    showAlert('Contacts exported successfully', 'success');
}

// Quick call functionality
function quickCall(number, name) {
    if (confirm(`Call ${name} at ${number}?`)) {
        window.location.href = `tel:${number}`;
    }
}
</script>
{% endblock %}
